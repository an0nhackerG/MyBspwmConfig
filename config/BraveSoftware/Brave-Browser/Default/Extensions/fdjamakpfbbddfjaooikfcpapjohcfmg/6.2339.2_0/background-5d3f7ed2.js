/*! For license information please see background-5d3f7ed2.js.LICENSE.txt */
(self.webpackChunk_dashlane_amphora=self.webpackChunk_dashlane_amphora||[]).push([[433],{16946:(e,t,r)=>{"use strict";var s;r.d(t,{O:()=>s}),function(e){e.PopupCarbon="Popup",e.PopupCarbonLoader="PopupCarbonLoader",e.OptionsCarbon="OptionsCarbon",e.WebappCarbon="leeloo"}(s||(s={}))},13186:(e,t,r)=>{"use strict";r.d(t,{P:()=>u,y:()=>c});r(86847),r(4473),r(68126),r(41437),r(24814),r(71632),r(75815),r(73636),r(55566),r(72029),r(2165),r(296),r(30094),r(83746),r(37944),r(32721),r(55402),r(22250),r(92665),r(88737);function s(e){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s(e)}function a(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,(n=a.key,i=void 0,i=function(e,t){if("object"!==s(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!==s(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(n,"string"),"symbol"===s(i)?i:String(i)),a)}var n,i}function n(e,t){return n=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},n(e,t)}function i(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,a=o(e);if(t){var n=o(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return function(e,t){if(t&&("object"===s(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,r)}}function o(e){return o=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},o(e)}var c=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&n(e,t)}(c,e);var t,r,s,o=i(c);function c(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c);for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];return(e=o.call.apply(o,[this].concat(r))).isConnected=!1,e.onMessage=null,e}return t=c,(r=[{key:"connect",value:function(e){this.onMessage=function(t){e.receive(t)},this.isConnected=!0,this._connected()}},{key:"receive",value:function(e){this._messageReceived(e)}},{key:"send",value:function(e){if(!this.isConnected)throw new Error("Channel not connected");if(!this.onMessage)throw new Error("onMessage handler not set");this.onMessage(e)}}])&&a(t.prototype,r),s&&a(t,s),Object.defineProperty(t,"prototype",{writable:!1}),c}(r(71796).GenericChannel),u=function(e,t){e.connect(t),t.connect(e)}},89515:(e,t,r)=>{"use strict";r.d(t,{Y:()=>l});r(37391),r(38298),r(4473),r(68126),r(22250),r(26589),r(75815),r(92665),r(88737),r(2191),r(75986),r(41437),r(24814),r(71632),r(73636),r(55566),r(72029),r(2165),r(296),r(30094),r(83746),r(37944),r(32721),r(55402);var s=r(71796),a=r(18511),n=r(20500);function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}function o(e,t){for(var r=0;r<t.length;r++){var s=t[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,(a=s.key,n=void 0,n=function(e,t){if("object"!==i(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var s=r.call(e,t||"default");if("object"!==i(s))return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(a,"string"),"symbol"===i(n)?n:String(n)),s)}var a,n}function c(e,t){return c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},c(e,t)}function u(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,s=d(e);if(t){var a=d(this).constructor;r=Reflect.construct(s,arguments,a)}else r=s.apply(this,arguments);return function(e,t){if(t&&("object"===i(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,r)}}function d(e){return d=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},d(e)}var l=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&c(e,t)}(d,e);var t,r,s,i=u(d);function d(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,d),(t=i.call(this,r)).name=void 0,t.currentPorts=void 0,t.onConnectListener=function(e){if(e.name.startsWith(t.name)){if(t.currentPorts.has(e.name))throw new Error("Port already connected");if(!(0,a.k)(e))throw new Error("Sender origin not trusted");t.setup(e)}},t.onDisconnectListener=function(e){n.b.removeListener(t.onConnectListener);var r=t.currentPorts.get(e.name);if(r&&(r.onMessage.removeListener(t.onMessageListener),r.onDisconnect.removeListener(t.onDisconnectListener),t.currentPorts.delete(e.name)),t._disconnected(),chrome.runtime.lastError){var s,a=null!=(s=chrome.runtime.lastError.message)?s:"Unknown chrome.runtime.lastError";throw new Error(a)}},t.onMessageListener=function(e){t._messageReceived(e)},t.name=e,t.currentPorts=new Map,t}return t=d,(r=[{key:"connect",value:function(){n.b.addListener(this.onConnectListener)}},{key:"autoReconnect",value:function(){this.connect()}},{key:"send",value:function(e){if(!this.currentPorts.size)throw new Error("No port to send message");this.currentPorts.forEach((function(t){return t.postMessage(e)}))}},{key:"setup",value:function(e){var t=this.currentPorts.get(e.name);t&&(t.disconnect(),this.onDisconnectListener(t)),e.onMessage.addListener(this.onMessageListener),e.onDisconnect.addListener(this.onDisconnectListener),this.currentPorts.set(e.name,e),this._connected()}}])&&o(t.prototype,r),s&&o(t,s),Object.defineProperty(t,"prototype",{writable:!1}),d}(s.GenericChannel)},97875:(e,t,r)=>{"use strict";r.d(t,{s:()=>l});r(37391),r(4473),r(68126),r(41437),r(24814),r(71632),r(75815),r(73636),r(55566),r(72029),r(2165),r(296),r(30094),r(83746),r(37944),r(32721),r(55402),r(22250),r(92665),r(88737);var s=r(71796),a=r(18511),n=r(20500);function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}function o(e,t){for(var r=0;r<t.length;r++){var s=t[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,(a=s.key,n=void 0,n=function(e,t){if("object"!==i(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var s=r.call(e,t||"default");if("object"!==i(s))return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(a,"string"),"symbol"===i(n)?n:String(n)),s)}var a,n}function c(e,t){return c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},c(e,t)}function u(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,s=d(e);if(t){var a=d(this).constructor;r=Reflect.construct(s,arguments,a)}else r=s.apply(this,arguments);return function(e,t){if(t&&("object"===i(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,r)}}function d(e){return d=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},d(e)}var l=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&c(e,t)}(d,e);var t,r,s,i=u(d);function d(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,d),(t=i.call(this,r)).name=void 0,t.port=void 0,t.onConnectListener=function(e){if(e.name===t.name){if(!(0,a.k)(e))throw new Error("Sender origin not trusted");t.setup(e)}},t.onDisconnectListener=function(){if(n.b.removeListener(t.onConnectListener),t.port&&(t.port.onMessage.removeListener(t.onMessageListener),t.port.onDisconnect.removeListener(t.onDisconnectListener),t.port=void 0),t._disconnected(),chrome.runtime.lastError){var e,r=null!=(e=chrome.runtime.lastError.message)?e:"Unknown chrome.runtime.lastError";throw new Error(r)}},t.onMessageListener=function(e){t._messageReceived(e)},t.name=e,t}return t=d,(r=[{key:"connect",value:function(){this.port&&(this.port.disconnect(),this.onDisconnectListener()),n.b.addListener(this.onConnectListener)}},{key:"autoReconnect",value:function(){this.connect()}},{key:"send",value:function(e){if(!this.port)throw new Error("No port to send message");this.port.postMessage(e)}},{key:"setup",value:function(e){this.port=e,this.port.onMessage.addListener(this.onMessageListener),this.port.onDisconnect.addListener(this.onDisconnectListener),this._connected()}}])&&o(t.prototype,r),s&&o(t,s),Object.defineProperty(t,"prototype",{writable:!1}),d}(s.GenericChannel)},18511:(e,t,r)=>{"use strict";r.d(t,{k:()=>i});r(22250),r(75815),r(92665),r(88737),r(23389),r(21675),r(37853),r(35758),r(82312);var s=r(92204),a=["safari-mv2-converted","5P72E3GC48"];function n(e){var t=function(e){var t,r,s,a,n,i,o;return null!=(t=null===(r=e.sender)||void 0===r?void 0:r.origin)?t:new URL(null!=(s=null!=(a=null===(n=e.sender)||void 0===n?void 0:n.url)?a:null===(i=e.sender)||void 0===i||null===(o=i.tab)||void 0===o?void 0:o.url)?s:"").origin}(e);return new URL((0,s.A)("")).origin===t}function i(e){return!!function(e){var t,r,s=null!=(t=null===(r=e.sender)||void 0===r?void 0:r.id)?t:"";return a.some((function(e){return s.includes(e)}))}(e)||!!n(e)}},70920:(e,t,r)=>{"use strict";r.d(t,{D:()=>y});r(75815),r(45749),r(23041),r(22250),r(92665),r(88737),r(2165),r(83746),r(37944),r(55402),r(97979),r(38509),r(95665),r(41533),r(72029),r(71632),r(2191),r(4473),r(68126),r(75986),r(37391),r(41437),r(5744),r(18549),r(15442);var s=r(30754),a=r(82324),n=r(81805);function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}function o(){o=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,s=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},n=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function d(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{d({},"")}catch(e){d=function(e,t,r){return e[t]=r}}function l(e,t,r,a){var n=t&&t.prototype instanceof m?t:m,i=Object.create(n.prototype),o=new x(a||[]);return s(i,"_invoke",{value:E(e,r,o)}),i}function p(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=l;var h={};function m(){}function y(){}function g(){}var v={};d(v,n,(function(){return this}));var f=Object.getPrototypeOf,w=f&&f(f(R([])));w&&w!==t&&r.call(w,n)&&(v=w);var S=g.prototype=m.prototype=Object.create(v);function _(e){["next","throw","return"].forEach((function(t){d(e,t,(function(e){return this._invoke(t,e)}))}))}function b(e,t){function a(s,n,o,c){var u=p(e[s],e,n);if("throw"!==u.type){var d=u.arg,l=d.value;return l&&"object"==i(l)&&r.call(l,"__await")?t.resolve(l.__await).then((function(e){a("next",e,o,c)}),(function(e){a("throw",e,o,c)})):t.resolve(l).then((function(e){d.value=e,o(d)}),(function(e){return a("throw",e,o,c)}))}c(u.arg)}var n;s(this,"_invoke",{value:function(e,r){function s(){return new t((function(t,s){a(e,r,t,s)}))}return n=n?n.then(s,s):s()}})}function E(e,t,r){var s="suspendedStart";return function(a,n){if("executing"===s)throw new Error("Generator is already running");if("completed"===s){if("throw"===a)throw n;return I()}for(r.method=a,r.arg=n;;){var i=r.delegate;if(i){var o=A(i,r);if(o){if(o===h)continue;return o}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===s)throw s="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);s="executing";var c=p(e,t,r);if("normal"===c.type){if(s=r.done?"completed":"suspendedYield",c.arg===h)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(s="completed",r.method="throw",r.arg=c.arg)}}}function A(e,t){var r=t.method,s=e.iterator[r];if(void 0===s)return t.delegate=null,"throw"===r&&e.iterator.return&&(t.method="return",t.arg=void 0,A(e,t),"throw"===t.method)||"return"!==r&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+r+"' method")),h;var a=p(s,e.iterator,t.arg);if("throw"===a.type)return t.method="throw",t.arg=a.arg,t.delegate=null,h;var n=a.arg;return n?n.done?(t[e.resultName]=n.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,h):n:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,h)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function x(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function R(e){if(e){var t=e[n];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var s=-1,a=function t(){for(;++s<e.length;)if(r.call(e,s))return t.value=e[s],t.done=!1,t;return t.value=void 0,t.done=!0,t};return a.next=a}}return{next:I}}function I(){return{value:void 0,done:!0}}return y.prototype=g,s(S,"constructor",{value:g,configurable:!0}),s(g,"constructor",{value:y,configurable:!0}),y.displayName=d(g,u,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===y||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,g):(e.__proto__=g,d(e,u,"GeneratorFunction")),e.prototype=Object.create(S),e},e.awrap=function(e){return{__await:e}},_(b.prototype),d(b.prototype,c,(function(){return this})),e.AsyncIterator=b,e.async=function(t,r,s,a,n){void 0===n&&(n=Promise);var i=new b(l(t,r,s,a),n);return e.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},_(S),d(S,u,"Generator"),d(S,n,(function(){return this})),d(S,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),r=[];for(var s in t)r.push(s);return r.reverse(),function e(){for(;r.length;){var s=r.pop();if(s in t)return e.value=s,e.done=!1,e}return e.done=!0,e}},e.values=R,x.prototype={constructor:x,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(C),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function s(r,s){return i.type="throw",i.arg=e,t.next=r,s&&(t.method="next",t.arg=void 0),!!s}for(var a=this.tryEntries.length-1;a>=0;--a){var n=this.tryEntries[a],i=n.completion;if("root"===n.tryLoc)return s("end");if(n.tryLoc<=this.prev){var o=r.call(n,"catchLoc"),c=r.call(n,"finallyLoc");if(o&&c){if(this.prev<n.catchLoc)return s(n.catchLoc,!0);if(this.prev<n.finallyLoc)return s(n.finallyLoc)}else if(o){if(this.prev<n.catchLoc)return s(n.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<n.finallyLoc)return s(n.finallyLoc)}}}},abrupt:function(e,t){for(var s=this.tryEntries.length-1;s>=0;--s){var a=this.tryEntries[s];if(a.tryLoc<=this.prev&&r.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var n=a;break}}n&&("break"===e||"continue"===e)&&n.tryLoc<=t&&t<=n.finallyLoc&&(n=null);var i=n?n.completion:{};return i.type=e,i.arg=t,n?(this.method="next",this.next=n.finallyLoc,h):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),C(r),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var s=r.completion;if("throw"===s.type){var a=s.arg;C(r)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:R(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),h}},e}function c(e,t,r,s,a,n,i){try{var o=e[n](i),c=o.value}catch(e){return void r(e)}o.done?t(c):Promise.resolve(c).then(s,a)}var u=" ";function d(e,t){return l.apply(this,arguments)}function l(){var e;return e=o().mark((function e(t,r){var i,c,d,l;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,s.U)(t);case 3:if(i=e.sent,"controllable_by_this_extension"===(c=i.levelOfControl)||"controlled_by_this_extension"===c){e.next=8;break}throw d=["Impossible to change browser setting: ".concat(t,"."),"Extension prevented from changing: ".concat(c)].join(u),new Error(d);case 8:e.next=18;break;case 10:if(e.prev=10,e.t0=e.catch(0),!(0,a.b)(e.t0)){e.next=15;break}throw l="Browser setting not supported: ".concat(t),new Error(l);case 15:if(!(0,a.I)(e.t0)){e.next=17;break}throw e.t0.runtimeError;case 17:throw e.t0;case 18:return e.prev=18,e.next=21,(0,n.t)(t,r);case 21:e.next=27;break;case 23:throw e.prev=23,e.t1=e.catch(18),(0,a.I)(e.t1)?e.t1.runtimeError:e.t1;case 27:case"end":return e.stop()}}),e,null,[[0,10],[18,23]])})),l=function(){var t=this,r=arguments;return new Promise((function(s,a){var n=e.apply(t,r);function i(e){c(n,s,a,i,o,"next",e)}function o(e){c(n,s,a,i,o,"throw",e)}i(void 0)}))},l.apply(this,arguments)}function p(e){return p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},p(e)}function h(){h=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,s=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},n=a.iterator||"@@iterator",i=a.asyncIterator||"@@asyncIterator",o=a.toStringTag||"@@toStringTag";function c(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,r){return e[t]=r}}function u(e,t,r,a){var n=t&&t.prototype instanceof m?t:m,i=Object.create(n.prototype),o=new x(a||[]);return s(i,"_invoke",{value:E(e,r,o)}),i}function d(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=u;var l={};function m(){}function y(){}function g(){}var v={};c(v,n,(function(){return this}));var f=Object.getPrototypeOf,w=f&&f(f(R([])));w&&w!==t&&r.call(w,n)&&(v=w);var S=g.prototype=m.prototype=Object.create(v);function _(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function b(e,t){function a(s,n,i,o){var c=d(e[s],e,n);if("throw"!==c.type){var u=c.arg,l=u.value;return l&&"object"==p(l)&&r.call(l,"__await")?t.resolve(l.__await).then((function(e){a("next",e,i,o)}),(function(e){a("throw",e,i,o)})):t.resolve(l).then((function(e){u.value=e,i(u)}),(function(e){return a("throw",e,i,o)}))}o(c.arg)}var n;s(this,"_invoke",{value:function(e,r){function s(){return new t((function(t,s){a(e,r,t,s)}))}return n=n?n.then(s,s):s()}})}function E(e,t,r){var s="suspendedStart";return function(a,n){if("executing"===s)throw new Error("Generator is already running");if("completed"===s){if("throw"===a)throw n;return I()}for(r.method=a,r.arg=n;;){var i=r.delegate;if(i){var o=A(i,r);if(o){if(o===l)continue;return o}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===s)throw s="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);s="executing";var c=d(e,t,r);if("normal"===c.type){if(s=r.done?"completed":"suspendedYield",c.arg===l)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(s="completed",r.method="throw",r.arg=c.arg)}}}function A(e,t){var r=t.method,s=e.iterator[r];if(void 0===s)return t.delegate=null,"throw"===r&&e.iterator.return&&(t.method="return",t.arg=void 0,A(e,t),"throw"===t.method)||"return"!==r&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+r+"' method")),l;var a=d(s,e.iterator,t.arg);if("throw"===a.type)return t.method="throw",t.arg=a.arg,t.delegate=null,l;var n=a.arg;return n?n.done?(t[e.resultName]=n.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,l):n:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,l)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function x(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function R(e){if(e){var t=e[n];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var s=-1,a=function t(){for(;++s<e.length;)if(r.call(e,s))return t.value=e[s],t.done=!1,t;return t.value=void 0,t.done=!0,t};return a.next=a}}return{next:I}}function I(){return{value:void 0,done:!0}}return y.prototype=g,s(S,"constructor",{value:g,configurable:!0}),s(g,"constructor",{value:y,configurable:!0}),y.displayName=c(g,o,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===y||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,g):(e.__proto__=g,c(e,o,"GeneratorFunction")),e.prototype=Object.create(S),e},e.awrap=function(e){return{__await:e}},_(b.prototype),c(b.prototype,i,(function(){return this})),e.AsyncIterator=b,e.async=function(t,r,s,a,n){void 0===n&&(n=Promise);var i=new b(u(t,r,s,a),n);return e.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},_(S),c(S,o,"Generator"),c(S,n,(function(){return this})),c(S,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),r=[];for(var s in t)r.push(s);return r.reverse(),function e(){for(;r.length;){var s=r.pop();if(s in t)return e.value=s,e.done=!1,e}return e.done=!0,e}},e.values=R,x.prototype={constructor:x,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(C),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function s(r,s){return i.type="throw",i.arg=e,t.next=r,s&&(t.method="next",t.arg=void 0),!!s}for(var a=this.tryEntries.length-1;a>=0;--a){var n=this.tryEntries[a],i=n.completion;if("root"===n.tryLoc)return s("end");if(n.tryLoc<=this.prev){var o=r.call(n,"catchLoc"),c=r.call(n,"finallyLoc");if(o&&c){if(this.prev<n.catchLoc)return s(n.catchLoc,!0);if(this.prev<n.finallyLoc)return s(n.finallyLoc)}else if(o){if(this.prev<n.catchLoc)return s(n.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<n.finallyLoc)return s(n.finallyLoc)}}}},abrupt:function(e,t){for(var s=this.tryEntries.length-1;s>=0;--s){var a=this.tryEntries[s];if(a.tryLoc<=this.prev&&r.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var n=a;break}}n&&("break"===e||"continue"===e)&&n.tryLoc<=t&&t<=n.finallyLoc&&(n=null);var i=n?n.completion:{};return i.type=e,i.arg=t,n?(this.method="next",this.next=n.finallyLoc,l):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),C(r),l}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var s=r.completion;if("throw"===s.type){var a=s.arg;C(r)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:R(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},e}function m(e,t,r,s,a,n,i){try{var o=e[n](i),c=o.value}catch(e){return void r(e)}o.done?t(c):Promise.resolve(c).then(s,a)}function y(){return g.apply(this,arguments)}function g(){var e;return e=h().mark((function e(){var t;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=["autofillAddressEnabled","autofillCreditCardEnabled","passwordSavingEnabled"].map((function(e){return d(e,!1)})),e.next=4,Promise.all(t);case 4:case"end":return e.stop()}}),e)})),g=function(){var t=this,r=arguments;return new Promise((function(s,a){var n=e.apply(t,r);function i(e){m(n,s,a,i,o,"next",e)}function o(e){m(n,s,a,i,o,"throw",e)}i(void 0)}))},g.apply(this,arguments)}},88417:(e,t,r)=>{"use strict";r.d(t,{F:()=>d});r(35758),r(82312),r(37391),r(75815),r(45749),r(2165),r(83746),r(37944),r(55402),r(22250),r(92665),r(88737),r(97979),r(38509),r(95665),r(41533),r(72029),r(71632),r(2191),r(4473),r(68126),r(75986),r(41437),r(5744),r(18549);var s=r(84318),a=r(16241);function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function i(){i=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,s=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},o=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function d(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{d({},"")}catch(e){d=function(e,t,r){return e[t]=r}}function l(e,t,r,a){var n=t&&t.prototype instanceof m?t:m,i=Object.create(n.prototype),o=new x(a||[]);return s(i,"_invoke",{value:E(e,r,o)}),i}function p(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=l;var h={};function m(){}function y(){}function g(){}var v={};d(v,o,(function(){return this}));var f=Object.getPrototypeOf,w=f&&f(f(R([])));w&&w!==t&&r.call(w,o)&&(v=w);var S=g.prototype=m.prototype=Object.create(v);function _(e){["next","throw","return"].forEach((function(t){d(e,t,(function(e){return this._invoke(t,e)}))}))}function b(e,t){function a(s,i,o,c){var u=p(e[s],e,i);if("throw"!==u.type){var d=u.arg,l=d.value;return l&&"object"==n(l)&&r.call(l,"__await")?t.resolve(l.__await).then((function(e){a("next",e,o,c)}),(function(e){a("throw",e,o,c)})):t.resolve(l).then((function(e){d.value=e,o(d)}),(function(e){return a("throw",e,o,c)}))}c(u.arg)}var i;s(this,"_invoke",{value:function(e,r){function s(){return new t((function(t,s){a(e,r,t,s)}))}return i=i?i.then(s,s):s()}})}function E(e,t,r){var s="suspendedStart";return function(a,n){if("executing"===s)throw new Error("Generator is already running");if("completed"===s){if("throw"===a)throw n;return I()}for(r.method=a,r.arg=n;;){var i=r.delegate;if(i){var o=A(i,r);if(o){if(o===h)continue;return o}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===s)throw s="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);s="executing";var c=p(e,t,r);if("normal"===c.type){if(s=r.done?"completed":"suspendedYield",c.arg===h)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(s="completed",r.method="throw",r.arg=c.arg)}}}function A(e,t){var r=t.method,s=e.iterator[r];if(void 0===s)return t.delegate=null,"throw"===r&&e.iterator.return&&(t.method="return",t.arg=void 0,A(e,t),"throw"===t.method)||"return"!==r&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+r+"' method")),h;var a=p(s,e.iterator,t.arg);if("throw"===a.type)return t.method="throw",t.arg=a.arg,t.delegate=null,h;var n=a.arg;return n?n.done?(t[e.resultName]=n.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,h):n:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,h)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function x(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function R(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var s=-1,a=function t(){for(;++s<e.length;)if(r.call(e,s))return t.value=e[s],t.done=!1,t;return t.value=void 0,t.done=!0,t};return a.next=a}}return{next:I}}function I(){return{value:void 0,done:!0}}return y.prototype=g,s(S,"constructor",{value:g,configurable:!0}),s(g,"constructor",{value:y,configurable:!0}),y.displayName=d(g,u,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===y||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,g):(e.__proto__=g,d(e,u,"GeneratorFunction")),e.prototype=Object.create(S),e},e.awrap=function(e){return{__await:e}},_(b.prototype),d(b.prototype,c,(function(){return this})),e.AsyncIterator=b,e.async=function(t,r,s,a,n){void 0===n&&(n=Promise);var i=new b(l(t,r,s,a),n);return e.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},_(S),d(S,u,"Generator"),d(S,o,(function(){return this})),d(S,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),r=[];for(var s in t)r.push(s);return r.reverse(),function e(){for(;r.length;){var s=r.pop();if(s in t)return e.value=s,e.done=!1,e}return e.done=!0,e}},e.values=R,x.prototype={constructor:x,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(C),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function s(r,s){return i.type="throw",i.arg=e,t.next=r,s&&(t.method="next",t.arg=void 0),!!s}for(var a=this.tryEntries.length-1;a>=0;--a){var n=this.tryEntries[a],i=n.completion;if("root"===n.tryLoc)return s("end");if(n.tryLoc<=this.prev){var o=r.call(n,"catchLoc"),c=r.call(n,"finallyLoc");if(o&&c){if(this.prev<n.catchLoc)return s(n.catchLoc,!0);if(this.prev<n.finallyLoc)return s(n.finallyLoc)}else if(o){if(this.prev<n.catchLoc)return s(n.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<n.finallyLoc)return s(n.finallyLoc)}}}},abrupt:function(e,t){for(var s=this.tryEntries.length-1;s>=0;--s){var a=this.tryEntries[s];if(a.tryLoc<=this.prev&&r.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var n=a;break}}n&&("break"===e||"continue"===e)&&n.tryLoc<=t&&t<=n.finallyLoc&&(n=null);var i=n?n.completion:{};return i.type=e,i.arg=t,n?(this.method="next",this.next=n.finallyLoc,h):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),C(r),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var s=r.completion;if("throw"===s.type){var a=s.arg;C(r)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:R(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),h}},e}function o(e,t,r,s,a,n,i){try{var o=e[n](i),c=o.value}catch(e){return void r(e)}o.done?t(c):Promise.resolve(c).then(s,a)}var c={nightly:"icon_nightly_auth",mv2:"icon_auth",mv3:"icon_mv3_auth"},u="icon_not_auth";function d(e){return l.apply(this,arguments)}function l(){var e;return e=i().mark((function e(t){var r,n,o,d;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.isUserAuthenticated,n=r?(i=void 0,(i=(0,s.W)()).name.includes("Nightly")?c.nightly:i.name.includes("Beta")||3===i.manifest_version?c.mv3:c.mv2):u,o="icons/action/".concat(n),d={16:"".concat(o,".png"),32:"".concat(o,"@2x.png")},e.next=6,(0,a.B)(d);case 6:case"end":return e.stop()}var i}),e)})),l=function(){var t=this,r=arguments;return new Promise((function(s,a){var n=e.apply(t,r);function i(e){o(n,s,a,i,c,"next",e)}function c(e){o(n,s,a,i,c,"throw",e)}i(void 0)}))},l.apply(this,arguments)}},36956:(e,t,r)=>{"use strict";r.d(t,{$:()=>u});r(38298),r(86847),r(22250),r(75815),r(45749),r(92665),r(88737),r(23041),r(37391),r(2165),r(83746),r(37944),r(55402),r(97979),r(38509),r(95665),r(41533),r(72029),r(71632),r(2191),r(4473),r(68126),r(75986),r(41437),r(5744),r(18549);var s=r(329),a=r(98641);function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function i(){i=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,s=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},o=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function d(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{d({},"")}catch(e){d=function(e,t,r){return e[t]=r}}function l(e,t,r,a){var n=t&&t.prototype instanceof m?t:m,i=Object.create(n.prototype),o=new x(a||[]);return s(i,"_invoke",{value:E(e,r,o)}),i}function p(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=l;var h={};function m(){}function y(){}function g(){}var v={};d(v,o,(function(){return this}));var f=Object.getPrototypeOf,w=f&&f(f(R([])));w&&w!==t&&r.call(w,o)&&(v=w);var S=g.prototype=m.prototype=Object.create(v);function _(e){["next","throw","return"].forEach((function(t){d(e,t,(function(e){return this._invoke(t,e)}))}))}function b(e,t){function a(s,i,o,c){var u=p(e[s],e,i);if("throw"!==u.type){var d=u.arg,l=d.value;return l&&"object"==n(l)&&r.call(l,"__await")?t.resolve(l.__await).then((function(e){a("next",e,o,c)}),(function(e){a("throw",e,o,c)})):t.resolve(l).then((function(e){d.value=e,o(d)}),(function(e){return a("throw",e,o,c)}))}c(u.arg)}var i;s(this,"_invoke",{value:function(e,r){function s(){return new t((function(t,s){a(e,r,t,s)}))}return i=i?i.then(s,s):s()}})}function E(e,t,r){var s="suspendedStart";return function(a,n){if("executing"===s)throw new Error("Generator is already running");if("completed"===s){if("throw"===a)throw n;return I()}for(r.method=a,r.arg=n;;){var i=r.delegate;if(i){var o=A(i,r);if(o){if(o===h)continue;return o}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===s)throw s="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);s="executing";var c=p(e,t,r);if("normal"===c.type){if(s=r.done?"completed":"suspendedYield",c.arg===h)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(s="completed",r.method="throw",r.arg=c.arg)}}}function A(e,t){var r=t.method,s=e.iterator[r];if(void 0===s)return t.delegate=null,"throw"===r&&e.iterator.return&&(t.method="return",t.arg=void 0,A(e,t),"throw"===t.method)||"return"!==r&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+r+"' method")),h;var a=p(s,e.iterator,t.arg);if("throw"===a.type)return t.method="throw",t.arg=a.arg,t.delegate=null,h;var n=a.arg;return n?n.done?(t[e.resultName]=n.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,h):n:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,h)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function x(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function R(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var s=-1,a=function t(){for(;++s<e.length;)if(r.call(e,s))return t.value=e[s],t.done=!1,t;return t.value=void 0,t.done=!0,t};return a.next=a}}return{next:I}}function I(){return{value:void 0,done:!0}}return y.prototype=g,s(S,"constructor",{value:g,configurable:!0}),s(g,"constructor",{value:y,configurable:!0}),y.displayName=d(g,u,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===y||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,g):(e.__proto__=g,d(e,u,"GeneratorFunction")),e.prototype=Object.create(S),e},e.awrap=function(e){return{__await:e}},_(b.prototype),d(b.prototype,c,(function(){return this})),e.AsyncIterator=b,e.async=function(t,r,s,a,n){void 0===n&&(n=Promise);var i=new b(l(t,r,s,a),n);return e.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},_(S),d(S,u,"Generator"),d(S,o,(function(){return this})),d(S,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),r=[];for(var s in t)r.push(s);return r.reverse(),function e(){for(;r.length;){var s=r.pop();if(s in t)return e.value=s,e.done=!1,e}return e.done=!0,e}},e.values=R,x.prototype={constructor:x,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(C),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function s(r,s){return i.type="throw",i.arg=e,t.next=r,s&&(t.method="next",t.arg=void 0),!!s}for(var a=this.tryEntries.length-1;a>=0;--a){var n=this.tryEntries[a],i=n.completion;if("root"===n.tryLoc)return s("end");if(n.tryLoc<=this.prev){var o=r.call(n,"catchLoc"),c=r.call(n,"finallyLoc");if(o&&c){if(this.prev<n.catchLoc)return s(n.catchLoc,!0);if(this.prev<n.finallyLoc)return s(n.finallyLoc)}else if(o){if(this.prev<n.catchLoc)return s(n.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<n.finallyLoc)return s(n.finallyLoc)}}}},abrupt:function(e,t){for(var s=this.tryEntries.length-1;s>=0;--s){var a=this.tryEntries[s];if(a.tryLoc<=this.prev&&r.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var n=a;break}}n&&("break"===e||"continue"===e)&&n.tryLoc<=t&&t<=n.finallyLoc&&(n=null);var i=n?n.completion:{};return i.type=e,i.arg=t,n?(this.method="next",this.next=n.finallyLoc,h):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),C(r),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var s=r.completion;if("throw"===s.type){var a=s.arg;C(r)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:R(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),h}},e}function o(e,t,r,s,a,n,i){try{var o=e[n](i),c=o.value}catch(e){return void r(e)}o.done?t(c):Promise.resolve(c).then(s,a)}function c(e){var t="http".concat(e.secure?"s":""),r=e.domain.startsWith(".")?e.domain.substring(1):e.domain;return"".concat(t,"://").concat(r).concat(e.path)}function u(e){return d.apply(this,arguments)}function d(){var e;return e=i().mark((function e(t){var r;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,s.g)({domain:t});case 2:return r=e.sent,e.abrupt("return",Promise.all(r.map((function(e){return(0,a.O)({url:c(e),name:e.name})}))));case 4:case"end":return e.stop()}}),e)})),d=function(){var t=this,r=arguments;return new Promise((function(s,a){var n=e.apply(t,r);function i(e){o(n,s,a,i,c,"next",e)}function c(e){o(n,s,a,i,c,"throw",e)}i(void 0)}))},d.apply(this,arguments)}},79563:(e,t,r)=>{"use strict";r.d(t,{j:()=>c});r(75815),r(45749),r(2165),r(83746),r(37944),r(55402),r(22250),r(92665),r(88737),r(97979),r(38509),r(95665),r(41533),r(72029),r(71632),r(2191),r(4473),r(68126),r(75986),r(37391),r(41437),r(5744),r(18549);var s=r(39680),a=r(41808);function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function i(){i=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,s=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},o=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function d(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{d({},"")}catch(e){d=function(e,t,r){return e[t]=r}}function l(e,t,r,a){var n=t&&t.prototype instanceof m?t:m,i=Object.create(n.prototype),o=new x(a||[]);return s(i,"_invoke",{value:E(e,r,o)}),i}function p(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=l;var h={};function m(){}function y(){}function g(){}var v={};d(v,o,(function(){return this}));var f=Object.getPrototypeOf,w=f&&f(f(R([])));w&&w!==t&&r.call(w,o)&&(v=w);var S=g.prototype=m.prototype=Object.create(v);function _(e){["next","throw","return"].forEach((function(t){d(e,t,(function(e){return this._invoke(t,e)}))}))}function b(e,t){function a(s,i,o,c){var u=p(e[s],e,i);if("throw"!==u.type){var d=u.arg,l=d.value;return l&&"object"==n(l)&&r.call(l,"__await")?t.resolve(l.__await).then((function(e){a("next",e,o,c)}),(function(e){a("throw",e,o,c)})):t.resolve(l).then((function(e){d.value=e,o(d)}),(function(e){return a("throw",e,o,c)}))}c(u.arg)}var i;s(this,"_invoke",{value:function(e,r){function s(){return new t((function(t,s){a(e,r,t,s)}))}return i=i?i.then(s,s):s()}})}function E(e,t,r){var s="suspendedStart";return function(a,n){if("executing"===s)throw new Error("Generator is already running");if("completed"===s){if("throw"===a)throw n;return I()}for(r.method=a,r.arg=n;;){var i=r.delegate;if(i){var o=A(i,r);if(o){if(o===h)continue;return o}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===s)throw s="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);s="executing";var c=p(e,t,r);if("normal"===c.type){if(s=r.done?"completed":"suspendedYield",c.arg===h)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(s="completed",r.method="throw",r.arg=c.arg)}}}function A(e,t){var r=t.method,s=e.iterator[r];if(void 0===s)return t.delegate=null,"throw"===r&&e.iterator.return&&(t.method="return",t.arg=void 0,A(e,t),"throw"===t.method)||"return"!==r&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+r+"' method")),h;var a=p(s,e.iterator,t.arg);if("throw"===a.type)return t.method="throw",t.arg=a.arg,t.delegate=null,h;var n=a.arg;return n?n.done?(t[e.resultName]=n.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,h):n:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,h)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function x(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function R(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var s=-1,a=function t(){for(;++s<e.length;)if(r.call(e,s))return t.value=e[s],t.done=!1,t;return t.value=void 0,t.done=!0,t};return a.next=a}}return{next:I}}function I(){return{value:void 0,done:!0}}return y.prototype=g,s(S,"constructor",{value:g,configurable:!0}),s(g,"constructor",{value:y,configurable:!0}),y.displayName=d(g,u,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===y||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,g):(e.__proto__=g,d(e,u,"GeneratorFunction")),e.prototype=Object.create(S),e},e.awrap=function(e){return{__await:e}},_(b.prototype),d(b.prototype,c,(function(){return this})),e.AsyncIterator=b,e.async=function(t,r,s,a,n){void 0===n&&(n=Promise);var i=new b(l(t,r,s,a),n);return e.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},_(S),d(S,u,"Generator"),d(S,o,(function(){return this})),d(S,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),r=[];for(var s in t)r.push(s);return r.reverse(),function e(){for(;r.length;){var s=r.pop();if(s in t)return e.value=s,e.done=!1,e}return e.done=!0,e}},e.values=R,x.prototype={constructor:x,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(C),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function s(r,s){return i.type="throw",i.arg=e,t.next=r,s&&(t.method="next",t.arg=void 0),!!s}for(var a=this.tryEntries.length-1;a>=0;--a){var n=this.tryEntries[a],i=n.completion;if("root"===n.tryLoc)return s("end");if(n.tryLoc<=this.prev){var o=r.call(n,"catchLoc"),c=r.call(n,"finallyLoc");if(o&&c){if(this.prev<n.catchLoc)return s(n.catchLoc,!0);if(this.prev<n.finallyLoc)return s(n.finallyLoc)}else if(o){if(this.prev<n.catchLoc)return s(n.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<n.finallyLoc)return s(n.finallyLoc)}}}},abrupt:function(e,t){for(var s=this.tryEntries.length-1;s>=0;--s){var a=this.tryEntries[s];if(a.tryLoc<=this.prev&&r.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var n=a;break}}n&&("break"===e||"continue"===e)&&n.tryLoc<=t&&t<=n.finallyLoc&&(n=null);var i=n?n.completion:{};return i.type=e,i.arg=t,n?(this.method="next",this.next=n.finallyLoc,h):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),C(r),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var s=r.completion;if("throw"===s.type){var a=s.arg;C(r)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:R(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),h}},e}function o(e,t,r,s,a,n,i){try{var o=e[n](i),c=o.value}catch(e){return void r(e)}o.done?t(c):Promise.resolve(c).then(s,a)}function c(e){return u.apply(this,arguments)}function u(){var e;return e=i().mark((function e(t){var r,n,o,c;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(0,s.G)()){e.next=5;break}return e.next=3,(0,s.y)(t);case 3:return r=e.sent,e.abrupt("return",r>0);case 5:return e.next=7,(0,a.U)(t);case 7:return n=e.sent,o=void 0===n[t],c=null===n[t],e.abrupt("return",!o&&!c);case 11:case"end":return e.stop()}}),e)})),u=function(){var t=this,r=arguments;return new Promise((function(s,a){var n=e.apply(t,r);function i(e){o(n,s,a,i,c,"next",e)}function c(e){o(n,s,a,i,c,"throw",e)}i(void 0)}))},u.apply(this,arguments)}},48758:(e,t,r)=>{"use strict";r.d(t,{b:()=>I});r(86847),r(72424),r(23041),r(15442),r(37391),r(32202),r(75815),r(68585),r(45749),r(2165),r(83746),r(37944),r(55402),r(22250),r(92665),r(88737),r(97979),r(38509),r(95665),r(41533),r(72029),r(71632),r(2191),r(4473),r(68126),r(75986),r(41437),r(5744),r(18549),r(296),r(30094),r(32721),r(7541),r(22440),r(94973);var s=r(92204),a=r(24715),n=r(72733),i=r(57306),o=r(31460),c=(r(38298),r(61222));function u(e){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u(e)}function d(){d=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,s=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},n=a.iterator||"@@iterator",i=a.asyncIterator||"@@asyncIterator",o=a.toStringTag||"@@toStringTag";function c(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,r){return e[t]=r}}function l(e,t,r,a){var n=t&&t.prototype instanceof m?t:m,i=Object.create(n.prototype),o=new x(a||[]);return s(i,"_invoke",{value:E(e,r,o)}),i}function p(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=l;var h={};function m(){}function y(){}function g(){}var v={};c(v,n,(function(){return this}));var f=Object.getPrototypeOf,w=f&&f(f(R([])));w&&w!==t&&r.call(w,n)&&(v=w);var S=g.prototype=m.prototype=Object.create(v);function _(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function b(e,t){function a(s,n,i,o){var c=p(e[s],e,n);if("throw"!==c.type){var d=c.arg,l=d.value;return l&&"object"==u(l)&&r.call(l,"__await")?t.resolve(l.__await).then((function(e){a("next",e,i,o)}),(function(e){a("throw",e,i,o)})):t.resolve(l).then((function(e){d.value=e,i(d)}),(function(e){return a("throw",e,i,o)}))}o(c.arg)}var n;s(this,"_invoke",{value:function(e,r){function s(){return new t((function(t,s){a(e,r,t,s)}))}return n=n?n.then(s,s):s()}})}function E(e,t,r){var s="suspendedStart";return function(a,n){if("executing"===s)throw new Error("Generator is already running");if("completed"===s){if("throw"===a)throw n;return I()}for(r.method=a,r.arg=n;;){var i=r.delegate;if(i){var o=A(i,r);if(o){if(o===h)continue;return o}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===s)throw s="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);s="executing";var c=p(e,t,r);if("normal"===c.type){if(s=r.done?"completed":"suspendedYield",c.arg===h)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(s="completed",r.method="throw",r.arg=c.arg)}}}function A(e,t){var r=t.method,s=e.iterator[r];if(void 0===s)return t.delegate=null,"throw"===r&&e.iterator.return&&(t.method="return",t.arg=void 0,A(e,t),"throw"===t.method)||"return"!==r&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+r+"' method")),h;var a=p(s,e.iterator,t.arg);if("throw"===a.type)return t.method="throw",t.arg=a.arg,t.delegate=null,h;var n=a.arg;return n?n.done?(t[e.resultName]=n.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,h):n:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,h)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function x(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function R(e){if(e){var t=e[n];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var s=-1,a=function t(){for(;++s<e.length;)if(r.call(e,s))return t.value=e[s],t.done=!1,t;return t.value=void 0,t.done=!0,t};return a.next=a}}return{next:I}}function I(){return{value:void 0,done:!0}}return y.prototype=g,s(S,"constructor",{value:g,configurable:!0}),s(g,"constructor",{value:y,configurable:!0}),y.displayName=c(g,o,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===y||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,g):(e.__proto__=g,c(e,o,"GeneratorFunction")),e.prototype=Object.create(S),e},e.awrap=function(e){return{__await:e}},_(b.prototype),c(b.prototype,i,(function(){return this})),e.AsyncIterator=b,e.async=function(t,r,s,a,n){void 0===n&&(n=Promise);var i=new b(l(t,r,s,a),n);return e.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},_(S),c(S,o,"Generator"),c(S,n,(function(){return this})),c(S,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),r=[];for(var s in t)r.push(s);return r.reverse(),function e(){for(;r.length;){var s=r.pop();if(s in t)return e.value=s,e.done=!1,e}return e.done=!0,e}},e.values=R,x.prototype={constructor:x,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(C),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function s(r,s){return i.type="throw",i.arg=e,t.next=r,s&&(t.method="next",t.arg=void 0),!!s}for(var a=this.tryEntries.length-1;a>=0;--a){var n=this.tryEntries[a],i=n.completion;if("root"===n.tryLoc)return s("end");if(n.tryLoc<=this.prev){var o=r.call(n,"catchLoc"),c=r.call(n,"finallyLoc");if(o&&c){if(this.prev<n.catchLoc)return s(n.catchLoc,!0);if(this.prev<n.finallyLoc)return s(n.finallyLoc)}else if(o){if(this.prev<n.catchLoc)return s(n.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<n.finallyLoc)return s(n.finallyLoc)}}}},abrupt:function(e,t){for(var s=this.tryEntries.length-1;s>=0;--s){var a=this.tryEntries[s];if(a.tryLoc<=this.prev&&r.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var n=a;break}}n&&("break"===e||"continue"===e)&&n.tryLoc<=t&&t<=n.finallyLoc&&(n=null);var i=n?n.completion:{};return i.type=e,i.arg=t,n?(this.method="next",this.next=n.finallyLoc,h):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),C(r),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var s=r.completion;if("throw"===s.type){var a=s.arg;C(r)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:R(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),h}},e}function l(e,t,r,s,a,n,i){try{var o=e[n](i),c=o.value}catch(e){return void r(e)}o.done?t(c):Promise.resolve(c).then(s,a)}function p(){return h.apply(this,arguments)}function h(){var e;return e=d().mark((function e(){var t,r,a,n;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,c.I)({});case 2:return t=e.sent,r=(0,s.A)(""),a=function(e){return"string"==typeof e.url&&e.url.startsWith(r)},n=function(e){return""!==e.url},e.abrupt("return",t.filter(a).filter(n));case 7:case"end":return e.stop()}}),e)})),h=function(){var t=this,r=arguments;return new Promise((function(s,a){var n=e.apply(t,r);function i(e){l(n,s,a,i,o,"next",e)}function o(e){l(n,s,a,i,o,"throw",e)}i(void 0)}))},h.apply(this,arguments)}function m(e){return m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},m(e)}function y(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function g(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?y(Object(r),!0).forEach((function(t){v(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):y(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function v(e,t,r){return(t=function(e){var t=function(e,t){if("object"!==m(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var s=r.call(e,t||"default");if("object"!==m(s))return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===m(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function f(){f=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,s=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},n=a.iterator||"@@iterator",i=a.asyncIterator||"@@asyncIterator",o=a.toStringTag||"@@toStringTag";function c(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,r){return e[t]=r}}function u(e,t,r,a){var n=t&&t.prototype instanceof p?t:p,i=Object.create(n.prototype),o=new x(a||[]);return s(i,"_invoke",{value:E(e,r,o)}),i}function d(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=u;var l={};function p(){}function h(){}function y(){}var g={};c(g,n,(function(){return this}));var v=Object.getPrototypeOf,w=v&&v(v(R([])));w&&w!==t&&r.call(w,n)&&(g=w);var S=y.prototype=p.prototype=Object.create(g);function _(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function b(e,t){function a(s,n,i,o){var c=d(e[s],e,n);if("throw"!==c.type){var u=c.arg,l=u.value;return l&&"object"==m(l)&&r.call(l,"__await")?t.resolve(l.__await).then((function(e){a("next",e,i,o)}),(function(e){a("throw",e,i,o)})):t.resolve(l).then((function(e){u.value=e,i(u)}),(function(e){return a("throw",e,i,o)}))}o(c.arg)}var n;s(this,"_invoke",{value:function(e,r){function s(){return new t((function(t,s){a(e,r,t,s)}))}return n=n?n.then(s,s):s()}})}function E(e,t,r){var s="suspendedStart";return function(a,n){if("executing"===s)throw new Error("Generator is already running");if("completed"===s){if("throw"===a)throw n;return I()}for(r.method=a,r.arg=n;;){var i=r.delegate;if(i){var o=A(i,r);if(o){if(o===l)continue;return o}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===s)throw s="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);s="executing";var c=d(e,t,r);if("normal"===c.type){if(s=r.done?"completed":"suspendedYield",c.arg===l)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(s="completed",r.method="throw",r.arg=c.arg)}}}function A(e,t){var r=t.method,s=e.iterator[r];if(void 0===s)return t.delegate=null,"throw"===r&&e.iterator.return&&(t.method="return",t.arg=void 0,A(e,t),"throw"===t.method)||"return"!==r&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+r+"' method")),l;var a=d(s,e.iterator,t.arg);if("throw"===a.type)return t.method="throw",t.arg=a.arg,t.delegate=null,l;var n=a.arg;return n?n.done?(t[e.resultName]=n.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,l):n:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,l)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function x(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function R(e){if(e){var t=e[n];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var s=-1,a=function t(){for(;++s<e.length;)if(r.call(e,s))return t.value=e[s],t.done=!1,t;return t.value=void 0,t.done=!0,t};return a.next=a}}return{next:I}}function I(){return{value:void 0,done:!0}}return h.prototype=y,s(S,"constructor",{value:y,configurable:!0}),s(y,"constructor",{value:h,configurable:!0}),h.displayName=c(y,o,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===h||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,y):(e.__proto__=y,c(e,o,"GeneratorFunction")),e.prototype=Object.create(S),e},e.awrap=function(e){return{__await:e}},_(b.prototype),c(b.prototype,i,(function(){return this})),e.AsyncIterator=b,e.async=function(t,r,s,a,n){void 0===n&&(n=Promise);var i=new b(u(t,r,s,a),n);return e.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},_(S),c(S,o,"Generator"),c(S,n,(function(){return this})),c(S,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),r=[];for(var s in t)r.push(s);return r.reverse(),function e(){for(;r.length;){var s=r.pop();if(s in t)return e.value=s,e.done=!1,e}return e.done=!0,e}},e.values=R,x.prototype={constructor:x,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(C),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function s(r,s){return i.type="throw",i.arg=e,t.next=r,s&&(t.method="next",t.arg=void 0),!!s}for(var a=this.tryEntries.length-1;a>=0;--a){var n=this.tryEntries[a],i=n.completion;if("root"===n.tryLoc)return s("end");if(n.tryLoc<=this.prev){var o=r.call(n,"catchLoc"),c=r.call(n,"finallyLoc");if(o&&c){if(this.prev<n.catchLoc)return s(n.catchLoc,!0);if(this.prev<n.finallyLoc)return s(n.finallyLoc)}else if(o){if(this.prev<n.catchLoc)return s(n.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<n.finallyLoc)return s(n.finallyLoc)}}}},abrupt:function(e,t){for(var s=this.tryEntries.length-1;s>=0;--s){var a=this.tryEntries[s];if(a.tryLoc<=this.prev&&r.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var n=a;break}}n&&("break"===e||"continue"===e)&&n.tryLoc<=t&&t<=n.finallyLoc&&(n=null);var i=n?n.completion:{};return i.type=e,i.arg=t,n?(this.method="next",this.next=n.finallyLoc,l):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),C(r),l}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var s=r.completion;if("throw"===s.type){var a=s.arg;C(r)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:R(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},e}function w(e,t,r,s,a,n,i){try{var o=e[n](i),c=o.value}catch(e){return void r(e)}o.done?t(c):Promise.resolve(c).then(s,a)}function S(e){return function(){var t=this,r=arguments;return new Promise((function(s,a){var n=e.apply(t,r);function i(e){w(n,s,a,i,o,"next",e)}function o(e){w(n,s,a,i,o,"throw",e)}i(void 0)}))}}var _="index.html";function b(){var e=(0,s.A)("");return"".concat(e).concat(_)}function E(e){var t=e.identifier,r=e.queryInfo,s=e.name,a=b();if(!s)return a;var n=t?"#".concat(s,"/").concat(t):"#".concat(s),i=r?"?".concat(function(e){return Object.keys(e).map((function(t){return"".concat(t,"=").concat(e[t])})).join("&")}(r)):"";return encodeURI("".concat(a).concat(n).concat(i))}function A(e){return T.apply(this,arguments)}function T(){return(T=S(f().mark((function e(t){var r;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={url:t},e.next=3,(0,a.U)(r);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function C(e){var t,r=e.existingTabs,s=e.focusedWindow,a=r.filter((function(e){return e.active})),n=a.find((function(e){return e.windowId===s.id})),i=a.pop(),o=r.pop();return null!=(t=null!=n?n:i)?t:o}function x(e){return R.apply(this,arguments)}function R(){return(R=S(f().mark((function e(t){var r,s,a,c,u,d;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.path,s=t.tabs,e.next=3,(0,n.T)();case 3:if(a=e.sent,c=C({existingTabs:s,focusedWindow:a})){e.next=7;break}return e.abrupt("return");case 7:if(c.windowId!==a.id&&(0,i.V)(c.windowId,{focused:!0}),c.id){e.next=10;break}return e.abrupt("return");case 10:return u=r===b()?{}:{url:r},d=g({active:!0},u),e.next=14,(0,o.V)(c.id,d);case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function I(e){return P.apply(this,arguments)}function P(){return P=S(f().mark((function e(t){var r,s,a,n,i;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.id,s=t.query,a=t.route,n=E({identifier:r,queryInfo:s,name:a}),e.next=4,p();case 4:if(!(i=e.sent).length){e.next=9;break}return e.next=8,x({path:n,tabs:i});case 8:return e.abrupt("return");case 9:return e.next=11,A(n);case 11:case"end":return e.stop()}}),e)}))),P.apply(this,arguments)}},61476:(e,t,r)=>{"use strict";r.d(t,{J:()=>o});var s=r(86952),a=r(46047),n=r(70219),i=r(26331);const o=(0,s.Q)({name:"permissions",commands:{addGroupManager:a.B,removeGroupManager:n.d},events:{},queries:{userPermissions:i.l}})},46047:(e,t,r)=>{"use strict";r.d(t,{B:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},70219:(e,t,r)=>{"use strict";r.d(t,{d:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},26331:(e,t,r)=>{"use strict";r.d(t,{l:()=>n});var s=r(99059),a=r(25029);class n extends((0,s.k)({scope:a.F.Device})){}},43897:(e,t,r)=>{"use strict";r.d(t,{B:()=>C});var s,a=r(88802),n=r(99634),i=r(61476),o=r(6447),c=r(63663),u=r(46047),d=r(60399),l=r(57924),p=r(94189),h=r(73404),m=r(53576),y=r(87279),g=r(48844);!function(e){e[e.GroupManager=0]="GroupManager"}(s||(s={}));let v=class{constructor(e,t){this.serverApiClient=e,this.client=t}async addRole({role:e,params:t}){if(e===s.GroupManager)return await this.addGroupManager(t)}async removeRole({role:e,params:t}){if(e===s.GroupManager)return await this.removeGroupManager(t)}async getSpecialUserGroupRevision(e){const{commands:{carbon:t}}=this.client.getClient(m.carbonLegacyApi),r=await t({name:"getSpecialUserGroupRevision",args:[{teamId:e}]});let s;if(!(0,y.d6)(r))throw r.error.error;{const{carbonResult:e}=r.data,{specialUserGroupRevision:t}=e;s=t}return s}async removeGroupManager({memberLogin:e,teamId:t}){const r=await this.getSpecialUserGroupRevision(t);return await(0,d.z)(this.serverApiClient.v1.teams.removeGroupManager({memberLogin:e,userGroupRevision:r}).pipe((0,g.DZ)((e=>{throw new Error(e.message)})),(0,g.lk)((e=>{if(e.data)return(0,y.Vp)(void 0);throw new Error("Unknown server error occurred while attempting to remove group manager")}))))}async addGroupManager({memberLogin:e,teamId:t}){const r=await this.getSpecialUserGroupRevision(t),{commands:{carbon:s}}=this.client.getClient(m.carbonLegacyApi),a=await s({name:"getSpecialUserGroupInviteValuesForMemberInTeam",args:[{memberLogin:e,teamId:t}]});let n="",i="";if(!(0,y.d6)(a))throw a.error.error;{const{carbonResult:e}=a.data,{groupKey:t,proposeSignature:r}=e;n=t,i=r}return await(0,d.z)(this.serverApiClient.v1.teams.addGroupManager({memberLogin:e,groupKey:n,proposeSignature:i,userGroupRevision:r}).pipe((0,g.DZ)((e=>{throw new Error(e.message)})),(0,g.lk)((e=>{if(e.data)return(0,y.Vp)(void 0);throw new Error("Unknown server error occurred while attempting to add group manager")}))))}};v=(0,a.__decorate)([(0,l.GS)(),(0,a.__metadata)("design:paramtypes",[h.l,p.w])],v);let f=class{constructor(e){this.roleService=e}async execute({body:e}){return await this.roleService.addRole({role:s.GroupManager,params:e})}};f=(0,a.__decorate)([(0,c.W)(u.B),(0,a.__metadata)("design:paramtypes",[v])],f);var w=r(70219);let S=class{constructor(e){this.roleService=e}async execute({body:e}){return await this.roleService.removeRole({role:s.GroupManager,params:e})}};S=(0,a.__decorate)([(0,c.W)(w.d),(0,a.__metadata)("design:paramtypes",[v])],S);var _=r(26331),b=r(20754);const E=r(7165).z.enum(["GROUP_CREATE","GROUP_DELETE","GROUP_EDIT","GROUP_READ"]);let A=class{constructor(e){this.serverApiClient=e}getActiveUserPermissions(){return this.serverApiClient.v1.teams.getUserPermissions().pipe((0,g.DZ)((e=>{throw new Error(`getUserPermissions failed with error: ${e}`)})),(0,g.lk)((e=>(0,y.Vp)(this.serverToDomainPermissionsMapper(e.data.permissions)))))}serverToDomainPermissionsMapper(e){return e.filter((e=>E.safeParse(e).success))}};A=(0,a.__decorate)([(0,l.GS)(),(0,a.__metadata)("design:paramtypes",[h.l])],A);let T=class{constructor(e){this.permissionsService=e}execute(){return this.permissionsService.getActiveUserPermissions()}};T=(0,a.__decorate)([(0,b.e)(_.l),(0,a.__metadata)("design:paramtypes",[A])],T);let C=class{};C=(0,a.__decorate)([(0,n.Y)({api:i.J,imports:[o.n],providers:[A,v],handlers:{commands:{addGroupManager:f,removeGroupManager:S},events:{},queries:{userPermissions:T}}})],C)},18183:(e,t,r)=>{"use strict";r.d(t,{j:()=>S});var s=r(86952),a=r(13060),n=r(22481),i=r(74593),o=r(23823),c=r(78519),u=r(6790),d=r(78548),l=r(60017),p=r(24662),h=r(77539),m=r(22632),y=r(14074),g=r(40956),v=r(22618),f=r(36261),w=r(80448);const S=(0,s.Q)({name:"accountRecoveryKey",commands:{goToActivationNextStep:a.Z,goToActivationPrevStep:n.H,requestActivation:i.e,cancelActivation:o.w,cancelGeneration:c.r,confirmActivation:u.W,confirmNewPassword:d.v,deactivate:l.E,submitRecoveryKey:p.Y,tryAgainRecovery:h.d,cancelRecoveryFlow:m.b,startRecoveryFlow:y.Q},queries:{activationFlowStatus:g.S,accountRecoveryKeyStatus:v.D,recoveryFlowStatus:f.y,recoveryMethodsInfo:w.V},events:{}})},23823:(e,t,r)=>{"use strict";r.d(t,{w:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},78519:(e,t,r)=>{"use strict";r.d(t,{r:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},22632:(e,t,r)=>{"use strict";r.d(t,{b:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.Device})){}},6790:(e,t,r)=>{"use strict";r.d(t,{W:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},78548:(e,t,r)=>{"use strict";r.d(t,{v:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.Device})){}},60017:(e,t,r)=>{"use strict";r.d(t,{E:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},13060:(e,t,r)=>{"use strict";r.d(t,{Z:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},22481:(e,t,r)=>{"use strict";r.d(t,{H:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},74593:(e,t,r)=>{"use strict";r.d(t,{e:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},14074:(e,t,r)=>{"use strict";r.d(t,{Q:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.Device})){}},24662:(e,t,r)=>{"use strict";r.d(t,{Y:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.Device})){}},77539:(e,t,r)=>{"use strict";r.d(t,{d:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.Device})){}},22618:(e,t,r)=>{"use strict";r.d(t,{D:()=>n});var s=r(99059),a=r(25029);class n extends((0,s.k)({scope:a.F.Device})){}},40956:(e,t,r)=>{"use strict";r.d(t,{S:()=>n});var s=r(99059),a=r(25029);class n extends((0,s.k)({scope:a.F.User})){}},36261:(e,t,r)=>{"use strict";r.d(t,{y:()=>n});var s=r(99059),a=r(25029);class n extends((0,s.k)({scope:a.F.Device})){}},80448:(e,t,r)=>{"use strict";r.d(t,{V:()=>n});var s=r(99059),a=r(25029);class n extends((0,s.k)({scope:a.F.User})){}},8443:(e,t,r)=>{"use strict";r.d(t,{D:()=>pt});var s=r(88802),a=r(18183),n=r(11433),i=r(99634),o=r(38679),c=r(6447),u=r(37935),d=r(80310),l=r(87279),p=r(63663),h=r(13060),m=r(64472),y=r(24966),g=r(57924),v=r(31948),f=r(5331),w=r(60399),S=r(30523),_=r(87065),b=r(53576),E=r(73404),A=r(21869),T=r(48844),C=r(18533),x=r(20195),R=r(25029),I=r(95681),P=r(23347);const D=e=>!(!e||"object"!=typeof e)&&"isEnabled"in e;class U extends((0,I.Q)({initialValue:{isEnabled:void 0,login:void 0},persist:!1,scope:R.F.Device,storeName:"account-recovery-key",storeTypeGuard:D,capacity:P.Y._001KB})){}const F=["email_token","totp","duo_push","dashlane_authenticator"],O=e=>"object"==typeof e&&"type"in e;var N,k=r(96168);!function(e){e.GENERIC_ERROR="GENERIC_ERROR",e.NETWORK_ERROR="NETWORK_ERROR",e.INITIALIZE_MACHINE_ERROR="INITIALIZE_MACHINE_ERROR",e.WRONG_RECOVERY_KEY_ERROR="WRONG_RECOVERY_KEY_ERROR",e.CHANGE_MASTER_PASSWORD_ERROR="CHANGE_MASTER_PASSWORD_ERROR"}(N||(N={}));class L extends((0,k.Hu)(N.NETWORK_ERROR,"There is an issue with your connection")){}let M=class{constructor(e,t,r,s){this.store=e,this.serverApiClient=t,this.carbon=r,this.context=s}getCurrentUserLogin(){return this.context.get(A.l.UserName)}getAuthTicketInfo(){const{carbonState:e}=this.carbon.queries;return(0,w.z)(e({path:"userSession.authTicketInfo"}).pipe((0,T.nb)({success:e=>e,failure:()=>{throw new Error("Failure getting auth ticket info")}})))}retrieveLocalAccounts(){const{carbonState:e}=this.carbon.queries;return(0,w.z)(e({path:"authentication.localAccounts"}).pipe((0,S.h)(l.d6),(0,S.h)((e=>e.data.accountsListInitialized)),(0,_.U)((e=>e.data.accountsList))))}async getCurrentPersonalSettings(){const{carbonStateList:e}=this.carbon.queries;return await(0,w.z)(e({paths:["userSession.personalSettings.AccountRecoveryKey","userSession.personalSettings.AccountRecoveryKeyId"]}).pipe((0,T.nb)({success:([e,t])=>({AccountRecoveryKey:e,AccountRecoveryKeyId:t}),failure:()=>{throw new Error("Failure getting state list")}})))}getLastAuthenticatedUserRecoveryData(){return this.store.state$.pipe((0,_.U)((e=>({isEnabled:e.isEnabled,login:e.login}))))}async updateLastAuthenticatedUserRecoveryStatus(e){if(!e)throw new Error("No user login provided");const t=await(0,w.z)(this.serverApiClient.v1.accountrecovery.getStatus({login:e}));if((0,l.hx)(t))throw new Error("Server call failed");await this.store.set({isEnabled:t.data.data.enabled,login:e})}async generateRecoveryKey(){const{carbon:e}=this.carbon.commands,t={length:28,digits:!0,letters:!0,avoidAmbiguous:!0,symbols:!1};return await e({name:"generatePassword",args:[{settings:t}]})}async setPersonalSettings(e){const{carbon:t}=this.carbon.commands;return await t({name:"updateAccountRecoveryKeyPersonalSettings",args:[e]})}async getPreferredVerificationMethod(e){return await(0,w.z)(this.serverApiClient.v1.authentication.getAuthenticationMethodsForDevice({login:e,methods:F}).pipe((0,T.DZ)((e=>(0,C.EQ)(e,{BusinessError:()=>{throw new Error(N.GENERIC_ERROR)},FetchFailedError:()=>new L,BadStatus:x.j}))),(0,T.lk)((e=>{const t=e.data.verifications.find(O);if(t)return(0,l.Vp)(t);throw new Error("Unsupported authentication method")}))))}async requestActivation(e){return await(0,w.z)(this.serverApiClient.v1.accountrecovery.requestActivation({encryptedVaultKey:e}).pipe((0,T.DZ)((e=>(0,C.EQ)(e,{BusinessError:()=>{throw new Error(N.GENERIC_ERROR)},FetchFailedError:()=>new L,BadStatus:x.j}))),(0,T.lk)((e=>{if(e.data.recoveryId)return(0,l.Vp)(e.data.recoveryId);throw new Error(N.GENERIC_ERROR)}))))}async confirmActivation(e){return await(0,w.z)(this.serverApiClient.v1.accountrecovery.confirmActivation({recoveryId:e}).pipe((0,T.DZ)((e=>(0,C.EQ)(e,{BusinessError:()=>{throw new Error(N.GENERIC_ERROR)},FetchFailedError:()=>new L,BadStatus:x.j}))),(0,T.lk)((()=>(0,l.Vp)(void 0)))))}async deactivate(e){return await(0,w.z)(this.serverApiClient.v1.accountrecovery.deactivate({reason:e}).pipe((0,T.DZ)((e=>(0,C.EQ)(e,{BusinessError:()=>{throw new Error(N.GENERIC_ERROR)},FetchFailedError:()=>new L,BadStatus:x.j}))),(0,T.lk)((()=>(0,l.Vp)(void 0)))))}async getEncryptedVaultKey(e,t){return await(0,w.z)(this.serverApiClient.v1.accountrecovery.getEncryptedVaultKey({login:e,authTicket:t}).pipe((0,T.DZ)((e=>(0,C.EQ)(e,{BusinessError:()=>{throw new Error(N.GENERIC_ERROR)},FetchFailedError:()=>new L,BadStatus:x.j}))),(0,T.lk)((e=>{const{encryptedVaultKey:t,recoveryId:r}=e.data;if(t&&r)return(0,l.Vp)({encryptedVaultKey:t,recoveryId:r});throw new Error(N.GENERIC_ERROR)}))))}};M=(0,s.__decorate)([(0,g.GS)(),(0,s.__metadata)("design:paramtypes",[U,E.l,b.CarbonLegacyClient,A.f])],M);let V=class{constructor(e){this.recoveryKeyService=e}async execute(){try{const e=await(0,w.z)(this.recoveryKeyService.getLastAuthenticatedUserRecoveryData());return Promise.resolve({isFeatureEnabled:e.isEnabled,recoveryKey:"",recoveryId:"",encryptedVaultKey:""})}catch(e){return Promise.reject(new Error("Unable to retrieve initialization data"))}}};V=(0,s.__decorate)([(0,g.GS)(),(0,s.__metadata)("design:paramtypes",[M])],V);var G=r(54066),q=r(10370),j=r(89685),K=r(56268),W=r(66122),B=r(94805),H=r(16698);let z=class{constructor(e,t){this.carbon=e,this.flexibleEncryptor=t}makeDerivationConfig(e){const[,,t]=e.split("$");return"pbkdf2"===t?B.E1:B.mr}async getUserCryptoConfig(){const{carbonStateList:e}=this.carbon.queries;return await(0,w.z)(e({paths:["userSession.personalSettings.CryptoFixedSalt","userSession.personalSettings.CryptoUserPayload"]}).pipe((0,T.nb)({success:([e,t])=>{if("string"!=typeof e)throw new Error("Fixed salt is not a string");if("string"!=typeof t)throw new Error("Marker is not a string");return{fixedSalt:e,derivationConfig:this.makeDerivationConfig(t)}},failure:()=>{throw new Error("Failure getting state list")}})))}async getUserMasterPassword(){const{carbonState:e}=this.carbon.queries;return await(0,w.z)(e({path:"userSession.session.masterPassword"}).pipe((0,_.U)((e=>{if(!(0,l.d6)(e))throw new Error("Error when fetching master password from session");const t=e.data;if("string"!=typeof t)throw new Error("Result data is not a string");return(0,G.u)(t)}))))}async encrypt(e){const t=await this.getUserMasterPassword(),{derivationConfig:r,fixedSalt:s}=await this.getUserCryptoConfig();return await this.flexibleEncryptor.encrypt(e,t,r,H.Nw,{salt:(0,W.R)(s)})}};z=(0,s.__decorate)([(0,g.GS)(),(0,s.__metadata)("design:paramtypes",[b.CarbonLegacyClient,K._])],z);let $=class{constructor(e,t){this.accountRecoveryKeyService=e,this.recoveryKeyEncryptor=t}async executeWithParams(e){if(e.recoveryKey)return(0,l.Vp)({recoveryKey:e.recoveryKey,encryptedVaultKey:e.encryptedVaultKey,recoveryId:e.recoveryId});const t=await this.accountRecoveryKeyService.generateRecoveryKey();if((0,l.hx)(t))return(0,l.Rn)({tag:N.GENERIC_ERROR});const r=(0,G.u)(t.data.carbonResult.password.toUpperCase()),s=await this.recoveryKeyEncryptor.encrypt(r),a=(0,q.s)(s),n=await this.accountRecoveryKeyService.requestActivation(a);return(0,l.hx)(n)?(0,l.Rn)({tag:n.error.tag}):(0,l.Vp)({recoveryKey:(0,j.v)(r),encryptedVaultKey:a,recoveryId:n.data})}};$=(0,s.__decorate)([(0,g.GS)(),(0,s.__metadata)("design:paramtypes",[M,z])],$);var Q=r(92233),Y=r(76183);let X=class{constructor(e,t){this.accountRecoveryKeyService=e,this.syncService=t}async executeWithParams(e,t){const r=await this.accountRecoveryKeyService.getCurrentPersonalSettings(),s={AccountRecoveryKey:e,AccountRecoveryKeyId:t};if(await this.accountRecoveryKeyService.setPersonalSettings(s),(0,l.hx)(await this.syncService.waitForSync(Q.Trigger.SettingsChange)))return await this.accountRecoveryKeyService.setPersonalSettings(r),(0,l.Rn)({tag:N.GENERIC_ERROR});const a=await this.accountRecoveryKeyService.confirmActivation(t);if((0,l.hx)(a))return await this.accountRecoveryKeyService.setPersonalSettings(r),(0,l.hx)(await this.syncService.waitForSync(Q.Trigger.SettingsChange))?(0,l.Rn)({tag:N.GENERIC_ERROR}):(0,l.Rn)({tag:a.error.tag});const n=this.accountRecoveryKeyService.getCurrentUserLogin();if(!n)throw new Error("No user login provided");return await this.accountRecoveryKeyService.updateLastAuthenticatedUserRecoveryStatus(n),Promise.resolve((0,l.Vp)(void 0))}};X=(0,s.__decorate)([(0,g.GS)(),(0,s.__metadata)("design:paramtypes",[M,Y._])],X);let J=class{constructor(e,t,r){this.initializeMachineService=e,this.requestActivationService=t,this.confirmActivationService=r}create(){return(0,v.C)({predictableActionArguments:!0,schema:{events:{},context:{}},initial:"Starting",id:"ActivationFlowMachine",context:{isFeatureEnabled:!1,recoveryKey:"",recoveryId:"",encryptedVaultKey:""},states:{Starting:{invoke:{src:"initializeMachine",onDone:[{actions:["assignInitialContext"],target:"InitAccountRecoveryKeyActivation",cond:"isActivationFlow"},{actions:["assignInitialContext"],target:"GenerateNewAccountRecoveryKey"}]}},InitAccountRecoveryKeyActivation:{on:{REQUEST_ACTIVATION:{target:"RequestingActivation"}}},RequestingActivation:{invoke:{src:"requestActivation",onDone:[{cond:"isFunctionalError",actions:["assignFunctionalError"],target:"AccountRecoveryKeyActivationError"},{actions:["assignKeys"],target:"DisplayAccountRecoveryKey"}],onError:{actions:["assignGenericError"],target:"AccountRecoveryKeyActivationError"}}},DisplayAccountRecoveryKey:{on:{GO_TO_NEXT_STEP:{target:"ConfirmAccountRecoveryKey"}}},ConfirmAccountRecoveryKey:{on:{GO_TO_NEXT_STEP:{target:"FinalisingAccountRecoveryKeyActivation"},GO_TO_PREV_STEP:{target:"DisplayAccountRecoveryKey"}}},FinalisingAccountRecoveryKeyActivation:{invoke:{src:"confirmActivation",onDone:[{cond:"isFunctionalError",actions:["assignFunctionalError"],target:"AccountRecoveryKeyActivationError"},{target:"AccountRecoveryKeyActivationDone"}],onError:{actions:["assignGenericError"],target:"AccountRecoveryKeyActivationError"}}},AccountRecoveryKeyActivationDone:{},GenerateNewAccountRecoveryKey:{on:{REQUEST_ACTIVATION:{target:"RequestingActivation"},CANCEL_GENERATION:{target:"CancelNewAccountRecoveryKey"}}},CancelNewAccountRecoveryKey:{on:{GO_TO_PREV_STEP:{target:"GenerateNewAccountRecoveryKey"}}},AccountRecoveryKeyActivationError:{}},on:{RESET_FLOW:{actions:["clearContext"],target:"Starting"}}},{actions:{assignInitialContext:(0,f.f0)({encryptedVaultKey:(e,t)=>t.data.encryptedVaultKey,recoveryKey:(e,t)=>t.data.recoveryKey,recoveryId:(e,t)=>t.data.recoveryId,isFeatureEnabled:(e,t)=>t.data.isFeatureEnabled}),assignKeys:(0,f.f0)({recoveryKey:(e,t)=>t.data.data.recoveryKey,encryptedVaultKey:(e,t)=>t.data.data.encryptedVaultKey,recoveryId:(e,t)=>t.data.data.recoveryId}),assignFunctionalError:(0,f.f0)({error:(e,t)=>t.data.error.tag}),assignGenericError:(0,f.f0)({error:()=>N.GENERIC_ERROR}),clearContext:(0,f.f0)({encryptedVaultKey:()=>"",recoveryKey:()=>"",recoveryId:()=>"",error:()=>{}})},services:{initializeMachine:()=>this.initializeMachineService.execute(),requestActivation:e=>this.requestActivationService.executeWithParams(e),confirmActivation:e=>this.confirmActivationService.executeWithParams(e.recoveryKey,e.recoveryId)},guards:{isActivationFlow:(e,t)=>function(e){return e.type.startsWith("done.invoke.ActivationFlowMachine.Starting")}(t)&&!t.data.isFeatureEnabled,isFunctionalError:(e,t)=>(function(e){return e.type.startsWith("done.invoke.ActivationFlowMachine.RequestingActivation")}(t)||function(e){return e.type.startsWith("done.invoke.ActivationFlowMachine.FinalisingAccountRecoveryKeyActivation")}(t))&&(0,l.hx)(t.data)}})}};J=(0,s.__decorate)([(0,g.GS)(),(0,s.__metadata)("design:paramtypes",[V,$,X])],J);var Z=r(26290);const ee=e=>!0;class te extends((0,I.Q)({initialValue:void 0,persist:!1,scope:R.F.Device,storeName:"activation-flow-machine",storeTypeGuard:ee})){}let re=class{constructor(e,t){this.activationMachineStore=t;const r=e.create();this.interpreter=m.kJ(r).onTransition((async e=>{e.changed||"xstate.init"===e.event.type||console.warn(`[ARK Activation] State is unchanged. Unexpected transition on ${JSON.stringify(e.value)} with event ${e.event.type} `);try{const e=this.interpreter?.getSnapshot();e&&await(async(e,t)=>{await e.set(JSON.stringify(t))})(this.activationMachineStore,e)}catch(e){console.warn("[ARK Activation] Unable to get snapshot",e)}}))}async prepare(){if(this.interpreter)try{const e=await(async e=>{const t=await e.getState();return t?Z.ZM.create(JSON.parse(t)):void 0})(this.activationMachineStore);try{this.interpreter.start(e)}catch(e){console.error("[ARK Activation] Unable to reuse the stored state: ",e),this.interpreter.start()}}catch(e){console.error("[ARK Activation] Unable to start machine",e)}}ready(){return new y.X(!0)}continue(e){if(!this.interpreter)throw new Error("Activation flow not started");this.interpreter.send(e)}stop(){this.isStarted()&&(this.interpreter=void 0)}isStarted(){return Boolean(this.interpreter)}};re=(0,s.__decorate)([(0,g.GS)(),(0,s.__metadata)("design:paramtypes",[J,te])],re);let se=class{constructor(e){this.activationFlow=e}execute(){return this.activationFlow.continue({type:"GO_TO_NEXT_STEP"}),Promise.resolve((0,l.Vp)(void 0))}};se=(0,s.__decorate)([(0,p.W)(h.Z),(0,s.__metadata)("design:paramtypes",[re])],se);var ae=r(22481);let ne=class{constructor(e){this.activationFlow=e}execute(){return this.activationFlow.continue({type:"GO_TO_PREV_STEP"}),Promise.resolve((0,l.Vp)(void 0))}};ne=(0,s.__decorate)([(0,p.W)(ae.H),(0,s.__metadata)("design:paramtypes",[re])],ne);var ie=r(74593);let oe=class{constructor(e){this.activationFlow=e}execute(){return this.activationFlow.continue({type:"REQUEST_ACTIVATION"}),Promise.resolve((0,l.Vp)(void 0))}};oe=(0,s.__decorate)([(0,p.W)(ie.e),(0,s.__metadata)("design:paramtypes",[re])],oe);var ce=r(23823);let ue=class{constructor(e){this.activationFlow=e}execute(){return this.activationFlow.continue({type:"RESET_FLOW"}),Promise.resolve((0,l.Vp)(void 0))}};ue=(0,s.__decorate)([(0,p.W)(ce.w),(0,s.__metadata)("design:paramtypes",[re])],ue);var de=r(78519);let le=class{constructor(e){this.activationFlow=e}execute(){return this.activationFlow.continue({type:"CANCEL_GENERATION"}),Promise.resolve((0,l.Vp)(void 0))}};le=(0,s.__decorate)([(0,p.W)(de.r),(0,s.__metadata)("design:paramtypes",[re])],le);var pe=r(6790);let he=class{constructor(e){this.activationFlow=e}execute(){return this.activationFlow.continue({type:"GO_TO_NEXT_STEP"}),Promise.resolve((0,l.Vp)(void 0))}};he=(0,s.__decorate)([(0,p.W)(pe.W),(0,s.__metadata)("design:paramtypes",[re])],he);var me=r(78548);let ye=class{constructor(e){this.recoveryKeyService=e}async execute(){try{const{authTicket:e}=await this.recoveryKeyService.getAuthTicketInfo();return Promise.resolve(e??"")}catch(e){return Promise.reject(new Error("Unable to retrieve initialization data"))}}};ye=(0,s.__decorate)([(0,g.GS)(),(0,s.__metadata)("design:paramtypes",[M])],ye);var ge=r(25594);let ve=class{constructor(e){this.flexibleDecryptor=e}async decrypt(e,t){return await this.flexibleDecryptor.decrypt(e,t)}};ve=(0,s.__decorate)([(0,g.GS)(),(0,s.__metadata)("design:paramtypes",[ge.a])],ve);let fe=class{constructor(e,t){this.accountRecoveryKeyService=e,this.recoveryKeyDecryptor=t}async executeWithParams({login:e,authTicket:t,recoveryKey:r}){try{const s=await this.accountRecoveryKeyService.getEncryptedVaultKey(e,t);if((0,l.hx)(s))return Promise.reject(N.GENERIC_ERROR);const a=(0,G.u)(r),n=(0,W.R)(s.data.encryptedVaultKey),i=await this.recoveryKeyDecryptor.decrypt(a,n),o=(0,q.s)(i),c=atob(o);return Promise.resolve({oldPassword:c})}catch(e){return(s=e)instanceof Error&&s.message.includes("Signature cannot be verified")?Promise.reject(N.WRONG_RECOVERY_KEY_ERROR):Promise.reject(N.GENERIC_ERROR)}var s}};fe=(0,s.__decorate)([(0,g.GS)(),(0,s.__metadata)("design:paramtypes",[M,ve])],fe);let we=class{constructor(e){this.carbon=e}async executeWithParams(e){const{commands:t,queries:r}=this.carbon;try{const r=await t.carbonLegacyLeeloo({name:"openSessionWithMasterPassword",arg:[{login:e.login,password:e.oldPassword,rememberPassword:!1,requiredPermissions:void 0}]});if((0,l.hx)(r))return Promise.reject(new Error(`[ARK] - Error while trying to open session with deciphered recovery key: ${r.error}`));const s=await t.carbon({name:"changeMasterPassword",args:[{newPassword:e.newPassword,currentPassword:e.oldPassword,flow:"ACCOUNT_RECOVERY_KEY"}]});return(0,l.hx)(s)?Promise.reject(new Error(`[ARK] - Error while changing user Master Password: ${s.error}`)):Promise.resolve(void 0)}catch(e){const s=await(0,w.z)(r.carbonState({path:"userSession.account.isAuthenticated"}));return(0,l.d6)(s)&&s.data&&await t.carbonLegacyLeeloo({name:"closeSession",arg:[{}]}),Promise.reject(new Error(`[ARK] - Unable to change user Master Password: ${e}`))}}};we=(0,s.__decorate)([(0,g.GS)(),(0,s.__metadata)("design:paramtypes",[b.CarbonLegacyClient])],we);var Se=r(81822);let _e=class{constructor(e,t){this.recoveryKeyService=e,this.identityVerification=t,this.recoveryKeyService=e,this.identityVerification=t}async executeWithParams(e){try{const t=await this.recoveryKeyService.getPreferredVerificationMethod(e);if((0,l.hx)(t))throw new Error("Unable to retrieve verifications methods for login");const r=t.data.type;return this.identityVerification.commands.startIdentityVerification({login:e,verificationMethod:r}),Promise.resolve(void 0)}catch(e){return Promise.reject(new Error("Something went wrong..."))}}};_e=(0,s.__decorate)([(0,g.GS)(),(0,s.__metadata)("design:paramtypes",[M,Se.l])],_e);let be=class{constructor(e,t,r,s){this.initializeMachineService=e,this.checkAccountRecoveryKeyService=t,this.changeMasterPasswordService=r,this.requestAuthenticationMethodForLoginService=s}create(){return(0,v.C)({predictableActionArguments:!0,schema:{events:{},context:{}},initial:"Idle",id:"RecoveryFlowMachine",context:{login:"",authTicket:"",newPassword:"",recoveryKey:"",oldPassword:"",encryptedVaultKey:""},states:{Idle:{entry:["clearContext"],on:{START_RECOVERY_FLOW:{target:"Starting",actions:["assignAccountEmail"]}}},Starting:{invoke:{src:"initializeMachine",onDone:[{actions:["assignInitialContext"],target:"IdentityVerification",cond:"isAuthTicketNeeded"},{actions:["assignInitialContext"],target:"EnterRecoveryKey"}]}},IdentityVerification:{entry:["requestAuthenticationMethodForLogin"]},EnterRecoveryKey:{on:{SUBMIT_RECOVERY_KEY:{actions:["assignRecoveryKey"],target:"CheckAccountRecoveryKey"}}},CheckAccountRecoveryKey:{invoke:{src:"checkAccountRecoveryKey",onDone:{actions:["assignOldPassword"],target:"ChangeMasterPassword"},onError:{actions:["assignError"],target:"EnterRecoveryKey"}}},ChangeMasterPassword:{on:{CONFIRM_NEW_PASSWORD:{actions:["assignNewPassword"],target:"FinalisingRecovery"}}},FinalisingRecovery:{invoke:{src:"changeMasterPassword",onDone:{target:"RecoverySuccess"},onError:{actions:["assignError"],target:"RecoveryError"}}},RecoveryError:{on:{TRY_AGAIN:{actions:["clearError"],target:"ChangeMasterPassword"}}},RecoverySuccess:{type:"final"}},on:{CLEAR_ERROR:{actions:["clearError"]},IDENTITY_VERIFICATION_COMPLETE:{actions:["assignAuthTicket"],target:"EnterRecoveryKey"},CANCEL_RECOVERY_FLOW:{target:"Idle"}}},{actions:{assignAccountEmail:(0,f.f0)({login:(e,t)=>t.login}),assignInitialContext:(0,f.f0)({authTicket:(e,t)=>t.data}),assignAuthTicket:(0,f.f0)({authTicket:(e,t)=>t.authTicket}),assignNewPassword:(0,f.f0)({newPassword:(e,t)=>t.password}),assignRecoveryKey:(0,f.f0)({recoveryKey:(e,t)=>t.recoveryKey}),assignOldPassword:(0,f.f0)({oldPassword:(e,t)=>t.data.oldPassword}),assignError:(0,f.f0)({error:(e,t)=>t.data}),clearError:(0,f.f0)({error:()=>{}}),requestAuthenticationMethodForLogin:e=>this.requestAuthenticationMethodForLoginService.executeWithParams(e.login),clearContext:(0,f.f0)({login:()=>"",newPassword:()=>"",localAccounts:()=>[],recoveryKey:()=>"",oldPassword:()=>"",encryptedVaultKey:()=>"",authTicket:()=>""})},services:{initializeMachine:()=>this.initializeMachineService.execute(),checkAccountRecoveryKey:e=>this.checkAccountRecoveryKeyService.executeWithParams(e),changeMasterPassword:e=>this.changeMasterPasswordService.executeWithParams(e)},guards:{isAuthTicketNeeded:(e,t)=>!t.data}})}};be=(0,s.__decorate)([(0,g.GS)(),(0,s.__metadata)("design:paramtypes",[ye,fe,we,_e])],be);const Ee=e=>!0;class Ae extends((0,I.Q)({initialValue:void 0,persist:!1,scope:R.F.Device,storeName:"recovery-flow-machine",storeTypeGuard:Ee})){}let Te=class{constructor(e,t){this.recoveryMachineStore=t;const r=e.create();this.interpreter=m.kJ(r).onTransition((async e=>{e.changed||"xstate.init"===e.event.type||console.warn(`[ARK Recovery] State is unchanged. Unexpected transition on ${JSON.stringify(e.value)} with event ${e.event.type} `);try{const e=this.interpreter?.getSnapshot();e&&await(async(e,t)=>{await e.set(JSON.stringify(t))})(this.recoveryMachineStore,e)}catch(e){console.warn("[ARK Recovery] Unable to get snapshot",e)}}))}async prepare(){if(this.interpreter)try{const e=await(async e=>{const t=await e.getState();return t?Z.ZM.create(JSON.parse(t)):void 0})(this.recoveryMachineStore);try{this.interpreter.start(e)}catch(e){console.error("[ARK Recovery] Unable to reuse the stored state: ",e),this.interpreter.start()}}catch(e){console.error("[ARK Recovery] Unable to start machine",e)}}ready(){return new y.X(!0)}continue(e){if(!this.interpreter)throw new Error("Recovery flow not started");this.interpreter.send(e)}stop(){this.isStarted()&&(this.interpreter=void 0)}isStarted(){return Boolean(this.interpreter)}};Te=(0,s.__decorate)([(0,g.GS)(),(0,s.__metadata)("design:paramtypes",[be,Ae])],Te);let Ce=class{constructor(e){this.recoveryFlow=e,this.recoveryFlow=e}execute(e){return this.recoveryFlow.continue({type:"CONFIRM_NEW_PASSWORD",password:e.body.password}),Promise.resolve((0,l.Vp)(void 0))}};Ce=(0,s.__decorate)([(0,p.W)(me.v),(0,s.__metadata)("design:paramtypes",[Te])],Ce);var xe=r(60017),Re=r(26457),Ie=r(9671);let Pe=class{constructor(e,t,r,s,a){this.accountRecoveryKeyService=e,this.activationFlow=t,this.syncService=r,this.logger=s,this.allowedToFail=a}async execute(e){const{reason:t}=e.body,r=await this.accountRecoveryKeyService.deactivate(t);if((0,l.hx)(r))return this.logger.trace("Deactivate ARK: "+r.error.message),(0,l.Rn)({tag:r.error.tag});const s=this.accountRecoveryKeyService.getCurrentUserLogin();return s?(await this.accountRecoveryKeyService.updateLastAuthenticatedUserRecoveryStatus(s),this.activationFlow.continue({type:"RESET_FLOW"}),await this.accountRecoveryKeyService.setPersonalSettings({AccountRecoveryKey:void 0,AccountRecoveryKeyId:void 0}),await this.allowedToFail.doOne((async()=>await this.syncService.waitForSync(Q.Trigger.SettingsChange)),"waitForSync"),(0,l.Vp)(void 0)):(this.logger.trace("Deactivate ARK: No user login provided"),(0,l.Rn)({tag:N.GENERIC_ERROR}))}};Pe=(0,s.__decorate)([(0,p.W)(xe.E),(0,s.__metadata)("design:paramtypes",[M,re,Y._,Re.V,Ie.J])],Pe);var De=r(24662);let Ue=class{constructor(e){this.recoveryFlow=e}execute(e){return this.recoveryFlow.continue({type:"SUBMIT_RECOVERY_KEY",recoveryKey:e.body.recoveryKey}),Promise.resolve((0,l.Vp)(void 0))}};Ue=(0,s.__decorate)([(0,p.W)(De.Y),(0,s.__metadata)("design:paramtypes",[Te])],Ue);var Fe=r(77539);let Oe=class{constructor(e){this.recoveryFlow=e}execute(){return this.recoveryFlow.continue({type:"TRY_AGAIN"}),Promise.resolve((0,l.Vp)(void 0))}};Oe=(0,s.__decorate)([(0,p.W)(Fe.d),(0,s.__metadata)("design:paramtypes",[Te])],Oe);var Ne=r(22632),ke=r(94189);let Le=class{constructor(e,t){this.recoveryFlow=e,this.cqrsClient=t,this.recoveryFlow=e}execute(){return this.recoveryFlow.continue({type:"CANCEL_RECOVERY_FLOW"}),this.cqrsClient.getClient(n.i).commands.cancelIdentityVerification(),Promise.resolve((0,l.Vp)(void 0))}};Le=(0,s.__decorate)([(0,p.W)(Ne.b),(0,s.__metadata)("design:paramtypes",[Te,ke.w])],Le);var Me=r(14074);let Ve=class{constructor(e){this.recoveryFlow=e,this.recoveryFlow=e}execute(e){const{login:t}=e.body;return this.recoveryFlow.continue({type:"START_RECOVERY_FLOW",login:t}),Promise.resolve((0,l.Vp)(void 0))}};Ve=(0,s.__decorate)([(0,p.W)(Me.Q),(0,s.__metadata)("design:paramtypes",[Te])],Ve);var Ge,qe,je=r(85390),Ke=r(6136),We=r(20754),Be=r(40956),He=r(69885),ze=r(6220);!function(e){e[e.InitActivation=0]="InitActivation",e[e.RequestActivation=1]="RequestActivation",e[e.DisplayKey=2]="DisplayKey",e[e.ConfirmKey=3]="ConfirmKey",e[e.FinaliseActivation=4]="FinaliseActivation",e[e.ActivationDone=5]="ActivationDone",e[e.ShowError=6]="ShowError",e[e.GenerateNewKey=7]="GenerateNewKey",e[e.CancelGenerateNewKey=8]="CancelGenerateNewKey"}(Ge||(Ge={})),function(e){e[e.InitRecovery=0]="InitRecovery",e[e.IdentityVerification=1]="IdentityVerification",e[e.EnterRecoveryKey=2]="EnterRecoveryKey",e[e.CheckAccountRecoveryKey=3]="CheckAccountRecoveryKey",e[e.ChangeMasterPassword=4]="ChangeMasterPassword",e[e.Finalising=5]="Finalising",e[e.Success=6]="Success",e[e.Failure=7]="Failure"}(qe||(qe={}));const $e=e=>(0,He.of)((0,l.Vp)(function(e){if(!e.matches("Starting"))return e.matches("InitAccountRecoveryKeyActivation")?{step:Ge.InitActivation}:e.matches("RequestingActivation")?{step:Ge.RequestActivation}:e.matches("DisplayAccountRecoveryKey")?{step:Ge.DisplayKey,recoveryKey:e.context.recoveryKey}:e.matches("ConfirmAccountRecoveryKey")?{step:Ge.ConfirmKey,recoveryKey:e.context.recoveryKey}:e.matches("FinalisingAccountRecoveryKeyActivation")?{step:Ge.FinaliseActivation}:e.matches("AccountRecoveryKeyActivationDone")?{step:Ge.ActivationDone,isFeatureEnabled:e.context.isFeatureEnabled}:e.matches("AccountRecoveryKeyActivationError")?{step:Ge.ShowError,error:e.context.error}:e.matches("GenerateNewAccountRecoveryKey")?{step:Ge.GenerateNewKey}:e.matches("CancelNewAccountRecoveryKey")?{step:Ge.CancelGenerateNewKey}:void console.warn("[ARK Activation] - No view associated to state ",e.value)}(e))),Qe=e=>e.pipe((0,ze.z)($e));var Ye=r(52800);const Xe=(e,t)=>{const r=t.matches(e.value),s=(0,Ye.Z)(e.context,t.context);return r&&s};let Je=class{constructor(e,t){this.activationFlow=e,this.activationFlowMachineStore=t}execute(){return(0,je.a)([(e=this.activationFlowMachineStore,e.state$.pipe((0,_.U)((e=>e?Z.ZM.create(JSON.parse(e)):void 0)))),this.activationFlow.ready()],((e,t)=>{if(e&&t)return e})).pipe((0,S.h)(Boolean),(0,Ke.x)(((e,t)=>Xe(e,t))),Qe);var e}};Je=(0,s.__decorate)([(0,We.e)(Be.S),(0,s.__metadata)("design:paramtypes",[re,te])],Je);var Ze=r(43978),et=r(22618);let tt=class{constructor(e){this.accountRecoveryKeyService=e}execute({body:e}){const{login:t}=e;return""===t?(0,He.of)((0,l.Vp)({isEnabled:!1})):this.accountRecoveryKeyService.getLastAuthenticatedUserRecoveryData().pipe((0,Ze.w)((async e=>(void 0!==e.isEnabled&&t===e.login||await this.accountRecoveryKeyService.updateLastAuthenticatedUserRecoveryStatus(t),e))),(0,_.U)((e=>(0,l.Vp)({isEnabled:e.isEnabled}))))}};tt=(0,s.__decorate)([(0,We.e)(et.D),(0,s.__metadata)("design:paramtypes",[M])],tt);var rt=r(162),st=r(80448);let at=class{constructor(e,t){this.accountRecoveryKeyService=e,this.client=t}execute(){const e=this.accountRecoveryKeyService.getCurrentUserLogin();if(!e)throw new Error("No user login provided");const t=(0,rt.D)(this.accountRecoveryKeyService.updateLastAuthenticatedUserRecoveryStatus(e)).pipe((0,Ze.w)((()=>this.client.getClient(b.carbonLegacyApi).queries.carbonState({path:"userSession.personalSettings.RecoveryOptIn"}))),(0,S.h)(l.d6),(0,_.U)((e=>"boolean"==typeof e.data&&e.data))),r=this.accountRecoveryKeyService.getLastAuthenticatedUserRecoveryData().pipe((0,_.U)((e=>void 0!==e.isEnabled&&e.isEnabled)));return(0,je.a)([t,r]).pipe((0,_.U)((([e,t])=>(0,l.Vp)({adminAssistedRecovery:e,accountRecoveryKey:t}))))}};at=(0,s.__decorate)([(0,We.e)(st.V),(0,s.__metadata)("design:paramtypes",[M,ke.w])],at);var nt=r(36261);const it=e=>(0,He.of)((0,l.Vp)(function(e){return e.matches("Starting")?{step:qe.InitRecovery,error:e.context.error}:e.matches("IdentityVerification")?{step:qe.IdentityVerification,login:e.context.login}:e.matches("EnterRecoveryKey")||e.matches("CheckAccountRecoveryKey")?{step:qe.EnterRecoveryKey,error:e.context.error}:e.matches("ChangeMasterPassword")?{step:qe.ChangeMasterPassword,error:e.context.error}:e.matches("FinalisingRecovery")?{step:qe.Finalising}:e.matches("RecoverySuccess")?{step:qe.Success}:e.matches("RecoveryError")?{step:qe.Failure}:void console.warn("[ARK Recovery] - No view associated to state ",e.value)}(e))),ot=e=>e.pipe((0,ze.z)(it));let ct=class{constructor(e,t){this.recoveryFlow=e,this.recoveryFlowMachineStore=t}execute(){return(0,je.a)([(e=this.recoveryFlowMachineStore,e.state$.pipe((0,_.U)((e=>e?Z.ZM.create(JSON.parse(e)):void 0)))),this.recoveryFlow.ready()],((e,t)=>{if(e&&t)return e})).pipe((0,S.h)(Boolean),(0,Ke.x)(((e,t)=>Xe(e,t))),ot);var e}};ct=(0,s.__decorate)([(0,We.e)(nt.y),(0,s.__metadata)("design:paramtypes",[Te,Ae])],ct);var ut=r(68307),dt=r(13089);let lt=class{constructor(e){this.recoveryFlow=e,this.recoveryFlow=e}handle(e){const{authTicket:t}=e.body;return this.recoveryFlow.continue({type:"IDENTITY_VERIFICATION_COMPLETE",authTicket:t}),Promise.resolve()}};lt=(0,s.__decorate)([(0,ut.b)(dt.w),(0,s.__metadata)("design:paramtypes",[Te])],lt);let pt=class{};pt=(0,s.__decorate)([(0,i.Y)({api:a.j,stores:[te,Ae,U],imports:[c.n,u.D,d.R],handlers:{commands:{goToActivationNextStep:se,goToActivationPrevStep:ne,requestActivation:oe,cancelActivation:ue,cancelGeneration:le,confirmActivation:he,confirmNewPassword:Ce,deactivate:Pe,submitRecoveryKey:Ue,tryAgainRecovery:Oe,cancelRecoveryFlow:Le,startRecoveryFlow:Ve},events:{...(0,i.g)(n.i,{identityVerificationCompleted:lt})},queries:{activationFlowStatus:Je,accountRecoveryKeyStatus:tt,recoveryMethodsInfo:at,recoveryFlowStatus:ct}},providers:[...(0,o.H)(re,{inject:[J,te],asyncFactory:async(e,t)=>{const r=new re(e,t);return await r.prepare(),r}}),...(0,o.H)(Te,{inject:[be,Ae],asyncFactory:async(e,t)=>{const r=new Te(e,t);return await r.prepare(),r}}),J,be,V,ye,fe,_e,M,$,X,ve,z,we]})],pt)},1534:(e,t,r)=>{"use strict";r.d(t,{D:()=>n});var s=r(86952),a=r(65446);const n=(0,s.Q)({name:"overrides",commands:{},events:{},queries:{OverridesQuery:a.N}})},65446:(e,t,r)=>{"use strict";r.d(t,{N:()=>n});var s=r(99059),a=r(25029);class n extends((0,s.k)({scope:a.F.Device})){}},5540:(e,t,r)=>{"use strict";r.d(t,{x:()=>R});var s=r(88802),a=r(99634);var n=r(1534),i=r(57924),o=r(26457),c=r(43702),u=r(25859),d=r(6220),l=r(87065),p=r(30523),h=r(39995);class m{constructor(e,t,r,s){this.settings=e,this.store=t,this.appLogger=r,this.rfuDispatcher=s;const{fileName:a}=e;this.jsonSerializerCodec=new c.b,this.newlyUpdatedFiles$=(0,u.P)((async()=>{const e=await this.store.getState();return{[a]:e.revision}})).pipe((0,d.z)((e=>this.rfuDispatcher.fileSubscription(e))))}initFileObservation(){this.newlyUpdatedFiles$.subscribe(this._handleRFUDownload.bind(this))}streamFileUpdate(){return this.store.state$.pipe((0,l.U)((e=>e.data)),(0,p.h)((e=>this.settings.typeguard(e))))}async _handleRFUDownload(e){const{fileName:t}=this.settings;if(!(t in e))return;const r=e[t],s=this.jsonSerializerCodec.decode(r.buffer);this.settings.typeguard(s)&&(await this.store.set({filename:r.fileName,data:s,revision:r.revision,lastDownloadTimestamp:r.lastDownloadTimestamp}),this.rfuDispatcher.fileSubscription({[t]:r.revision}))}}var y=r(73881),g=r(95681),v=r(23347),f=r(10722),w=r(25029);const S=e=>!("object"!=typeof e||null===e)&&("filename"in e&&null!==e.filename&&void 0!==e.filename&&"string"==typeof e.filename&&"revision"in e&&null!==e.revision&&void 0!==e.revision&&"number"==typeof e.revision),_=e=>({filename:e,revision:1,data:{},lastDownloadTimestamp:Date.now()});let b=class{constructor(e){this.rfuClient=e}onFrameworkInit(){this.rfuClient.initFileObservation()}};b=(0,s.__decorate)([(0,i.ar)(),(0,s.__metadata)("design:paramtypes",[m])],b);var E=r(20754),A=r(65446),T=r(87279);let C=class{constructor(e){this.rfuClient=e}execute(){return this.rfuClient.streamFileUpdate().pipe((0,l.U)((e=>(0,T.Vp)({overrides:e}))))}};C=(0,s.__decorate)([(0,E.e)(A.N),(0,s.__metadata)("design:paramtypes",[m])],C);const x=((e,t)=>{const r=(e=>class extends((0,g.Q)({storeName:"RFUStore",persist:!0,storage:{schemaVersion:1,initialValue:_(e),typeGuard:S},codec:f.E,storeTypeGuard:S,capacity:v.Y._010KB,scope:w.F.Device,isCache:!0})){})(e);var s;return{providers:[{token:m,asyncFactory:(e,t,r)=>Promise.resolve(new m(s,e,t,r)),inject:[(s={fileName:e,storeClass:r,typeguard:t}).storeClass,o.V,h.Q]}],onFrameworkInit:[b],imports:[y.Q],stores:[r]}})("overrides.json",(e=>null!=e&&"object"==typeof e&&Object.values(e).every((e=>Array.isArray(e)&&e.every((e=>(e=>{if(!e||"object"!=typeof e)return!1;const t="type"in e&&void 0!==e.type&&("startsWith"===e.type||"regexp"===e.type),r="value"in e&&void 0!==e.value&&(Array.isArray(e.value)&&e.value.every((e=>"string"==typeof e))||"string"==typeof e.value),s="conditions"in e&&void 0!==e.conditions&&Array.isArray(e.conditions)&&e.conditions.every((e=>(e=>{const t="type"in e&&void 0!==e.type&&("css"===e.type||"xpath"===e.type),r="selector"in e&&void 0!==e.selector&&"string"==typeof e.selector;return t&&r})(e))),a="actions"in e&&void 0!==e.actions&&Array.isArray(e.actions)&&e.actions.every((e=>(e=>{const t="type"in e&&void 0!==e.type&&("set"===e.type||"ignore"===e.type),r="cssSelector"in e&&void 0!==e.cssSelector&&"string"==typeof e.cssSelector;return t&&r})(e)));return t&&r&&s&&a})(e)))))));let R=class{};R=(0,s.__decorate)([(0,a.Y)({api:n.D,composes:[x],handlers:{commands:{},events:{},queries:{overrides:C}}})],R)},29986:(e,t,r)=>{"use strict";r.d(t,{V:()=>i});var s=r(86952),a=r(28096),n=r(75203);const i=(0,s.Q)({name:"authenticationFlow",commands:{changeLogin:n.hW,changeTwoFactorAuthenticationOtpType:n.eG,clearError:n.jq,resendEmailToken:n.Gc,resendPushNotification:n.rF,sendAccountEmail:n.A,sendMasterPassword:n.rT,submitBackupCode:n.sH,submitEmailToken:n.XH,submitTotp:n.ad,switchToDashlaneAuthenticator:n.K1,switchToEmailToken:n.v5,retryWebAuthnAuthentication:n.M6,useMasterPassword:n.Cc,webAuthnAuthenticationFail:n.O3,logout:n.N5,lockSession:n.Y$,loginViaSSO:n.yv,initiateLoginWithSSO:n.Hr,initiateAutologinWithSSOCommand:n.x2},queries:{authenticationFlowStatus:a.DW,getSsoUserSettings:a.Dc,getProviderInfo:a.L2},events:{}})},75203:(e,t,r)=>{"use strict";r.d(t,{A:()=>n,Cc:()=>f,Gc:()=>p,Hr:()=>E,K1:()=>o,M6:()=>v,N5:()=>S,O3:()=>w,XH:()=>c,Y$:()=>_,ad:()=>u,eG:()=>l,hW:()=>i,jq:()=>g,rF:()=>m,rT:()=>h,sH:()=>d,v5:()=>y,x2:()=>A,yv:()=>b});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.Device})){}class i extends((0,s.g)({scope:a.F.Device})){}class o extends((0,s.g)({scope:a.F.Device})){}class c extends((0,s.g)({scope:a.F.Device})){}class u extends((0,s.g)({scope:a.F.Device})){}class d extends((0,s.g)({scope:a.F.Device})){}class l extends((0,s.g)({scope:a.F.Device})){}class p extends((0,s.g)({scope:a.F.Device})){}class h extends((0,s.g)({scope:a.F.Device})){}class m extends((0,s.g)({scope:a.F.Device})){}class y extends((0,s.g)({scope:a.F.Device})){}class g extends((0,s.g)({scope:a.F.Device})){}class v extends((0,s.g)({scope:a.F.Device})){}class f extends((0,s.g)({scope:a.F.Device})){}class w extends((0,s.g)({scope:a.F.Device})){}class S extends((0,s.g)({scope:a.F.Device})){}class _ extends((0,s.g)({scope:a.F.Device})){}class b extends((0,s.g)({scope:a.F.Device})){}class E extends((0,s.g)({scope:a.F.Device})){}class A extends((0,s.g)({scope:a.F.Device})){}},28096:(e,t,r)=>{"use strict";r.d(t,{DW:()=>n,Dc:()=>i,L2:()=>o});var s=r(99059),a=r(25029);class n extends((0,s.k)({scope:a.F.Device})){}class i extends((0,s.k)({scope:a.F.Device})){}class o extends((0,s.k)({scope:a.F.Device})){}},6218:(e,t,r)=>{"use strict";r.d(t,{F:()=>i});var s=r(86952),a=r(53835),n=r(33969);const i=(0,s.Q)({name:"deviceTransfer",commands:{refreshRequest:n.V},events:{},queries:{trustedDeviceFlowStatus:a.N}})},33969:(e,t,r)=>{"use strict";r.d(t,{V:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},53835:(e,t,r)=>{"use strict";r.d(t,{N:()=>n});var s=r(99059),a=r(25029);class n extends((0,s.k)({scope:a.F.Device})){}},70486:(e,t,r)=>{"use strict";var s;r.d(t,{T:()=>s}),function(e){e[e.WaitingForNewRequest=0]="WaitingForNewRequest",e[e.NewDeviceRequestAvailable=1]="NewDeviceRequestAvailable"}(s||(s={}))},11433:(e,t,r)=>{"use strict";r.d(t,{i:()=>o});var s=r(86952),a=r(41025),n=r(13744),i=r(13089);const o=(0,s.Q)({name:"identityVerificationFlow",commands:{changeTwoFactorAuthenticationOtpType:n.eG,clearError:n.$5,resendEmailToken:n.Gc,resendPushNotification:n.rF,submitBackupCode:n.sH,submitEmailToken:n.XH,submitTotp:n.ad,switchToDashlaneAuthenticator:n.K1,switchToEmailToken:n.v5,startIdentityVerification:n.qw,cancelIdentityVerification:n.Vs},queries:{identityVerificationFlowStatus:a.O},events:{identityVerificationCompleted:i.w}})},13744:(e,t,r)=>{"use strict";r.d(t,{$5:()=>i,Gc:()=>o,K1:()=>p,Vs:()=>y,XH:()=>u,ad:()=>l,eG:()=>n,qw:()=>m,rF:()=>c,sH:()=>d,v5:()=>h});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.Device})){}class i extends((0,s.g)({scope:a.F.Device})){}class o extends((0,s.g)({scope:a.F.Device})){}class c extends((0,s.g)({scope:a.F.Device})){}class u extends((0,s.g)({scope:a.F.Device})){}class d extends((0,s.g)({scope:a.F.Device})){}class l extends((0,s.g)({scope:a.F.Device})){}class p extends((0,s.g)({scope:a.F.Device})){}class h extends((0,s.g)({scope:a.F.Device})){}class m extends((0,s.g)({scope:a.F.Device})){}class y extends((0,s.g)({scope:a.F.Device})){}},13089:(e,t,r)=>{"use strict";r.d(t,{w:()=>n});var s=r(88885),a=r(25029);class n extends((0,s.d)({scope:a.F.Device})){}},41025:(e,t,r)=>{"use strict";r.d(t,{O:()=>n});var s=r(99059),a=r(25029);class n extends((0,s.k)({scope:a.F.Device})){}},81822:(e,t,r)=>{"use strict";r.d(t,{l:()=>n});var s=r(67837),a=r(11433);class n extends((0,s.E)(a.i)){}(0,s.K)(a.i,n)},82353:(e,t,r)=>{"use strict";r.r(t),r.d(t,{AuthenticationFlowContracts:()=>s,DeviceTransferContracts:()=>n,IdentityVerificationFlowContracts:()=>a});var s={};r.r(s),r.d(s,{AuthenticationFlowStatusQuery:()=>d.DW,ChangeAccountEmailCommand:()=>u.hW,ChangeTwoFactorAuthenticationOtpTypeCommand:()=>u.eG,ClearErrorCommand:()=>u.jq,GetSsoProviderInfoQuery:()=>d.L2,GetSsoUserSettingsQuery:()=>d.Dc,InitiateAutologinWithSSOCommand:()=>u.x2,InitiateLoginWithSSOCommand:()=>u.Hr,LockCommand:()=>u.Y$,LoginViaSSOCommand:()=>u.yv,LogoutCommand:()=>u.N5,ResendEmailTokenCommand:()=>u.Gc,ResendPushNotificationCommand:()=>u.rF,RetryWebAuthnAuthenticationCommand:()=>u.M6,SSOMigrationType:()=>o,SendAccountEmailCommand:()=>u.A,SendMasterPasswordCommand:()=>u.rT,SsoMigrationServerMethod:()=>i,SubmitBackupCodeCommand:()=>u.sH,SubmitEmailTokenCommand:()=>u.XH,SubmitTotpCommand:()=>u.ad,SwitchToDashlaneAuthenticatorCommand:()=>u.K1,SwitchToEmailTokenCommand:()=>u.v5,UseMasterPasswordCommand:()=>u.Cc,WebAuthnAuthenticationFailCommand:()=>u.O3,authenticationFlowApi:()=>c.V});var a={};r.r(a),r.d(a,{CancelIdentityVerificationCommand:()=>p.Vs,ChangeTwoFactorAuthenticationOtpTypeCommand:()=>p.eG,ClearIdentityVerificationErrorCommand:()=>p.$5,IdentityVerificationClient:()=>m.l,IdentityVerificationCompletedEvent:()=>y.w,IdentityVerificationFlowStatusQuery:()=>h.O,ResendEmailTokenCommand:()=>p.Gc,ResendPushNotificationCommand:()=>p.rF,StartIdentityVerificationCommand:()=>p.qw,SubmitBackupCodeCommand:()=>p.sH,SubmitEmailTokenCommand:()=>p.XH,SubmitTotpCommand:()=>p.ad,SwitchToDashlaneAuthenticatorCommand:()=>p.K1,SwitchToEmailTokenCommand:()=>p.v5,identityVerificationFlowApi:()=>l.i});var n={};r.r(n),r.d(n,{RefreshRequestCommand:()=>v.V,TrustedDeviceFlowStatusQuery:()=>f.N,TrustedDeviceFlowStep:()=>w.T,deviceTransferApi:()=>g.F});var i,o,c=r(29986),u=r(75203),d=r(28096);!function(e){e.SSO="sso",e.MP="master_password"}(i||(i={})),function(e){e[e.MP_TO_SSO=0]="MP_TO_SSO",e[e.MP_TO_SSO_WITH_INFO=1]="MP_TO_SSO_WITH_INFO",e[e.SSO_TO_MP=2]="SSO_TO_MP"}(o||(o={}));var l=r(11433),p=r(13744),h=r(41025),m=r(81822),y=r(13089),g=r(6218),v=r(33969),f=r(53835),w=r(70486)},4622:(e,t,r)=>{"use strict";r.d(t,{c:()=>tt});var s=r(88802),a=r(99634),n=r(38679),i=r(9671),o=r(53576),c=r(29986),u=r(6447),d=r(44985),l=r(26290),p=r(25029),h=r(95681),m=r(87065);const y=e=>!0;class g extends((0,h.Q)({initialValue:void 0,persist:!1,scope:p.F.Device,storeName:"authentication-flow-machine",storeTypeGuard:y})){}var v=r(23347),f=r(10722);const w=e=>!(!e||"object"!=typeof e)&&"rememberMeForSSOPreference"in e;class S extends((0,h.Q)({codec:f.E,persist:!0,storage:{initialValue:{rememberMeForSSOPreference:!0},schemaVersion:1,typeGuard:w},scope:p.F.Device,storeName:"sso-info",storeTypeGuard:w,capacity:v.Y._001KB})){}const _=e=>!0;class b extends((0,h.Q)({persist:!1,initialValue:{},scope:p.F.Device,storeName:"sso-provider-info",storeTypeGuard:_,capacity:v.Y._001KB})){}var E=r(87279),A=r(63663),T=r(75203),C=r(64472),x=r(11746),R=r(57924);class I{constructor(e,t){this.interpreter=e,this.carbon=t}execute(){try{const{carbonState:e}=this.carbon.queries;e({path:"userSession.loginDeviceLimitFlow.flow"}).pipe((0,m.U)((e=>{if("success"===e.tag)return e.data}))).subscribe((e=>{Boolean(this.lastDeviceLimitFlowValue)&&!e&&this.interpreter.send({type:"DEVICE_LIMIT_ABORTED"}),this.lastDeviceLimitFlowValue=e}))}catch(e){return Promise.reject(new Error("Unable to subscribe to loginDeviceLimitFlow state"))}}}var P=r(5331),D=r(31948),U=r(94189);let F=class{constructor(e){this.carbonLegacy=e.getClient(o.carbonLegacyApi)}async executeWithParams({login:e,masterPassword:t,isRememberMeEnabled:r}){try{return await this.carbonLegacy.commands.carbonLegacyLeeloo({name:"openSessionWithMasterPassword",arg:[{login:e,password:t,rememberPassword:r,requiredPermissions:void 0}]}),Promise.resolve()}catch(e){}}};F=(0,s.__decorate)([(0,R.GS)(),(0,s.__metadata)("design:paramtypes",[U.w])],F);let O=class{constructor(e){this.carbonLegacy=e.getClient(o.carbonLegacyApi)}async execute(){try{const e=await this.carbonLegacy.commands.carbon({name:"checkDoesLocalRecoveryKeyExist",args:[]});if(!(0,E.d6)(e))throw new Error("Carbon command failed");return{isAccountRecoveryAvailable:e.data.carbonResult.doesExist}}catch(e){return{isAccountRecoveryAvailable:!1}}}};O=(0,s.__decorate)([(0,R.GS)(),(0,s.__metadata)("design:paramtypes",[U.w])],O);var N=r(60399),k=r(30523),L=r(62013),M=r(28489),V=r(95082);class G{}const q=e=>!!e&&"object"==typeof e&&(0,M.l$)(e,"ssoUser")&&(0,M.l$)(e,"serviceProviderUrl");let j=class{constructor(e,t,r){this.ssoUserSettingsStore=t,this.client=e,this.authenticationFlowInfraContext=r}async retrieveSSOInfo(){const e=await(0,N.z)(this.client.getClient(o.carbonLegacyApi).queries.carbonState({path:"userSession.ssoSettings"}).pipe((0,m.U)((e=>{if(!(0,E.d6)(e)||!q(e.data))throw new Error("SsoSettings is not of the expected type");return e.data}))));return{isNitroProvider:e.isNitroProvider??!1,serviceProviderUrl:e.serviceProviderUrl}}async execute(e){const{loginUserWithEnclaveSSO:t}=this.client.getClient(V.y).commands,r=await this.retrieveSSOInfo(),{login:s,rememberMeForSSOPreference:a}=e.body;return await this.ssoUserSettingsStore.set({rememberMeForSSOPreference:a}),r.isNitroProvider?await t({userEmailAddress:s}):this.authenticationFlowInfraContext.redirectUserToExternalUrl({externalUrl:r.serviceProviderUrl,tabFocus:!0}),Promise.resolve((0,E.Vp)(void 0))}};j=(0,s.__decorate)([(0,A.W)(T.Hr),(0,s.__metadata)("design:paramtypes",[U.w,S,G])],j);let K=class{constructor(e,t,r){this.ssoProviderInfoStore=t,this.allwowToFail=r,this.ssoProviderInfoStore=t,this.carbonLegacy=e.getClient(o.carbonLegacyApi)}async retrieveSSOSettings(){return await(0,N.z)(this.carbonLegacy.queries.carbonStateList({paths:["userSession.ssoSettings","userSession.account.isAuthenticated"]}).pipe((0,m.U)((e=>{if(!((t=e)&&"object"==typeof t&&(0,M.l$)(t,"data")&&(0,L.isArray)(t.data)&&q(t.data[0])&&"boolean"==typeof t.data[1]))throw new Error("LoginStatus is not of the expected type");if(e.data[1])return e.data[0];var t})),(0,k.h)((e=>void 0!==e))))}async execute(){const e=await this.retrieveSSOSettings();if(q(e))return await this.ssoProviderInfoStore.set({isNitroProvider:e.isNitroProvider??!1,serviceProviderUrl:e.serviceProviderUrl}),{serviceProviderRedirectUrl:e.serviceProviderUrl,isNitroProvider:e.isNitroProvider,migration:e.migration};throw new Error("ssoSettings is not of the expected type")}};K=(0,s.__decorate)([(0,R.GS)(),(0,s.__metadata)("design:paramtypes",[U.w,b,i.J])],K);let W=class{constructor(e,t,r){this.masterPasswordService=t,this.accountRecoveryStatusService=e,this.checkForLoginStatusUpdateService=r}desc(){return{config:{predictableActionArguments:!0,schema:{events:{},context:{}},initial:"CheckingAccountRecoveryStatus",id:"MasterPasswordFlowMachine",context:{isRememberMeEnabled:!1,isAccountRecoveryAvailable:!1},states:{CheckingAccountRecoveryStatus:{invoke:{src:"checkAccountRecoveryStatus",onDone:{target:"WaitingForMasterPassword",actions:["assignAccountRecoveryStatus"]}}},WaitingForMasterPassword:{on:{INPUT_MASTER_PASSWORD:{target:"ValidatingMasterPassword",actions:["assignMasterPassword"]}}},ValidatingMasterPassword:{entry:["authenticateWithMasterPassword"],on:{CARBON_LEGACY_LOGIN_STATUS_CHANGED:[{target:"MigrationNeeded",cond:"shouldTriggerMigration"},{target:"MasterPasswordDone",cond:"isLoggedIn"}],CARBON_LEGACY_ERROR:{target:"WaitingForMasterPassword",actions:["assignError"]},DEVICE_LIMIT_ABORTED:{target:"DeviceLimitAborted"}}},MigrationNeeded:{invoke:{src:"checkForLoginStatusUpdate",onDone:{target:"MPToSSOMigration",actions:["assignSSOMigrationStatus"]}}},MPToSSOMigration:{},DeviceLimitAborted:{type:"final",data:{shouldResetAuthenticationFlow:!0}},MasterPasswordDone:{type:"final",data:{shouldResetAuthenticationFlow:!1}}}},options:{actions:{assignMasterPassword:(0,P.f0)({masterPassword:(e,t)=>t.masterPassword,isRememberMeEnabled:(e,t)=>t.rememberMe}),assignAccountRecoveryStatus:(0,P.f0)({isAccountRecoveryAvailable:(e,t)=>t.data.isAccountRecoveryAvailable}),assignError:(0,P.f0)({error:(e,t)=>({code:"unknown_error",data:{message:t.error}})}),assignSSOMigrationStatus:(0,P.f0)({migration:(e,t)=>t.data.migration,serviceProviderRedirectUrl:(e,t)=>t.data.serviceProviderRedirectUrl,isNitroProvider:(e,t)=>t.data.isNitroProvider}),authenticateWithMasterPassword:e=>{const{login:t,masterPassword:r,isRememberMeEnabled:s}=e;return this.masterPasswordService.executeWithParams({login:t??"",masterPassword:r??"",isRememberMeEnabled:s})}},services:{checkAccountRecoveryStatus:()=>this.accountRecoveryStatusService.execute(),checkForLoginStatusUpdate:()=>this.checkForLoginStatusUpdateService.execute()},guards:{shouldTriggerMigration:(e,t)=>t.needsSSOMigration??!1,isLoggedIn:(e,t)=>t.loggedIn}}}}create(){const{config:e,options:t}=this.desc();return(0,D.C)(e,t)}};W=(0,s.__decorate)([(0,R.GS)(),(0,s.__metadata)("design:paramtypes",[O,F,K])],W);let B=class{constructor(e){this.carbonLegacy=e.getClient(o.carbonLegacyApi)}async execute(e){try{return await this.carbonLegacy.commands.carbonLegacyLeeloo({name:"openSessionResendToken",arg:[{login:e.login??""}]}),Promise.resolve()}catch(e){}}};B=(0,s.__decorate)([(0,R.GS)(),(0,s.__metadata)("design:paramtypes",[U.w])],B);let H=class{constructor(e){this.carbonLegacy=e.getClient(o.carbonLegacyApi)}async requestCodeAgainstServer(){}async execute({login:e}){return await this.carbonLegacy.commands.carbonLegacyLeeloo({name:"openSessionWithDashlaneAuthenticator",arg:[{login:e,password:null,persistData:!0,deviceName:""}]}),Promise.resolve()}async cancel(){return await this.carbonLegacy.commands.carbonLegacyLeeloo({name:"cancelDashlaneAuthenticatorRegistration",arg:[]}),Promise.resolve()}};H=(0,s.__decorate)([(0,R.GS)(),(0,s.__metadata)("design:paramtypes",[U.w])],H);let z=class{constructor(e,t){this.dashlaneAuthenticatorService=e,this.sendEmailToken=t}desc(){return{config:{predictableActionArguments:!0,schema:{events:{},context:{}},id:"AuthenticatorMachine",context:{isDashlaneAuthenticatorAvailable:!1},initial:"RequestingServerPush",states:{RequestingServerPush:{entry:["updateDashlaneAuthenticatorAvailability"],invoke:{src:"authenticateWithDashlaneAuthenticator"},on:{CARBON_LEGACY_ERROR:{actions:["assignError","updateDashlaneAuthenticatorAvailability"]},RESEND_PUSH_NOTIFICATION:{target:"RequestingServerPush",actions:["clearError"]},SWITCH_TO_EMAIL_TOKEN:{actions:["cancelDashlaneAuthenticator","clearError"],target:"EmailTokenRequested"}}},AuthenticatorPushValidated:{type:"final",data:{switchToEmailToken:!1}},EmailTokenRequested:{entry:["sendEmailToken"],type:"final",data:{switchToEmailToken:!0}}}},options:{actions:{clearError:(0,P.f0)({error:()=>{}}),assignError:(0,P.f0)({error:(e,t)=>({code:"unknown_error",data:{message:t.error}})}),switchToEmailToken:(0,P.f0)({switchToEmailToken:()=>!0}),updateDashlaneAuthenticatorAvailability:(0,P.f0)({isDashlaneAuthenticatorAvailable:!0}),cancelDashlaneAuthenticator:()=>{this.dashlaneAuthenticatorService.cancel()},sendEmailToken:e=>{const{login:t}=e;this.sendEmailToken.execute({login:t})}},services:{authenticateWithDashlaneAuthenticator:e=>{const{login:t}=e;return this.dashlaneAuthenticatorService.execute({login:t})}},guards:{}}}}create(){const{config:e,options:t}=this.desc();return(0,D.C)(e,t)}};z=(0,s.__decorate)([(0,R.GS)(),(0,s.__metadata)("design:paramtypes",[H,B])],z);let $=class{constructor(e){this.carbonLegacy=e.getClient(o.carbonLegacyApi)}async execute(e){try{await this.carbonLegacy.commands.carbonLegacyLeeloo({name:"openSessionWithToken",arg:[{login:e.login??"",password:null,token:e.emailToken??"",persistData:!0,deviceName:e.deviceName}]})}catch(e){}}};$=(0,s.__decorate)([(0,R.GS)(),(0,s.__metadata)("design:paramtypes",[U.w])],$);let Q=class{constructor(e,t){this.authenticateWithEmailToken=e,this.sendEmailToken=t}desc(){return{config:{predictableActionArguments:!0,schema:{events:{},context:{}},id:"EmailTokenMachine",context:{login:"",emailToken:"",deviceName:""},initial:"WaitingForEmailToken",states:{SendEmailToken:{invoke:{src:"sendEmailToken",onError:{target:"WaitingForEmailToken"},onDone:{target:"WaitingForEmailToken"}}},WaitingForEmailToken:{on:{INPUT_EMAIL_TOKEN:{target:"ValidatingEmailToken",actions:["assignEmailToken"]},RESEND_EMAIL_TOKEN:{target:"SendEmailToken",actions:["clearError"]}}},ValidatingEmailToken:{entry:["authenticateWithEmailToken"],on:{CARBON_LEGACY_ERROR:{target:"WaitingForEmailToken",actions:["assignError"]}}},FinishingEmailToken:{type:"final",data:{switchToDashlaneAuthenticator:!1}},DashlaneAuthenticatorRequested:{type:"final",data:{switchToDashlaneAuthenticator:!0}}},on:{SWITCH_TO_DASHLANE_AUTHENTICATOR:{target:".DashlaneAuthenticatorRequested",internal:!0,actions:["clearError"]}}},options:{actions:{clearError:(0,P.f0)({error:()=>{}}),assignError:(0,P.f0)({error:(e,t)=>({code:"unknown_error",data:{message:t.error}})}),assignEmailToken:(0,P.f0)({emailToken:(e,t)=>t.emailToken}),authenticateWithEmailToken:e=>{const{deviceName:t,emailToken:r,login:s}=e;return this.authenticateWithEmailToken.execute({deviceName:t,emailToken:r,login:s})}},services:{sendEmailToken:e=>{const{login:t}=e;return this.sendEmailToken.execute({login:t})}},guards:{}}}}create(){const{config:e,options:t}=this.desc();return(0,D.C)(e,t)}};Q=(0,s.__decorate)([(0,R.GS)(),(0,s.__metadata)("design:paramtypes",[$,B])],Q);const Y=e=>({initial:e.initial,states:e.states,on:e.on??{}});let X=class{constructor(e,t){this.authenticatorMachine=e,this.emailTokenMachine=t}desc(){return{config:{predictableActionArguments:!0,schema:{events:{},context:{},guards:{}},id:"DeviceRegistrationMachine",context:{...this.authenticatorMachine.desc().config.context,...this.emailTokenMachine.desc().config.context,registrationMethod:void 0},initial:"StartDeviceRegistration",states:{StartDeviceRegistration:{always:[{target:"EmailToken",cond:"isRegistrationMethodEmailToken"},{target:"DashlaneAuthenticator",cond:"isRegistrationMethodAuthenticator"},{target:"TwoFactorAuthentication",cond:"isRegistrationMethodOTP"}]},DashlaneAuthenticator:{...Y(this.authenticatorMachine.desc().config),onDone:[{target:"EmailToken",cond:"shouldSwitchToEmailToken"},{target:"DeviceRegistrationDone"}]},EmailToken:{...Y(this.emailTokenMachine.desc().config),onDone:[{target:"DashlaneAuthenticator",cond:"shouldSwitchToAuthenticator"},{target:"DeviceRegistrationDone"}]},TwoFactorAuthentication:{onDone:{target:"DeviceRegistrationDone"}},DeviceRegistrationDone:{type:"final"}}},options:{actions:{...this.authenticatorMachine.desc().options.actions,...this.emailTokenMachine.desc().options.actions,assignUnknownDeviceRegistrationError:(0,P.f0)({error:()=>({code:"unknown_error",data:{message:"Unknown device registration error"}})})},services:{...this.authenticatorMachine.desc().options.services,...this.emailTokenMachine.desc().options.services},guards:{...this.authenticatorMachine.desc().options.guards,...this.emailTokenMachine.desc().options.guards,isRegistrationMethodEmailToken:e=>"email_token"===e.registrationMethod,isRegistrationMethodOTP:e=>"otp"===e.registrationMethod,isRegistrationMethodAuthenticator:e=>"dashlane_authenticator"===e.registrationMethod,shouldSwitchToEmailToken:(e,t)=>t.data.switchToEmailToken,shouldSwitchToAuthenticator:(e,t)=>t.data.switchToDashlaneAuthenticator}}}}create(){const{config:e,options:t}=this.desc();return(0,D.C)(e,t)}};X=(0,s.__decorate)([(0,R.GS)(),(0,s.__metadata)("design:paramtypes",[z,Q])],X);let J=class{desc(){return{config:{predictableActionArguments:!0,schema:{events:{},context:{}},id:"WebAuthnMachine",context:{},initial:"InitWebAuthnAuthentication",states:{InitWebAuthnAuthentication:{on:{WEBAUTHN_AUTHENTICATION_FAIL:{target:"WebAuthnAuthenticationFailed",actions:["assignWebAuthnError"]}}},WebAuthnAuthenticationFailed:{on:{RETRY_WEBAUTHN_AUTHENTICATION:{target:"InitWebAuthnAuthentication",actions:["clearError"]}}},WebAuthnAuthenticationDone:{type:"final",data:{switchToMasterPassword:!1}},MasterPasswordRequested:{type:"final",data:{switchToMasterPassword:!0}}},on:{USE_MASTER_PASSWORD:{actions:["clearError"],target:".MasterPasswordRequested",internal:!0}}},options:{actions:{clearError:(0,P.f0)({error:()=>{}}),assignWebAuthnError:(0,P.f0)({error:(e,t)=>t.error})},services:{},guards:{}}}}create(){const{config:e,options:t}=this.desc();return(0,D.C)(e,t)}};J=(0,s.__decorate)([(0,R.GS)()],J);let Z=class{constructor(e){this.carbonLegacy=e.getClient(o.carbonLegacyApi)}executeWithParams({login:e,masterPassword:t,otp:r,twoFactorAuthenticationOtpType:s,otpVerificationMode:a,deviceName:n}){const i={login:e,password:t??null,otp:r,withBackupCode:"backupCode"===s,persistData:!0};try{"otp2"===a?this.carbonLegacy.commands.carbonLegacyLeeloo({name:"openSessionWithOTP",arg:[{...i,deviceName:n}]}):"otp1"===a&&this.carbonLegacy.commands.carbonLegacyLeeloo({name:"openSessionWithOTPForNewDevice",arg:[i]})}catch(e){}return Promise.resolve()}};Z=(0,s.__decorate)([(0,R.GS)(),(0,s.__metadata)("design:paramtypes",[U.w])],Z);let ee=class{constructor(e){this.twoFactorAuthenticationService=e}desc(){return{config:{predictableActionArguments:!0,schema:{events:{},context:{}},id:"WebAuthnMachine",context:{twoFactorAuthenticationOtpType:"totp"},initial:"WaitingForTotp",states:{WaitingForTotp:{on:{INPUT_TOTP:{target:"ValidatingTwoFactorAuthenticationOtp",actions:["assignTwoFactorAuthenticationOtpValue"]},SWITCH_TWO_FACTOR_AUTHENTICATION_TYPE:{target:"WaitingForBackupCode",actions:["assignTwoFactorAuthenticationOtpType","clearError"]}}},WaitingForBackupCode:{on:{INPUT_BACKUP_CODE:{target:"ValidatingTwoFactorAuthenticationOtp",actions:["assignTwoFactorAuthenticationOtpValue"]},SWITCH_TWO_FACTOR_AUTHENTICATION_TYPE:{target:"WaitingForTotp",actions:["assignTwoFactorAuthenticationOtpType","clearError"]}}},ValidatingTwoFactorAuthenticationOtp:{entry:["authenticateWithTwoFactorAuthentication"],on:{CARBON_LEGACY_ERROR:[{target:"WaitingForBackupCode",cond:"isBackupCode",actions:["assignError"]},{target:"WaitingForTotp",actions:["assignError"]}]}},TwoFactorAuthenticationDone:{type:"final"}}},options:{actions:{assignError:(0,P.f0)({error:(e,t)=>({code:"unknown_error",data:{message:t.error}})}),clearError:(0,P.f0)({error:()=>{}}),assignTwoFactorAuthenticationOtpValue:(0,P.f0)({twoFactorAuthenticationOtpValue:(e,t)=>t.twoFactorAuthenticationOtpValue}),assignTwoFactorAuthenticationOtpType:(0,P.f0)({twoFactorAuthenticationOtpType:(e,t)=>t.twoFactorAuthenticationOtpType}),authenticateWithTwoFactorAuthentication:e=>{const t={login:e.login??"",masterPassword:e.masterPassword??null,otp:e.twoFactorAuthenticationOtpValue,twoFactorAuthenticationOtpType:e.twoFactorAuthenticationOtpType,persistData:!0,otpVerificationMode:e.otpVerificationMode,deviceName:e.deviceName};this.twoFactorAuthenticationService.executeWithParams(t)}},services:{},guards:{isBackupCode:e=>"backupCode"===e.twoFactorAuthenticationOtpType}}}}create(){const{config:e,options:t}=this.desc();return(0,D.C)(e,t)}};ee=(0,s.__decorate)([(0,R.GS)(),(0,s.__metadata)("design:paramtypes",[Z])],ee);let te=class{desc(){return{config:{predictableActionArguments:!0,schema:{context:{}},id:"PasswordLessMachine",initial:"PasswordLessUnavailable",states:{PasswordLessUnavailable:{on:{CARBON_LEGACY_ERROR:{actions:["assignError"]}}}}},options:{actions:{assignError:(0,P.f0)({error:(e,t)=>({code:"unknown_error",data:{message:t.error}})})},services:{},guards:{}}}}create(){const{config:e,options:t}=this.desc();return(0,D.C)(e,t)}};te=(0,s.__decorate)([(0,R.GS)()],te);let re=class{constructor(e){this.carbonLegacy=e.getClient(o.carbonLegacyApi)}retrieveLocalAccounts(e){return(0,N.z)(e.queries.carbonState({path:"authentication.localAccounts"}).pipe((0,k.h)(E.d6),(0,k.h)((e=>e.data.accountsListInitialized)),(0,m.U)((e=>e.data.accountsList))))}async execute(){try{const e=await this.retrieveLocalAccounts(this.carbonLegacy),t=e?.find((e=>e.isLastSuccessfulLogin));return{localAccounts:e??[],lastUsedLogin:t?.login??"",shouldAskMasterPassword:t?.shouldAskMasterPassword??!1,shouldAskOTP:t?.hasLoginOtp??!1,rememberMeType:t?.rememberMeType??"disabled"}}catch(e){return Promise.reject(new Error("Unable to retrieve initialization data"))}}};re=(0,s.__decorate)([(0,R.GS)(),(0,s.__metadata)("design:paramtypes",[U.w])],re);let se=class{constructor(e){this.carbonLegacy=e.getClient(o.carbonLegacyApi)}async execute(e){await this.carbonLegacy.commands.carbon({name:"loginViaSSO",args:[e]})}};se=(0,s.__decorate)([(0,R.GS)(),(0,s.__metadata)("design:paramtypes",[U.w])],se);let ae=class{constructor(e){this.ssoProviderInfoStore=e,this.ssoProviderInfoStore=e}async execute({isNitroProvider:e,serviceProviderRedirectUrl:t}){await this.ssoProviderInfoStore.set({isNitroProvider:e,serviceProviderUrl:t})}};ae=(0,s.__decorate)([(0,R.GS)(),(0,s.__metadata)("design:paramtypes",[b])],ae);let ne=class{constructor(e){this.carbonLegacy=e.getClient(o.carbonLegacyApi)}async execute({login:e}){return await this.carbonLegacy.commands.carbonLegacyLeeloo({name:"openSession",arg:[{login:e??""}]}),Promise.resolve()}};ne=(0,s.__decorate)([(0,R.GS)(),(0,s.__metadata)("design:paramtypes",[U.w])],ne);let ie=class{constructor(e,t,r,s,a,n,i,o,c){this.passwordLessMachine=e,this.deviceRegistrationMachine=t,this.masterPasswordFlowMachine=r,this.twoFactorAuthenticationMachine=s,this.webAuthnMachine=a,this.initializeMachineService=n,this.legacySSOLoginService=i,this.requestAuthenticationMethodForLogin=o,this.storeSSOInfoService=c}desc(){return{config:{predictableActionArguments:!0,schema:{events:{},context:{}},initial:"Starting",id:"AuthenticationFlowMachine",context:{...this.deviceRegistrationMachine.desc().config.context,...this.masterPasswordFlowMachine.desc().config.context,...this.twoFactorAuthenticationMachine.desc().config.context,...this.webAuthnMachine.desc().config.context,ready:!1,shouldAskMasterPassword:!1,shouldAskOTP:!1},states:{Starting:{invoke:{src:"initializeMachine",onDone:{actions:["assignInitializationResults"],target:"RememberMeRedirection"}}},RememberMeRedirection:{always:[{target:"MasterPassword",cond:"shouldAskMasterPassword"},{target:"CheckSessionForOtp2",cond:"shouldAskOTP"},{target:"WebAuthn",cond:"rememberMeIsWebAuthn"},{target:"WaitingForEmail"}]},CheckSessionForOtp2:{entry:["requestAuthenticationMethodForLogin"]},WaitingForEmail:{on:{INPUT_ACCOUNT_EMAIL:{target:"ValidatingEmail",actions:["assignAccountEmail","clearError"]}}},ValidatingEmail:{entry:["requestAuthenticationMethodForLogin"],on:{CARBON_LEGACY_ERROR:{target:"WaitingForEmail",actions:["assignError"]}}},PasswordLess:{...Y(this.passwordLessMachine.desc().config)},DeviceRegistration:{...Y(this.deviceRegistrationMachine.desc().config)},WebAuthn:{...Y(this.webAuthnMachine.desc().config),onDone:[{target:"MasterPassword",cond:"shouldSwitchToMasterPassword"},{target:"AuthenticationDone"}]},TwoFactorAuthentication:{...Y(this.twoFactorAuthenticationMachine.desc().config),onDone:{target:"AuthenticationDone"}},SSOAuthentication:{entry:["legacySSOLogin"]},SSORedirectionToIdp:{entry:["assignServiceProviderInfo","storeSSOInfo"]},MasterPassword:{...Y(this.masterPasswordFlowMachine.desc().config),onDone:[{target:"WaitingForEmail",cond:"shouldResetAuthenticationFlow"},{target:"AuthenticationDone"}]},AuthenticationDone:{on:{CARBON_LEGACY_LOGIN_STATUS_CHANGED:{cond:"isLoggedOut",target:"Starting"}}}},on:{CHANGE_ACCOUNT_EMAIL:[{target:"ValidatingEmail",actions:["clearError","assignAccountEmail"],cond:"isAccountLoginAvailable"},{target:"WaitingForEmail",actions:["clearError","clearEmail"]}],CARBON_LEGACY_ASK_MASTER_PASSWORD:{target:"MasterPassword",actions:["clearError"]},CARBON_LEGACY_OPEN_SESSION_TOKEN_SENT:[{target:"DeviceRegistration.EmailToken",actions:["clearError"],cond:"isGrapheneDeviceRegistrationFlow"},{target:"DeviceRegistration.EmailToken",actions:["clearError"]}],CARBON_LEGACY_OPEN_SESSION_DASHLANE_AUTHENTICATOR:{target:"DeviceRegistration.DashlaneAuthenticator",actions:["clearError"]},CARBON_LEGACY_OPEN_SESSION_SSO_REDIRECTION_TO_IDP_REQUIRED:{target:"SSORedirectionToIdp",actions:["clearError"]},CARBON_LEGACY_SSO_LOGIN_BYPASS:{target:"SSOAuthentication",actions:["assignSsoData"]},CARBON_LEGACY_OPEN_SESSION_OTP_SENT:{target:"TwoFactorAuthentication",actions:["assignOtpVerificationMode","clearError"]},CARBON_LEGACY_OPEN_SESSION_MASTER_PASSWORD_LESS:{target:"PasswordLess"},CLEAR_ERROR:{actions:["clearError"]}}},options:{actions:{...this.deviceRegistrationMachine.desc().options.actions,...this.masterPasswordFlowMachine.desc().options.actions,...this.twoFactorAuthenticationMachine.desc().options.actions,...this.webAuthnMachine.desc().options.actions,assignInitializationResults:(0,P.f0)({login:(e,t)=>t.data.lastUsedLogin,localAccounts:(e,t)=>t.data.localAccounts,shouldAskMasterPassword:(e,t)=>t.data.shouldAskMasterPassword,shouldAskOTP:(e,t)=>t.data.shouldAskOTP,rememberMeType:(e,t)=>t.data.rememberMeType,ready:()=>!0}),assignAccountEmail:(0,P.f0)({login:(e,t)=>t.login}),assignError:(0,P.f0)({error:(e,t)=>({code:"unknown_error",data:{message:t.error}})}),assignOtpVerificationMode:(0,P.f0)({otpVerificationMode:(e,t)=>t.otpVerificationMode}),assignSsoData:(0,P.f0)({ssoData:(e,t)=>t}),assignServiceProviderInfo:(0,P.f0)({serviceProviderRedirectUrl:(e,t)=>t.serviceProviderRedirectUrl,isNitroProvider:(e,t)=>t.isNitroProvider,rememberMeForSSOPreference:(e,t)=>t.rememberMeForSSOPreference}),clearEmail:(0,P.f0)({login:void 0}),clearError:(0,P.f0)({error:()=>{}}),clearContext:(0,P.f0)({login:()=>"",shouldAskOTP:()=>!1,shouldAskMasterPassword:()=>!1,twoFactorAuthenticationOtpType:()=>"totp",registrationMethod:()=>{},emailToken:()=>"",deviceName:()=>"",isDashlaneAuthenticatorAvailable:()=>!1,isRememberMeEnabled:()=>!1,isAccountRecoveryAvailable:()=>!1}),legacySSOLogin:(e,t)=>this.legacySSOLoginService.execute(t),requestAuthenticationMethodForLogin:e=>this.requestAuthenticationMethodForLogin.execute(e),storeSSOInfo:(e,t)=>this.storeSSOInfoService.execute(t)},services:{...this.deviceRegistrationMachine.desc().options.services,...this.masterPasswordFlowMachine.desc().options.services,...this.twoFactorAuthenticationMachine.desc().options.services,...this.webAuthnMachine.desc().options.services,initializeMachine:()=>this.initializeMachineService.execute()},guards:{...this.deviceRegistrationMachine.desc().options.guards,...this.masterPasswordFlowMachine.desc().options.guards,...this.twoFactorAuthenticationMachine.desc().options.guards,...this.webAuthnMachine.desc().options.guards,isAccountLoginAvailable:(e,t)=>Boolean(t.login),isLoggedOut:(e,t)=>!t.loggedIn,shouldAskMasterPassword:e=>!!e.shouldAskMasterPassword&&e.shouldAskMasterPassword,shouldAskOTP:e=>!!e.shouldAskOTP&&e.shouldAskOTP,shouldSwitchToMasterPassword:(e,t)=>t.data.switchToMasterPassword,shouldResetAuthenticationFlow:(e,t)=>t.data.shouldResetAuthenticationFlow,rememberMeIsWebAuthn:e=>void 0!==e.rememberMeType&&"webauthn"===e.rememberMeType,isGrapheneDeviceRegistrationFlow:e=>!!e.login&&e.login.includes("kw_test_newdevice")}}}}create(){const{config:e,options:t}=this.desc();return(0,D.C)(e,t)}};ie=(0,s.__decorate)([(0,R.GS)(),(0,s.__metadata)("design:paramtypes",[te,X,W,ee,J,re,se,ne,ae])],ie);let oe=class{constructor(e,t,r,s){this.carbon=r,this.allowedToFail=s,this.loginMachineStore=t;const a=e.create();this.interpreter=C.kJ(a).onTransition((async e=>{e.changed||"xstate.init"===e.event.type||console.warn(`[Auth] State is unchanged. Unexpected transition on ${JSON.stringify(e.value)} with event ${e.event.type} `);const t=this.interpreter.getSnapshot();await(async(e,t)=>{await e.set(JSON.stringify(t))})(this.loginMachineStore,t)})),this.abortDeviceLimitEventHandler=new I(this.interpreter,this.carbon)}async prepare(){this.abortDeviceLimitEventHandler.execute();const e=await(async e=>{const t=await e.getState();return t?l.ZM.create(JSON.parse(t)):void 0})(this.loginMachineStore);if(!e){const e=this.interpreter.start();return void await(0,x.x)(e,(e=>e.context.ready))}let t;await this.allowedToFail.doOne((()=>{if(e.done)throw new Error("Restarting a machine which is already in its final state. Starting from scratch instead.");t=this.interpreter.start(e)}),"Resuming state machine"),t||(t=this.interpreter.start()),await(0,x.x)(t,(e=>e.context.ready))}continue(e){this.interpreter.send(e)}};oe=(0,s.__decorate)([(0,R.GS)(),(0,s.__metadata)("design:paramtypes",[ie,g,o.CarbonLegacyClient,i.J])],oe);let ce=class{constructor(e){this.authenticationFlow=e}execute(e){const{login:t}=e.body;return this.authenticationFlow.continue({type:"CHANGE_ACCOUNT_EMAIL",login:t}),Promise.resolve((0,E.Vp)(void 0))}};ce=(0,s.__decorate)([(0,A.W)(T.hW),(0,s.__metadata)("design:paramtypes",[oe])],ce);let ue=class{constructor(e){this.authenticationFlow=e}execute(e){const{twoFactorAuthenticationOtpType:t}=e.body;return this.authenticationFlow.continue({type:"SWITCH_TWO_FACTOR_AUTHENTICATION_TYPE",twoFactorAuthenticationOtpType:t}),Promise.resolve((0,E.Vp)(void 0))}};ue=(0,s.__decorate)([(0,A.W)(T.eG),(0,s.__metadata)("design:paramtypes",[oe])],ue);let de=class{constructor(e){this.authenticationFlow=e}execute(){return this.authenticationFlow.continue({type:"CLEAR_ERROR"}),Promise.resolve((0,E.Vp)(void 0))}};de=(0,s.__decorate)([(0,A.W)(T.jq),(0,s.__metadata)("design:paramtypes",[oe])],de);let le=class{constructor(e){this.authenticationFlow=e}execute(){return this.authenticationFlow.continue({type:"RESEND_EMAIL_TOKEN"}),Promise.resolve((0,E.Vp)(void 0))}};le=(0,s.__decorate)([(0,A.W)(T.Gc),(0,s.__metadata)("design:paramtypes",[oe])],le);let pe=class{constructor(e){this.authenticationFlow=e}execute(){return this.authenticationFlow.continue({type:"RESEND_PUSH_NOTIFICATION"}),Promise.resolve((0,E.Vp)(void 0))}};pe=(0,s.__decorate)([(0,A.W)(T.rF),(0,s.__metadata)("design:paramtypes",[oe])],pe);let he=class{constructor(e){this.authenticationFlow=e}execute(e){const{login:t}=e.body;return this.authenticationFlow.continue({type:"INPUT_ACCOUNT_EMAIL",login:t}),Promise.resolve((0,E.Vp)(void 0))}};he=(0,s.__decorate)([(0,A.W)(T.A),(0,s.__metadata)("design:paramtypes",[oe])],he);let me=class{constructor(e){this.authenticationFlow=e}execute(e){const{masterPassword:t,rememberMe:r}=e.body;return this.authenticationFlow.continue({type:"INPUT_MASTER_PASSWORD",masterPassword:t,rememberMe:r}),Promise.resolve((0,E.Vp)(void 0))}};me=(0,s.__decorate)([(0,A.W)(T.rT),(0,s.__metadata)("design:paramtypes",[oe])],me);let ye=class{constructor(e){this.authenticationFlow=e}execute(e){const{twoFactorAuthenticationOtpValue:t}=e.body;return this.authenticationFlow.continue({type:"INPUT_BACKUP_CODE",twoFactorAuthenticationOtpValue:t}),Promise.resolve((0,E.Vp)(void 0))}};ye=(0,s.__decorate)([(0,A.W)(T.sH),(0,s.__metadata)("design:paramtypes",[oe])],ye);let ge=class{constructor(e){this.authenticationFlow=e}execute(e){const{emailToken:t,deviceName:r}=e.body;return this.authenticationFlow.continue({type:"INPUT_EMAIL_TOKEN",emailToken:t,deviceName:r}),Promise.resolve((0,E.Vp)(void 0))}};ge=(0,s.__decorate)([(0,A.W)(T.XH),(0,s.__metadata)("design:paramtypes",[oe])],ge);let ve=class{constructor(e){this.authenticationFlow=e}execute(e){const{twoFactorAuthenticationOtpValue:t}=e.body;return this.authenticationFlow.continue({type:"INPUT_TOTP",twoFactorAuthenticationOtpValue:t}),Promise.resolve((0,E.Vp)(void 0))}};ve=(0,s.__decorate)([(0,A.W)(T.ad),(0,s.__metadata)("design:paramtypes",[oe])],ve);let fe=class{constructor(e){this.authenticationFlow=e}execute(){return this.authenticationFlow.continue({type:"SWITCH_TO_DASHLANE_AUTHENTICATOR"}),Promise.resolve((0,E.Vp)(void 0))}};fe=(0,s.__decorate)([(0,A.W)(T.K1),(0,s.__metadata)("design:paramtypes",[oe])],fe);let we=class{constructor(e){this.authenticationFlow=e}execute(){return this.authenticationFlow.continue({type:"SWITCH_TO_EMAIL_TOKEN"}),Promise.resolve((0,E.Vp)(void 0))}};we=(0,s.__decorate)([(0,A.W)(T.v5),(0,s.__metadata)("design:paramtypes",[oe])],we);let Se=class{constructor(e){this.authenticationFlow=e}execute(){return this.authenticationFlow.continue({type:"RETRY_WEBAUTHN_AUTHENTICATION"}),Promise.resolve((0,E.Vp)(void 0))}};Se=(0,s.__decorate)([(0,A.W)(T.M6),(0,s.__metadata)("design:paramtypes",[oe])],Se);let _e=class{constructor(e){this.authenticationFlow=e}execute(){return this.authenticationFlow.continue({type:"USE_MASTER_PASSWORD"}),Promise.resolve((0,E.Vp)(void 0))}};_e=(0,s.__decorate)([(0,A.W)(T.Cc),(0,s.__metadata)("design:paramtypes",[oe])],_e);let be=class{constructor(e){this.authenticationFlow=e}execute(e){const{webAuthnError:t}=e.body;return this.authenticationFlow.continue({type:"WEBAUTHN_AUTHENTICATION_FAIL",error:t}),Promise.resolve((0,E.Vp)(void 0))}};be=(0,s.__decorate)([(0,A.W)(T.O3),(0,s.__metadata)("design:paramtypes",[oe])],be);var Ee=r(26457);let Ae=class{constructor(e,t){this.carbonLegacy=e.getClient(o.carbonLegacyApi),this.logger=t}async execute(){try{await this.carbonLegacy.commands.carbonLegacyLeeloo({name:"closeSession",arg:[{}]})}catch(e){this.logger.trace("Logout Command error :"+e)}return Promise.resolve((0,E.Vp)(void 0))}};Ae=(0,s.__decorate)([(0,A.W)(T.N5),(0,s.__metadata)("design:paramtypes",[U.w,Ee.V])],Ae);let Te=class{constructor(e,t){this.carbonLegacy=e.getClient(o.carbonLegacyApi),this.logger=t}async execute(){try{await this.carbonLegacy.commands.carbonLegacyLeeloo({name:"lockSession",arg:[{}]})}catch(e){this.logger.trace("LockSession command handler: "+e)}return Promise.resolve((0,E.Vp)(void 0))}};Te=(0,s.__decorate)([(0,A.W)(T.Y$),(0,s.__metadata)("design:paramtypes",[U.w,Ee.V])],Te);let Ce=class{constructor(e){this.authenticationFlow=e}execute(e){return this.authenticationFlow.continue({type:"CARBON_LEGACY_SSO_LOGIN_BYPASS",...e.body}),Promise.resolve((0,E.Vp)(void 0))}};Ce=(0,s.__decorate)([(0,A.W)(T.yv),(0,s.__metadata)("design:paramtypes",[oe])],Ce);var xe=r(74081),Re=r(73404);const Ie=e=>!!e&&"object"==typeof e&&(0,M.l$)(e,"type")&&"sso"===e.type;let Pe=class{constructor(e,t,r,s){this.allowToFail=s,this.client=e,this.authenticationFlowInfraContext=t,this.serverApiClient=r}getDeviceAccessKeys(e){return this.client.getClient(o.carbonLegacyApi).queries.carbonState({path:"authentication.localUsers"}).pipe((0,k.h)(E.d6),(0,m.U)((t=>t.data[e])))}async checkSSOInfo(e){const t=(await(0,N.z)(this.getDeviceAccessKeys(e).pipe((0,m.U)((t=>this.serverApiClient.v1.authentication.getAuthenticationMethodsForLogin({login:e,deviceAccessKey:t.deviceAccessKey,methods:["email_token","totp","duo_push","dashlane_authenticator"]}))),(0,xe.J)(),(0,k.h)(E.d6),(0,m.U)((e=>e.data.data))))).verifications.find(Ie);if(t){const e=t.ssoInfo;return{isNitroProvider:e.isNitroProvider,serviceProviderUrl:e.serviceProviderUrl}}throw new Error("No SSO authentication available for the user")}async execute(e){const{login:t}=e.body,{loginUserWithEnclaveSSO:r}=this.client.getClient(V.y).commands;return await this.allowToFail.doOne((async()=>{const e=await this.checkSSOInfo(t);e.isNitroProvider?await r({userEmailAddress:t}):this.authenticationFlowInfraContext.redirectUserToExternalUrl({externalUrl:e.serviceProviderUrl,tabFocus:!1})}),"InitiateAutologinWithSSOCommandHandler.execute"),Promise.resolve((0,E.Vp)(void 0))}};Pe=(0,s.__decorate)([(0,A.W)(T.x2),(0,s.__metadata)("design:paramtypes",[U.w,G,Re.l,i.J])],Pe);var De=r(68307);let Ue=class{constructor(e,t,r,s){this.authenticationFlow=e,this.logger=t,this.ssoUserSettingsStore=r,this.carbonLegacy=s.getClient(o.carbonLegacyApi)}getLoginFlowMigrationKillswitch(){return(0,N.z)(this.carbonLegacy.queries.carbonState({path:"device.killswitch.disableLoginFlowMigration"}).pipe((0,k.h)(E.d6),(0,m.U)((e=>e))))}async handle(e){const t=await this.getLoginFlowMigrationKillswitch();let r=!1;if(self.localStorage){const e=self.localStorage.getItem("extng.loginFlow.forceLegacyFallback");r=Boolean(e)&&"true"===e}if("success"===t.tag&&t.data||r)return console.warn("[Authentication-flow] Ignoring carbon event due to legacy login fallback"),Promise.resolve();switch(e.body.eventName){case"openSessionMasterPasswordLess":this.authenticationFlow.continue({type:"CARBON_LEGACY_OPEN_SESSION_MASTER_PASSWORD_LESS"});break;case"openSessionTokenSent":this.authenticationFlow.continue({type:"CARBON_LEGACY_OPEN_SESSION_TOKEN_SENT"});break;case"openSessionAskMasterPassword":this.authenticationFlow.continue({type:"CARBON_LEGACY_ASK_MASTER_PASSWORD"});break;case"openSessionDashlaneAuthenticator":this.authenticationFlow.continue({type:"CARBON_LEGACY_OPEN_SESSION_DASHLANE_AUTHENTICATOR"});break;case"openSessionOTPSent":case"openSessionOTPForNewDeviceRequired":this.authenticationFlow.continue({type:"CARBON_LEGACY_OPEN_SESSION_OTP_SENT",otpVerificationMode:"openSessionOTPSent"===e.body.eventName?"otp2":"otp1"});break;case"openSessionSsoRedirectionToIdpRequired":{const t=e.body.eventData,{rememberMeForSSOPreference:r}=await this.ssoUserSettingsStore.getState();this.authenticationFlow.continue({type:"CARBON_LEGACY_OPEN_SESSION_SSO_REDIRECTION_TO_IDP_REQUIRED",serviceProviderRedirectUrl:t.serviceProviderRedirectUrl,isNitroProvider:t.isNitroProvider,rememberMeForSSOPreference:r})}break;case"openSessionFailed":{const t=e.body.eventData;this.authenticationFlow.continue({type:"CARBON_LEGACY_ERROR",error:t.errorCode})}break;case"loginStatusChanged":{const t=e.body.eventData;this.authenticationFlow.continue({type:"CARBON_LEGACY_LOGIN_STATUS_CHANGED",loggedIn:t.loggedIn,needsSSOMigration:t.needsSSOMigration})}}return Promise.resolve()}};Ue=(0,s.__decorate)([(0,De.b)(o.CarbonLegacyEvent),(0,s.__metadata)("design:paramtypes",[oe,Ee.V,S,U.w])],Ue);var Fe=r(6136),Oe=r(20754),Ne=r(28096),ke=r(69885),Le=r(6220);const Me=e=>({step:"EmailStep",loginEmail:e.context.login,localAccounts:e.context.localAccounts??[],isLoading:e.matches("ValidatingEmail")&&!e.context.error,error:e.context.error?.data?.message}),Ve=e=>({step:"PasswordLessStep",localAccounts:e.context.localAccounts??[],error:e.context.error?.data?.message}),Ge=e=>({step:"EmailTokenStep",localAccounts:e.context.localAccounts??[],loginEmail:e.context.login,isLoading:e.matches({DeviceRegistration:{EmailToken:"ValidatingEmailToken"}})&&!e.context.error,error:e.context.error?.data?.message,emailToken:e.context.emailToken,isDashlaneAuthenticatorAvailable:e.context.isDashlaneAuthenticatorAvailable}),qe=e=>({step:"DashlaneAuthenticatorStep",localAccounts:e.context.localAccounts??[],isLoading:e.matches({DeviceRegistration:{DashlaneAuthenticator:"RequestingServerPush"}})&&!e.context.error,error:e.context.error?.data?.message}),je=e=>({step:"TwoFactorAuthenticationOtpStep",localAccounts:e.context.localAccounts??[],loginEmail:e.context.login,isLoading:e.matches({TwoFactorAuthentication:"ValidatingTwoFactorAuthenticationOtp"})&&!e.context.error,error:e.context.error?.data?.message,twoFactorAuthenticationOtpValue:e.context.twoFactorAuthenticationOtpValue,twoFactorAuthenticationOtpType:e.context.twoFactorAuthenticationOtpType}),Ke=e=>({step:"WebAuthnStep",localAccounts:e.context.localAccounts??[],loginEmail:e.context.login,isLoading:e.matches({WebAuthn:"InitWebAuthnAuthentication"})&&!e.context.error,error:e.context.error?.data?.message}),We=e=>({step:"SSORedirectionToIdpStep",loginEmail:e.context.login,serviceProviderRedirectUrl:e.context.serviceProviderRedirectUrl??"",isNitroProvider:e.context.isNitroProvider??!1,rememberMeForSSOPreference:e.context.rememberMeForSSOPreference,isLoading:e.matches({SSORedirectionToIdp:"InitSSOAuthentication"})&&!e.context.error,error:e.context.error?.data?.message,localAccounts:e.context.localAccounts??[]}),Be=e=>({step:"MasterPasswordStep",loginEmail:e.context.login??"",localAccounts:e.context.localAccounts??[],isLoading:(e.matches({MasterPassword:"ValidatingMasterPassword"})||e.matches({MasterPassword:"MigrationNeeded"})||e.matches({MasterPassword:"MPToSSOMigration"})||e.matches("AuthenticationDone"))&&!e.context.error,isAccountRecoveryAvailable:e.context.isAccountRecoveryAvailable,error:e.context.error?.data?.message,serviceProviderRedirectUrl:e.context.serviceProviderRedirectUrl,isNitroProvider:e.context.isNitroProvider??!1,migration:e.context.migration}),He=e=>({step:"StartingStep",localAccounts:e.context.localAccounts??[]});const ze=e=>(0,ke.of)((0,E.Vp)(function(e){return e.matches("Starting")?He(e):e.matches("WaitingForEmail")||e.matches("ValidatingEmail")?Me(e):e.matches({PasswordLess:"PasswordLessUnavailable"})?Ve(e):e.matches({DeviceRegistration:{EmailToken:"SendEmailToken"}})||e.matches({DeviceRegistration:{EmailToken:"WaitingForEmailToken"}})||e.matches({DeviceRegistration:{EmailToken:"ValidatingEmailToken"}})||e.matches({DeviceRegistration:{EmailToken:"FinishingEmailToken"}})?Ge(e):e.matches({DeviceRegistration:{DashlaneAuthenticator:"RequestingServerPush"}})||e.matches({DeviceRegistration:{DashlaneAuthenticator:"AuthenticatorPushFailed"}})||e.matches({DeviceRegistration:{DashlaneAuthenticator:"AuthenticatorPushValidated"}})?qe(e):e.matches({TwoFactorAuthentication:"WaitingForTotp"})||e.matches({TwoFactorAuthentication:"WaitingForBackupCode"})||e.matches({TwoFactorAuthentication:"ValidatingTwoFactorAuthenticationOtp"})||e.matches({TwoFactorAuthentication:"FinishingTwoFactorAuthenticationOtp"})?je(e):e.matches({WebAuthn:"InitWebAuthnAuthentication"})||e.matches({WebAuthn:"WebAuthnAuthenticationFailed"})||e.matches({WebAuthn:"WebAuthnAuthenticationValidated"})?Ke(e):e.matches("SSORedirectionToIdp")?We(e):e.matches({MasterPassword:"CheckingAccountRecoveryStatus"})||e.matches({MasterPassword:"WaitingForMasterPassword"})||e.matches({MasterPassword:"ValidatingMasterPassword"})||e.matches({MasterPassword:"MigrationNeeded"})||e.matches({MasterPassword:"MPToSSOMigration"})||e.matches("AuthenticationDone")?Be(e):void console.warn("[Auth] - No view associated to state ",JSON.stringify(e.value))}(e))),$e=e=>e.pipe((0,Le.z)(ze));var Qe=r(30045);let Ye=class{constructor(e,t){this.authenticationFlow=e,this.loginMachineStore=t}execute(){return(e=this.loginMachineStore,e.state$.pipe((0,m.U)((e=>e?l.ZM.create(JSON.parse(e)):void 0)))).pipe((0,k.h)(Boolean),(0,Fe.x)(((e,t)=>((e,t)=>{const r=t.matches(e.value),s=(0,Qe.Z)(e.context,t.context);return r&&s})(e,t))),$e);var e}};Ye=(0,s.__decorate)([(0,Oe.e)(Ne.DW),(0,s.__metadata)("design:paramtypes",[oe,g])],Ye);let Xe=class{constructor(e){this.ssoUserSettingsStore=e,this.ssoUserSettingsStore=e}execute(){return this.ssoUserSettingsStore.state$.pipe((0,m.U)((e=>(0,E.Vp)({rememberMeForSSOPreference:e.rememberMeForSSOPreference}))))}};Xe=(0,s.__decorate)([(0,Oe.e)(Ne.Dc),(0,s.__metadata)("design:paramtypes",[S])],Xe);let Je=class{constructor(e){this.ssoProviderInfoStore=e,this.ssoProviderInfoStore=e}execute(){return this.ssoProviderInfoStore.state$.pipe((0,m.U)((e=>(0,E.Vp)({serviceProviderUrl:e.serviceProviderUrl,isNitroProvider:e.isNitroProvider,migrationType:e.migrationType}))))}};Je=(0,s.__decorate)([(0,Oe.e)(Ne.L2),(0,s.__metadata)("design:paramtypes",[b])],Je);const Ze=e=>!0;class et extends((0,h.Q)({initialValue:void 0,persist:!1,scope:p.F.Device,storeName:"device-registration-flow-store",storeTypeGuard:Ze})){}let tt=class{};tt=(0,s.__decorate)([(0,a.Y)({api:c.V,handlers:{commands:{changeLogin:ce,changeTwoFactorAuthenticationOtpType:ue,clearError:de,resendEmailToken:le,resendPushNotification:pe,sendAccountEmail:he,sendMasterPassword:me,submitBackupCode:ye,submitEmailToken:ge,submitTotp:ve,switchToDashlaneAuthenticator:fe,switchToEmailToken:we,retryWebAuthnAuthentication:Se,useMasterPassword:_e,webAuthnAuthenticationFail:be,logout:Ae,lockSession:Te,loginViaSSO:Ce,initiateLoginWithSSO:j,initiateAutologinWithSSO:Pe},events:{...(0,a.g)(o.carbonLegacyApi,{carbonLegacy:Ue})},queries:{authenticationFlowStatus:Ye,getSsoUserSettings:Xe,getProviderInfo:Je}},configurations:{authenticationFlowContextInfrastructure:{token:G}},providers:[te,z,X,Q,J,W,ee,...(0,n.H)(oe,{inject:[ie,g,o.CarbonLegacyClient,i.J],asyncFactory:async(e,t,r,s)=>{const a=new oe(e,t,r,s);return await a.prepare(),a}}),ie,re,se,O,K,H,$,F,Z,ne,B,ae],stores:[g,et,S,b],imports:[u.n,d.i]})],tt)},59550:(e,t,r)=>{"use strict";r.d(t,{Q:()=>l});var s=r(88802),a=r(60399),n=r(87065),i=r(53576),o=r(28489),c=r(87279),u=r(57924),d=r(94189);let l=class{constructor(e){this.cqrsClient=e}getDeviceCredentialsForUser(e){const{queries:{carbonStateList:t}}=this.cqrsClient.getClient(i.carbonLegacyApi);return(0,a.z)(t({paths:["authentication.currentUser.deviceKeys","userSession.localSettings.uki","userSession.account.login"]}).pipe((0,n.U)((e=>{if((0,c.hx)(e))throw new Error("Failed to get credentials from carbon");return(0,c.db)(e)})),(0,n.U)(this.carbonStateToRequestUserDeviceCredentials(e))))}carbonStateToRequestUserDeviceCredentials(e){return([t,r,s])=>{if(!t&&!r||s!==e)throw new Error("No user device credentials available for active user");let a;if(r){if("string"!=typeof r)throw new Error("Unexpected UKI state shape received from carbon");a=function(e){const t=e.split("-");if(t.length>0){const[r]=t;return{accessKey:r,secretKey:e}}throw new Error("Invalid UKI format")}(r)}else{if(!function(e){return!!(e&&"object"==typeof e&&(0,o.l$)(e,"accessKey")&&(0,o.l$)(e,"secretKey"))&&"string"==typeof e.accessKey&&"string"==typeof e.secretKey}(t))throw new Error("Unexpected user device state shape received from carbon");a=t}return{login:e,deviceAccessKey:a.accessKey,deviceSecretKey:a.secretKey}}}};l=(0,s.__decorate)([(0,u.GS)(),(0,s.__metadata)("design:paramtypes",[d.w])],l)},54901:(e,t,r)=>{"use strict";r.d(t,{I:()=>ae});var s=r(88802),a=r(6218),n=r(99634),i=r(38679),o=r(6447),c=r(56695),u=r.n(c),d=r(57924);let l=class{constructor(e){this.sodium=e}generateNonce(){return this.sodium.randombytes_buf(this.sodium.crypto_box_NONCEBYTES)}generateKeyPair(){return this.sodium.crypto_kx_keypair()}hash(e,t){return this.sodium.crypto_generichash(this.sodium.crypto_secretbox_KEYBYTES,e,t)}compare(e,t){return this.sodium.memcmp(e,t)}generateSharedSecret(e,t,r){return this.sodium.crypto_kx_client_session_keys(e,t,r)}encrypt(e,t,r){return this.sodium.crypto_secretbox_easy(e,t,r)}decrypt(e,t,r){return this.sodium.crypto_secretbox_open_easy(e,t,r)}};l=(0,s.__decorate)([(0,d.GS)(),(0,s.__metadata)("design:paramtypes",[Object])],l);var p=r(25029),h=r(95681),m=r(23347);const y=e=>!(!e||"object"!=typeof e)&&"passphraseChallenge"in e;class g extends((0,h.Q)({initialValue:{passphraseChallenge:""},persist:!1,scope:p.F.Device,storeName:"universal-device-transfer",storeTypeGuard:y,capacity:m.Y._010KB})){}var v=r(26290),f=r(87065);const w=e=>!0;class S extends((0,h.Q)({initialValue:void 0,persist:!1,scope:p.F.Device,storeName:"trusted-device-flow-machine",storeTypeGuard:w})){}var _=r(64472),b=r(24966),E=r(31948),A=r(5331),T=r(87279),C=r(98645),x=r(77410),R=r.n(x),I=r(48844),P=r(18533),D=r(20195),U=r(73404),F=r(60399);const O=Math.pow(2,32)-1;let N=class{constructor(e,t,r){this.cryptoToolbox=e,this.deviceTransferStore=t,this.serverApiClient=r}verifyUntrustedDevicePublicKey(e,t){return this.cryptoToolbox.compare(e,this.cryptoToolbox.hash(t))}generateEncryptionKey(e,t,r,s=!1){return this.cryptoToolbox.hash(`DASHLANE_D2D_SYMMETRIC_KEY${e.length}${e}${t}`,s?r.sharedTx:r.sharedRx)}generateVisualCheckSeed(e,t,r,s=!1){return this.cryptoToolbox.hash(`DASHLANE_D2D_SAS_SEED${e.length}${e}${t}`,s?r.sharedTx:r.sharedRx)}getWordList(){return(0,C.readFileSync)(R().resolve("/","../assets/eff_large_wordlist.txt"),"utf8").split("\n").map((e=>e.split("\t")[1]))}generatePassphrase(e){const t=this.getWordList(),r=[],s=Math.floor(O/t.length)*t.length;for(let a=0;a<e.length;a+=4){const n=e[a];if(n<s){const e=t[n%t.length];r.push(e)}if(5===r.length)break}return r.join(" ")}async verifyPassphraseChallenge(e){const{passphraseChallenge:t}=await this.deviceTransferStore.getState();if(!t)throw new Error("[DEVICE-TRANSFER]: Passphrase challenge not generated yet");return e===t}async getKeyExchangeTransferInfo(){return await(0,F.z)(this.serverApiClient.v1.secretTransfer.getKeyExchangeTransferInfo({}).pipe((0,I.DZ)((e=>(0,P.EQ)(e,{BusinessError:()=>{throw new Error("[D2D]: Business Error")},FetchFailedError:()=>{throw new Error("[D2D]: Network error")},BadStatus:D.j}))),(0,I.lk)((e=>(0,T.Vp)(e.data)))))}};N=(0,s.__decorate)([(0,d.GS)(),(0,s.__metadata)("design:paramtypes",[l,g,U.l])],N);let k=class{constructor(e){this.deviceTransferService=e,this.deviceTransferService=e}async execute(){const e=await this.deviceTransferService.getKeyExchangeTransferInfo();if((0,T.hx)(e))return Promise.reject(new Error("Something went wrong"));const{transferId:t,receiver:r}=e.data.transfer;return Promise.resolve({transferId:t,untrustedDeviceName:r.deviceName,untrustedDeviceHashedPublicKey:r.hashedPublicKey})}};k=(0,s.__decorate)([(0,d.GS)(),(0,s.__metadata)("design:paramtypes",[N])],k);let L=class{constructor(e){this.getPendingDeviceTransferRequestService=e}create(){return(0,E.C)({predictableActionArguments:!0,schema:{events:{},context:{}},initial:"Idle",id:"TrustedDeviceFlowMachine",context:{transferId:void 0,untrustedDeviceName:"",untrustedDeviceHashedPublicKey:"",untrustedDeviceLocation:"",requestTimestamp:void 0},states:{Idle:{on:{REFRESH_REQUEST:{target:"WaitingForNewDeviceTransferRequest"}}},WaitingForNewDeviceTransferRequest:{invoke:{src:"getPendingDeviceTransferRequest",onDone:[{actions:["assignUntrustedDeviceData"],cond:"isDeviceTransferRequestAvailable",target:"NewDeviceTransferRequest"},{actions:["assignUntrustedDeviceData"],target:"Idle"}]}},NewDeviceTransferRequest:{}}},{actions:{assignUntrustedDeviceData:(0,A.f0)({transferId:(e,t)=>t.data.transferId,untrustedDeviceName:(e,t)=>t.data.untrustedDeviceName,untrustedDeviceHashedPublicKey:(e,t)=>t.data.untrustedDeviceHashedPublicKey,untrustedDeviceLocation:(e,t)=>t.data.untrustedDeviceLocation,requestTimestamp:(e,t)=>t.data.requestTimestamp}),clearContext:(0,A.f0)({transferId:()=>{},untrustedDeviceName:()=>"",untrustedDeviceHashedPublicKey:()=>""})},services:{getPendingDeviceTransferRequest:()=>this.getPendingDeviceTransferRequestService.execute()},guards:{isDeviceTransferRequestAvailable:(e,t)=>!!t.data.transferId}})}};L=(0,s.__decorate)([(0,d.GS)(),(0,s.__metadata)("design:paramtypes",[k])],L);let M=class{constructor(e,t){this.trustedDeviceMachineStore=t;const r=e.create();this.interpreter=_.kJ(r).onTransition((async e=>{e.changed||"xstate.init"===e.event.type||console.warn(`[D2D Trusted Device Flow] State is unchanged. Unexpected transition on ${JSON.stringify(e.value)} with event ${e.event.type} `);try{const e=this.interpreter?.getSnapshot();e&&await(async(e,t)=>{await e.set(JSON.stringify(t))})(this.trustedDeviceMachineStore,e)}catch(e){console.warn("[D2D Trusted Device Flow] Unable to get snapshot",e)}}))}async prepare(){if(this.interpreter)try{const e=await(async e=>{const t=await e.getState();return t?v.ZM.create(JSON.parse(t)):void 0})(this.trustedDeviceMachineStore);try{this.interpreter.start(e)}catch(e){console.error("[D2D Trusted Device Flow] Unable to reuse the stored state: ",e),this.interpreter.start()}}catch(e){console.error("[D2D Trusted Device Flow] Unable to start machine",e)}}ready(){return new b.X(!0)}continue(e){if(!this.interpreter)throw new Error("TrustedDevice flow not started");this.interpreter.send(e)}stop(){this.isStarted()&&(this.interpreter=void 0)}isStarted(){return Boolean(this.interpreter)}};M=(0,s.__decorate)([(0,d.GS)(),(0,s.__metadata)("design:paramtypes",[L,S])],M);var V=r(85390),G=r(30523),q=r(6136),j=r(20754),K=r(53835),W=r(69885),B=r(6220),H=r(70486);const z=e=>(0,W.of)((0,T.Vp)(function(e){return e.matches("Idle")||e.matches("WaitingForNewDeviceTransferRequest")?{step:H.T.WaitingForNewRequest}:e.matches("NewDeviceTransferRequest")?{step:H.T.NewDeviceRequestAvailable,untrustedDeviceName:e.context.untrustedDeviceName,untrustedDeviceLocation:e.context.untrustedDeviceLocation,requestTimestamp:e.context.requestTimestamp}:void console.warn("[D2D Trusted Device] - No view associated to state ",e.value)}(e))),$=e=>e.pipe((0,B.z)(z));var Q=r(30045);let Y=class{constructor(e,t){this.trustedDeviceFlow=e,this.trustedDeviceFlowMachineStore=t}execute(){return(0,V.a)([(e=this.trustedDeviceFlowMachineStore,e.state$.pipe((0,f.U)((e=>e?v.ZM.create(JSON.parse(e)):void 0)))),this.trustedDeviceFlow.ready()],((e,t)=>{if(e&&t)return e})).pipe((0,G.h)(Boolean),(0,q.x)(((e,t)=>((e,t)=>{const r=t.matches(e.value),s=(0,Q.Z)(e.context,t.context);return r&&s})(e,t))),$);var e}};Y=(0,s.__decorate)([(0,j.e)(K.N),(0,s.__metadata)("design:paramtypes",[M,S])],Y);var X=r(63663),J=r(33969);let Z=class{constructor(e){this.trustedDeviceFlow=e,this.trustedDeviceFlow=e}execute(){return this.trustedDeviceFlow.continue({type:"REFRESH_REQUEST"}),Promise.resolve((0,T.Vp)(void 0))}};Z=(0,s.__decorate)([(0,X.W)(J.V),(0,s.__metadata)("design:paramtypes",[M])],Z);const ee=e=>!0;class te extends((0,h.Q)({initialValue:void 0,persist:!1,scope:p.F.Device,storeName:"untrusted-device-flow-machine",storeTypeGuard:ee})){}let re=class{create(){return(0,E.C)({predictableActionArguments:!0,schema:{events:{},context:{}},initial:"Idle",id:"UntrustedDeviceFlowMachine",context:{transferId:void 0},states:{Idle:{}}})}};re=(0,s.__decorate)([(0,d.GS)()],re);let se=class{constructor(e,t){this.untrustedDeviceMachineStore=t;const r=e.create();this.interpreter=_.kJ(r).onTransition((async e=>{e.changed||"xstate.init"===e.event.type||console.warn(`[D2D Untrusted Device Flow] State is unchanged. Unexpected transition on ${JSON.stringify(e.value)} with event ${e.event.type} `);try{const e=this.interpreter?.getSnapshot();e&&await(async(e,t)=>{await e.set(JSON.stringify(t))})(this.untrustedDeviceMachineStore,e)}catch(e){console.warn("[D2D Untrusted Device Flow] Unable to get snapshot",e)}}))}async prepare(){if(this.interpreter)try{const e=await(async e=>{const t=await e.getState();return t?v.ZM.create(JSON.parse(t)):void 0})(this.untrustedDeviceMachineStore);try{this.interpreter.start(e)}catch(e){console.error("[D2D Untrusted Device Flow] Unable to reuse the stored state: ",e),this.interpreter.start()}}catch(e){console.error("[D2D Untrusted Device Flow] Unable to start machine",e)}}ready(){return new b.X(!0)}continue(e){if(!this.interpreter)throw new Error("UntrustedDevice flow not started");this.interpreter.send(e)}stop(){this.isStarted()&&(this.interpreter=void 0)}isStarted(){return Boolean(this.interpreter)}};se=(0,s.__decorate)([(0,d.GS)(),(0,s.__metadata)("design:paramtypes",[re,te])],se);let ae=class{};ae=(0,s.__decorate)([(0,n.Y)({api:a.F,stores:[g,S,te],imports:[o.n],providers:[{token:l,asyncFactory:async()=>{await u().ready;const e=u();return new l(e)}},...(0,i.H)(M,{inject:[L,S],asyncFactory:async(e,t)=>{const r=new M(e,t);return await r.prepare(),r}}),...(0,i.H)(se,{inject:[re,te],asyncFactory:async(e,t)=>{const r=new se(e,t);return await r.prepare(),r}}),l,N,k,L,re],handlers:{commands:{refreshRequest:Z},events:{},queries:{trustedDeviceFlowStatus:Y}}})],ae)},99600:(e,t,r)=>{"use strict";r.d(t,{f:()=>Pe});var s,a,n,i,o,c=r(88802),u=r(99634),d=r(38679),l=r(6447),p=r(11433),h=r(57924),m=r(5331),y=r(31948),g=r(87279),v=r(60399),f=r(73404),w=r(48844),S=r(18533),_=r(95087),b=r(20195),E=r(96168);!function(e){e.VERIFICATION_FAILED="verification_failed",e.VERIFICATION_TIMEOUT="verification_timeout",e.VERIFICATION_REQUIRES_REQUEST="verification_requires_request",e.ACCOUNT_BLOCKED_CONTACT_SUPPORT="account_blocked_contact_support",e.INVALID_OTP_ALREADY_USED="invalid_otp_already_used",e.INVALID_OTP_BLOCKED="invalid_otp_blocked"}(s||(s={}));class A extends((0,E.Hu)(s.VERIFICATION_FAILED,"")){}class T extends((0,E.Hu)(s.VERIFICATION_TIMEOUT,"")){}class C extends((0,E.Hu)(s.VERIFICATION_REQUIRES_REQUEST,"")){}class x extends((0,E.Hu)(s.ACCOUNT_BLOCKED_CONTACT_SUPPORT,"")){}class R extends((0,E.Hu)(s.INVALID_OTP_ALREADY_USED,"")){}class I extends((0,E.Hu)(s.INVALID_OTP_BLOCKED,"")){}class P extends((0,E.Hu)("network_error","")){}!function(e){e.TOKEN_NOT_VALID="TOKEN_NOT_VALID",e.TOKEN_EXPIRED="TOKEN_EXPIRED",e.TOKEN_TOO_MANY_ATTEMPTS="TOKEN_TOO_MANY_ATTEMPTS",e.TOKEN_ACCOUNT_LOCKED="TOKEN_ACCOUNT_LOCKED"}(a||(a={})),function(e){e.OTP_NOT_VALID="OTP_NOT_VALID",e.OTP_TOO_MANY_ATTEMPTS="OTP_TOO_MANY_ATTEMPTS",e.OTP_ALREADY_USED="OTP_ALREADY_USED",e.BACKUP_CODE_NOT_VALID="BACKUP_CODE_NOT_VALID"}(n||(n={})),function(e){e.DASHLANE_AUTHENTICATOR_PUSH_NOTIFICATION_DENIED="DASHLANE_AUTHENTICATOR_PUSH_NOTIFICATION_DENIED",e.TOKEN_EXPIRED="TOKEN_EXPIRED"}(i||(i={})),function(e){e.NETWORK_ERROR="NETWORK_ERROR",e.UNKNOWN_ERROR="UNKNOWN_ERROR"}(o||(o={}));let D=class{constructor(e){this.serverApiClient=e}async performEmailTokenVerification(e,t){return await(0,v.z)(this.serverApiClient.v1.authentication.performEmailTokenVerification({login:e,token:t}).pipe((0,w.DZ)((e=>(0,S.EQ)(e,{BusinessError:e=>{switch(e.code){case s.VERIFICATION_FAILED:return new A;case s.VERIFICATION_TIMEOUT:return new T;case s.VERIFICATION_REQUIRES_REQUEST:return new C;case s.ACCOUNT_BLOCKED_CONTACT_SUPPORT:return new x;default:(0,_.U)(e.code)}},FetchFailedError:()=>new P,BadStatus:b.j}))),(0,w.lk)((e=>(0,g.Vp)(e.data.authTicket)))))}async performTotpVerification(e,t){return await(0,v.z)(this.serverApiClient.v1.authentication.performTotpVerification({login:e,otp:t}).pipe((0,w.DZ)((e=>(0,S.EQ)(e,{BusinessError:e=>{switch(e.code){case s.VERIFICATION_FAILED:return new A;case s.INVALID_OTP_ALREADY_USED:return new R;case s.INVALID_OTP_BLOCKED:return new I;default:(0,_.U)(e.code)}},FetchFailedError:()=>new P,BadStatus:b.j}))),(0,w.lk)((e=>(0,g.Vp)(e.data.authTicket)))))}async performDashlaneAuthenticatorValidation(e,t){return await(0,v.z)(this.serverApiClient.v1.authentication.performDashlaneAuthenticatorVerification({login:e,deviceName:t}).pipe((0,w.DZ)((e=>(0,S.EQ)(e,{BusinessError:e=>{switch(e.code){case s.VERIFICATION_FAILED:return new A;case s.VERIFICATION_TIMEOUT:return new T;default:(0,_.U)(e.code)}},FetchFailedError:()=>new P,BadStatus:b.j}))),(0,w.lk)((e=>(0,g.Vp)(e.data.authTicket)))))}async askServerToSendToken(e){return await(0,v.z)(this.serverApiClient.v1.authentication.requestEmailTokenVerification({login:e}).pipe((0,w.DZ)((e=>{throw e})),(0,w.lk)((()=>(0,g.Vp)(void 0)))))}};D=(0,c.__decorate)([(0,h.GS)(),(0,c.__metadata)("design:paramtypes",[f.l])],D);let U=class{constructor(e){this.identityVerificationService=e,this.identityVerificationService=e}async execute({login:e}){if(e){const t=await this.identityVerificationService.askServerToSendToken(e);if((0,g.hx)(t))return Promise.reject(t.error)}Promise.resolve(void 0)}};U=(0,c.__decorate)([(0,h.GS)(),(0,c.__metadata)("design:paramtypes",[D])],U);var F=r(81459);let O=class extends F.f{};O=(0,c.__decorate)([(0,h.GS)()],O);let N=class{constructor(e,t){this.identityVerificationService=e,this.eventEmitter=t}mapFunctionalErrorToErrorCode(e){switch(e.tag){case s.VERIFICATION_FAILED:return i.DASHLANE_AUTHENTICATOR_PUSH_NOTIFICATION_DENIED;case s.VERIFICATION_TIMEOUT:return i.TOKEN_EXPIRED;default:return o.UNKNOWN_ERROR}}async execute({login:e}){if(!e)throw new Error("Something went wrong");const t=await this.identityVerificationService.performDashlaneAuthenticatorValidation(e,"");if((0,g.hx)(t)){const e=this.mapFunctionalErrorToErrorCode(t.error);return Promise.reject(e)}return this.eventEmitter.sendEvent("identityVerificationCompleted",{authTicket:t.data}),Promise.resolve()}};N=(0,c.__decorate)([(0,h.GS)(),(0,c.__metadata)("design:paramtypes",[D,O])],N);let k=class{constructor(e,t){this.dashlaneAuthenticatorService=e,this.sendEmailToken=t}desc(){return{config:{predictableActionArguments:!0,schema:{events:{},context:{}},id:"AuthenticatorMachine",context:{isDashlaneAuthenticatorAvailable:!1},initial:"RequestingServerPush",states:{RequestingServerPush:{entry:["updateDashlaneAuthenticatorAvailability"],invoke:{src:"authenticateWithDashlaneAuthenticator",onDone:{target:"AuthenticatorPushValidated"},onError:{actions:["assignError","updateDashlaneAuthenticatorAvailability"]}},on:{RESEND_PUSH_NOTIFICATION:{target:"RequestingServerPush",actions:["clearError"]},SWITCH_TO_EMAIL_TOKEN:{actions:["clearError"],target:"EmailTokenRequested"}}},AuthenticatorPushValidated:{type:"final",data:{switchToEmailToken:!1}},EmailTokenRequested:{entry:["sendEmailToken"],type:"final",data:{switchToEmailToken:!0}}}},options:{actions:{clearError:(0,m.f0)({error:()=>{}}),assignError:(0,m.f0)({error:(e,t)=>t.data}),switchToEmailToken:(0,m.f0)({switchToEmailToken:()=>!0}),updateDashlaneAuthenticatorAvailability:(0,m.f0)({isDashlaneAuthenticatorAvailable:!0}),sendEmailToken:e=>{const{login:t}=e;this.sendEmailToken.execute({login:t})}},services:{authenticateWithDashlaneAuthenticator:e=>{const{login:t}=e;return this.dashlaneAuthenticatorService.execute({login:t})}},guards:{}}}}create(){const{config:e,options:t}=this.desc();return(0,y.C)(e,t)}};k=(0,c.__decorate)([(0,h.GS)(),(0,c.__metadata)("design:paramtypes",[N,U])],k);const L=/^\d{6}$/;let M=class{constructor(e,t){this.identityVerificationService=e,this.eventEmitter=t}mapFunctionalErrorToErrorCode(e){switch(e.tag){case s.VERIFICATION_FAILED:return a.TOKEN_NOT_VALID;case s.VERIFICATION_TIMEOUT:return a.TOKEN_EXPIRED;case s.VERIFICATION_REQUIRES_REQUEST:return a.TOKEN_TOO_MANY_ATTEMPTS;case s.ACCOUNT_BLOCKED_CONTACT_SUPPORT:return a.TOKEN_ACCOUNT_LOCKED;default:return o.UNKNOWN_ERROR}}async executeWithParams(e){if(!e.login||!e.emailToken||0===e.emailToken.length||!L.test(e.emailToken))return Promise.reject(o.UNKNOWN_ERROR);const t=await this.identityVerificationService.performEmailTokenVerification(e.login,e.emailToken);if((0,g.hx)(t)){const e=this.mapFunctionalErrorToErrorCode(t.error);return Promise.reject(e)}const r=t.data;return this.eventEmitter.sendEvent("identityVerificationCompleted",{authTicket:r}),Promise.resolve()}};M=(0,c.__decorate)([(0,h.GS)(),(0,c.__metadata)("design:paramtypes",[D,O])],M);let V=class{constructor(e,t){this.authenticateWithEmailToken=e,this.sendEmailToken=t}desc(){return{config:{predictableActionArguments:!0,schema:{events:{},context:{}},id:"EmailTokenMachine",context:{login:"",emailToken:"",deviceName:""},initial:"SendEmailToken",states:{SendEmailToken:{invoke:{src:"sendEmailToken",onError:{target:"WaitingForEmailToken"},onDone:{target:"WaitingForEmailToken"}}},WaitingForEmailToken:{on:{INPUT_EMAIL_TOKEN:{target:"ValidatingEmailToken",actions:["assignEmailToken"]},RESEND_EMAIL_TOKEN:{target:"SendEmailToken",actions:["clearError"]}}},ValidatingEmailToken:{invoke:{src:"authenticateWithEmailToken",onDone:{target:"FinishingEmailToken"},onError:{target:"WaitingForEmailToken",actions:["assignError"]}}},FinishingEmailToken:{type:"final",data:{switchToDashlaneAuthenticator:!1}},DashlaneAuthenticatorRequested:{type:"final",data:{switchToDashlaneAuthenticator:!0}}},on:{SWITCH_TO_DASHLANE_AUTHENTICATOR:{target:".DashlaneAuthenticatorRequested",internal:!0,actions:["clearError"]}}},options:{actions:{assignError:(0,m.f0)({error:(e,t)=>t.data}),clearError:(0,m.f0)({error:()=>{}}),assignEmailToken:(0,m.f0)({emailToken:(e,t)=>t.emailToken})},services:{sendEmailToken:e=>{const{login:t}=e;return this.sendEmailToken.execute({login:t})},authenticateWithEmailToken:e=>{const{deviceName:t,emailToken:r,login:s}=e;return this.authenticateWithEmailToken.executeWithParams({deviceName:t,emailToken:r,login:s})}},guards:{}}}}create(){const{config:e,options:t}=this.desc();return(0,y.C)(e,t)}};V=(0,c.__decorate)([(0,h.GS)(),(0,c.__metadata)("design:paramtypes",[M,U])],V);const G=e=>({initial:e.initial,states:e.states,on:e.on??{}});let q=class{constructor(e,t){this.authenticatorMachine=e,this.emailTokenMachine=t}desc(){return{config:{predictableActionArguments:!0,schema:{events:{},context:{},guards:{}},id:"DeviceRegistrationMachine",context:{...this.authenticatorMachine.desc().config.context,...this.emailTokenMachine.desc().config.context,registrationMethod:void 0},initial:"StartDeviceRegistration",states:{StartDeviceRegistration:{always:[{target:"EmailToken",cond:"isRegistrationMethodEmailToken"},{target:"DashlaneAuthenticator",cond:"isRegistrationMethodAuthenticator"},{target:"TwoFactorAuthentication",cond:"isRegistrationMethodOTP"}]},DashlaneAuthenticator:{...G(this.authenticatorMachine.desc().config),onDone:[{target:"EmailToken",cond:"shouldSwitchToEmailToken"},{target:"DeviceRegistrationDone"}]},EmailToken:{...G(this.emailTokenMachine.desc().config),onDone:[{target:"DashlaneAuthenticator",cond:"shouldSwitchToAuthenticator"},{target:"DeviceRegistrationDone"}]},TwoFactorAuthentication:{onDone:{target:"DeviceRegistrationDone"}},DeviceRegistrationDone:{type:"final"}}},options:{actions:{...this.authenticatorMachine.desc().options.actions,...this.emailTokenMachine.desc().options.actions,assignUnknownDeviceRegistrationError:(0,m.f0)({error:()=>({code:"unknown_error",data:{message:"Unknown device registration error"}})})},services:{...this.authenticatorMachine.desc().options.services,...this.emailTokenMachine.desc().options.services},guards:{...this.authenticatorMachine.desc().options.guards,...this.emailTokenMachine.desc().options.guards,isRegistrationMethodEmailToken:e=>"email_token"===e.registrationMethod,isRegistrationMethodOTP:e=>"otp"===e.registrationMethod,isRegistrationMethodAuthenticator:e=>"dashlane_authenticator"===e.registrationMethod,shouldSwitchToEmailToken:(e,t)=>t.data.switchToEmailToken,shouldSwitchToAuthenticator:(e,t)=>t.data.switchToDashlaneAuthenticator}}}}create(){const{config:e,options:t}=this.desc();return(0,y.C)(e,t)}};q=(0,c.__decorate)([(0,h.GS)(),(0,c.__metadata)("design:paramtypes",[k,V])],q);var j=r(25029),K=r(95681);const W=e=>!0;class B extends((0,K.Q)({initialValue:void 0,persist:!1,scope:j.F.Device,storeName:"device-registration-flow-store",storeTypeGuard:W})){}let H=class{constructor(e,t){this.identityVerificationService=e,this.eventEmitter=t}mapFunctionalErrorToErrorCode(e){switch(e.tag){case s.VERIFICATION_FAILED:return n.OTP_NOT_VALID;case s.INVALID_OTP_ALREADY_USED:return n.OTP_ALREADY_USED;case s.INVALID_OTP_BLOCKED:return n.OTP_TOO_MANY_ATTEMPTS;default:return o.UNKNOWN_ERROR}}async executeWithParams(e){if(!e.login||!e.otp||0===e.otp.length||"totp"===e.twoFactorAuthenticationOtpType&&!L.test(e.otp))return Promise.reject(o.UNKNOWN_ERROR);const t=await this.identityVerificationService.performTotpVerification(e.login,e.otp);if((0,g.hx)(t)){const e=this.mapFunctionalErrorToErrorCode(t.error);return Promise.reject(e)}return this.eventEmitter.sendEvent("identityVerificationCompleted",{authTicket:t.data}),Promise.resolve()}};H=(0,c.__decorate)([(0,h.GS)(),(0,c.__metadata)("design:paramtypes",[D,O])],H);let z=class{constructor(e){this.twoFactorAuthenticationService=e}desc(){return{config:{predictableActionArguments:!0,schema:{events:{},context:{}},id:"TwoFactorAuthenticationMachine",context:{twoFactorAuthenticationOtpType:"totp"},initial:"WaitingForTotp",states:{WaitingForTotp:{on:{INPUT_TOTP:{target:"ValidatingTwoFactorAuthenticationOtp",actions:["assignTwoFactorAuthenticationOtpValue"]},SWITCH_TWO_FACTOR_AUTHENTICATION_TYPE:{target:"WaitingForBackupCode",actions:["assignTwoFactorAuthenticationOtpType","clearError"]}}},WaitingForBackupCode:{on:{INPUT_BACKUP_CODE:{target:"ValidatingTwoFactorAuthenticationOtp",actions:["assignTwoFactorAuthenticationOtpValue"]},SWITCH_TWO_FACTOR_AUTHENTICATION_TYPE:{target:"WaitingForTotp",actions:["assignTwoFactorAuthenticationOtpType","clearError"]}}},ValidatingTwoFactorAuthenticationOtp:{invoke:{src:"authenticateWithTwoFactorAuthentication",onDone:{target:"TwoFactorAuthenticationDone"},onError:[{target:"WaitingForBackupCode",cond:"isBackupCode",actions:["assignError"]},{target:"WaitingForTotp",actions:["assignError"]}]}},TwoFactorAuthenticationDone:{type:"final"}}},options:{actions:{assignError:(0,m.f0)({error:(e,t)=>t.data}),clearError:(0,m.f0)({error:()=>{}}),assignTwoFactorAuthenticationOtpValue:(0,m.f0)({twoFactorAuthenticationOtpValue:(e,t)=>t.twoFactorAuthenticationOtpValue}),assignTwoFactorAuthenticationOtpType:(0,m.f0)({twoFactorAuthenticationOtpType:(e,t)=>t.twoFactorAuthenticationOtpType})},services:{authenticateWithTwoFactorAuthentication:e=>{const t={login:e.login??"",masterPassword:e.masterPassword??null,otp:e.twoFactorAuthenticationOtpValue,twoFactorAuthenticationOtpType:e.twoFactorAuthenticationOtpType,persistData:!0,otpVerificationMode:e.otpVerificationMode,deviceName:e.deviceName};return this.twoFactorAuthenticationService.executeWithParams(t)}},guards:{isBackupCode:e=>"backupCode"===e.twoFactorAuthenticationOtpType}}}}create(){const{config:e,options:t}=this.desc();return(0,y.C)(e,t)}};z=(0,c.__decorate)([(0,h.GS)(),(0,c.__metadata)("design:paramtypes",[H])],z);let $=class{constructor(e,t){this.deviceRegistrationMachine=e,this.twoFactorAuthenticationMachine=t}desc(){return{config:{predictableActionArguments:!0,schema:{events:{},context:{}},initial:"Starting",id:"IdentityVerificationFlowMachine",context:{...this.deviceRegistrationMachine.desc().config.context,...this.twoFactorAuthenticationMachine.desc().config.context,ready:!1,shouldAskOTP:!1},states:{Starting:{entry:["assignInitializationResults"]},DeviceRegistration:{...G(this.deviceRegistrationMachine.desc().config)},TwoFactorAuthentication:{...G(this.twoFactorAuthenticationMachine.desc().config),onDone:{target:"AuthenticationDone"}},AuthenticationDone:{type:"final"}},on:{VERIFY_IDENTITY_WITH_TOKEN:{target:"DeviceRegistration.EmailToken",actions:["assignAccountEmail"]},VERIFY_IDENTITY_WITH_DASHLANE_AUTHENTICATOR:{target:"DeviceRegistration.DashlaneAuthenticator",actions:["assignAccountEmail"]},VERIFY_IDENTITY_WITH_TOTP:{target:"TwoFactorAuthentication",actions:["assignAccountEmail"]},CANCEL_IDENTITY_VERIFICATION:{target:"Starting",actions:["clearContext"]},CLEAR_ERROR:{actions:["clearError"]}}},options:{actions:{...this.deviceRegistrationMachine.desc().options.actions,...this.twoFactorAuthenticationMachine.desc().options.actions,assignInitializationResults:(0,m.f0)({ready:()=>!0}),assignAccountEmail:(0,m.f0)({login:(e,t)=>t.login}),clearContext:(0,m.f0)({login:()=>"",shouldAskOTP:()=>!1,twoFactorAuthenticationOtpType:()=>"totp",registrationMethod:()=>{},emailToken:()=>"",deviceName:()=>"",isDashlaneAuthenticatorAvailable:()=>!1}),clearError:(0,m.f0)({error:()=>{}})},services:{...this.deviceRegistrationMachine.desc().options.services,...this.twoFactorAuthenticationMachine.desc().options.services},guards:{...this.deviceRegistrationMachine.desc().options.guards,...this.twoFactorAuthenticationMachine.desc().options.guards,isGrapheneDeviceRegistrationFlow:e=>!!e.login&&e.login.includes("kw_test_newdevice")}}}}create(){const{config:e,options:t}=this.desc();return(0,y.C)(e,t)}};$=(0,c.__decorate)([(0,h.GS)(),(0,c.__metadata)("design:paramtypes",[q,z])],$);var Q=r(85390),Y=r(30523),X=r(6136),J=r(20754),Z=r(41025),ee=r(69885),te=r(6220);const re=e=>({step:"EmailTokenStep",isLoading:e.matches({DeviceRegistration:{EmailToken:"ValidatingEmailToken"}})&&!e.context.error,error:e.context.error,emailToken:e.context.emailToken,isDashlaneAuthenticatorAvailable:e.context.isDashlaneAuthenticatorAvailable}),se=e=>({step:"DashlaneAuthenticatorStep",isLoading:e.matches({DeviceRegistration:{DashlaneAuthenticator:"RequestingServerPush"}})&&!e.context.error,error:e.context.error}),ae=e=>({step:"TwoFactorAuthenticationOtpStep",isLoading:e.matches({TwoFactorAuthentication:"ValidatingTwoFactorAuthenticationOtp"})&&!e.context.error,error:e.context.error,twoFactorAuthenticationOtpValue:e.context.twoFactorAuthenticationOtpValue,twoFactorAuthenticationOtpType:e.context.twoFactorAuthenticationOtpType});const ne=e=>(0,ee.of)((0,g.Vp)(function(e){return e.matches("Starting")?{step:"StartingStep"}:e.matches({DeviceRegistration:{EmailToken:"SendEmailToken"}})||e.matches({DeviceRegistration:{EmailToken:"WaitingForEmailToken"}})||e.matches({DeviceRegistration:{EmailToken:"ValidatingEmailToken"}})||e.matches({DeviceRegistration:{EmailToken:"FinishingEmailToken"}})?re(e):e.matches({DeviceRegistration:{DashlaneAuthenticator:"RequestingServerPush"}})||e.matches({DeviceRegistration:{DashlaneAuthenticator:"AuthenticatorPushFailed"}})||e.matches({DeviceRegistration:{DashlaneAuthenticator:"AuthenticatorPushValidated"}})?se(e):e.matches({TwoFactorAuthentication:"WaitingForTotp"})||e.matches({TwoFactorAuthentication:"WaitingForBackupCode"})||e.matches({TwoFactorAuthentication:"ValidatingTwoFactorAuthenticationOtp"})||e.matches({TwoFactorAuthentication:"FinishingTwoFactorAuthenticationOtp"})?ae(e):void console.warn("[Auth Ticket] - No view associated to state ",JSON.stringify(e.value))}(e))),ie=e=>e.pipe((0,te.z)(ne));var oe=r(26290),ce=r(87065);const ue=e=>!0;class de extends((0,K.Q)({initialValue:void 0,persist:!1,scope:j.F.Device,storeName:"identity-verification-flow-machine",storeTypeGuard:ue})){}var le=r(30045);var pe=r(24966),he=r(64472),me=r(11746);let ye=class{constructor(e,t){this.identityVerificationMachineStore=t,this.initFlag=new pe.X(!1);const r=e.create();this.delayedEvents=[],this.interpreter=he.kJ(r).onTransition((async e=>{e.changed||"xstate.init"===e.event.type||console.warn(`[Auth Ticket] State is unchanged. Unexpected transition on ${JSON.stringify(e.value)} with event ${e.event.type} `);try{const e=this.interpreter?.getSnapshot();e&&await(async(e,t)=>{await e.set(JSON.stringify(t))})(this.identityVerificationMachineStore,e)}catch(e){console.warn("[Auth Ticket] Unable to get snapshot",e)}}))}async prepare(){if(this.interpreter)try{const e=await(async e=>{const t=await e.getState();return t?oe.ZM.create(JSON.parse(t)):void 0})(this.identityVerificationMachineStore);let t;try{t=this.interpreter.start(e)}catch(e){console.error("[Auth Ticket] Unable to reuse the stored state: ",e),t=this.interpreter.start()}await(0,me.x)(t,(e=>e.context.ready)),this.interpreter.send(this.delayedEvents),this.delayedEvents=[],this.initFlag.next(!0)}catch(e){console.error("[Auth Ticket] Unable to start machine",e)}}ready(){return this.initFlag}continue(e){if(!this.interpreter)throw new Error("Authentication flow not started");this.interpreter.getSnapshot().context.ready?this.interpreter.send(e):this.delayedEvents.push(e)}stop(){this.isStarted()&&(this.interpreter=void 0)}isStarted(){return Boolean(this.interpreter)}};ye=(0,c.__decorate)([(0,h.GS)(),(0,c.__metadata)("design:paramtypes",[$,de])],ye);let ge=class{constructor(e,t){this.identityVerificationFlow=e,this.identityVerificationMachineStore=t}execute(){return(0,Q.a)([(e=this.identityVerificationMachineStore,e.state$.pipe((0,ce.U)((e=>e?oe.ZM.create(JSON.parse(e)):void 0)))),this.identityVerificationFlow.ready()],((e,t)=>{if(e&&t)return e})).pipe((0,Y.h)(Boolean),(0,X.x)(((e,t)=>((e,t)=>{const r=t.matches(e.value),s=(0,le.Z)(e.context,t.context);return r&&s})(e,t))),ie);var e}};ge=(0,c.__decorate)([(0,J.e)(Z.O),(0,c.__metadata)("design:paramtypes",[ye,de])],ge);var ve=r(63663),fe=r(13744);let we=class{constructor(e){this.identityVerificationFlow=e}execute(e){const{twoFactorAuthenticationOtpType:t}=e.body;return this.identityVerificationFlow.continue({type:"SWITCH_TWO_FACTOR_AUTHENTICATION_TYPE",twoFactorAuthenticationOtpType:t}),Promise.resolve((0,g.Vp)(void 0))}};we=(0,c.__decorate)([(0,ve.W)(fe.eG),(0,c.__metadata)("design:paramtypes",[ye])],we);let Se=class{constructor(e){this.identityVerificationFlow=e}execute(){return this.identityVerificationFlow.continue({type:"CLEAR_ERROR"}),Promise.resolve((0,g.Vp)(void 0))}};Se=(0,c.__decorate)([(0,ve.W)(fe.$5),(0,c.__metadata)("design:paramtypes",[ye])],Se);let _e=class{constructor(e){this.identityVerificationFlow=e}execute(){return this.identityVerificationFlow.continue({type:"RESEND_EMAIL_TOKEN"}),Promise.resolve((0,g.Vp)(void 0))}};_e=(0,c.__decorate)([(0,ve.W)(fe.Gc),(0,c.__metadata)("design:paramtypes",[ye])],_e);let be=class{constructor(e){this.identityVerificationFlow=e}execute(){return this.identityVerificationFlow.continue({type:"RESEND_PUSH_NOTIFICATION"}),Promise.resolve((0,g.Vp)(void 0))}};be=(0,c.__decorate)([(0,ve.W)(fe.rF),(0,c.__metadata)("design:paramtypes",[ye])],be);let Ee=class{constructor(e){this.identityVerificationFlow=e}execute(e){const{twoFactorAuthenticationOtpValue:t}=e.body;return this.identityVerificationFlow.continue({type:"INPUT_BACKUP_CODE",twoFactorAuthenticationOtpValue:t}),Promise.resolve((0,g.Vp)(void 0))}};Ee=(0,c.__decorate)([(0,ve.W)(fe.sH),(0,c.__metadata)("design:paramtypes",[ye])],Ee);let Ae=class{constructor(e){this.identityVerificationFlow=e}execute(e){const{emailToken:t,deviceName:r}=e.body;return this.identityVerificationFlow.continue({type:"INPUT_EMAIL_TOKEN",emailToken:t,deviceName:r}),Promise.resolve((0,g.Vp)(void 0))}};Ae=(0,c.__decorate)([(0,ve.W)(fe.XH),(0,c.__metadata)("design:paramtypes",[ye])],Ae);let Te=class{constructor(e){this.identityVerificationFlow=e}execute(e){const{twoFactorAuthenticationOtpValue:t}=e.body;return this.identityVerificationFlow.continue({type:"INPUT_TOTP",twoFactorAuthenticationOtpValue:t}),Promise.resolve((0,g.Vp)(void 0))}};Te=(0,c.__decorate)([(0,ve.W)(fe.ad),(0,c.__metadata)("design:paramtypes",[ye])],Te);let Ce=class{constructor(e){this.identityVerificationFlow=e}execute(){return this.identityVerificationFlow.continue({type:"SWITCH_TO_DASHLANE_AUTHENTICATOR"}),Promise.resolve((0,g.Vp)(void 0))}};Ce=(0,c.__decorate)([(0,ve.W)(fe.K1),(0,c.__metadata)("design:paramtypes",[ye])],Ce);let xe=class{constructor(e){this.identityVerificationFlow=e}execute(){return this.identityVerificationFlow.continue({type:"SWITCH_TO_EMAIL_TOKEN"}),Promise.resolve((0,g.Vp)(void 0))}};xe=(0,c.__decorate)([(0,ve.W)(fe.v5),(0,c.__metadata)("design:paramtypes",[ye])],xe);let Re=class{constructor(e){this.identityVerificationFlow=e}execute(e){const{login:t,verificationMethod:r}=e.body;switch(r){case"email_token":this.identityVerificationFlow.continue({type:"VERIFY_IDENTITY_WITH_TOKEN",login:t});break;case"totp":this.identityVerificationFlow.continue({type:"VERIFY_IDENTITY_WITH_TOTP",login:t});break;case"dashlane_authenticator":this.identityVerificationFlow.continue({type:"VERIFY_IDENTITY_WITH_DASHLANE_AUTHENTICATOR",login:t})}return Promise.resolve((0,g.Vp)(void 0))}};Re=(0,c.__decorate)([(0,ve.W)(fe.qw),(0,c.__metadata)("design:paramtypes",[ye])],Re);let Ie=class{constructor(e){this.identityVerificationFlow=e}execute(){return this.identityVerificationFlow.continue({type:"CANCEL_IDENTITY_VERIFICATION"}),Promise.resolve((0,g.Vp)(void 0))}};Ie=(0,c.__decorate)([(0,ve.W)(fe.Vs),(0,c.__metadata)("design:paramtypes",[ye])],Ie);let Pe=class{};Pe=(0,c.__decorate)([(0,u.Y)({api:p.i,handlers:{commands:{changeTwoFactorAuthenticationOtpType:we,clearError:Se,resendEmailToken:_e,resendPushNotification:be,submitBackupCode:Ee,submitEmailToken:Ae,submitTotp:Te,switchToDashlaneAuthenticator:Ce,switchToEmailToken:xe,startIdentityVerification:Re,cancelIdentityVerification:Ie},events:{},queries:{identityVerificationFlowStatus:ge}},providers:[q,k,N,V,z,...(0,d.H)(ye,{inject:[$,de],asyncFactory:async(e,t)=>{const r=new ye(e,t);return await r.prepare(),r}}),$,M,H,U,D,O],imports:[l.n],exports:[ye],stores:[de,B]})],Pe)},17556:(e,t,r)=>{"use strict";r.d(t,{e:()=>s});class s{redirectUserToExternalUrl(e){!async function(){try{await chrome.tabs.create({url:e.externalUrl,active:e.tabFocus})}catch(t){console.warn("[Auto-SSO] No window available. Delaying tab creation");const r=()=>{chrome.tabs.create({url:e.externalUrl,active:e.tabFocus}),chrome.windows.onCreated.removeListener(r)};chrome.windows.onCreated.addListener(r)}}()}}},15403:(e,t,r)=>{"use strict";r.d(t,{c:()=>s});const s=(0,r(86952).Q)({name:"autofillData",commands:{},events:{},queries:{}})},92018:(e,t,r)=>{"use strict";r.d(t,{Y:()=>i});var s=r(86952),a=r(11564),n=r(73581);const i=(0,s.Q)({name:"autofillTracking",commands:{temporaryEmitPasswordAutofillPerformedEvent:n.q},events:{passwordAutofillPerformedEvent:a.p},queries:{}})},73581:(e,t,r)=>{"use strict";r.d(t,{q:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},11564:(e,t,r)=>{"use strict";r.d(t,{p:()=>n});var s=r(88885),a=r(25029);class n extends((0,s.d)({scope:a.F.User})){}},46154:(e,t,r)=>{"use strict";r.d(t,{Pw:()=>i,q_:()=>a,rF:()=>o,up:()=>s});const s=["KWAddress","KWBankStatement","KWCompany","KWDriverLicence","KWEmail","KWFiscalStatement","KWIDCard","KWIdentity","KWMerchand","KWPassport","KWPaymentMean_creditCard","KWPaymentMean_paypal","KWPersonalWebsite","KWPhone","KWSecureNote","KWSecureNoteCategory","KWSocialSecurityStatement"],a=["KWAuthentifiant","KWGeneratedPassword","KWPasskey"],n=[...s,...a],i=e=>!!e&&"string"==typeof e&&n.includes(e),o=e=>!!e&&"object"==typeof e&&Array.isArray(e)&&e.every(i)},3124:(e,t,r)=>{"use strict";r.d(t,{P:()=>s,w:()=>a});const s=e=>e instanceof Array&&!e.find((e=>{return!("object"==typeof(t=e)&&null!==t&&"id"in t&&"fieldIdentifier"in t&&"domain"in t);var t})),a=e=>"none"===e.correctedDataSource},52434:(e,t,r)=>{"use strict";var s;r.d(t,{M:()=>s}),function(e){e[e.CannotDisable=0]="CannotDisable",e[e.DisableSpecificVaultItem=1]="DisableSpecificVaultItem",e[e.DisableGeneralSetting=2]="DisableGeneralSetting"}(s||(s={}))},85449:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});const s=e=>Array.isArray(e)},78364:(e,t,r)=>{"use strict";var s;r.d(t,{k:()=>s}),function(e){e.Address="Address",e.BankAccount="BankAccount",e.Company="Company",e.Credential="Credential",e.CredentialCategory="CredentialCategory",e.DriverLicense="DriverLicense",e.Email="Email",e.FiscalId="FiscalId",e.GeneratedPassword="GeneratedPassword",e.IdCard="IdCard",e.Identity="Identity",e.NoteCategory="NoteCategory",e.Note="Note",e.Passport="Passport",e.Passkey="Passkey",e.PaymentCard="PaymentCard",e.PersonalWebsite="PersonalWebsite",e.Phone="Phone",e.SocialSecurityId="SocialSecurityId"}(s||(s={}))},74127:(e,t,r)=>{"use strict";r.r(t),r.d(t,{AddDisabledSourceTypesCommand:()=>R.g,AnalysisStatus:()=>T._,CREDENTIAL_DATA_MODELS:()=>p.q_,DisableAnalysisCommand:()=>I.u,DisableAutofillOnFormsCommand:()=>D.t,DisableAutofillOnLoginsCommand:()=>U.f,DisableAutologinCommand:()=>P.T,DisableFollowUpNotificationCommand:()=>F.y,DisablePhishingPreventionForUrlCommand:()=>E.z,EnableAnalysisCommand:()=>O.c,EnableAutofillOnFormsCommand:()=>k.a,EnableAutofillOnLoginsCommand:()=>L.I,EnableAutologinCommand:()=>N.i,EnableFollowUpNotificationCommand:()=>M.B,FORM_DATA_MODELS:()=>p.up,GetAnalysisStatusOnUrlQuery:()=>T.h,GetAutofillDisabledOnLoginsAndFormsNotificationStatusQuery:()=>v.z,GetAutofillProtectionContextQuery:()=>w.u,GetAutofillSettingsQuery:()=>C.T,GetDashlaneDefinedLinkedWebsitesQuery:()=>K.J,GetUserAutofillCorrectionsQuery:()=>x.w,OtherSourceType:()=>s,PasswordAutofillPerformedEvent:()=>i.p,PhishingPreventionDisabledForUrlQuery:()=>_.v,PhishingPreventionEnabledQuery:()=>S.i,RemoveDisabledSourceTypesCommand:()=>V.v,ResetProtectedItemAutofillTimerCommand:()=>b.y,SetAutofillDisabledOnLoginsAndFormsNotificationStatusCommand:()=>g.a,SetUserAutofillCorrectionsCommand:()=>q.S,TemporaryEmitPasswordAutofillPerformedEventCommand:()=>o.q,ToggleDashlaneCommand:()=>G.r,UpdateLinkedWebsitesCommand:()=>W.A,VaultItemDisableProtectionMode:()=>m.M,VaultSourceType:()=>c.k,autofillDataApi:()=>a.c,autofillNotificationsApi:()=>y._,autofillSecurityApi:()=>f.V,autofillSettingsApi:()=>A.I,autofillTrackingApi:()=>n.Y,isArrayOfAutofillableDataModel:()=>p.rF,isArrayOfUserAutofillCorrections:()=>h.P,isAutofillableDataModel:()=>p.Pw,isCredentialsArray:()=>l.A,isDashlaneDisabledPermanently:()=>h.w,isOtherSourceType:()=>u,isVaultSourceType:()=>d,linkedWebsitesApi:()=>j.G});var s,a=r(15403),n=r(92018),i=r(11564),o=r(73581),c=r(78364);!function(e){e.NewPassword="newPassword",e.SubmitButton="submitButton",e.WebauthnConditionalUI="WebauthnConditionalUI"}(s||(s={}));const u=e=>Object.values(s).includes(e),d=e=>e in c.k;var l=r(85449),p=r(46154),h=r(3124),m=r(52434),y=r(45714),g=r(61933),v=r(63208),f=r(38554),w=r(51730),S=r(5282),_=r(63212),b=r(93555),E=r(94370),A=r(69029),T=r(68573),C=r(63267),x=r(3414),R=r(99682),I=r(3909),P=r(34962),D=r(65791),U=r(56e3),F=r(11232),O=r(54405),N=r(4924),k=r(38018),L=r(69643),M=r(82796),V=r(46918),G=r(50163),q=r(29641),j=r(46097),K=r(66608),W=r(9446)},46097:(e,t,r)=>{"use strict";r.d(t,{G:()=>i});var s=r(86952),a=r(66608),n=r(9446);const i=(0,s.Q)({name:"linkedWebsites",commands:{updateLinkedWebsites:n.A},events:{},queries:{getDashlaneDefinedLinkedWebsites:a.J}})},9446:(e,t,r)=>{"use strict";r.d(t,{A:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},66608:(e,t,r)=>{"use strict";r.d(t,{J:()=>n});var s=r(99059),a=r(25029);class n extends((0,s.k)({scope:a.F.User})){}},45714:(e,t,r)=>{"use strict";r.d(t,{_:()=>i});var s=r(86952),a=r(61933),n=r(63208);const i=(0,s.Q)({name:"autofillNotifications",commands:{setAutofillDisabledOnLoginsAndFormsNotificationStatus:a.a},events:{},queries:{getAutofillDisabledOnLoginsAndFormsNotificationStatus:n.z}})},61933:(e,t,r)=>{"use strict";r.d(t,{a:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},63208:(e,t,r)=>{"use strict";r.d(t,{z:()=>n});var s=r(99059),a=r(25029);class n extends((0,s.k)({scope:a.F.User})){}},38554:(e,t,r)=>{"use strict";r.d(t,{V:()=>u});var s=r(86952),a=r(51730),n=r(5282),i=r(63212),o=r(94370),c=r(93555);const u=(0,s.Q)({name:"autofillSecurity",commands:{disablePhishingPreventionForUrl:o.z,resetProtectedItemAutofillTimer:c.y},events:{},queries:{getAutofillProtectionContext:a.u,isPhishingPreventionCapabilityEnabled:n.i,isPhishingPreventionDisabledForUrl:i.v}})},94370:(e,t,r)=>{"use strict";r.d(t,{z:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},93555:(e,t,r)=>{"use strict";r.d(t,{y:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.Device})){}},51730:(e,t,r)=>{"use strict";r.d(t,{u:()=>n});var s=r(99059),a=r(25029);class n extends((0,s.k)({scope:a.F.User})){}},5282:(e,t,r)=>{"use strict";r.d(t,{i:()=>n});var s=r(99059),a=r(25029);class n extends((0,s.k)({scope:a.F.User})){}},63212:(e,t,r)=>{"use strict";r.d(t,{v:()=>n});var s=r(99059),a=r(25029);class n extends((0,s.k)({scope:a.F.User})){}},69029:(e,t,r)=>{"use strict";r.d(t,{I:()=>_});var s=r(86952),a=r(46918),n=r(99682),i=r(50163),o=r(68573),c=r(63267),u=r(3414),d=r(54405),l=r(4924),p=r(38018),h=r(69643),m=r(82796),y=r(3909),g=r(34962),v=r(65791),f=r(56e3),w=r(11232),S=r(29641);const _=(0,s.Q)({name:"autofillSettings",commands:{toggleDashlane:i.r,enableAnalysis:d.c,enableAutologin:l.i,enableAutofillOnForms:p.a,enableAutofillOnLogins:h.I,enableFollowUpNotification:m.B,disableAnalysis:y.u,disableAutologin:g.T,disableAutofillOnForms:v.t,disableAutofillOnLogins:f.f,disableFollowUpNotification:w.y,addDisabledSourceTypes:n.g,removeDisabledSourceTypes:a.v,setUserAutofillCorrections:S.S},events:{},queries:{getAnalysisStatusOnUrl:o.h,getAutofillSettings:c.T,getUserAutofillCorrections:u.w}})},99682:(e,t,r)=>{"use strict";r.d(t,{g:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},3909:(e,t,r)=>{"use strict";r.d(t,{u:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},65791:(e,t,r)=>{"use strict";r.d(t,{t:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},56e3:(e,t,r)=>{"use strict";r.d(t,{f:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},34962:(e,t,r)=>{"use strict";r.d(t,{T:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},11232:(e,t,r)=>{"use strict";r.d(t,{y:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},54405:(e,t,r)=>{"use strict";r.d(t,{c:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},38018:(e,t,r)=>{"use strict";r.d(t,{a:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},69643:(e,t,r)=>{"use strict";r.d(t,{I:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},4924:(e,t,r)=>{"use strict";r.d(t,{i:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},82796:(e,t,r)=>{"use strict";r.d(t,{B:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},46918:(e,t,r)=>{"use strict";r.d(t,{v:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},29641:(e,t,r)=>{"use strict";r.d(t,{S:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},50163:(e,t,r)=>{"use strict";r.d(t,{r:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},68573:(e,t,r)=>{"use strict";r.d(t,{_:()=>s,h:()=>i});var s,a=r(99059),n=r(25029);!function(e){e.ANALYSIS_ENABLED="ANALYSIS_ENABLED",e.ANALYSIS_DISABLED_BY_USER="ANALYSIS_DISABLED_BY_USER",e.ANALYSIS_DISABLED_BY_B2B_ADMIN="ANALYSIS_DISABLED_BY_B2B_ADMIN",e.ANALYSIS_DISABLED_BY_KILLSWITCH="ANALYSIS_DISABLED_BY_KILLSWITCH",e.ANALYSIS_DISABLED_BY_2FA_ENFORCEMENT="ANALYSIS_DISABLED_BY_2FA_ENFORCEMENT"}(s||(s={}));class i extends((0,a.k)({scope:n.F.Device})){}},63267:(e,t,r)=>{"use strict";r.d(t,{T:()=>n});var s=r(99059),a=r(25029);class n extends((0,s.k)({scope:a.F.User})){}},3414:(e,t,r)=>{"use strict";r.d(t,{w:()=>n});var s=r(99059),a=r(25029);class n extends((0,s.k)({scope:a.F.User})){}},29125:(e,t,r)=>{"use strict";r.d(t,{U:()=>i});var s=r(88802),a=r(99634),n=r(15403);let i=class{};i=(0,s.__decorate)([(0,a.Y)({api:n.c,handlers:{commands:{},events:{},queries:{}},providers:[]})],i)},59123:(e,t,r)=>{"use strict";r.d(t,{V:()=>h});var s=r(88802),a=r(99634),n=r(92018),i=r(81459),o=r(57924);let c=class extends i.f{};c=(0,s.__decorate)([(0,o.GS)()],c);var u=r(63663),d=r(87279),l=r(73581);let p=class{constructor(e){this.autofillTrackingEventsEmitter=e}execute({body:e}){const{credentialId:t}=e;return t&&this.autofillTrackingEventsEmitter.sendEvent("passwordAutofillPerformed",{credentialId:t}),Promise.resolve((0,d.Vp)(void 0))}};p=(0,s.__decorate)([(0,u.W)(l.q),(0,s.__metadata)("design:paramtypes",[c])],p);let h=class{};h=(0,s.__decorate)([(0,a.Y)({api:n.Y,handlers:{commands:{temporaryEmitPasswordAutofillPerformedEvent:p},events:{},queries:{}},providers:[c]})],h)},33084:(e,t,r)=>{"use strict";var s;r.d(t,{G:()=>s}),function(e){e.AutofillWebOneClickFormFill="autofill_web_oneClickFormFill",e.AutofillWebAskBeforeAutologin="autofill_web_askBeforeAutologin",e.AutofillWebNewSubdomainManagement="autofill_web_newSubdomainManagement",e.AutofillWebInjectScriptOnStartDev="autofill_web_injectScriptOnStart_dev",e.ReplaceInputListeners="autofill_web_replaceInputListeners",e.ReplaceInputListenersDev="autofill_web_replaceInputListeners_dev",e.PasskeySupport="autofill_web_passkey_support",e.PhishingPreventionOnPasteDev="autofill_web_phishing_prevention_on_paste_dev",e.PhishingPreventionOnPaste="autofill_web_phishing_prevention_on_paste_2",e.ImproveImpalaVisibility="autofill_web_improveImpalaVisibility",e.ImproveImpalaVisibilityDev="autofill_web_improveImpalaVisibility_dev",e.DisableAutologin="autofill_web_disableAutologin",e.AdminTabDev="ace_admin_tab_dev",e.AdminTab="ace_admin_tab",e.BiometricPasskeyDev="ace_web_biometric_passkey_dev",e.BiometricPasskey="ace_web_biometric_passkey",e.DisableEmailPasswordWarningDev="ace_disable_email_password_warning_dev",e.DisableEmailPasswordWarning="ace_disable_email_password_warning"}(s||(s={}))},26399:(e,t,r)=>{"use strict";r.d(t,{J:()=>x});var s=r(88802),a=r(99634),n=r(46097),i=r(60399),o=r(87065),c=r(69885),u=r(53576),d=r(64718),l=r(57924),p=r(94189),h=r(87279),m=r(85449),y=r(57282),g=r(29181),v=r(21405);const f=e=>Object.keys(e).map((t=>[t].concat(e[t]))),w=e=>[...e].sort();let S=class{constructor(e){this.cqrsClient=e,this.updateLinkedWebsites=async(e,t)=>{const r=await this.getCredentialById(t),s=this.getUserAddedLinkedWebsiteDomains(r),a=[...new Set(e)].filter(Boolean);var n,i;if(i=a,(n=s).length===i.length&&w(n).join("")===w(i).join(""))return;const o=0===a.length?[]:this.mergeLinkedWebsites(r,s,a),c={...r.LinkedServices,associated_domains:o},d=await this.cqrsClient.getClient(u.carbonLegacyApi).commands.carbon({name:"updateCredential",args:[{id:t,update:{linkedServices:c}}]});if((0,h.hx)(d))throw new Error("Error when updating linked websites using updateCredential query from Carbon")},this.populateDashlaneDefinedLinkedWebsitesIndex=e=>{const t={};return e.forEach((e=>{e.forEach((r=>{t[r]=e}))})),t},this.mergeLinkedDomainsIntoList=(e,t)=>{const r=[],s=[];e.forEach((e=>{return a=t,e.some((e=>a.includes(e)))?r.push(e):s.push(e);var a}));const a=r.concat([t]).flat();return s.concat([a])},this.reduceLinkedDomainsLists=(e,t,r)=>e.concat(t,r).reduce(this.mergeLinkedDomainsIntoList,[]),this._getDashlaneDefinedLinkedWebsites=e=>{const t=new d.Y(e).getRootDomain();return t?this.allDashlaneDefinedLinkedWebsitesIndex[t]||[t]:[]},this.getCredentialById=e=>{const{carbonState:t}=this.cqrsClient.getClient(u.carbonLegacyApi).queries;return(0,i.z)(t({path:"userSession.personalData.credentials"}).pipe((0,o.U)((t=>{if(!(0,h.d6)(t)||!(0,m.A)(t.data))throw new Error("Bad credential format");const r=t.data.find((t=>t.Id===e));if(r)return r;throw new Error("Cannot find credential")}))))},this.getUserAddedLinkedWebsiteDomains=e=>e.LinkedServices?.associated_domains?.flatMap((({domain:e})=>Boolean(e)?e:[]))??[],this.getNewLinkedWebsitesToAdd$=(e,t)=>t.filter((t=>!e.includes(t))).map((e=>({domain:e,source:u.LinkedWebsiteSource.Manual}))),this.mergeLinkedWebsites=(e,t,r)=>[...(e.LinkedServices?.associated_domains??[]).filter((e=>r.includes(e.domain))),...this.getNewLinkedWebsitesToAdd$(t,r)],this.allDashlaneDefinedLinkedWebsitesIndex=this.populateDashlaneDefinedLinkedWebsitesIndex(this.reduceLinkedDomainsLists(y,f(v),f(g)).map((e=>[...new Set(e)])))}getDashlaneDefinedLinkedWebsites$(e){return(0,c.of)(this._getDashlaneDefinedLinkedWebsites(e)).pipe((0,o.U)(h.Vp))}};S=(0,s.__decorate)([(0,l.GS)(),(0,s.__metadata)("design:paramtypes",[p.w])],S);var _=r(20754),b=r(66608);let E=class{constructor(e){this.linkedWebsites=e}execute({body:{url:e}}){return this.linkedWebsites.getDashlaneDefinedLinkedWebsites$(e)}};E=(0,s.__decorate)([(0,_.e)(b.J),(0,s.__metadata)("design:paramtypes",[S])],E);var A=r(63663),T=r(9446);let C=class{constructor(e){this.linkedWebsites=e}async execute({body:{credentialId:e,updatedLinkedWebsitesList:t}}){try{return await this.linkedWebsites.updateLinkedWebsites(t,e),(0,h.Vp)(void 0)}catch(e){return(0,h.Rn)({tag:"",error:e instanceof Error?e:new Error("Update linked websites command failed")})}}};C=(0,s.__decorate)([(0,A.W)(T.A),(0,s.__metadata)("design:paramtypes",[S])],C);let x=class{};x=(0,s.__decorate)([(0,a.Y)({api:n.G,handlers:{commands:{updateLinkedWebsites:C},events:{},queries:{getDashlaneDefinedLinkedWebsites:E}},providers:[S]})],x)},80034:(e,t,r)=>{"use strict";r.d(t,{r:()=>E});var s=r(88802),a=r(99634),n=r(45714),i=r(33084),o=r(95681),c=r(23347),u=r(25029),d=r(10722);const l=e=>void 0!==e&&"boolean"==typeof e;class p extends((0,o.Q)({persist:!0,storage:{initialValue:!1,typeGuard:l,schemaVersion:1},scope:u.F.User,storeName:"autofill-disabled-notification",capacity:c.Y._001KB,codec:d.E})){}var h=r(57924);let m=class{constructor(e){this.store=e}get autofillDisabledOnLoginsAndFormsNotificationStatus(){return{get$:this._getAutofillDisabledOnLoginsAndFormsNotificationStatus$,set:this._setAutofillDisabledOnLoginsAndFormsNotificationStatus.bind(this)}}get _getAutofillDisabledOnLoginsAndFormsNotificationStatus$(){return this.store.state$}async _setAutofillDisabledOnLoginsAndFormsNotificationStatus(e){try{await this.store.set(e)}catch{throw new Error("SetAutofillDisabledOnLoginsAndFormsNotificationStatus command from autofill-core failed")}}};m=(0,s.__decorate)([(0,h.GS)(),(0,s.__metadata)("design:paramtypes",[p])],m);var y=r(63663),g=r(87279),v=r(61933);let f=class{constructor(e){this.autofillDisabledNotificationRepository=e}async execute({body:e}){const{status:t}=e;return await this.autofillDisabledNotificationRepository.autofillDisabledOnLoginsAndFormsNotificationStatus.set(t),(0,g.Vp)(void 0)}};f=(0,s.__decorate)([(0,y.W)(v.a),(0,s.__metadata)("design:paramtypes",[m])],f);var w=r(87065),S=r(20754),_=r(63208);let b=class{constructor(e){this.repository=e}execute(){return this.repository.autofillDisabledOnLoginsAndFormsNotificationStatus.get$.pipe((0,w.U)(g.Vp))}};b=(0,s.__decorate)([(0,S.e)(_.z),(0,s.__metadata)("design:paramtypes",[m])],b);let E=class{};E=(0,s.__decorate)([(0,a.Y)({api:n._,handlers:{commands:{setAutofillDisabledOnLoginsAndFormsNotificationStatus:f},events:{},queries:{getAutofillDisabledOnLoginsAndFormsNotificationStatus:b}},stores:[p],providers:[m],requiredFeatureFlips:Object.values(i.G)})],E)},61845:(e,t,r)=>{"use strict";r.d(t,{k:()=>M});var s=r(88802),a=r(99634),n=r(38554),i=r(63663),o=r(94189),c=r(93555),u=r(87279),d=r(53576);let l=class{constructor(e){this.cqrsClient=e}async execute(){const{carbon:e}=this.cqrsClient.getClient(d.carbonLegacyApi).commands,t=await e({name:"resetProtectedItemAutofillTimer",args:[]});return(0,u.hx)(t)?(0,u.Rn)({tag:"ResetProtectedItemAutofillTimer command from autofill/security failed"}):(0,u.Vp)(void 0)}};l=(0,s.__decorate)([(0,i.W)(c.y),(0,s.__metadata)("design:paramtypes",[o.w])],l);var p=r(87065),h=r(85390),m=r(69885),y=r(60399),g=r(57924),v=r(85449),f=r(78364),w=r(52434),S=r(95681),_=r(23347),b=r(25029),E=r(10722),A=r(64718);const T=e=>!!e&&"object"==typeof e&&Object.values(e).every((e=>Array.isArray(e)))&&Object.keys(e).every((e=>new A.Y(e).isUrlValid()));class C extends((0,S.Q)({persist:!0,storage:{initialValue:{},typeGuard:T,schemaVersion:1},scope:b.F.User,storeName:"phishing-prevention-optouts",capacity:_.Y._010KB,codec:E.E})){}let x=class{constructor(e,t){this.cqrsClient=e,this.store=t,this._isPhishingPreventionEnabled=()=>{const{carbonState:e}=this.cqrsClient.getClient(d.carbonLegacyApi).queries;return e({path:"userSession.localSettings.nodePremiumStatus"}).pipe((0,p.U)((e=>{if(!(0,u.d6)(e))throw new Error("Cannot retrieve premium status");const t=e.data;return t.capabilities?.autofillWithPhishingPrevention.enabled??!1})))},this.isUserSSO=()=>{const{carbonState:e}=this.cqrsClient.getClient(d.carbonLegacyApi).queries;return e({path:"userSession.localSettings.premiumStatus"}).pipe((0,p.U)((e=>{if(!(0,u.d6)(e))throw new Error("Cannot retrieve premium status");return e.spaces})),(0,p.U)((e=>e?.[0].isSSOUser??!1)))},this.areProtectedItemsUnlocked=()=>{const{carbonState:e}=this.cqrsClient.getClient(d.carbonLegacyApi).queries;return(0,h.a)([e({path:"userSession.session.lastMasterPasswordCheck"}),e({path:"userSession.account.login"})]).pipe((0,p.U)((([e,t])=>{if(!(0,u.d6)(e)||"number"!=typeof e.data)throw new Error("Cannot retrieve last master password check");if(!(0,u.d6)(t)||"string"!=typeof t.data)throw new Error("No active login");const r=e.data,s=t.data;return Date.now()-r<(/^kw_test_auto_fmpc_.*/.test(s)?5e3:3e5)})))},this.isItemUnlocked=()=>(0,h.a)([this.areProtectedItemsUnlocked(),this.isUserSSO()]).pipe((0,p.U)((([e,t])=>e||t))),this.isGlobalCredentialProtectionSettingOn=()=>{const{carbonState:e}=this.cqrsClient.getClient(d.carbonLegacyApi).queries;return e({path:"userSession.personalSettings.ProtectPasswords"}).pipe((0,p.U)((e=>{if(!(0,u.d6)(e)||"boolean"!=typeof e.data)throw new Error("No global setting found");return e.data})))},this.getCredentialProtectionStatus=e=>{const{carbonState:t}=this.cqrsClient.getClient(d.carbonLegacyApi).queries;return t({path:"userSession.personalData.credentials"}).pipe((0,p.U)((t=>{if(!(0,u.d6)(t)||!(0,v.A)(t.data))throw new Error("Bad credential format");const r=t.data;return r.find((t=>t.Id===e))?.AutoProtected??!1})))},this.getIsMPRequiredForCreditCardOrSocialSecurityId=()=>{const{carbonState:e}=this.cqrsClient.getClient(d.carbonLegacyApi).queries;return e({path:"userSession.personalSettings.SecuredDataAutofillCreditcard"}).pipe((0,p.U)((e=>!(0,u.d6)(e)||"boolean"!=typeof e.data||e.data)))},this._isVaultItemProtected=(e,t)=>e===f.k.PaymentCard||e===f.k.SocialSecurityId?(0,h.a)([this.isItemUnlocked(),this.getIsMPRequiredForCreditCardOrSocialSecurityId()]).pipe((0,p.U)((([e,t])=>({disableMode:w.M.CannotDisable,isProtected:t&&!e})))):e===f.k.Credential?(0,h.a)([this.isItemUnlocked(),this.isGlobalCredentialProtectionSettingOn(),this.getCredentialProtectionStatus(t)]).pipe((0,p.U)((([e,t,r])=>t?{disableMode:w.M.DisableGeneralSetting,isProtected:!e}:{disableMode:w.M.DisableSpecificVaultItem,isProtected:r&&!e}))):(0,m.of)({disableMode:w.M.CannotDisable,isProtected:!1})}getIsVaultItemProtected$(e,t){return this._isVaultItemProtected(e,t).pipe((0,p.U)(u.Vp))}getIsPhishingPreventionEnabled$(){return this._isPhishingPreventionEnabled().pipe((0,p.U)(u.Vp))}get phishingPreventionOptOuts(){return{get$:this._getPhishingPreventionOptOuts$,set$:this._setPhishingPreventionOptOut.bind(this)}}async disablePhishingPreventionForUrl(e,t){const r=await(0,y.z)(this._getPhishingPreventionOptOuts$),s={...r,[e]:Array.from(new Set(r[e]??[]).add(t))};await this._setPhishingPreventionOptOut(s)}get _getPhishingPreventionOptOuts$(){return this.store.state$}async _setPhishingPreventionOptOut(e){try{await this.store.set(e)}catch{throw new Error("SetPhishingPreventionOptOut command from autofill-core has failed")}}};x=(0,s.__decorate)([(0,g.GS)(),(0,s.__metadata)("design:paramtypes",[o.w,C])],x);var R=r(20754),I=r(51730);let P=class{constructor(e){this.autofillSecurity=e}execute({body:e}){const{vaultItemId:t,vaultType:r}=e;return this.autofillSecurity.getIsVaultItemProtected$(r,t)}};P=(0,s.__decorate)([(0,R.e)(I.u),(0,s.__metadata)("design:paramtypes",[x])],P);var D=r(5282);let U=class{constructor(e){this.autofillSecurity=e}execute(){return this.autofillSecurity.getIsPhishingPreventionEnabled$()}};U=(0,s.__decorate)([(0,R.e)(D.i),(0,s.__metadata)("design:paramtypes",[x])],U);var F=r(94370);let O=class{constructor(e){this.autofillSecurityRepository=e}async execute({body:{credentialUrl:e,pasteDestinationUrl:t}}){return await this.autofillSecurityRepository.disablePhishingPreventionForUrl(e,t),(0,u.Vp)(void 0)}};O=(0,s.__decorate)([(0,i.W)(F.z),(0,s.__metadata)("design:paramtypes",[x])],O);var N=r(63212);let k=class{constructor(e){this.autofillSecurity=e}execute({body:{credentialUrl:e,pasteDestinationUrl:t}}){return this.autofillSecurity.phishingPreventionOptOuts.get$.pipe((0,p.U)((r=>e in r&&(r[e]??[]).includes(t))),(0,p.U)(u.Vp))}};k=(0,s.__decorate)([(0,R.e)(N.v),(0,s.__metadata)("design:paramtypes",[x])],k);var L=r(33084);let M=class{};M=(0,s.__decorate)([(0,a.Y)({api:n.V,handlers:{commands:{resetProtectedItemAutofillTimer:l,disablePhishingPreventionForUrl:O},events:{},queries:{getAutofillProtectionContext:P,isPhishingPreventionCapabilityEnabled:U,isPhishingPreventionDisabledForUrl:k}},stores:[C],providers:[x],requiredFeatureFlips:Object.values(L.G)})],M)},29748:(e,t,r)=>{"use strict";r.d(t,{P:()=>ye});var s=r(88802),a=r(99634),n=r(69029),i=r(33084),o=r(63663),c=r(94189),u=r(50163),d=r(87279),l=r(53576);let p=class{constructor(e){this.cqrsClient=e}async execute({body:e}){const{isAutofillEnabled:t,url:r}=e,{carbon:s}=this.cqrsClient.getClient(l.carbonLegacyApi).commands,a=await s({name:"toggleDashlane",args:[{where:"site",autofill:t,autologin:t,url:r}]});if((0,d.hx)(a))throw new Error("Toggle Dashlane command from core-autofill failed");return(0,d.Vp)(void 0)}};p=(0,s.__decorate)([(0,o.W)(u.r),(0,s.__metadata)("design:paramtypes",[c.w])],p);var h=r(87065),m=r(85390),y=r(43978),g=r(20754),v=r(64718),f=r(68573),w=r(28489);var S,_,b;!function(e){e[e.UNKNOWN_ERROR=0]="UNKNOWN_ERROR"}(S||(S={})),function(e){e.EMAIL_TOKEN="email_token",e.DEVICE_REGISTRATION="totp_device_registration",e.LOGIN="totp_login",e.SSO="sso"}(_||(_={})),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.PENDING=1]="PENDING",e[e.ERROR=2]="ERROR",e[e.READY=3]="READY"}(b||(b={}));const E=e=>{if(!(t=e)||"object"!=typeof t||!(0,w.l$)(t,"status")||"number"!=typeof t.status)throw new Error("twoFactorAuthentication is not of the expected type");var t;return e.status===b.READY&&e.shouldEnforceTwoFactorAuthentication},A=e=>!!e&&"object"==typeof e&&Array.isArray(e)&&e.every((e=>"string"==typeof e));var T=r(60399),C=r(97280),x=r(57924),R=r(46154);let I=class{constructor(e){this.cqrsClient=e}get isAutofillDisabled(){return{get$:this._getIsAutofillDisabled$,set:this._setIsAutofillDisabled.bind(this)}}get isAutologinDisabled(){return{get$:this._getIsAutologinDisabled$,set:this._setIsAutologinDisabled.bind(this)}}get disabledDomains(){return{get$:this._getDisabledDomains$,set:this._setDisabledDomains.bind(this),add:this._addDisabledDomains.bind(this),remove:this._removeDisabledDomains.bind(this)}}get disabledSourceTypes(){return{get$:this._getDisabledSourceTypes$,set:this._setDisabledSourceTypes.bind(this),add:this._addDisabledSourceTypes.bind(this),remove:this._removeDisabledSourceTypes.bind(this)}}get isFollowUpNotificationEnabled(){return{get$:this._getIsFollowUpNotificationEnabled$,set:this._setIsFollowUpNotificationEnabled.bind(this)}}async _updateSettings(e){const t=e.isAutofillDisabled??await(0,T.z)(this._getIsAutofillDisabled$),r=e.isAutologinDisabled??await(0,T.z)(this._getIsAutologinDisabled$),s=e.disabledDomains??await(0,T.z)(this._getDisabledDomains$),a=e.disabledSourceTypes??await(0,T.z)(this._getDisabledSourceTypes$),n=e.isFollowUpNotificationEnabled??await(0,T.z)(this._getIsFollowUpNotificationEnabled$),i=await this.cqrsClient.getClient(l.carbonLegacyApi).commands.carbon({name:"updateAutofillSettings",args:[{AutofillSettings:{disabledDomains:s,disabledSourceTypes:a,isAutofillDisabled:t,isAutologinDisabled:r,isFollowUpNotificationEnabled:n}}]});if((0,d.hx)(i))throw new Error("Error when updating autofill settings using updateAutofillSettings query from Carbon")}get _getAutofillSettings$(){const{carbonState:e}=this.cqrsClient.getClient(l.carbonLegacyApi).queries;return e({path:"userSession.personalSettings.AutofillSettings"}).pipe((0,h.U)((e=>{if(!(0,d.d6)(e)||!(e=>!!e&&"object"==typeof e&&(0,w.l$)(e,"isAutofillDisabled")&&"boolean"==typeof e.isAutofillDisabled&&(0,w.l$)(e,"isAutologinDisabled")&&"boolean"==typeof e.isAutologinDisabled&&(0,w.l$)(e,"disabledSourceTypes")&&(0,R.rF)(e.disabledSourceTypes)&&(0,w.l$)(e,"disabledDomains")&&Array.isArray(e.disabledDomains)&&e.disabledDomains.every((e=>"string"==typeof e))&&(0,w.l$)(e,"isFollowUpNotificationEnabled")&&"boolean"==typeof e.isFollowUpNotificationEnabled)(e.data))throw new Error("AutofillSettings is not of the expected type");return e.data})),(0,C.d)(1))}get _getIsAutofillDisabled$(){return this._getAutofillSettings$.pipe((0,h.U)((({isAutofillDisabled:e})=>e)))}_setIsAutofillDisabled(e){return this._updateSettings({isAutofillDisabled:e})}get _getIsAutologinDisabled$(){return this._getAutofillSettings$.pipe((0,h.U)((({isAutologinDisabled:e})=>e)))}_setIsAutologinDisabled(e){return this._updateSettings({isAutologinDisabled:e})}_setIsFollowUpNotificationEnabled(e){return this._updateSettings({isFollowUpNotificationEnabled:e})}get _getDisabledDomains$(){return this._getAutofillSettings$.pipe((0,h.U)((({disabledDomains:e})=>e)))}_setDisabledDomains(e){return this._updateSettings({disabledDomains:e})}async _addDisabledDomains(e){const t=await(0,T.z)(this._getDisabledDomains$);return this._setDisabledDomains([...new Set([...t,...e])])}async _removeDisabledDomains(e){const t=await(0,T.z)(this._getDisabledDomains$);return this._setDisabledDomains(t.filter((t=>!e.includes(t))))}get _getDisabledSourceTypes$(){return this._getAutofillSettings$.pipe((0,h.U)((({disabledSourceTypes:e})=>e)))}_setDisabledSourceTypes(e){return this._updateSettings({disabledSourceTypes:e})}async _addDisabledSourceTypes(e){const t=await(0,T.z)(this._getDisabledSourceTypes$);return this._setDisabledSourceTypes([...new Set([...t,...e])])}async _removeDisabledSourceTypes(e){const t=await(0,T.z)(this._getDisabledSourceTypes$);return this._setDisabledSourceTypes(t.filter((t=>!e.includes(t))))}get _getIsFollowUpNotificationEnabled$(){return this._getAutofillSettings$.pipe((0,h.U)((({isFollowUpNotificationEnabled:e})=>e)))}};I=(0,s.__decorate)([(0,x.GS)(),(0,s.__metadata)("design:paramtypes",[c.w])],I);let P=class{constructor(e,t){this.cqrsClient=e,this.settings=t}execute({body:{url:e}}){const{carbonState:t}=this.cqrsClient.getClient(l.carbonLegacyApi).queries,r=new v.Y(e),s=r.getRootDomain(),a=r.getHost(),n=t({path:"device.killswitch.disableAutofill"}).pipe((0,h.U)((e=>{if(!(0,d.d6)(e)||!(e=>"boolean"==typeof e)(e.data))throw new Error("Error when fetching killswitch.disableAutofill");return e.data}))),i=(0,m.a)({isAutofillDisabled:this.settings.isAutofillDisabled.get$,disabledDomains:this.settings.disabledDomains.get$}).pipe((0,y.w)((async({isAutofillDisabled:e,disabledDomains:t})=>e||t.includes(await s)))),o=t({path:"userSession.spaceData.spaces"}).pipe((0,y.w)((async e=>{if(!(0,d.d6)(e)||!(e=>!!e&&"object"==typeof e&&Array.isArray(e)&&e.every((e=>(0,w.l$)(e,"details")&&(0,w.l$)(e.details,"info"))))(e.data))throw new Error("Error when fetching spaceData.spaces");const t=e.data.reduce(((e,t)=>{const r=t.details.info.autologinDomainDisabledArray;return[...e,...A(r)?r:[]]}),[]),r=await a;return t.some((e=>{const t=new v.Y(e).getHost();return t===r||r.endsWith(`.${t}`)}))}))),c=t({path:"authentication.twoFactorAuthentication"}).pipe((0,h.U)((e=>{if(!(0,d.d6)(e))throw new Error("Error when fetching authentication.twoFactorAuthentication");return E(e.data)})));return(0,m.a)({isAutofillDisabledByB2BAdmin:o,isAutofillDisabledByKillswitch:n,isAutofillDisabledByUser:i,isAutofillDisabledBy2FAEnforcement:c}).pipe((0,h.U)((({isAutofillDisabledBy2FAEnforcement:e,isAutofillDisabledByB2BAdmin:t,isAutofillDisabledByKillswitch:r,isAutofillDisabledByUser:s})=>{let a=f._.ANALYSIS_ENABLED;return r?a=f._.ANALYSIS_DISABLED_BY_KILLSWITCH:t?a=f._.ANALYSIS_DISABLED_BY_B2B_ADMIN:s?a=f._.ANALYSIS_DISABLED_BY_USER:e&&(a=f._.ANALYSIS_DISABLED_BY_2FA_ENFORCEMENT),(0,d.Vp)({analysisStatus:a})})))}};P=(0,s.__decorate)([(0,g.e)(f.h),(0,s.__metadata)("design:paramtypes",[c.w,I])],P);var D=r(63267);let U=class{constructor(e){this.settings=e}execute(){return(0,m.a)({disabledDomains:this.settings.disabledDomains.get$,disabledSourceTypes:this.settings.disabledSourceTypes.get$,isAutofillDisabled:this.settings.isAutofillDisabled.get$,isAutologinDisabled:this.settings.isAutologinDisabled.get$,isFollowUpNotificationEnabled:this.settings.isFollowUpNotificationEnabled.get$}).pipe((0,h.U)(d.Vp))}};U=(0,s.__decorate)([(0,g.e)(D.T),(0,s.__metadata)("design:paramtypes",[I])],U);var F=r(99682);let O=class{constructor(e){this.settings=e}async execute({body:{sourceTypes:e}}){return await this.settings.disabledSourceTypes.add(e),(0,d.Vp)(void 0)}};O=(0,s.__decorate)([(0,o.W)(F.g),(0,s.__metadata)("design:paramtypes",[I])],O);var N=r(46918);let k=class{constructor(e){this.settings=e}async execute({body:{sourceTypes:e}}){return await this.settings.disabledSourceTypes.remove(e),(0,d.Vp)(void 0)}};k=(0,s.__decorate)([(0,o.W)(N.v),(0,s.__metadata)("design:paramtypes",[I])],k);var L=r(54405);let M=class{constructor(e){this.settings=e}async execute(){return await this.settings.isAutofillDisabled.set(!1),(0,d.Vp)(void 0)}};M=(0,s.__decorate)([(0,o.W)(L.c),(0,s.__metadata)("design:paramtypes",[I])],M);var V=r(3909);let G=class{constructor(e){this.settings=e}async execute(){return await this.settings.isAutofillDisabled.set(!0),(0,d.Vp)(void 0)}};G=(0,s.__decorate)([(0,o.W)(V.u),(0,s.__metadata)("design:paramtypes",[I])],G);var q=r(4924);let j=class{constructor(e){this.settings=e}async execute(){return await this.settings.isAutologinDisabled.set(!1),(0,d.Vp)(void 0)}};j=(0,s.__decorate)([(0,o.W)(q.i),(0,s.__metadata)("design:paramtypes",[I])],j);var K=r(34962);let W=class{constructor(e){this.settings=e}async execute(){return await this.settings.isAutologinDisabled.set(!0),(0,d.Vp)(void 0)}};W=(0,s.__decorate)([(0,o.W)(K.T),(0,s.__metadata)("design:paramtypes",[I])],W);var B=r(38018);let H=class{constructor(e){this.settings=e}async execute(){return await this.settings.disabledSourceTypes.remove([...R.up]),(0,d.Vp)(void 0)}};H=(0,s.__decorate)([(0,o.W)(B.a),(0,s.__metadata)("design:paramtypes",[I])],H);var z=r(69643);let $=class{constructor(e){this.settings=e}async execute(){return await this.settings.disabledSourceTypes.remove([...R.q_]),(0,d.Vp)(void 0)}};$=(0,s.__decorate)([(0,o.W)(z.I),(0,s.__metadata)("design:paramtypes",[I])],$);var Q=r(82796);let Y=class{constructor(e){this.settings=e}async execute(){return await this.settings.isFollowUpNotificationEnabled.set(!0),(0,d.Vp)(void 0)}};Y=(0,s.__decorate)([(0,o.W)(Q.B),(0,s.__metadata)("design:paramtypes",[I])],Y);var X=r(65791);let J=class{constructor(e){this.settings=e}async execute(){return await this.settings.disabledSourceTypes.add([...R.up]),(0,d.Vp)(void 0)}};J=(0,s.__decorate)([(0,o.W)(X.t),(0,s.__metadata)("design:paramtypes",[I])],J);var Z=r(56e3);let ee=class{constructor(e){this.settings=e}async execute(){return await this.settings.disabledSourceTypes.add([...R.q_]),(0,d.Vp)(void 0)}};ee=(0,s.__decorate)([(0,o.W)(Z.f),(0,s.__metadata)("design:paramtypes",[I])],ee);var te=r(11232);let re=class{constructor(e){this.settings=e}async execute(){return await this.settings.isFollowUpNotificationEnabled.set(!1),(0,d.Vp)(void 0)}};re=(0,s.__decorate)([(0,o.W)(te.y),(0,s.__metadata)("design:paramtypes",[I])],re);var se=r(29641),ae=r(3124),ne=r(95681),ie=r(23347),oe=r(25029),ce=r(10722);const ue=e=>!!e&&(0,ae.P)(e);class de extends((0,ne.Q)({persist:!0,storage:{initialValue:[],typeGuard:ue,schemaVersion:1},scope:oe.F.Device,storeName:"user-autofill-corrections",capacity:ie.Y._100KB,codec:ce.E})){}let le=class{constructor(e){this.store=e}get userAutofillCorrections(){return{get$:this._getUserAutofillCorrections$,set:this._setUserAutofillCorrections.bind(this)}}get _getUserAutofillCorrections$(){return this.store.state$}async _setUserAutofillCorrections(e){try{await this.store.set(e)}catch{throw new Error("SetUserAutofillCorrections command from core-autofill failed")}}};le=(0,s.__decorate)([(0,x.GS)(),(0,s.__metadata)("design:paramtypes",[de])],le);let pe=class{constructor(e){this.correctionsRepository=e}async execute({body:e}){const{corrections:t}=e;return await this.correctionsRepository.userAutofillCorrections.set(t),(0,d.Vp)(void 0)}};pe=(0,s.__decorate)([(0,o.W)(se.S),(0,s.__metadata)("design:paramtypes",[le])],pe);var he=r(3414);let me=class{constructor(e){this.settings=e}execute(){return this.settings.userAutofillCorrections.get$.pipe((0,h.U)(d.Vp))}};me=(0,s.__decorate)([(0,g.e)(he.w),(0,s.__metadata)("design:paramtypes",[le])],me);let ye=class{};ye=(0,s.__decorate)([(0,a.Y)({api:n.I,handlers:{commands:{toggleDashlane:p,enableAnalysis:M,enableAutologin:j,enableAutofillOnForms:H,enableAutofillOnLogins:$,enableFollowUpNotification:Y,disableAnalysis:G,disableAutologin:W,disableAutofillOnForms:J,disableAutofillOnLogins:ee,disableFollowUpNotification:re,addDisabledSourceTypes:O,removeDisabledSourceTypes:k,setUserAutofillCorrections:pe},events:{},queries:{getAnalysisStatusOnUrl:P,getAutofillSettings:U,getUserAutofillCorrections:me}},stores:[de],providers:[I,le],requiredFeatureFlips:Object.values(i.G)})],ye)},75962:(e,t,r)=>{"use strict";r.d(t,{J:()=>l});var s=r(86952),a=r(80673),n=r(88030),i=r(30600),o=r(5105),c=r(22730),u=r(86695),d=r(23913);const l=(0,s.Q)({name:"masterPasswordSecurity",commands:{dismissMasterPasswordNotification:a.T,temporaryCheckMasterPassword:n.T,temporaryResetMasterPasswordLeaked:i.j,temporaryCheckMasterPasswordWeak:o.B},events:{},queries:{isMasterPasswordLeaked:c.B,isMasterPasswordWeak:u.D,isMasterPasswordNotificationDismissed:d.F}})},80673:(e,t,r)=>{"use strict";r.d(t,{T:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},5105:(e,t,r)=>{"use strict";r.d(t,{B:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},88030:(e,t,r)=>{"use strict";r.d(t,{T:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},30600:(e,t,r)=>{"use strict";r.d(t,{j:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},22730:(e,t,r)=>{"use strict";r.d(t,{B:()=>a});var s=r(99059);class a extends((0,s.k)()){}},23913:(e,t,r)=>{"use strict";r.d(t,{F:()=>a});var s=r(99059);class a extends((0,s.k)()){}},86695:(e,t,r)=>{"use strict";r.d(t,{D:()=>a});var s=r(99059);class a extends((0,s.k)()){}},97500:(e,t,r)=>{"use strict";r.d(t,{f:()=>Ue});var s=r(99634),a=r(75962),n=r(37935),i=r(6447),o=r(70305),c=r(20754),u=r(22730),d=r(25029),l=r(95681),p=r(23347),h=r(10722),m=r(7165);const y=m.z.object({isMasterPasswordLeaked:m.z.boolean(),isMasterPasswordNotificationDismissed:m.z.boolean(),isMasterPasswordWeak:m.z.boolean(),lastCheckTimestamp:m.z.number()}),g=e=>y.safeParse(e).success;class v extends((0,l.Q)({persist:!0,storage:{initialValue:{isMasterPasswordWeak:!1,isMasterPasswordLeaked:!1,isMasterPasswordNotificationDismissed:!1,lastCheckTimestamp:0},typeGuard:g,schemaVersion:1},scope:d.F.User,isCache:!0,storeName:"master-password-security",codec:h.E,capacity:p.Y._001KB})){}var f=r(87279),w=r(87065),S=function(e,t,r,s){var a,n=arguments.length,i=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,s);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(i=(n<3?a(i):n>3?a(t,r,i):a(t,r))||i);return n>3&&i&&Object.defineProperty(t,r,i),i},_=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let b=class{constructor(e){this.masterPasswordSecurityStore=e}execute(){return this.masterPasswordSecurityStore.state$.pipe((0,w.U)((e=>(0,f.Vp)(e.isMasterPasswordLeaked))))}};b=S([(0,c.e)(u.B),_("design:paramtypes",[v])],b);var E=r(86695),A=function(e,t,r,s){var a,n=arguments.length,i=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,s);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(i=(n<3?a(i):n>3?a(t,r,i):a(t,r))||i);return n>3&&i&&Object.defineProperty(t,r,i),i},T=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let C=class{constructor(e){this.masterPasswordSecurityStore=e}execute(){return this.masterPasswordSecurityStore.state$.pipe((0,w.U)((e=>(0,f.Vp)(e.isMasterPasswordWeak))))}};C=A([(0,c.e)(E.D),T("design:paramtypes",[v])],C);var x=r(23913),R=function(e,t,r,s){var a,n=arguments.length,i=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,s);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(i=(n<3?a(i):n>3?a(t,r,i):a(t,r))||i);return n>3&&i&&Object.defineProperty(t,r,i),i},I=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let P=class{constructor(e){this.masterPasswordSecurityStore=e}execute(){return this.masterPasswordSecurityStore.state$.pipe((0,w.U)((e=>(0,f.Vp)(e.isMasterPasswordNotificationDismissed))))}};P=R([(0,c.e)(x.F),I("design:paramtypes",[v])],P);var D=r(63663),U=r(80673),F=function(e,t,r,s){var a,n=arguments.length,i=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,s);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(i=(n<3?a(i):n>3?a(t,r,i):a(t,r))||i);return n>3&&i&&Object.defineProperty(t,r,i),i},O=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let N=class{constructor(e){this.masterPasswordSecurityStore=e}async execute(){const e=await this.masterPasswordSecurityStore.getState();return await this.masterPasswordSecurityStore.set({...e,isMasterPasswordNotificationDismissed:!0}),Promise.resolve((0,f.Vp)(void 0))}};N=F([(0,D.W)(U.T),O("design:paramtypes",[v])],N);var k=r(88030),L=r(57924),M=r(73404),V=r(60399),G=r(79256),q=r(96303),j=r(54066),K=function(e,t,r,s){var a,n=arguments.length,i=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,s);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(i=(n<3?a(i):n>3?a(t,r,i):a(t,r))||i);return n>3&&i&&Object.defineProperty(t,r,i),i},W=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let B=class{constructor(e){this.argon2dDeriver=e}async hash(e){return(0,q.k)(await this.argon2dDeriver.derive((0,j.u)(e),(0,j.u)("z8CXohryCcGAa7CESNHYnedqbDyp"),{tCost:3,mCost:32768,parallelism:2}))}};B=K([(0,L.GS)(),W("design:paramtypes",[G.y])],B);var H=function(e,t,r,s){var a,n=arguments.length,i=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,s);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(i=(n<3?a(i):n>3?a(t,r,i):a(t,r))||i);return n>3&&i&&Object.defineProperty(t,r,i),i},z=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let $=class{constructor(e,t,r){this.serverApiClient=e,this.masterPasswordSecurityStore=t,this.passwordHasher=r}shouldBeChecked(){return(0,V.z)(this.masterPasswordSecurityStore.state$.pipe((0,w.U)((e=>!e.isMasterPasswordLeaked&&e.lastCheckTimestamp+864e5<=Date.now()))))}async check(e){const t=await this.passwordHasher.hash(e),r=await(0,V.z)(this.serverApiClient.v1.pwleak.getHashes({hashPrefix:t.substring(0,6)}));if((0,f.hx)(r))throw new Error("Error while retrieving list of hashes for MP checking");const s=r.data.data.includes(t),a=await this.masterPasswordSecurityStore.getState();return await this.masterPasswordSecurityStore.set({...a,isMasterPasswordLeaked:s,lastCheckTimestamp:Date.now()})}};$=H([(0,L.GS)(),z("design:paramtypes",[M.l,v,B])],$);var Q=function(e,t,r,s){var a,n=arguments.length,i=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,s);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(i=(n<3?a(i):n>3?a(t,r,i):a(t,r))||i);return n>3&&i&&Object.defineProperty(t,r,i),i},Y=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let X=class{constructor(e){this.masterPasswordSecurityStore=e}async reset(){const e=await this.masterPasswordSecurityStore.getState();return await this.masterPasswordSecurityStore.set({...e,isMasterPasswordNotificationDismissed:!1})}};X=Q([(0,L.GS)(),Y("design:paramtypes",[v])],X);var J=r(94189),Z=r(20587),ee=r(92233),te=function(e,t,r,s){var a,n=arguments.length,i=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,s);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(i=(n<3?a(i):n>3?a(t,r,i):a(t,r))||i);return n>3&&i&&Object.defineProperty(t,r,i),i},re=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let se=class{constructor(e,t){this.masterPasswordSecurityStore=e,this.cqrsClient=t}async send(){const{commands:{trackEvent:e}}=this.cqrsClient.getClient(Z.Yu),t=await this.masterPasswordSecurityStore.getState();await e({event:new ee.AnonymousMasterPasswordHealthReportEvent({isLeaked:t.isMasterPasswordLeaked})})}};se=te([(0,L.GS)(),re("design:paramtypes",[v,J.w])],se);var ae=function(e,t,r,s){var a,n=arguments.length,i=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,s);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(i=(n<3?a(i):n>3?a(t,r,i):a(t,r))||i);return n>3&&i&&Object.defineProperty(t,r,i),i},ne=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let ie=class{constructor(e,t,r){this.checkMasterPasswordService=e,this.resetMasterPasswordNotification=t,this.anonymousMasterPasswordLeakedTrackingEventSender=r}async execute({body:e}){return await this.resetMasterPasswordNotification.reset(),await this.checkMasterPasswordService.shouldBeChecked()?(await this.checkMasterPasswordService.check(e.password),this.anonymousMasterPasswordLeakedTrackingEventSender.send(),Promise.resolve((0,f.Vp)(void 0))):Promise.resolve((0,f.Vp)(void 0))}};ie=ae([(0,D.W)(k.T),ne("design:paramtypes",[$,X,se])],ie);var oe=r(30600),ce=function(e,t,r,s){var a,n=arguments.length,i=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,s);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(i=(n<3?a(i):n>3?a(t,r,i):a(t,r))||i);return n>3&&i&&Object.defineProperty(t,r,i),i},ue=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let de=class{constructor(e){this.masterPasswordSecurityStore=e}async execute(){const e=await this.masterPasswordSecurityStore.getState();return await this.masterPasswordSecurityStore.set({...e,lastCheckTimestamp:0,isMasterPasswordLeaked:!1,isMasterPasswordNotificationDismissed:!1}),Promise.resolve((0,f.Vp)(void 0))}};de=ce([(0,D.W)(oe.j),ue("design:paramtypes",[v])],de);var le=r(5105),pe=r(85465);const he=async e=>{if(e)return await(async e=>(await(0,pe.evaluate)(e)).score)(e)/25};var me=function(e,t,r,s){var a,n=arguments.length,i=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,s);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(i=(n<3?a(i):n>3?a(t,r,i):a(t,r))||i);return n>3&&i&&Object.defineProperty(t,r,i),i},ye=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let ge=class{constructor(e){this.masterPasswordSecurityStore=e}async check(e){const t=(await he(e)??5)<3,r=await this.masterPasswordSecurityStore.getState();return await this.masterPasswordSecurityStore.set({...r,isMasterPasswordWeak:t})}};ge=me([(0,L.GS)(),ye("design:paramtypes",[v])],ge);var ve=function(e,t,r,s){var a,n=arguments.length,i=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,s);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(i=(n<3?a(i):n>3?a(t,r,i):a(t,r))||i);return n>3&&i&&Object.defineProperty(t,r,i),i},fe=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let we=class{constructor(e,t){this.masterPasswordSecurityStore=e,this.cqrsClient=t}async send(){const{commands:{trackEvent:e}}=this.cqrsClient.getClient(Z.Yu),t=await this.masterPasswordSecurityStore.getState();await e({event:new ee.AnonymousMasterPasswordHealthReportEvent({isWeak:t.isMasterPasswordWeak})})}};we=ve([(0,L.GS)(),fe("design:paramtypes",[v,J.w])],we);var Se=function(e,t,r,s){var a,n=arguments.length,i=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,s);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(i=(n<3?a(i):n>3?a(t,r,i):a(t,r))||i);return n>3&&i&&Object.defineProperty(t,r,i),i},_e=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let be=class{constructor(e,t,r){this.checkMasterPasswordWeakService=e,this.anonymousMasterPasswordWeakTrackingEventSender=t,this.resetMasterPasswordNotification=r}async execute({body:e}){return await this.resetMasterPasswordNotification.reset(),await this.checkMasterPasswordWeakService.check(e.password),this.anonymousMasterPasswordWeakTrackingEventSender.send(),Promise.resolve((0,f.Vp)(void 0))}};be=Se([(0,D.W)(le.B),_e("design:paramtypes",[ge,we,X])],be);var Ee=function(e,t,r,s){var a,n=arguments.length,i=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,s);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(i=(n<3?a(i):n>3?a(t,r,i):a(t,r))||i);return n>3&&i&&Object.defineProperty(t,r,i),i},Ae=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Te=class{constructor(e){this.masterPasswordSecurityStore=e}async reset(){const e=await this.masterPasswordSecurityStore.getState();return await this.masterPasswordSecurityStore.set({...e,isMasterPasswordWeak:!1})}};Te=Ee([(0,L.GS)(),Ae("design:paramtypes",[v])],Te);var Ce=r(68307),xe=r(67490),Re=function(e,t,r,s){var a,n=arguments.length,i=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,s);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(i=(n<3?a(i):n>3?a(t,r,i):a(t,r))||i);return n>3&&i&&Object.defineProperty(t,r,i),i},Ie=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Pe=class{constructor(e){this.resetMasterPasswordWeak=e}handle(){return this.resetMasterPasswordWeak.reset(),Promise.resolve(void 0)}};Pe=Re([(0,Ce.b)(xe.D),Ie("design:paramtypes",[Te])],Pe);var De=function(e,t,r,s){var a,n=arguments.length,i=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,s);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(i=(n<3?a(i):n>3?a(t,r,i):a(t,r))||i);return n>3&&i&&Object.defineProperty(t,r,i),i};let Ue=class{};Ue=De([(0,s.Y)({api:a.J,handlers:{commands:{dismissMasterPasswordNotification:N,temporaryCheckMasterPassword:ie,temporaryResetMasterPasswordLeaked:de,temporaryCheckMasterPasswordWeak:be},events:{...(0,s.g)(o.v,{masterPasswordChanged:Pe})},queries:{isMasterPasswordLeaked:b,isMasterPasswordWeak:C,isMasterPasswordNotificationDismissed:P}},providers:[$,B,X,ge,se,we,Te],imports:[n.D,i.n],stores:[v]})],Ue)},43894:(e,t,r)=>{"use strict";r.d(t,{B:()=>i});var s=r(86952),a=r(11730),n=r(9932);const i=(0,s.Q)({name:"notifications",commands:{},events:{},queries:{GetPlanPricingQuery:a.c,GetUserMessagesQuery:n.m}})},11730:(e,t,r)=>{"use strict";r.d(t,{c:()=>n});var s=r(99059),a=r(25029);class n extends((0,s.k)({scope:a.F.User})){}},9932:(e,t,r)=>{"use strict";r.d(t,{m:()=>i});var s,a=r(99059),n=r(25029);!function(e){e.DEFAULT="default",e.TRIAL_EXPIRED="trial_expired",e.WEB_STORE="web_store",e.DASHBOARD_UPGRADE="dashboard_upgrade",e.SHARING_CENTER_FAMILY="sharing_center_family",e.SHARING_CENTER_WORK="sharing_center_work"}(s||(s={}));class i extends((0,a.k)({scope:n.F.User})){}},80260:(e,t,r)=>{"use strict";r.d(t,{F:()=>b});var s=r(88802),a=r(99634),n=r(43894),i=r(30523),o=r(87065),c=r(43978),u=r(20754),d=r(94189),l=r(53576),p=r(11730),h=r(57924),m=r(73404),y=r(48844),g=r(87279);let v=class{constructor(e){this.serverApiClient=e}getPlanPricing({login:e,userKey:t,couponCode:r,language:s,hasEssentials:a}){return this.serverApiClient.v1.payments.getAccessibleWebOffers({login:e,userKey:t,couponCode:r,language:s,forceFamily:!0,hasEssentials:a}).pipe((0,y.DZ)((e=>{throw new Error(`GetPlanPricing failed with error: ${e}`)})),(0,y.lk)((e=>{const{plans:t,currency:r}=e.data,{family:s}=t,{offers:a,...n}=s,i={plans:{family:{offers:a.map((({duration:e,...t})=>({billingPeriod:e,...t}))),...n}},currency:r};return(0,g.Vp)(i)})))}};v=(0,s.__decorate)([(0,h.GS)(),(0,s.__metadata)("design:paramtypes",[m.l])],v);let f=class{constructor(e,t){this.cqrsClient=e,this.webOffersService=t}execute(){const{carbonState:e}=this.cqrsClient.getClient(l.carbonLegacyApi).queries;return e({path:"userSession.account.login"}).pipe((0,i.h)(g.d6),(0,o.U)((e=>e.data)),(0,c.w)((e=>this.webOffersService.getPlanPricing({login:e}))))}};f=(0,s.__decorate)([(0,u.e)(p.c),(0,s.__metadata)("design:paramtypes",[d.w,v])],f);var w=r(9932);let S=class{constructor(e){this.cqrsClient=e}execute(){const{carbonState:e}=this.cqrsClient.getClient(l.carbonLegacyApi).queries;return e({path:"userSession.localSettings.userMessages"}).pipe((0,y.Qn)((e=>e)))}};S=(0,s.__decorate)([(0,u.e)(w.m),(0,s.__metadata)("design:paramtypes",[d.w])],S);var _=r(6447);let b=class{};b=(0,s.__decorate)([(0,a.Y)({api:n.B,handlers:{commands:{},events:{},queries:{getPlanPricing:f,getUserMessages:S}},imports:[_.n],providers:[v]})],b)},8122:(e,t,r)=>{"use strict";r.d(t,{J:()=>i});var s=r(86952),a=r(47010),n=r(76107);const i=(0,s.Q)({name:"antiphishing",commands:{addAutoRedirectedDomain:n.A},events:{},queries:{isAutoRedirectedDomain:a.U}})},76107:(e,t,r)=>{"use strict";r.d(t,{A:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},47010:(e,t,r)=>{"use strict";r.d(t,{U:()=>a});var s=r(99059);class a extends((0,s.k)()){}},71450:(e,t,r)=>{"use strict";r.d(t,{H:()=>c});var s=r(86952),a=r(26254),n=r(91619),i=r(30240),o=r(60135);const c=(0,s.Q)({name:"breaches",commands:{dismissBreach:a.n,markBreachAsSeen:n.Q},events:{},queries:{breach:i.i,unreadBreachesCount:o.L}})},49186:(e,t,r)=>{"use strict";var s,a;r.d(t,{J:()=>s}),function(e){e.PENDING="PENDING",e.VIEWED="VIEWED",e.ACKNOWLEDGED="ACKNOWLEDGED"}(s||(s={})),function(e){e.Username="username",e.Password="password",e.Email="email",e.CreditCard="creditcard",e.Phone="phone",e.Address="address",e.SSN="ssn",e.IP="ip",e.Location="geolocation",e.PersonalInfo="personalinfo",e.SocialNetwork="social"}(a||(a={}))},26254:(e,t,r)=>{"use strict";r.d(t,{n:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},91619:(e,t,r)=>{"use strict";r.d(t,{Q:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},30240:(e,t,r)=>{"use strict";r.d(t,{i:()=>n});var s=r(99059),a=r(25029);class n extends((0,s.k)({scope:a.F.User})){}},60135:(e,t,r)=>{"use strict";r.d(t,{L:()=>n});var s=r(99059),a=r(25029);class n extends((0,s.k)({scope:a.F.User})){}},96248:(e,t,r)=>{"use strict";r.d(t,{M:()=>u});var s=r(86952),a=r(9310),n=r(21444),i=r(94814),o=r(9062),c=r(36214);const u=(0,s.Q)({name:"emailMonitoring",commands:{dismissOnboardingNotification:a.n,optinEmail:n.P5,optoutEmail:i.Lc},events:{},queries:{emailList:o.dB,onboardingNotificationState:c.p}})},9310:(e,t,r)=>{"use strict";r.d(t,{n:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},21444:(e,t,r)=>{"use strict";r.d(t,{Dq:()=>i,NM:()=>d,Ox:()=>c,P5:()=>p,XX:()=>o,l2:()=>u,vc:()=>l});var s=r(74354),a=r(25029),n=r(96168);const i="OK";var o;!function(e){e.INVALID_EMAIL="EMAIL_IS_INVALID",e.ALREADY_SUBSCRIBED="USER_HAS_ALREADY_AN_ACTIVE_SUBSCRIPTION",e.TOO_MANY_SUBSCRIPTIONS="USER_HAS_TOO_MANY_SUBSCRIPTIONS",e.GENERIC_ERROR="GENERIC_ERROR"}(o||(o={}));class c extends((0,n.Hu)(o.INVALID_EMAIL,"")){}class u extends((0,n.Hu)(o.ALREADY_SUBSCRIBED,"")){}class d extends((0,n.Hu)(o.TOO_MANY_SUBSCRIPTIONS,"")){}class l extends((0,n.Hu)(o.GENERIC_ERROR,"")){}class p extends((0,s.g)({scope:a.F.User})){}},94814:(e,t,r)=>{"use strict";r.d(t,{KP:()=>o,Lc:()=>l,QS:()=>i,h1:()=>u,uD:()=>c,v4:()=>d});var s=r(74354),a=r(25029),n=r(96168);const i="OK";var o;!function(e){e.INVALID_EMAIL="EMAIL_IS_INVALID",e.NO_SUBSCRIPTION="USER_HAS_NO_SUBSCRIPTION",e.GENERIC_ERROR="GENERIC_ERROR"}(o||(o={}));class c extends((0,n.Hu)(o.INVALID_EMAIL,"")){}class u extends((0,n.Hu)(o.NO_SUBSCRIPTION,"")){}class d extends((0,n.Hu)(o.GENERIC_ERROR,"")){}class l extends((0,s.g)({scope:a.F.User})){}},9062:(e,t,r)=>{"use strict";r.d(t,{a2:()=>n,dB:()=>i,wp:()=>s});var s,a=r(99059);function n(e){return"pending"===e||"active"===e||"disabled"===e}!function(e){e.PENDING="pending",e.ACTIVE="active",e.DISABLED="disabled"}(s||(s={}));class i extends((0,a.k)()){}},36214:(e,t,r)=>{"use strict";r.d(t,{p:()=>n});var s=r(99059),a=r(25029);class n extends((0,s.k)({scope:a.F.User})){}},90056:(e,t,r)=>{"use strict";r.d(t,{i:()=>n});var s=r(86952),a=r(6674);const n=(0,s.Q)({name:"otp",commands:{},events:{},queries:{otpCode:a.J}})},6674:(e,t,r)=>{"use strict";r.d(t,{J:()=>o,c:()=>i});var s=r(99059),a=r(25029),n=r(96168);class i extends((0,n.Hu)("Cannot generate OTP code due to no OtpSecret or OtpUrl found","")){}class o extends((0,s.k)({scope:a.F.User})){}},57668:(e,t,r)=>{"use strict";r.d(t,{d:()=>h});var s=r(86952),a=r(76687),n=r(45806),i=r(25547),o=r(99097),c=r(53489),u=r(75787),d=r(65796),l=r(32069),p=r(7466);const h=(0,s.Q)({name:"passwordHealth",commands:{updateIsCredentialExcluded:a.v,recalculatePasswordHealth:n.t},events:{passwordHealthComputationFinished:i.w},queries:{credentialHealthData:o.w,filterCredentials:c.Q,score:u.e,compromisedCredentials:d.v,compromisedCredentialsIdsForBreach:l.A,passwordHealthReport:p.b}})},76687:(e,t,r)=>{"use strict";r.d(t,{v:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},45806:(e,t,r)=>{"use strict";r.d(t,{t:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},25547:(e,t,r)=>{"use strict";r.d(t,{w:()=>n});var s=r(88885),a=r(25029);class n extends((0,s.d)({scope:a.F.User})){}},32069:(e,t,r)=>{"use strict";r.d(t,{A:()=>n});var s=r(99059),a=r(25029);class n extends((0,s.k)({scope:a.F.User})){}},65796:(e,t,r)=>{"use strict";r.d(t,{v:()=>n});var s=r(99059),a=r(25029);class n extends((0,s.k)({scope:a.F.User})){}},99097:(e,t,r)=>{"use strict";r.d(t,{w:()=>n});var s=r(99059),a=r(25029);class n extends((0,s.k)({scope:a.F.User})){}},53489:(e,t,r)=>{"use strict";r.d(t,{Q:()=>n});var s=r(99059),a=r(25029);class n extends((0,s.k)({scope:a.F.User})){}},7466:(e,t,r)=>{"use strict";r.d(t,{b:()=>n});var s=r(99059),a=r(25029);class n extends((0,s.k)({scope:a.F.User})){}},75787:(e,t,r)=>{"use strict";r.d(t,{e:()=>n});var s=r(99059),a=r(25029);class n extends((0,s.k)({scope:a.F.User})){}},93856:(e,t,r)=>{"use strict";r.d(t,{f:()=>s});const s=(0,r(86952).Q)({name:"vaultReport",commands:{},events:{},queries:{}})},47032:(e,t,r)=>{"use strict";r.d(t,{v:()=>b});var s=r(88802),a=r(99634),n=r(8122),i=r(25029),o=r(95681),c=r(23347),u=r(10722),d=r(7165);const l=d.z.object({autoredirection:d.z.record(d.z.boolean())}),p=e=>l.safeParse(e).success;class h extends((0,o.Q)({persist:!0,storage:{initialValue:{autoredirection:{}},typeGuard:p,schemaVersion:1},scope:i.F.Device,storeName:"antiphishing",codec:u.E,capacity:c.Y._001KB})){}var m=r(20754),y=r(47010),g=r(87065),v=r(87279);let f=class{constructor(e){this.antiphishingStore=e}execute({body:e}){return this.antiphishingStore.state$.pipe((0,g.U)((t=>(0,v.Vp)(!!e.domain&&!!t.autoredirection[e.domain]))))}};f=(0,s.__decorate)([(0,m.e)(y.U),(0,s.__metadata)("design:paramtypes",[h])],f);var w=r(63663),S=r(76107);let _=class{constructor(e){this.antiphishingStore=e}async execute({body:e}){const{domain:t}=e;if(t){const e=await this.antiphishingStore.getState();await this.antiphishingStore.set({...e,autoredirection:{...e.autoredirection,[t]:!0}})}return Promise.resolve((0,v.Vp)(void 0))}};_=(0,s.__decorate)([(0,w.W)(S.A),(0,s.__metadata)("design:paramtypes",[h])],_);let b=class{};b=(0,s.__decorate)([(0,a.Y)({api:n.J,handlers:{commands:{addAutoRedirectedDomain:_},events:{},queries:{isAutoRedirectedDomain:f}},stores:[h]})],b)},90364:(e,t,r)=>{"use strict";r.d(t,{b:()=>n});const s=e=>void 0===e||"string"==typeof e,a=e=>void 0===e||"number"==typeof e,n=e=>{if(!e||!Array.isArray(e))return!1;if(0===e.length)return!0;const t=e[0];return"string"==typeof t.Id&&a(t.LastBackupTime)&&s(t.kwType)&&s(t.AnonId)&&s(t.BreachId)&&a(t.ContentRevision)}},1237:(e,t,r)=>{"use strict";r.d(t,{T:()=>c,l:()=>o});var s=r(49186),a=r(9811);const n=({name:e,domains:t})=>{if(e)return e;if(t.length>0){const[e]=t;return e}return""},i=e=>(0,a.Tc)(e)?"private":"public",o=e=>[...e.reduce(((e,t)=>{const r=e.get(t.BreachId);return(!r||r.LastBackupTime&&t.LastBackupTime&&r.LastBackupTime<t.LastBackupTime)&&e.set(t.BreachId,t),e}),new Map).values()],c=(e,t)=>{const r=o(e.filter(a.rY)).find((e=>e.Id===t));if(!r)throw new Error("Breach not found");return(e=>{const t=e.Content,r=(0,a.Tc)(e)?e.Content.impactedEmails:[];return{anonId:e.AnonId??"",breachId:e.BreachId,breachType:i(e),domains:t.domains,eventDate:t.eventDate,id:e.Id,impactedEmails:r,kwType:e.kwType??"KWSecurityBreach",leakedData:t.leakedData??[],leakedPasswords:e.LeakedPasswords??[],name:n(t),status:e.Status??s.J.PENDING}})(r)}},9811:(e,t,r)=>{"use strict";r.d(t,{F7:()=>i,Tc:()=>o,rY:()=>n});const s=e=>"object"==typeof e,a=e=>(e=>s(e)&&"breachModelVersion"in e&&"number"==typeof e.breachModelVersion)(e)&&1===e.breachModelVersion&&"domains"in e&&Array.isArray(e.domains)&&"eventDate"in e&&"string"==typeof e.eventDate&&"id"in e&&"string"==typeof e.id,n=e=>{return s(t=e)&&"kwType"in t&&"string"==typeof t.kwType&&"KWSecurityBreach"===t.kwType&&a(e.Content);var t},i=e=>(e=>{const t=e;return"impactedEmails"in t&&Array.isArray(t.impactedEmails)})(e)&&e.impactedEmails.length>0,o=e=>n(e)&&i(e.Content)},32217:(e,t,r)=>{"use strict";r.d(t,{t:()=>T});var s=r(88802),a=r(99634),n=r(71450),i=r(63663),o=r(94189),c=r(87279),u=r(49186),d=r(26254),l=r(53576);let p=class{constructor(e){this.client=e}async execute({body:e}){const{commands:{carbon:t}}=this.client.getClient(l.carbonLegacyApi);return await t({name:"updateBreachStatus",args:[{id:e.id,status:u.J.ACKNOWLEDGED}]}),Promise.resolve((0,c.Vp)(void 0))}};p=(0,s.__decorate)([(0,i.W)(d.n),(0,s.__metadata)("design:paramtypes",[o.w])],p);var h=r(91619);let m=class{constructor(e){this.client=e}async execute({body:e}){const{commands:{carbon:t}}=this.client.getClient(l.carbonLegacyApi);return await t({name:"updateBreachStatus",args:[{id:e.id,status:u.J.VIEWED}]}),Promise.resolve((0,c.Vp)(void 0))}};m=(0,s.__decorate)([(0,i.W)(h.Q),(0,s.__metadata)("design:paramtypes",[o.w])],m);var y=r(48844),g=r(20754),v=r(30240),f=r(1237),w=r(90364);let S=class{constructor(e){this.client=e}execute({body:e}){const{id:t}=e,{queries:{carbonState:r}}=this.client.getClient(l.carbonLegacyApi);return r({path:"userSession.personalData.securityBreaches"}).pipe((0,y.Qn)((e=>{if(!(0,w.b)(e))throw new Error("Bad Breaches format");return e})),(0,y.Qn)((e=>(0,f.T)(e,t))))}};S=(0,s.__decorate)([(0,g.e)(v.i),(0,s.__metadata)("design:paramtypes",[o.w])],S);var _=r(87065),b=r(60135),E=r(9811);let A=class{constructor(e){this.client=e}execute(){const{queries:{carbonState:e}}=this.client.getClient(l.carbonLegacyApi);return e({path:"userSession.personalData.securityBreaches"}).pipe((0,y.Qn)((e=>{if(!(0,w.b)(e))throw new Error("Bad Breaches format");return e})),(0,_.U)((e=>{if((0,c.hx)(e))throw new Error("Error while fetching data");const t=(0,f.l)(e.data.filter(E.rY)).filter((e=>e.Status===u.J.PENDING&&(0,E.Tc)(e)));return(0,c.Vp)({count:t.length})})))}};A=(0,s.__decorate)([(0,g.e)(b.L),(0,s.__metadata)("design:paramtypes",[o.w])],A);let T=class{};T=(0,s.__decorate)([(0,a.Y)({api:n.H,handlers:{commands:{dismissBreach:p,markBreachAsSeen:m},events:{},queries:{breach:S,unreadBreachesCount:A}}})],T)},41239:(e,t,r)=>{"use strict";r.d(t,{S:()=>V});var s,a=r(88802),n=r(99634),i=r(96248),o=r(87065),c=r(6136),u=r(43978),d=r(90171),l=r(69885),p=r(87279),h=r(20754),m=r(9062),y=r(48844),g=r(73404),v=r(57924),f=r(25029),w=r(95681);!function(e){e.UNKNOWN="UNKNOWN",e.SEEN="SEEN",e.NOT_SEEN="NOT_SEEN"}(s||(s={}));var S=r(10722);const _=e=>(e=>!(!e||"object"!=typeof e)&&"onboardingStatus"in e&&"emails"in e)(e)&&function(e){return"UNKNOWN"===e||"SEEN"===e||"NOT_SEEN"===e}(e.onboardingStatus)&&Array.isArray(e.emails);class b extends((0,w.Q)({persist:!0,storage:{schemaVersion:1,initialValue:{onboardingStatus:s.NOT_SEEN,emails:[]},typeGuard:_},scope:f.F.User,storeName:"email-monitoring-state",storeTypeGuard:_,codec:S.E,isCache:!0})){}let E=class{constructor(e,t){this.serverApiClient=e,this.store=t,this.execute=()=>{this.serverApiClient.v1.darkwebmonitoring.listRegistrations({}).pipe((0,y.Qn)((({data:e})=>e.emails.map((e=>({email:e.email,state:(0,m.a2)(e.state)?e.state:m.wp.PENDING}))))),(0,y.Qn)((e=>{this.store.update((t=>({...t,emails:e})))})),(0,y.DZ)((e=>{throw e}))).subscribe()}}};E=(0,a.__decorate)([(0,v.GS)(),(0,a.__metadata)("design:paramtypes",[g.l,b])],E);let A=class{constructor(e,t){this.syncMonitoredEmails=e,this.store=t}execute(){this.syncMonitoredEmails.execute();return this.store.state$.pipe((0,o.U)((e=>e.emails)),(0,c.x)(((e,t)=>JSON.stringify(e)===JSON.stringify(t))),(0,o.U)((e=>(0,p.Vp)(e)))).pipe((0,u.w)((e=>{const t=()=>(this.syncMonitoredEmails.execute(),e),r=e=>(0,d.H)(0,e).pipe((0,u.w)((()=>(0,l.of)(t()))));return(0,p.hx)(e)||e.data.some((e=>e.state===m.wp.PENDING))?r(3e4):(0,l.of)(e)})))}};A=(0,a.__decorate)([(0,h.e)(m.dB),(0,a.__metadata)("design:paramtypes",[E,b])],A);var T=r(36214);let C=class{constructor(e){this.store=e}execute(){return this.store.state$.pipe((0,o.U)((e=>(0,p.Vp)(e.onboardingStatus))))}};C=(0,a.__decorate)([(0,h.e)(T.p),(0,a.__metadata)("design:paramtypes",[b])],C);var x=r(63663),R=r(9310);function I(e){return{...e,onboardingStatus:s.SEEN}}let P=class{constructor(e){this.store=e}async execute(){await this.store.update(I)}};P=(0,a.__decorate)([(0,v.GS)(),(0,a.__metadata)("design:paramtypes",[b])],P);let D=class{constructor(e){this.dismissOnboardingNotificationService=e}async execute(){return await this.dismissOnboardingNotificationService.execute(),Promise.resolve((0,p.Vp)(void 0))}};D=(0,a.__decorate)([(0,x.W)(R.n),(0,a.__metadata)("design:paramtypes",[P])],D);var U=r(21444),F=r(60399),O=r(82567);let N=class{constructor(e,t){this.serverApiClient=e,this.store=t}async execute({body:{email:e}}){return await(0,F.z)(this.serverApiClient.v1.darkwebmonitoring.registerEmail({email:e}).pipe((0,y.DZ)((e=>{throw new Error(e.message)})),(0,y.lk)((e=>e.data.result===U.Dq?(0,p.Vp)(void 0):(0,p.Rn)((e=>{switch(e){case U.XX.INVALID_EMAIL:return new U.Ox;case U.XX.ALREADY_SUBSCRIBED:return new U.l2;case U.XX.TOO_MANY_SUBSCRIPTIONS:return new U.NM;default:return new U.vc}})(e.data.result)))),(0,O.b)((async t=>{(0,p.d6)(t)&&await this.store.update((t=>({...t,emails:[...t.emails,{email:e,state:m.wp.PENDING}]})))}))))}};N=(0,a.__decorate)([(0,x.W)(U.P5),(0,a.__metadata)("design:paramtypes",[g.l,b])],N);var k=r(6447),L=r(94814);let M=class{constructor(e,t){this.serverApiClient=e,this.store=t,this.getFunctionalError=e=>{switch(e){case L.KP.NO_SUBSCRIPTION:return new L.h1;case L.KP.INVALID_EMAIL:return new L.uD;case L.KP.GENERIC_ERROR:default:return new L.v4}}}async execute({body:{email:e}}){return await(0,F.z)(this.serverApiClient.v1.darkwebmonitoring.deregisterEmail({email:e}).pipe((0,y.DZ)((e=>{throw new Error(e.message)})),(0,y.lk)((e=>e.data.result===L.QS?(0,p.Vp)(void 0):(0,p.Rn)(this.getFunctionalError(e.data.result)))),(0,O.b)((async t=>{(0,p.d6)(t)&&await this.store.update((t=>({...t,emails:[...t.emails.filter((t=>t.email!==e))]})))}))))}};M=(0,a.__decorate)([(0,x.W)(L.Lc),(0,a.__metadata)("design:paramtypes",[g.l,b])],M);let V=class{};V=(0,a.__decorate)([(0,n.Y)({api:i.M,stores:[b],handlers:{commands:{dismissOnboardingNotification:D,optinEmail:N,optoutEmail:M},events:{},queries:{emailList:A,onboardingNotificationState:C}},imports:[k.n],providers:[P,E]})],V)},67255:(e,t,r)=>{"use strict";r.d(t,{f:()=>k});var s=r(88802),a=r(99634),n=r(90056),i=r(87065),o=r(43978),c=r(69885),u=r(90171),d=r(30523),l=r(6674),p=r(20754),h=r(87279),m=r(53576),y=r(57924),g=r(94189),v=r(48844);const f=e=>void 0===e||"string"==typeof e;let w=class{constructor(e){this.client=e}getById(e){const{queries:{carbonState:t}}=this.client.getClient(m.carbonLegacyApi);return t({path:"state.userSession.personalData.credentials"}).pipe((0,v.Qn)((e=>{if(!(e=>!!Array.isArray(e)&&(0===e.length||e.every((e=>{const t=e;return"string"==typeof t.Id&&f(t.OtpSecret)&&f(t.OtpUrl)}))))(e))throw new Error("Bad credential format");return e})),(0,i.U)((t=>{if((0,h.hx)(t))return(0,h.Vp)(null);const r=t.data.reduce(((t,r)=>r.Id===e?{Id:r.Id,OtpSecret:r.OtpSecret,OtpUrl:r.OtpUrl}:t),null);return(0,h.Vp)(r)})))}};var S;w=(0,s.__decorate)([(0,y.GS)(),(0,s.__metadata)("design:paramtypes",[g.w])],w),function(e){e.SHA1="SHA-1",e.SHA256="SHA-256",e.SHA384="SHA-384",e.SHA512="SHA-512"}(S||(S={}));const _=["totp","hotp"],b=e=>{const t=new URL(e),r=(e=>{const t=e.hostname?e.hostname:/\/\/([th]otp)\//.exec(e.pathname)?.[1]??"";return _.includes(t)?t:null})(t),s=t.searchParams.get("secret")?.toUpperCase();if(!r||!s)throw new Error("Corrupted OTP url");const a=t.searchParams.get("digits"),n=t.searchParams.get("counter"),i=t.searchParams.get("period"),o=t.searchParams.get("algorithm");return{secret:s,algorithm:o?S[o]:S.SHA1,counter:n?Number.parseInt(n,10):0,digits:a?Number.parseInt(a,10):6,period:i?Number.parseInt(i,10):30}},E=e=>{const{OtpSecret:t,OtpUrl:r}=e;if(!t&&!r)throw new Error("Otp config missing for this credential");return r?b(r):{secret:(t??"").toUpperCase(),algorithm:S.SHA1,counter:0,digits:6,period:30}};var A=r(31222);const T="ABCDEFGHIJKLMNOPQRSTUVWXYZ234567".split("").reduce(((e,t,r)=>({...e,[t]:r})),{});function C(e){const t=T[e];if(void 0===t)throw new Error(`Invalid character found: ${e}`);return t}const x=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9],R=async(e,t,r)=>{const s=(e=>{const t=new Uint8Array(e),r=15&t[t.length-1],s=t.slice(r,r+4).reduce(((e,t)=>e.concat(t.toString(16).toString().padStart(2,"0"))),"");return 2147483647&Number.parseInt(s,16)})(await e(function(e){const t=new ArrayBuffer(8);return new DataView(t).setBigUint64(0,BigInt(e)),t}(t)));return(s%(r<=9?x[r]:Math.pow(10,r))).toString().padStart(r,"0")};class I{constructor(e,t){this.signer=e,this.getStep=t}async computeOtpCode({counter:e,digits:t,period:r}){const s=this.getStep(e,r);try{return await R(this.signer,s,t)}catch(e){return""}}}class P{constructor(e){this.hmacSigner=e}createCodeGenerator({secret:e,algorithm:t}){try{const r=function(e){const t=e.replaceAll("=","").trim().length;let r=0,s=0,a=0;const n=new Uint8Array(5*t/8|0);for(let i=0;i<t;i++)s=s<<5|C(e[i]),r+=5,r>=8&&(n[a++]=s>>>r-8&255,r-=8);return n.buffer}(e);return new I((e=>this.hmacSigner.sign(r,e,t)),this.getStep)}catch(e){return null}}getNextOtpRefreshTimestamp(e,t){if(e){const e=1e3*t,r=Math.floor(Date.now()/e)*e;return new Date(r+e).getTime()}throw new Error("Not supported for non time based OTP type")}}let D=class extends P{constructor(e){super(e)}getStep(e,t){return((e,t)=>Math.floor(e/t))(e||(new Date).getTime(),1e3*t)}};D=(0,s.__decorate)([(0,y.GS)(),(0,s.__metadata)("design:paramtypes",[A.q])],D);let U=class{constructor(e,t){this.credentialOTPGetter=e,this.otpGeneratorService=t}async withGeneratedCodeAndValidity(e,t){const r=await(t?.computeOtpCode(e))??"",s=this.otpGeneratorService.getNextOtpRefreshTimestamp(!0,e.period);return(0,h.Vp)({code:r,validityEndDate:s,validityTime:1e3*e.period})}withCodeGenerator(e){return{codeGenerator:this.otpGeneratorService.createCodeGenerator(e),params:e}}execute({body:e}){const{credentialId:t}=e;return this.credentialOTPGetter.getById(t).pipe((0,i.U)((e=>{if((0,h.hx)(e)||!e.data)throw new Error("Credential not found");return e.data})),(0,i.U)((e=>{if(!e.OtpUrl&&!e.OtpSecret)return{params:null,codeGenerator:null};const t=E(e);return this.withCodeGenerator(t)})),(0,o.w)((({params:e,codeGenerator:t})=>null===e||null===t?(0,c.of)((0,h.Rn)(new l.c)):(0,u.H)(0,1e3).pipe((0,d.h)((t=>{if(0===t)return!0;return((e,t)=>e-Date.now()>=1e3*t-1e3)(this.otpGeneratorService.getNextOtpRefreshTimestamp(!0,e.period),e.period)})),(0,o.w)((()=>this.withGeneratedCodeAndValidity(e,t)))))))}};U=(0,s.__decorate)([(0,p.e)(l.J),(0,s.__metadata)("design:paramtypes",[w,D])],U);let F=class extends P{constructor(e){super(e)}getStep(e,t){return e}};F=(0,s.__decorate)([(0,y.GS)(),(0,s.__metadata)("design:paramtypes",[A.q])],F);var O=r(37935);let N=class{};N=(0,s.__decorate)([(0,a.Y)({sharedModuleName:"otp-generator",providers:[D,F],exports:[D,F],imports:[O.D]})],N);let k=class{};k=(0,s.__decorate)([(0,a.Y)({api:n.i,handlers:{commands:{},events:{},queries:{otpCode:U}},imports:[N],providers:[w]})],k)},59206:(e,t,r)=>{"use strict";r.d(t,{U:()=>l});var s=r(88802),a=r(53576),n=r(57924),i=r(94189),o=r(48844),c=r(90364),u=r(1237),d=r(9811);let l=class{constructor(e){this.client=e}getSupportedBreaches(){const{queries:{carbonState:e}}=this.client.getClient(a.carbonLegacyApi);return e({path:"userSession.personalData.securityBreaches"}).pipe((0,o.Qn)((e=>{if(!(0,c.b)(e))throw new Error("Bad Breaches format");return e})),(0,o.Qn)((e=>e.filter(d.rY))))}get(){const{queries:{carbonState:e}}=this.client.getClient(a.carbonLegacyApi);return e({path:"userSession.personalData.securityBreaches"}).pipe((0,o.Qn)((e=>{if(!(0,c.b)(e))throw new Error("Bad Breaches format");return e})),(0,o.Qn)((e=>(0,u.l)(e.filter(d.rY)))))}};l=(0,s.__decorate)([(0,n.GS)(),(0,s.__metadata)("design:paramtypes",[i.w])],l)},45883:(e,t,r)=>{"use strict";r.d(t,{J:()=>m});var s=r(88802),a=r(53576),n=r(57924),i=r(94189),o=r(48844),c=r(87279),u=r(64718),d=r(61076),l=r(87065);const p=e=>void 0===e||"string"==typeof e,h=e=>void 0===e||"string"==typeof e||"boolean"==typeof e;let m=class{constructor(e){this.client=e}vaultBooleanFormatter(e,t=!1){return void 0===e?t:"string"==typeof e?"true"===e.toLocaleLowerCase():e}get(){const{queries:{carbonState:e}}=this.client.getClient(a.carbonLegacyApi),t=e({path:"state.userSession.spaceData.spaces"}).pipe((0,o.Qn)((e=>{if(!(e=>!!Array.isArray(e)&&(0===e.length||e.every((e=>{const t=e;return"string"==typeof t.teamId&&"object"==typeof t.details&&"string"==typeof t.details.status}))))(e))throw new Error("Bad space item format");return new Set(e.filter((e=>"accepted"===e.details.status)).map((e=>e.teamId)))}))),r=e({path:"userSession.sharingData.items"}).pipe((0,o.Qn)((e=>{if(!(e=>!!Array.isArray(e)&&(0===e.length||e.every((e=>{const t=e;return"string"==typeof t.content&&"string"==typeof t.itemId&&"number"==typeof t.timestamp}))))(e))throw new Error("Bad shared items format");return e.map((e=>e.itemId))})));return e({path:"state.userSession.personalData.credentials"}).pipe((0,o.Qn)((e=>{if(!(e=>!!Array.isArray(e)&&(0===e.length||e.every((e=>{const t=e;return"string"==typeof t.Id&&h(t.AutoLogin)&&h(t.AutoProtected)&&p(t.Email)&&p(t.Login)&&p(t.OtpSecret)&&p(t.OtpUrl)&&p(t.Password)&&p(t.Title)&&p(t.Url)&&p(t.SpaceId)&&h(t.Checked)}))))(e))throw new Error("Bad credential format");return e})),(0,d.V)(r,t),(0,l.U)((([e,t,r])=>{const s={};return(0,c.hx)(e)||(0,c.hx)(r)||e.data.forEach((e=>{const a=new u.Y(e.Url).getRootDomain();var n;e.SpaceId&&""!==e.SpaceId&&!r.data.has(e.SpaceId)||(s[e.Id]={domains:a?[a]:[],autoLogin:this.vaultBooleanFormatter(e.AutoLogin),autoProtected:this.vaultBooleanFormatter(e.AutoProtected),email:e.Email??"",excluded:this.vaultBooleanFormatter(e.Checked),id:e.Id,login:e.Login??"",otpSecret:e.OtpSecret??"",otpUrl:e.OtpUrl??"",password:e.Password??"",spaceId:e.SpaceId??"",shared:(n=e.Id,!(0,c.hx)(t)&&t.data.includes(n)),title:e.Title??""})})),(0,c.Vp)(s)})))}};m=(0,s.__decorate)([(0,n.GS)(),(0,s.__metadata)("design:paramtypes",[i.w])],m)},90140:(e,t,r)=>{"use strict";r.d(t,{C:()=>_t});var s=r(88802),a=r(57668),n=r(6447),i=r(60733),o=r(99634),c=r(92018),u=r(48430),d=r(25029),l=r(63663),p=r(94189),h=r(53576),m=r(87279),y=r(76687),g=r(95681),v=r(10722),f=r(28489);const w=e=>"object"==typeof e&&null!==e&&(0,f.l$)(e,"credentialsAtRisk")&&(0,f.l$)(e,"index")&&"object"==typeof e.credentialsAtRisk&&"object"==typeof e.index;class S extends((0,g.Q)({persist:!0,storage:{initialValue:{credentialsAtRisk:{},index:{}},typeGuard:w,schemaVersion:1},scope:d.F.User,storeName:"password-health-state",storeTypeGuard:w,codec:v.E,isCache:!0})){}var _,b,E,A;!function(e){e.Weak="weak",e.Reused="reused",e.Compromised="compromised",e.Excluded="excluded"}(_||(_={})),function(e){e.All="all",e.Weak="weak",e.Reused="reused",e.Compromised="compromised",e.Excluded="excluded"}(b||(b={})),function(e){e.WEAK="weak",e.EXTREMELY_WEAK="extremely_weak"}(E||(E={})),function(e){e.COMMON="common",e.STRONG="strong"}(A||(A={}));const T=e=>{const t={};if(!Object.keys(e).length)return t;for(const r in e){if(!e[r])continue;const s=e[r]?.spaceId??"";void 0===t[s]&&(t[s]={[_.Reused]:[],[_.Weak]:[],[_.Compromised]:[],[_.Excluded]:[],corruptedCount:0,importantCorruptedCount:0}),e[r]?.excluded?t[s][_.Excluded].push(r):(t[s].corruptedCount++,e[r]?.isImportant&&t[s].importantCorruptedCount++,e[r]?.risks.forEach((e=>t[s][e.riskType].push(r))))}return t};let C=class{constructor(e,t){this.store=e,this.client=t}async execute({body:e}){const{commands:{carbon:t}}=this.client.getClient(h.carbonLegacyApi);return await t({name:"updateCredential",args:[{id:e.credentialId,update:{isExcludedFromHealth:e.excluded}}]}),this.store.update((t=>{const r={...t.credentialsAtRisk[e.credentialId],excluded:e.excluded},s={...t};return s.credentialsAtRisk[e.credentialId]=r,s.index=T(t.credentialsAtRisk),s})),Promise.resolve((0,m.Vp)(void 0))}};C=(0,s.__decorate)([(0,l.W)(y.v),(0,s.__metadata)("design:paramtypes",[S,p.w])],C);var x=r(45806),R=r(57924),I=r(7165);const P=I.z.object({isOutdated:I.z.literal(!0),lastUpdateTimestamp:I.z.number(),updatedCredentialIds:I.z.record(I.z.string()),deletedCredentialIds:I.z.record(I.z.string()),hasUpdatedBreaches:I.z.boolean()}),D=I.z.object({isOutdated:I.z.literal(!1),lastUpdateTimestamp:I.z.number()}),U=I.z.discriminatedUnion("isOutdated",[P,D]),F=e=>U.safeParse(e).success;class O extends((0,g.Q)({persist:!0,storage:{initialValue:{isOutdated:!1,lastUpdateTimestamp:0},typeGuard:F,schemaVersion:1},scope:d.F.User,storeName:"health-cache-state",storeTypeGuard:F,codec:v.E,isCache:!0})){}var N=r(64987),k=r(70493);var L=r(59206),M=r(45883),V=r(81459);let G=class extends V.f{};G=(0,s.__decorate)([(0,R.GS)()],G);const q=e=>{const t=e.risks.filter((e=>e.riskType===_.Reused));return 1===t.length?t[0]:void 0},j=(e,t)=>e?.risks.find((e=>e.riskType===t)),K=(e,t)=>e.risks.filter((e=>e.riskType!==t)),W=(e,t,r)=>[...r,{riskType:_.Reused,credentialIds:[...t.credentialIds].filter((t=>e!==t))}],B=(e,t)=>{const r=q(t);return{...t,risks:K(t,_.Reused).concat([{riskType:_.Reused,credentialIds:r?[...r.credentialIds].concat(e.id):[e.id]}])}},H=e=>({id:e.id,title:e.title,email:e.email,excluded:e.excluded,login:e.login,autoLogin:e.autoLogin,autoProtected:e.autoProtected,otpSecret:e.otpSecret,otpUrl:e.otpUrl,spaceId:e.spaceId,shared:e.shared,domains:e.domains}),z=e=>({...H(e),risks:[],isImportant:!1}),$=(e,t,r)=>{const s=K(t,_.Reused),a=r&&r.length>0,n=s.length>0;return a||n?{...z(e),risks:a?s.concat([{riskType:_.Reused,credentialIds:r}]):s}:void 0},Q=e=>!!j(e,_.Weak),Y=e=>!!q(e),X=e=>!!j(e,_.Compromised),J=e=>e.excluded,Z=3,ee=5;function te(e,t,r=Z,s=ee){if(!e||!t)return!1;const a=e.length,n=t.length;if(Math.abs(a-n)>r)return!1;if(a<s||n<s)return e===t;if(e===t)return!0;let i=new Array(n+1),o=new Array(n+1),c=!1;for(let e=0;e<n+1;e++)i[e]=e;for(let s=0;s<a;s++){o[0]=s+1,c=o[0]>r;for(let a=0;a<n;a++){const n=i[a+1]+1,u=o[a]+1;let d=i[a];e[s]!==t[a]&&d++,o[a+1]=Math.min(n,Math.min(u,d)),c=c&&o[a+1]>r}const a=i;if(i=o,o=a,c)break}return i[n]<=r}const re=(e,t,r)=>{const s=((e,t)=>Object.keys(t).reduce(((r,s)=>te(s,e.password)?[...r,...t[s]]:r),[]))(e,r);if(!t&&0===s.length)return{};const a=(e=>{if(0!==e.length)return{riskType:_.Compromised,breaches:e}})(s),n=t?K(t,_.Compromised):[],i={...z(e),risks:a?n.concat(a):n};return{[e.id]:0===i.risks.length?void 0:i}},se=(e,t,r)=>{if(!r)return Promise.resolve({});const s=t[e.id]??z(e),a=s.risks.length>0,n=((e,t)=>Object.keys(t).map((e=>t[e])).filter((t=>t.id!==e.id&&te(t.password,e.password))).map((e=>e.id)))(e,r);if(0===n.length&&!a)return Promise.resolve({});const i=q(s)?.credentialIds??[],o=((e,t,r,s)=>{const a=r.filter((e=>!t.includes(e)));if(0===a.length)return{};const n={};for(const t of a){const r=s[t];if(!r)continue;const a=q(r);if(!a)continue;const i=K(r,_.Reused);1===a.credentialIds.length&&0===i.length?n[t]=void 0:n[t]={...r,risks:1===a.credentialIds.length?i:W(e,a,i)}}return n})(e.id,n,i,t),c=((e,t,r,s,a)=>{const n=t.filter((e=>!r.includes(e)));if(0===n.length)return{};const i={};for(const t of n){const r=s[t];if(r)i[t]=B(e,r);else{const r=a[t];i[t]={...z(r),risks:[{riskType:_.Reused,credentialIds:[e.id]}]}}}return i})(e,n,i,t,r),u=$(e,s,n);return Promise.resolve({...o,...c,[e.id]:u})};var ae=r(85465);const ne=async e=>{if(e)return await(async e=>(await(0,ae.evaluate)(e)).score)(e)/25},ie=async(e,t)=>{const r=await ne(e.password),s=t??z(e),a=K(s,_.Weak),n=void 0!==r&&r<2;return n||0!==a.length?{[e.id]:{...s,...H(e),risks:n?a.concat([{riskType:_.Weak,strength:r}]):a}}:{[e.id]:void 0}},oe=(e,t,r)=>{if(!t)return{};const s=e.domains.some((e=>r.has(e))),a={...t,isImportant:s};return{[t.id]:a}},ce=e=>{const t={};return Object.keys(e).forEach((r=>{const s=e[r];s&&(t[r]=s)})),t},ue=async({credentialUpdates:e,allCredentials:t,breaches:r,importantDomains:s,hasUpdatedBreaches:a,healthState:n,deletedCredentialIds:i})=>{const o=(e=>{const t={};return e.forEach((e=>{e.LeakedPasswords&&e.LeakedPasswords.forEach((r=>{Object.prototype.hasOwnProperty.call(t,r)?t[r].push({breachId:e.Id,date:e.Content.eventDate,domains:e.Content.domains}):t[r]=[{breachId:e.Id,date:e.Content.eventDate,domains:e.Content.domains}]}))})),t})(r),c=0===e.length&&0===i.length&&!a,u={...n?.credentialsAtRisk??{}},d=e=>Object.keys(e).forEach((t=>u[t]=e[t]));i.length>0&&d(((e=[])=>e.reduce(((e,t)=>({...e,[t]:void 0})),{}))(i));const l={},p={};for(const e of Object.keys(t))t[e].excluded?l[e]=z(t[e]):p[e]=t[e];const h=[],m=[];for(const t of e)t.excluded?m.push(t):i.includes(t.id)||h.push(t);d(((e,t)=>{const r={};for(const s of Object.values(t)){if(!s)continue;const t=q(s);if(!t)continue;const a=t.credentialIds.filter((t=>!e.includes(t)));if(a.length!==t.credentialIds.length){const e=K(s,_.Reused);0===a.length&&0===e.length?r[s.id]=void 0:r[s.id]={...s,risks:0===a.length?e:[...e,{...t,credentialIds:a}]}}}return r})([...Object.values(m).map((e=>e.id)),...i],u)),c&&d((e=>{const t={};for(let r=0;r<e.length;r++){const s=e[r],a=s.password,n=s.id,i=[];for(let o=r+1;o<e.length;o++){const r=e[o].id,c=e[o].password,u=e[o];if(te(a,c)){const e=t[r]??z(u),a=j(e,_.Reused),o=a?.credentialIds??[];t[r]=$(s,e,o.concat(n)),i.push(r)}}const o=t[n]??z(s),c=j(o,_.Reused),u=c?.credentialIds??[];t[n]=$(s,o,i.concat(u))}return t})(Object.values(p)));const y=c?Object.values(p):h;if(a)for await(const e of Object.values(p)){d(re(e,u[e.id],o))}for await(const e of y){if(!a){d(re(e,u[e.id],o))}if(!c){d(await se(e,u,p))}d(await ie(e,u[e.id])),d(oe(e,u[e.id],s))}return d(l),{credentialsAtRisk:ce(u),index:T(u)}};var de=r(67978),le=r(75994);let pe=class extends de.K{constructor(e){super("assets/domains/importantDomains.json",e)}loadResource(e){if(!(t=e)||!Array.isArray(t))throw new Error("Important domains file corrupted");var t;return new Set(e)}};pe=(0,s.__decorate)([(0,R.GS)(),(0,s.__metadata)("design:paramtypes",[le.X])],pe);var he=r(60399);let me=class{constructor(e,t,r,s,a,n){this.store=e,this.credentialsGetter=t,this.breachesGetter=r,this.importantDomains=s,this.eventEmitter=a,this.client=n}async run({updatedCredentialIds:e,deletedCredentialIds:t,hasUpdatedBreaches:r=!1}){const{userFeatureFlips:s}=this.client.getClient(k.cV).queries,a=await(0,he.z)(s());if((0,m.d6)(a)&&a.data.web_disable_password_health)return await this.store.set({credentialsAtRisk:{},index:{}}),void this.eventEmitter.sendEvent("passwordHealthComputationFinished",null);const n=await this.store.getState(),i=await(0,he.z)(this.credentialsGetter.get()),o=await(0,he.z)(this.breachesGetter.get()),c=await this.importantDomains.get();if((0,m.hx)(i)||(0,m.hx)(o))throw new Error("Failure getting vault data");const u=e?.length??0,d=t?.length??0,l=u>0||d>0||r,p=u+d<=50,h=l&&p?n:void 0,y=l?((e,t)=>e.reduce(((e,r)=>void 0===t[r]?e:[...e,t[r]]),[]))(e??[],i.data):[],g=await ue({hasUpdatedBreaches:r,credentialUpdates:p?y:[],allCredentials:i.data,breaches:o.data,importantDomains:c,healthState:h,deletedCredentialIds:p?[...t??[]]:[]});await this.store.set({...g}),this.eventEmitter.sendEvent("passwordHealthComputationFinished",null)}};me=(0,s.__decorate)([(0,R.GS)(),(0,s.__metadata)("design:paramtypes",[S,M.J,L.U,pe,G,p.w])],me);const ye=new N.WU;let ge=class{constructor(e,t){this.store=e,this.passwordHealthCalculationService=t}update(e){ye.runExclusive((async()=>{const t=await this.store.getState();this.store.set(((e,t)=>{const{isOutdated:r}=t;if(!r)return{isOutdated:!1,lastUpdateTimestamp:e.lastUpdateTimestamp};const{updatedCredentialIds:s,deletedCredentialIds:a,hasUpdatedBreaches:n}=t,i=e.isOutdated?{...e}:{isOutdated:!0,lastUpdateTimestamp:e.lastUpdateTimestamp,updatedCredentialIds:{},deletedCredentialIds:{},hasUpdatedBreaches:!1};return s&&(i.updatedCredentialIds={...i.updatedCredentialIds,...s.reduce(((e,t)=>({...e,[t]:t})),{})}),a&&(i.deletedCredentialIds={...i.deletedCredentialIds,...a.reduce(((e,t)=>({...e,[t]:t})),{})}),n&&(i.hasUpdatedBreaches=n),i})(t,e))}))}async updateHealthState(){await ye.runExclusive((async()=>{const e=await this.store.getState();(e.isOutdated||0===e.lastUpdateTimestamp||e.lastUpdateTimestamp+864e5<Date.now())&&(await this.passwordHealthCalculationService.run(this.prepCacheStateProps(e)),await this.markAsUpToDate())}))}prepCacheStateProps(e){return e.isOutdated?{updatedCredentialIds:Object.keys(e.updatedCredentialIds),deletedCredentialIds:Object.keys(e.deletedCredentialIds),hasUpdatedBreaches:e.hasUpdatedBreaches}:{}}async markAsUpToDate(){await this.store.set({isOutdated:!1,lastUpdateTimestamp:(new Date).getTime()})}};ge=(0,s.__decorate)([(0,R.GS)(),(0,s.__metadata)("design:paramtypes",[O,me])],ge);let ve=class{constructor(e){this.healthCacheUpdaterService=e}execute(){return this.healthCacheUpdaterService.update({isOutdated:!0}),Promise.resolve((0,m.Vp)(void 0))}};ve=(0,s.__decorate)([(0,l.W)(x.t),(0,s.__metadata)("design:paramtypes",[ge])],ve);var fe=r(87065),we=r(20754),Se=r(99097),_e=r(61076),be=r(82567);let Ee=class{constructor(e,t,r){this.store=e,this.cacheStore=t,this.healthCacheUpdater=r,this.state$=this.cacheStore.state$.pipe((0,_e.V)(this.store.state$),(0,be.b)((()=>{this.healthCacheUpdater.updateHealthState()})),(0,fe.U)((([e,t])=>t)))}};Ee=(0,s.__decorate)([(0,R.GS)(),(0,s.__metadata)("design:paramtypes",[S,O,ge])],Ee);const Ae=(e,t)=>{const r=((e,t)=>{if(0!==t.length)switch(e){case b.All:{const e={[_.Compromised]:3,[_.Weak]:2,[_.Reused]:1,[_.Excluded]:0};return t.reduce(((t,r)=>t?e[r.riskType]>e[t.riskType]?r:t:r),void 0)}case b.Compromised:return t.find((e=>e.riskType===_.Compromised));case b.Weak:return t.find((e=>e.riskType===_.Weak));case b.Reused:return t.find((e=>e.riskType===_.Reused));default:return}})(e,t);if(!r)return;const s={severity:A.COMMON};switch(r.riskType){case _.Compromised:{const e=[...r.breaches].sort(((e,t)=>{const r=Date.parse(e.date),s=Date.parse(t.date);return r===s?0:r<s?1:-1}))[0];return{...s,riskType:_.Compromised,date:e.date,domain:e.domains[0]??null,severity:A.STRONG}}case _.Reused:return{...s,riskType:_.Reused,reuseCount:r.credentialIds.length};case _.Weak:return{...s,riskType:_.Weak,strength:r.strength>=1?E.WEAK:E.EXTREMELY_WEAK}}};let Te=class{constructor(e){this.store=e}execute({body:e}){const{credentialId:t}=e;return this.store.state$.pipe((0,fe.U)((e=>e.credentialsAtRisk[t]?(0,m.Vp)((e=>{const{excluded:t,risks:r}=e;return{excluded:t,corruptionData:Ae(b.All,r)}})(e.credentialsAtRisk[t])):(0,m.Vp)(null))))}};Te=(0,s.__decorate)([(0,we.e)(Se.w),(0,s.__metadata)("design:paramtypes",[Ee])],Te);var Ce=r(75787),xe=r(86742);const Re=e=>null===e?null:Math.round(100*e),Ie=(e,t)=>({total:t,excluded:e.excluded.length,compromised:e.compromised.length,reused:e.reused.length,weak:e.weak.length,score:Re((0,xe.R9)(e.corruptedCount,e.importantCorruptedCount,t-e.excluded.length))}),Pe=(e,t)=>{const{compromised:r,reused:s,weak:a,corrupted:n,excluded:i,importantCorrupted:o}=Object.keys(e).reduce(((t,r)=>({compromised:t.compromised+e[r].compromised.length,reused:t.reused+e[r].reused.length,weak:t.weak+e[r].weak.length,corrupted:t.corrupted+e[r].corruptedCount,importantCorrupted:t.importantCorrupted+e[r].importantCorruptedCount,excluded:t.excluded+e[r].excluded.length})),{compromised:0,reused:0,weak:0,corrupted:0,importantCorrupted:0,excluded:0}),c=(0,xe.R9)(n,o,t-i);return{compromised:r,reused:s,total:t,weak:a,score:Re(c),excluded:i}};function De(e,t){return(0,m.hx)(e)?0:Object.keys(e.data).filter((r=>e.data[r].spaceId===t)).length}let Ue=class{constructor(e,t,r){this.cacheStateStore=e,this.credentialsGetter=t,this.store=r}execute({body:e}){const{spaceId:t=null}=e;return this.store.state$.pipe((0,_e.V)(this.credentialsGetter.get(),this.cacheStateStore.state$),(0,fe.U)((([e,r,s])=>{if(null!==t&&void 0===e.index[t]){const e=De(r,t);return(0,m.Vp)({counters:{compromised:0,reused:0,score:100,total:e,weak:0,excluded:0},isInitialized:s.lastUpdateTimestamp>0})}if(null===t){const t=(0,m.hx)(r)?0:Object.keys(r.data).length;return(0,m.Vp)({counters:Pe(e.index,t),isInitialized:s.lastUpdateTimestamp>0})}const a=De(r,t);return(0,m.Vp)({counters:Ie(e.index[t],a),isInitialized:s.lastUpdateTimestamp>0})})))}};Ue=(0,s.__decorate)([(0,we.e)(Ce.e),(0,s.__metadata)("design:paramtypes",[O,M.J,Ee])],Ue);var Fe=r(53489);const Oe={[_.Compromised]:1,[_.Reused]:2,[_.Weak]:3,[_.Excluded]:4},Ne=e=>[...e].sort(((e,t)=>{const r=Oe[e.corruptionData?.riskType??_.Excluded],s=Oe[t.corruptionData?.riskType??_.Excluded];if(r===s){const r=((e,t)=>e?.riskType===_.Compromised&&t?.riskType===_.Compromised?Date.parse(t.date)-Date.parse(e.date):e?.riskType===_.Reused&&t?.riskType===_.Reused?t.reuseCount-e.reuseCount:e?.riskType===_.Weak&&t?.riskType===_.Weak?e.strength===t.strength?0:e.strength===E.WEAK?1:-1:0)(e.corruptionData,t.corruptionData);return 0!==r?r:e.title.localeCompare(t.title)}return r-s})),ke=(e,t)=>t===b.All?[...new Set([...e[_.Compromised],...e[_.Reused],...e[_.Weak],...e[_.Excluded]])]:e[t],Le=(e,t)=>{const{id:r,title:s,login:a,email:n,autoProtected:i,shared:o,excluded:c,domains:u,risks:d}=e;return{id:r,title:s,login:a,email:n,autoProtected:i,shared:o,excluded:c,domainIcon:void 0,corruptionData:Ae(t,d),domain:u[0]}};let Me=class{constructor(e){this.store=e}execute({body:e}){const{healthFilter:t,spaceId:r}=e;return this.store.state$.pipe((0,fe.U)((e=>null!==r&&void 0===e.index[r]?(0,m.Vp)([]):(0,m.Vp)(Ne(((e,t,r,s)=>{let a;if(null!==e)a=ke(t[e],r);else{if(r===b.All)return Object.values(s).map((e=>Le(e,r)));a=Object.keys(t).reduce(((e,s)=>[...e,...ke(t[s],r)]),[])}return a.map((e=>Le(s[e],r)))})(r,e.index,t||b.All,e.credentialsAtRisk))))))}};Me=(0,s.__decorate)([(0,we.e)(Fe.Q),(0,s.__metadata)("design:paramtypes",[Ee])],Me);var Ve=r(65796);let Ge=class{constructor(e){this.store=e}execute({body:e}){const{credentialIds:t}=e;return this.store.state$.pipe((0,fe.U)((e=>(0,m.Vp)(((e,t)=>Object.keys(e).reduce(((t,r)=>[...t,...e[r].compromised]),[]).filter((e=>t.includes(e))))(e.index,t)))))}};Ge=(0,s.__decorate)([(0,we.e)(Ve.v),(0,s.__metadata)("design:paramtypes",[Ee])],Ge);var qe=r(32069);let je=class{constructor(e){this.store=e}execute({body:e}){const{breachId:t}=e;return this.store.state$.pipe((0,fe.U)((e=>(0,m.Vp)(((e,t)=>Object.keys(e.index).reduce(((r,s)=>[...r,...e.index[s].compromised.filter((r=>{const s=j(e.credentialsAtRisk[r],_.Compromised);return s?.breaches.some((e=>e.breachId===t))}))]),[]))(e,t)))))}};je=(0,s.__decorate)([(0,we.e)(qe.A),(0,s.__metadata)("design:paramtypes",[Ee])],je);var Ke=r(7466);function We(e){const t={};return Object.keys(e).forEach((r=>{const s=e[r].spaceId;void 0===t[s]?t[s]=1:t[s]++})),t}let Be=class{constructor(e,t){this.store=e,this.credentialsGetter=t}execute(){return this.store.state$.pipe((0,_e.V)(this.credentialsGetter.get()),(0,fe.U)((([e,t])=>{const r={};if(!(0,m.d6)(t))throw new Error("Error while retrieving credentials");const s=We(t.data),a=Object.keys(t.data).length,n=function(e){const t={};return Object.keys(e).forEach((r=>{const s=j(e[r],_.Compromised),a=e[r].spaceId;if(void 0===s)return;void 0===t[a]&&(t[a]={breaches:new Set,compromisedByBreaches:{}});const n=s.breaches.map((e=>e.breachId));t[a].breaches=new Set([...t[a].breaches,...n]),t[a].compromisedByBreaches[r]=new Set(n)})),t}(e.credentialsAtRisk);let i=new Set([]),o={},c=0;return Object.keys(e.index).forEach((t=>{const a=e.index[t],u=Ie(a,s[t]);r[t]={...u,breaches:n[t]?.breaches??new Set,compromisedByBreach:n[t]?.compromisedByBreaches??{},corrupted:a.corruptedCount},i=new Set([...i,...n[t]?.breaches??new Set]),o={...o,...n[t]?.compromisedByBreaches??{}},c+=a.corruptedCount})),r.global={...Pe(e.index,a),breaches:i,compromisedByBreach:o,corrupted:c},(0,m.Vp)(r)})))}};Be=(0,s.__decorate)([(0,we.e)(Ke.b),(0,s.__metadata)("design:paramtypes",[S,M.J])],Be);var He=r(48844);const ze=e=>{if(!e)return;const t=e;if(!((r=t.spaces)&&Array.isArray(r)&&0!==r.length&&(e=>{if(!e)return!1;const t=e;return!!(t.associatedEmail&&t.billingAdmins&&t.color&&t.info&&t.letter&&t.planType&&t.status&&t.teamAdmins&&t.teamId&&t.teamName&&t.tier)})(r.find((e=>"accepted"===e.status)))))return;var r;const s=t.spaces.find((e=>"accepted"===e.status));return s?.teamId};let $e=class{constructor(e){this.carbon=e}get(){const{queries:{carbonState:e}}=this.carbon;return e({path:"userSession.localSettings.premiumStatus"}).pipe((0,He.Qn)(ze))}};$e=(0,s.__decorate)([(0,R.GS)(),(0,s.__metadata)("design:paramtypes",[h.CarbonLegacyClient])],$e);var Qe=r(23347);const Ye=I.z.object({lastSentDate:I.z.number()}),Xe=(I.z.object({lastSentDate:I.z.number(),lastHash:I.z.string()}),e=>Ye.safeParse(e).success);class Je extends((0,g.Q)({persist:!0,storage:{initialValue:{lastSentDate:0,lastHash:""},typeGuard:Xe,schemaVersion:2,migrateStorageSchema:()=>({lastSentDate:0,lastHash:""})},scope:d.F.User,storeName:"user-activity-state",storeTypeGuard:Xe,codec:v.E,capacity:Qe.Y._001KB,isCache:!0})){}let Ze=class{constructor(e,t){this.client=e,this.healthCacheUpdater=t}async run(){await this.healthCacheUpdater.updateHealthState()}};Ze=(0,s.__decorate)([(0,R.GS)(),(0,s.__metadata)("design:paramtypes",[p.w,ge])],Ze);var et=r(25547),tt=r(68307),rt=r(73404),st=r(96303),at=r(54066);const nt=0;const it=e=>Math.floor(e/1e3);let ot=class{constructor(e,t,r,s,a,n){this.serverApiClient=e,this.userActivityStore=t,this.credentialsGetter=r,this.store=s,this.md5Hasher=a,this.currentSpaceGetter=n}async sendIfReportUpdated(){const e=await(0,he.z)(this.currentSpaceGetter.get());if(!(0,m.d6)(e))throw new Error("Error while retrieving current space for activity report");const t=(0,m.db)(e);if(!t)return Promise.resolve();const r=await this.store.getState(),s=await this.userActivityStore.getState(),a=await(0,he.z)(this.credentialsGetter.get()),n=Date.now(),i=it(n),o=it(s.lastSentDate||n);if(!(0,m.d6)(a))throw new Error("Error while retrieving credentials");const c=We(a.data),u=function(e,t,r){const s=e[r],a=t[r]??0;return s?{checkedPasswords:s.excluded.length,compromisedPasswords:s.compromised.length,nbrPasswords:a,reused:s.reused.length,safePasswords:a-s.corruptedCount,securityIndex:Re((0,xe.R9)(s.corruptedCount,s.importantCorruptedCount,a-s.excluded.length))??nt,weakPasswords:s.weak.length}:{checkedPasswords:0,compromisedPasswords:0,nbrPasswords:a,reused:0,safePasswords:a,securityIndex:a<xe.RG?nt:xe.JK,weakPasswords:0}}(r.index,c,t),d=s.lastHash,l=(0,st.k)(this.md5Hasher.compute((0,at.u)(JSON.stringify(u))));return d===l||(await(0,he.z)(this.serverApiClient.v1.useractivity.create({userActivity:{securityIndex:0},teamActivity:t?{teamId:parseInt(t,10),activity:u}:void 0,relativeEnd:i,relativeStart:o})),this.userActivityStore.set({lastSentDate:n,lastHash:l})),Promise.resolve()}};ot=(0,s.__decorate)([(0,R.GS)(),(0,s.__metadata)("design:paramtypes",[rt.l,Je,M.J,S,i.f,$e])],ot);var ct=r(21242);let ut=class{constructor(e,t){this.featureFlips=e,this.userActivitySender=t}async isPasswordHealthEnabled(){const{userFeatureFlips:e}=this.featureFlips.queries,t=await(0,he.z)(e());return!!(0,m.hx)(t)||!(0,m.db)(t).web_disable_password_health}async handle(){await this.isPasswordHealthEnabled()&&await this.userActivitySender.sendIfReportUpdated()}};ut=(0,s.__decorate)([(0,tt.b)(et.w),(0,s.__metadata)("design:paramtypes",[ct.P,ot])],ut);var dt=r(20587),lt=r(11564),pt=r(92233);let ht=class{constructor(e,t){this.store=e,this.cqrsClient=t}async handle({body:e}){const{credentialId:t}=e,{commands:{trackEvent:r}}=this.cqrsClient.getClient(dt.Yu),s=(e=>({is_excluded:!!e&&J(e),is_weak:!!e&&Q(e),is_reused:!!e&&Y(e),is_compromised:!!e&&X(e)}))((await(0,he.z)(this.store.state$)).credentialsAtRisk[t]);return r({event:new pt.UserCredentialHealthReportEvent({credentialSecurityStatus:s,itemId:t})}),Promise.resolve(void 0)}};ht=(0,s.__decorate)([(0,tt.b)(lt.p),(0,s.__metadata)("design:paramtypes",[Ee,p.w])],ht);var mt=r(82706),yt=r(72989);let gt=class{constructor(e){this.healthCacheUpdater=e}handle({body:e}){const{ids:t,vaultItemType:r}=e;return r===mt.U.Credential&&this.healthCacheUpdater.update({isOutdated:!0,updatedCredentialIds:t}),Promise.resolve(void 0)}};gt=(0,s.__decorate)([(0,tt.b)(yt.V),(0,s.__metadata)("design:paramtypes",[ge])],gt);var vt=r(3137);let ft=class{constructor(e){this.healthCacheUpdater=e}handle({body:e}){const{ids:t,vaultItemType:r}=e;return r===mt.U.Credential&&this.healthCacheUpdater.update({isOutdated:!0,updatedCredentialIds:t}),Promise.resolve(void 0)}};ft=(0,s.__decorate)([(0,tt.b)(vt.J),(0,s.__metadata)("design:paramtypes",[ge])],ft);var wt=r(49135);let St=class{constructor(e){this.healthCacheUpdater=e}handle({body:e}){const{ids:t,vaultItemType:r}=e;return r===mt.U.Credential&&this.healthCacheUpdater.update({isOutdated:!0,deletedCredentialIds:t}),Promise.resolve(void 0)}};St=(0,s.__decorate)([(0,tt.b)(wt.s),(0,s.__metadata)("design:paramtypes",[ge])],St);let _t=class{};_t=(0,s.__decorate)([(0,o.Y)({api:a.d,crons:[{handler:Ze,name:"health-cache",periodInMinutes:15,scope:d.F.User}],handlers:{commands:{updateIsCredentialExcluded:C,recalculatePasswordHealth:ve},events:{...(0,o.g)(a.d,{passwordHealthComputationFinished:ut}),...(0,o.g)(c.Y,{passwordAutofillPerformed:ht}),...(0,o.g)(u.L,{updated:gt,created:ft,deleted:St})},queries:{credentialHealthData:Te,score:Ue,filterCredentials:Me,compromisedCredentials:Ge,compromisedCredentialsIdsForBreach:je,passwordHealthReport:Be}},imports:[n.n],stores:[S,Je,O],providers:[M.J,L.U,pe,me,ge,Ze,G,ot,Ee,i.f,$e],requiredFeatureFlips:["web_disable_password_health"]})],_t)},86742:(e,t,r)=>{"use strict";r.d(t,{JK:()=>c,R9:()=>u,RG:()=>s});const s=5,a=.6,n=1,i=1,o=.2,c=100;function u(e,t,r){if(r<s)return null;const c=a*Math.pow(1-t/r,n),u=(1-a)*Math.pow(1-e/r,i);return o+(1-o)*(c+u)}},63277:(e,t,r)=>{"use strict";r.d(t,{E:()=>V});var s=r(88802),a=r(99634),n=r(93856),i=r(57668),o=r(57924),c=r(94189),u=r(20587),d=r(87279),l=r(92233),p=r(60399),h=r(59206),m=r(45883),y=r(86742),g=r(53576),v=r(48844),f=r(7165);const w=f.z.object({Id:f.z.string(),VaultItems:f.z.array(f.z.object({Id:f.z.string()}))}),S=f.z.array(w);let _=class{constructor(e){this.client=e}get(){const{queries:{carbonState:e}}=this.client.getClient(g.carbonLegacyApi);return e({path:"userSession.personalData.collections"}).pipe((0,v.Qn)((e=>{if(!(e=>S.safeParse(e).success)(e))throw new Error("Collection array has a wrong format");return e})))}};_=(0,s.__decorate)([(0,o.GS)(),(0,s.__metadata)("design:paramtypes",[c.w])],_);var b=r(25029),E=r(95681),A=r(23347),T=r(28489),C=r(10722);const x=e=>!(!e||"object"!=typeof e)&&((0,T.l$)(e,"lastSentDate")&&"number"==typeof e.lastSentDate);class R extends((0,E.Q)({codec:C.E,persist:!0,storage:{initialValue:{lastSentDate:0},schemaVersion:1,typeGuard:x},scope:b.F.User,storeName:"vault-report",storeTypeGuard:x,capacity:A.Y._001KB,isCache:!0})){}const I={collections_count:-1,collections_shared_count:-1,multiple_collections_count:-1,multiple_collections_shared_count:-1,single_collection_count:-1,single_collection_shared_count:-1,shared_count:-1,total_count:-1};function P(e){if(0===e.length)return 0;const t=e.flatMap((e=>e.VaultItems)),r=new Set(t.map((e=>e.Id))).size;return Math.round(t.length/r)}function D(e){if(0===e.length)return 0;let t=0,r=0;for(const s of e)s.VaultItems.length>0&&(r+=s.VaultItems.length,t++);return Math.round(r/t)}function U(e,t){let r=0,s=0;const a=e.map((e=>e.VaultItems)).reduce(((e,t)=>(t.forEach((t=>{const r=t.Id;e[r]?e[r]+=1:e[r]=1})),e)),{});return Object.values(a).forEach((e=>{e>1?r++:s++})),{collections_count:e.length,collections_shared_count:-1,multiple_collections_count:r,multiple_collections_shared_count:-1,single_collection_count:s,single_collection_shared_count:-1,shared_count:-1,total_count:t}}function F(e,t){return{itemsTotalCount:-1,itemsSharedCount:-1,collectionsTotalCount:e.length,collectionsSharedCount:-1,itemsPerCollectionAverageCount:D(e),collectionsPerItemAverageCount:P(e),ids:I,passwords:U(e,t),payments:I,personalInfo:I,secureNotes:I}}var O=r(9811);let N=class{constructor(e,t,r,s,a){this.breachesGetter=e,this.credentialGetter=t,this.vaultCollectionGetter=r,this.store=s,this.cqrsClient=a}getSpaceScope(e){switch(e){case"":return l.Scope.Personal;case"global":return l.Scope.Global;default:return l.Scope.Team}}async send(){const{queries:e}=this.cqrsClient.getClient(i.d),t=await(0,p.z)(e.passwordHealthReport()),r=await(0,p.z)(this.credentialGetter.get()),s=await(0,p.z)(this.vaultCollectionGetter.get()),a=await(0,p.z)(this.breachesGetter.getSupportedBreaches()),{commands:{trackEvent:n}}=this.cqrsClient.getClient(u.Yu);if(!((0,d.d6)(r)&&(0,d.d6)(a)&&(0,d.d6)(t)&&(0,d.d6)(s)))return Promise.reject(new Error("Error while retrieving credentials/breaches/health/collections"));const o=function(e){const t={global:{domainsWithoutAutofill:0,nbrPasswords:0,passwordsWithOtpCount:0,protectedPasswords:0}};return Object.keys(e).forEach((r=>{const s=e[r].spaceId;void 0===t[s]&&(t[s]={domainsWithoutAutofill:0,nbrPasswords:0,passwordsWithOtpCount:0,protectedPasswords:0}),t[s].nbrPasswords++,t.global.nbrPasswords++,e[r].autoLogin||(t[s].domainsWithoutAutofill++,t.global.domainsWithoutAutofill++),(e[r].otpSecret||e[r].otpUrl)&&(t[s].passwordsWithOtpCount++,t.global.passwordsWithOtpCount++),e[r].autoProtected&&(t[s].protectedPasswords++,t.global.protectedPasswords++)})),t}(r.data),c=function(e,t){const r=new Set,s=new Set;e.forEach((e=>{(0,O.F7)(e.Content)?s.add(e.Id):r.add(e.Id)}));const a=new Set,n=new Set,i={global:{activePrivateBreachAlerts:0,activePublicBreachAlerts:0,passwordsCompromisedThroughPrivateBreaches:0,privateBreachAlerts:s.size,publicBreachAlerts:r.size}};return Object.keys(t).forEach((e=>{if("global"===e)return;const o=t[e];void 0===i[e]&&(i[e]={activePrivateBreachAlerts:0,activePublicBreachAlerts:0,passwordsCompromisedThroughPrivateBreaches:0,privateBreachAlerts:s.size,publicBreachAlerts:r.size}),[...o.breaches].forEach((t=>{r.has(t)?(i[e].activePublicBreachAlerts++,a.add(t)):s.has(t)&&(i[e].activePrivateBreachAlerts++,n.add(t))})),Object.keys(o.compromisedByBreach).forEach((t=>{[...o.compromisedByBreach[t]].some((e=>s.has(e)))&&i[e].passwordsCompromisedThroughPrivateBreaches++})),i.global.passwordsCompromisedThroughPrivateBreaches+=i[e].passwordsCompromisedThroughPrivateBreaches})),i.global.activePrivateBreachAlerts=n.size,i.global.activePublicBreachAlerts=a.size,i}(a.data,t.data);return Object.keys(o).forEach((e=>{const r=t.data[e],a={scope:this.getSpaceScope(e),...F(s.data,o[e].nbrPasswords),...o[e],...c[e]},i=r?{passwordsSafeCount:o[e].nbrPasswords-r.corrupted,passwordsExcludedCount:r.excluded,passwordsCompromisedCount:r.compromised,passwordsReusedCount:r.reused,securityScore:r.score??void 0,passwordsWeakCount:r.weak}:{passwordsSafeCount:o[e].nbrPasswords,passwordsExcludedCount:0,passwordsCompromisedCount:0,passwordsReusedCount:0,securityScore:o[e].nbrPasswords<y.RG?void 0:y.JK,passwordsWeakCount:0};n({event:new l.UserVaultReportEvent({...a,...i})})})),this.store.set({lastSentDate:Date.now()}),Promise.resolve()}async shouldBeSent(){return(await(0,p.z)(this.store.state$)).lastSentDate+864e5<Date.now()}};N=(0,s.__decorate)([(0,o.GS)(),(0,s.__metadata)("design:paramtypes",[h.U,m.J,_,R,c.w])],N);var k=r(25547),L=r(68307);let M=class{constructor(e){this.vaultReportSender=e}async handle(){await this.vaultReportSender.shouldBeSent()&&this.vaultReportSender.send()}};M=(0,s.__decorate)([(0,L.b)(k.w),(0,s.__metadata)("design:paramtypes",[N])],M);let V=class{};V=(0,s.__decorate)([(0,a.Y)({api:n.f,handlers:{commands:{},events:{...(0,a.g)(i.d,{passwordHealthComputationFinished:M})},queries:{}},providers:[h.U,m.J,N,_],stores:[R]})],V)},57578:(e,t,r)=>{"use strict";r.d(t,{y:()=>i});var s=r(86952),a=r(75183),n=r(43832);const i=(0,s.Q)({name:"userConsents",commands:{UpdateConsentsCommand:a.a},events:{},queries:{getConsents:n.o}})},75183:(e,t,r)=>{"use strict";r.d(t,{a:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},43832:(e,t,r)=>{"use strict";r.d(t,{o:()=>n});var s=r(99059),a=r(25029);class n extends((0,s.k)({scope:a.F.User})){}},46093:(e,t,r)=>{"use strict";r.d(t,{K:()=>w});var s=r(88802),a=r(99634),n=r(57578),i=r(63663),o=r(75183),c=r(60399),u=r(57924),d=r(73404),l=r(48844),p=r(87279);let h=class{constructor(e){this.serverApiClient=e}updateConsents({triggerBy:e,consents:t}){return(0,c.z)(this.serverApiClient.v1.userconsents.updateConsents({triggerBy:e,consents:t}).pipe((0,l.DZ)((e=>{throw new Error(e.message)})),(0,l.lk)((e=>(0,p.Vp)(e.data)))))}};h=(0,s.__decorate)([(0,u.GS)(),(0,s.__metadata)("design:paramtypes",[d.l])],h);let m=class{constructor(e){this.userConsentsService=e}execute({body:{triggerBy:e,consents:t}}){return this.userConsentsService.updateConsents({triggerBy:e,consents:t})}};m=(0,s.__decorate)([(0,i.W)(o.a),(0,s.__metadata)("design:paramtypes",[h])],m);var y=r(20754),g=r(43832);let v=class{constructor(e){this.serverApiClient=e}execute(){return this.serverApiClient.v1.userconsents.getConsents({format:"two-consents"}).pipe((0,l.Qn)((e=>e.data)),(0,l.DZ)((e=>{throw new Error(e.message)})))}};v=(0,s.__decorate)([(0,y.e)(g.o),(0,s.__metadata)("design:paramtypes",[d.l])],v);var f=r(6447);let w=class{};w=(0,s.__decorate)([(0,a.Y)({api:n.y,imports:[f.n],providers:[h],handlers:{commands:{updateConsents:m},events:{},queries:{getConsents:v}}})],w)},89193:(e,t,r)=>{"use strict";r.d(t,{g:()=>n});var s=r(86952),a=r(98976);const n=(0,s.Q)({name:"activityLogs",commands:{storeActivityLogs:a.M},events:{},queries:{}})},98976:(e,t,r)=>{"use strict";r.d(t,{M:()=>i,W:()=>s});var s,a=r(74354),n=r(25029);!function(e){e.AUDIT_LOG_MISSING_JSON_SCHEMA="AUDIT_LOG_MISSING_JSON_SCHEMA",e.AUDIT_LOG_INVALID_JSON_FOR_JSON_SCHEMA="AUDIT_LOG_INVALID_JSON_FOR_JSON_SCHEMA",e.AUDIT_LOG_INVALID_LOG_SCHEMA_TYPE_OR_VERSION="AUDIT_LOG_INVALID_LOG_SCHEMA_TYPE_OR_VERSION",e.AUDIT_LOG_ERROR_READING_JSON_SCHEMA="AUDIT_LOG_ERROR_READING_JSON_SCHEMA",e.STORING_SENSITIVE_AUDIT_LOGS_NOT_ALLOWED="STORING_SENSITIVE_AUDIT_LOGS_NOT_ALLOWED"}(s||(s={}));class i extends((0,a.g)({scope:n.F.User})){}},97494:(e,t,r)=>{"use strict";r.r(t),r.d(t,{ActivityLogCategory:()=>a,ActivityLogType:()=>s,StoreActivityLogsCommand:()=>i.M,StoreActivityLogsInvalidLogsError:()=>i.W,activityLogsApi:()=>n.g});var s,a,n=r(89193),i=r(98976);!function(e){e.UserInvited="user_invited",e.UserReinvited="user_reinvited",e.UserRemoved="user_removed",e.TeamCaptainAdded="team_captain_added",e.TeamCaptainRemoved="team_captain_removed",e.GroupManagerAdded="group_manager_added",e.GroupManagerRemoved="group_manager_removed",e.MasterPasswordResetAccepted="master_password_reset_accepted",e.MasterPasswordResetRefused="master_password_reset_refused",e.BillingAdminAdded="billing_admin_added",e.BillingAdminRemoved="billing_admin_removed",e.UserGroupCreated="user_group_created",e.UserGroupRenamed="user_group_renamed",e.UserGroupDeleted="user_group_deleted",e.UserJoinedUserGroup="user_joined_user_group",e.UserLeftUserGroup="user_left_user_group",e.UserInvitedToUserGroup="user_invited_to_user_group",e.UserDeclinedInviteToUserGroup="user_declined_invite_to_user_group",e.UserRemovedFromUserGroup="user_removed_from_user_group",e.DomainRequested="domain_requested",e.DomainValidated="domain_validated",e.SensitiveLogsEnabled="collect_sensitive_data_audit_logs_enabled",e.SensitiveLogsDisabled="collect_sensitive_data_audit_logs_disabled",e.SsoIdpMetadataSet="sso_idp_metadata_set",e.SsoServiceProviderUrlSet="sso_service_provider_url_set",e.SsoEnabled="sso_enabled",e.SsoDisabled="sso_disabled",e.NitroSsoDomainProvisioned="nitro_sso_domain_provisioned",e.NitroSsoDomainRemoved="nitro_sso_domain_removed",e.NitroSsoDomainVerified="nitro_sso_domain_verified",e.NitroSsoSetupStarted="nitro_sso_setup_started",e.TeamNameChanged="team_name_changed",e.NewBillingPeriodCreated="new_billing_period_created",e.SeatsAdded="seats_added",e.ContactEmailChanged="contact_email_changed",e.MasterPasswordMobileResetEnabled="master_password_mobile_reset_enabled",e.MasterPasswordMobileResetDisabled="master_password_mobile_reset_disabled",e.MasterPasswordMobileReset="master_password_mobile_reset",e.MasterPasswordChanged="master_password_changed",e.MpToViewPasswordsEnabled="mp_to_view_passwords_enabled",e.MpToViewPasswordsDisabled="mp_to_view_passwords_disabled",e.TwoFactorAuthenticationLoginMethodAdded="two_factor_authentication_login_method_added",e.TwoFactorAuthenticationLoginMethodRemoved="two_factor_authentication_login_method_removed",e.BiometricSignInDisabled="biometric_sign_in_disabled",e.DWMEmailAdded="dwm_email_added",e.DWMEmailRemoved="dwm_email_removed",e.DWMAlertReceived="dwm_alert_received",e.UserDeviceAdded="user_device_added",e.UserDeviceRemoved="user_device_removed",e.UserDeviceLogin="user_device_login",e.MasterPasswordReset="master_password_reset",e.RequestedAccountRecovery="requested_account_recovery",e.CompletedAccountRecovery="completed_account_recovery",e.UserSharedCredentialWithGroup="user_shared_credential_with_group",e.UserSharedCredentialWithEmail="user_shared_credential_with_email",e.UserSharedCredentialWithExternal="user_shared_credential_with_external",e.UserSharedSecureNoteWithGroup="user_shared_secure_note_with_group",e.UserSharedSecureNoteWithEmail="user_shared_secure_note_with_email",e.UserSharedSecureNoteWithExternal="user_shared_secure_note_with_external",e.UserRevokedSharedCredentialGroup="user_revoked_shared_credential_group",e.UserRevokedSharedCredentialEmail="user_revoked_shared_credential_email",e.UserRevokedSharedCredentialExternal="user_revoked_shared_credential_external",e.UserRevokedSharedSecureNoteGroup="user_revoked_shared_secure_note_group",e.UserRevokedSharedSecureNoteEmail="user_revoked_shared_secure_note_email",e.UserRevokedSharedSecureNoteExternal="user_revoked_shared_secure_note_external",e.UserAcceptedSharingInviteSecureNote="user_accepted_sharing_invite_secure_note",e.UserRejectedSharingInviteSecureNote="user_rejected_sharing_invite_secure_note",e.UserAcceptedSharingInviteCredential="user_accepted_sharing_invite_credential",e.UserRejectedSharingInviteCredential="user_rejected_sharing_invite_credential",e.UserCreatedCredential="user_created_credential",e.UserModifiedCredential="user_modified_credential",e.UserDeletedCredential="user_deleted_credential",e.UserImportedCredentials="user_imported_credentials",e.UserCreatedSecureNote="user_created_secure_note",e.UserModifiedSecureNote="user_modified_secure_note",e.UserDeletedSecureNote="user_deleted_secure_note"}(s||(s={})),function(e){e.Account="account",e.Authentication="authentication",e.DarkWebMonitoring="dark_web_monitoring",e.Groups="groups",e.ImportExport="import_export",e.TeamSettings="team_settings",e.TeamSettingsActiveDirectory="team_settings_activedirectory",e.TeamSettingsPolicies="team_settings_policies",e.TeamSettingsSAMLProvisioning="team_settings_samlprovisioning",e.TeamSettingsSCIM="team_settings_scim",e.TeamSettingsSSO="team_settings_sso",e.Sharing="sharing",e.UserSettings="user_settings",e.UserSettingsAccountRecovery="user_settings_accountrecovery",e.Users="users",e.VaultIDs="vault_ids",e.VaultPasswords="vault_passwords",e.VaultPayments="vault_payments",e.VaultPersonalInfo="vault_personalinfo",e.VaultSecureNotes="vault_securenotes"}(a||(a={}))},4070:(e,t,r)=>{"use strict";r.d(t,{Z:()=>I});var s=r(88802),a=r(99634),n=r(6447),i=r(89193),o=r(25029),c=r(95681),u=r(23347),d=r(10722);const l=e=>!(!e||"object"!=typeof e)&&("activityLogsQueue"in e&&Array.isArray(e.activityLogsQueue));class p extends((0,c.Q)({persist:!0,storage:{initialValue:{activityLogsQueue:[]},typeGuard:l,schemaVersion:1},scope:o.F.User,storeName:"activity-logs",storeTypeGuard:l,codec:d.E,capacity:u.Y._010KB})){}var h=r(53576),m=r(57924),y=r(94189),g=r(48844);let v=class{constructor(e){this.client=e}get(){const{queries:{carbonState:e}}=this.client.getClient(h.carbonLegacyApi);return e({path:"state.userSession.spaceData.spaces"}).pipe((0,g.Qn)((e=>{if(!(e=>!!Array.isArray(e)&&(0===e.length||e.every((e=>{const t=e;return"string"==typeof t?.teamId&&"object"==typeof t?.details&&"string"==typeof t?.details.status}))))(e))throw new Error("Bad space item format");const t=e.find((e=>"accepted"===e.details.status)),r=t?.details.info.collectSensitiveDataAuditLogsEnabled;return Boolean(r)})))}};v=(0,s.__decorate)([(0,m.GS)(),(0,s.__metadata)("design:paramtypes",[y.w])],v);var f=r(64987),w=r(98976),S=r(63663),_=r(87279),b=r(60399);const E=new f.WU;let A=class{constructor(e,t){this.activityLogsStore=e,this.sensitiveLogsEnabledGetter=t}async execute({body:{activityLogs:e}}){const t=await(0,b.z)(this.sensitiveLogsEnabledGetter.get());if(!(0,_.d6)(t))throw new Error("Error while getting sensitive logs enabled data");const r=e.filter((e=>!e.is_sensitive||t.data));return r.length&&await this.updateActivityLogsState(r),Promise.resolve((0,_.Vp)(void 0))}async updateActivityLogsState(e){await E.runExclusive((async()=>{const t=await this.activityLogsStore.getState();await this.activityLogsStore.set({...t,activityLogsQueue:[...t.activityLogsQueue,...e]})}))}};A=(0,s.__decorate)([(0,S.W)(w.M),(0,s.__metadata)("design:paramtypes",[p,v])],A);var T=r(9671),C=r(73404);let x=class{constructor(e){this.serverApiClient=e}async sendLogs(e){return await(0,b.z)(this.serverApiClient.v1.teams.storeAuditLogs({auditLogs:e}).pipe((0,g.DZ)((()=>(0,_.Rn)("storeActivityLogs failed with an unknown HTTP error"))),(0,g.lk)((e=>e.data.invalidAuditLogs.length?(0,_.Vp)(this.serverToTechnicalSchemaErrorsMapper(e.data.invalidAuditLogs)):(0,_.Vp)(void 0)))))}serverToTechnicalSchemaErrorsMapper(e){return{invalidActivityLogs:e.map((e=>({uuid:e.uuid,error:w.W[e.error]})))}}};x=(0,s.__decorate)([(0,m.GS)(),(0,s.__metadata)("design:paramtypes",[C.l])],x);let R=class{constructor(e,t,r){this.activityLogsService=e,this.allowedToFail=t,this.activityLogsStore=r}async isRunnable(){const{activityLogsQueue:e}=await this.activityLogsStore.getState();return e.length>0}async run(){const{activityLogsQueue:e}=await this.activityLogsStore.getState();await this.attemptSendLogsToServer(e)}async attemptSendLogsToServer(e){const t=[...e];for(;t.length>0;){const e=t.splice(0,40);await this.sendLogsToServer(e)}}async sendLogsToServer(e){const t=await this.activityLogsService.sendLogs(e);if((0,_.hx)(t))return;const r=e.map((e=>e.uuid));if(await this.removeSentLogsFromActivityLogsQueue(r),t.data?.invalidActivityLogs){const r=this.createLogsTypeMap(e),s=e=>()=>{const t=r.get(e.uuid);throw new Error(`An activity log with a log type of ${t} has been detected to have a technical/schema error. (${e.error})`)};await this.allowedToFail.do((t.data.invalidActivityLogs??[]).map(s))}}createLogsTypeMap(e){const t=new Map;return e.forEach((e=>{t.set(e.uuid,e.log_type)})),t}async removeSentLogsFromActivityLogsQueue(e){const{activityLogsQueue:t}=await this.activityLogsStore.getState(),r=t.filter((t=>!e.includes(t.uuid)));await this.activityLogsStore.set({activityLogsQueue:[...r]})}};R=(0,s.__decorate)([(0,m.GS)(),(0,s.__metadata)("design:paramtypes",[x,T.J,p])],R);let I=class{};I=(0,s.__decorate)([(0,a.Y)({api:i.g,imports:[n.n],providers:[x,v],stores:[p],crons:[{handler:R,periodInMinutes:1,name:"activity-logs-cron",scope:o.F.User}],handlers:{commands:{storeActivityLogs:A},events:{},queries:{}}})],I)},70305:(e,t,r)=>{"use strict";r.d(t,{v:()=>i});var s=r(86952),a=r(67490),n=r(98193);const i=(0,s.Q)({name:"changeMasterPassword",commands:{temporarySendMasterPasswordChangedEvent:n.n},events:{masterPasswordChanged:a.D},queries:{}})},98193:(e,t,r)=>{"use strict";r.d(t,{n:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},67490:(e,t,r)=>{"use strict";r.d(t,{D:()=>n});var s=r(88885),a=r(25029);class n extends((0,s.d)({scope:a.F.User})){}},24208:(e,t,r)=>{"use strict";r.d(t,{Q:()=>f});var s=r(86952),a=r(55510),n=r(88885),i=r(25029);class o extends((0,n.d)({scope:i.F.User})){}class c extends((0,n.d)({scope:i.F.User})){}var u=r(66134),d=r(42858),l=r(15473),p=r(69207),h=r(37334),m=r(86334),y=r(54703);class g extends((0,n.d)({scope:i.F.User})){}var v=r(31839);const f=(0,s.Q)({name:"session",commands:{FlushLocalDataCommand:d.e,PrepareLocalDataFlushCommand:l.X,CreateUserSessionCommand:p.lk,OpenUserSessionCommand:h.Dx,CloseUserSessionCommand:m.V,DeleteLocalSessionCommand:y.G},queries:{SessionStateQuery:a.ZP,CreatedSessionsStateQuery:a.iH,SelectedOpenedSessionQuery:v._},events:{SessionOpenedEvent:o,SessionClosingEvent:c,SessionClosedEvent:u.X,SessionOpeningEvent:g}})},86334:(e,t,r)=>{"use strict";r.d(t,{V:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.Device})){}},69207:(e,t,r)=>{"use strict";r.d(t,{lk:()=>c});var s,a=r(74354),n=r(25029),i=r(96168);!function(e){e.AlreadyExists="alreadyExists"}(s||(s={}));class o extends((0,i.Hu)(s.AlreadyExists,"The session already exists. Delete it first.")){}class c extends((0,a.g)({scope:n.F.Device})){}},54703:(e,t,r)=>{"use strict";r.d(t,{G:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.Device})){}},42858:(e,t,r)=>{"use strict";r.d(t,{e:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},37334:(e,t,r)=>{"use strict";r.d(t,{Dx:()=>d});var s,a=r(74354),n=r(25029),i=r(96168);!function(e){e.NotCreated="notCreated",e.AlreadyOpened="alreadyOpened",e.MultiAccountNotYetSupported="multiAccountNotYetSupported"}(s||(s={}));class o extends((0,i.Hu)(s.NotCreated,"The session has not been created. Create it first.")){}class c extends((0,i.Hu)(s.AlreadyOpened,"The session is already opened for this user. Close it first.")){}class u extends((0,i.Hu)(s.MultiAccountNotYetSupported,"Another session is opened. Close it first.")){}class d extends((0,a.g)({scope:n.F.Device})){}},15473:(e,t,r)=>{"use strict";r.d(t,{X:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},66134:(e,t,r)=>{"use strict";r.d(t,{K:()=>s,X:()=>i});var s,a=r(88885),n=r(25029);!function(e){e.Close="close",e.Lock="lock"}(s||(s={}));class i extends((0,a.d)({scope:n.F.Device})){}},31839:(e,t,r)=>{"use strict";r.d(t,{_:()=>n});var s=r(99059),a=r(25029);class n extends((0,s.k)({scope:a.F.Device})){}},55510:(e,t,r)=>{"use strict";r.d(t,{XL:()=>o,ZP:()=>c,iH:()=>u,sM:()=>i});var s=r(99059),a=r(25029),n=r(7165);n.z.object({email:n.z.string()});var i,o;!function(e){e.NotCreated="notCreated",e.Closed="closed",e.Open="open"}(i||(i={}));class c extends((0,s.k)({scope:a.F.Device})){}!function(e){e.Closed="closed",e.Open="open"}(o||(o={}));class u extends((0,s.k)({scope:a.F.Device})){}},65766:(e,t,r)=>{"use strict";r.d(t,{Y:()=>i});var s=r(86952),a=r(10468),n=r(49273);const i=(0,s.Q)({name:"vaultAccess",commands:{},events:{},queries:{isAllowed:a.bY,deviceLimit:n.X}})},49273:(e,t,r)=>{"use strict";r.d(t,{X:()=>i});var s,a=r(99059),n=r(25029);!function(e){e.Android="android",e.DesktopMacOS="macosx",e.DesktopWindows="windows",e.IPad="ipad",e.IPhone="iphone",e.IPod="ipod",e.Other="other",e.StandaloneExtension="saex",e.TeamAdminConsole="tac",e.WebApp="webapp"}(s||(s={}));class i extends((0,a.k)({scope:n.F.User})){}},10468:(e,t,r)=>{"use strict";r.d(t,{Oq:()=>s,bY:()=>c});var s,a=r(99059),n=r(25029),i=r(96168);!function(e){e.DeviceLimited="DeviceLimited",e.Requires2FAEnforcement="Requires2FAEnforcement",e.RequiresSSO2MPMigration="RequiresSSO2MPMigration",e.RequiresMP2SSOMigration="RequiresMP2SSOMigration"}(s||(s={}));class o extends((0,i.Hu)("UserNotLogged","Please log the user")){}class c extends((0,a.k)({scope:n.F.User,noUserError:new o})){}},28365:(e,t,r)=>{"use strict";r.d(t,{M:()=>h});var s=r(88802),a=r(99634),n=r(70305),i=r(81459),o=r(57924);let c=class extends i.f{};c=(0,s.__decorate)([(0,o.GS)()],c);var u=r(98193),d=r(63663),l=r(87279);let p=class{constructor(e){this.eventEmitter=e}execute(){return this.eventEmitter.sendEvent("masterPasswordChanged",void 0),Promise.resolve((0,l.Vp)(void 0))}};p=(0,s.__decorate)([(0,d.W)(u.n),(0,s.__metadata)("design:paramtypes",[c])],p);let h=class{};h=(0,s.__decorate)([(0,a.Y)({api:n.v,handlers:{commands:{temporarySendMasterPasswordChangedEvent:p},events:{},queries:{}},providers:[c]})],h)},32109:(e,t,r)=>{"use strict";r.d(t,{P:()=>a});var s=r(94805);const a=e=>{const[,,t]=e.split("$");return"pbkdf2"===t?s.E1:s.mr}},87918:(e,t,r)=>{"use strict";r.d(t,{t:()=>p});var s=r(88802),a=r(60399),n=r(53576),i=r(57924),o=r(94189),c=r(54066),u=r(43293),d=r(48844),l=r(25594);let p=class{constructor(e,t){this.cqrsClients=e,this.flexibleDecryptor=t}async decrypt(e){const{carbonStateList:t}=this.cqrsClients.getClient(n.carbonLegacyApi).queries;return await(0,a.z)(t({paths:["userSession.session.localKey","userSession.session.masterPassword","userSession.session.serverKey"]}).pipe((0,d.nb)({success:([t,r,s])=>{if("string"==typeof t)return this.flexibleDecryptor.decrypt((0,c.u)(t),e);if("string"==typeof r&&"string"==typeof s){const t=s+r,a=(0,u.N)(t);return this.flexibleDecryptor.decrypt((0,c.u)(a),e)}throw new Error("Wrong types for local data key")},failure:()=>{throw new Error("Failure getting state list")}})))}};p=(0,s.__decorate)([(0,i.GS)(),(0,s.__metadata)("design:paramtypes",[o.w,l.a])],p)},12642:(e,t,r)=>{"use strict";r.d(t,{Y:()=>o});var s=r(88802),a=r(57924),n=r(87918),i=r(73378);let o=class{constructor(e,t){this.localDataKeyDecryptor=e,this.localDatKeyaEncryptor=t}encode(e){return this.localDatKeyaEncryptor.encrypt(e)}decode(e){return this.localDataKeyDecryptor.decrypt(e)}};o=(0,s.__decorate)([(0,a.GS)(),(0,s.__metadata)("design:paramtypes",[n.t,i.n])],o)},73378:(e,t,r)=>{"use strict";r.d(t,{n:()=>v});var s=r(88802),a=r(60399),n=r(57924),i=r(94189),o=r(53576),c=r(48844),u=r(94805),d=r(16698),l=r(54066),p=r(43293),h=r(66122),m=r(56268),y=r(19603),g=r(32109);let v=class{constructor(e,t,r){this.cqrsClients=e,this.flexibleEncryptor=t,this.randomValuesGetter=r}async encrypt(e){const{carbonStateList:t}=this.cqrsClients.getClient(o.carbonLegacyApi).queries;return await(0,a.z)(t({paths:["userSession.session.localKey","userSession.session.masterPassword","userSession.session.serverKey","userSession.personalSettings.CryptoFixedSalt","userSession.personalSettings.CryptoUserPayload"]}).pipe((0,c.nb)({success:([t,r,s,a,n])=>{if("string"==typeof t)return this.flexibleEncryptor.encrypt((0,l.u)(t),e,u.oo,d.gO);if("string"==typeof r&&"string"==typeof s){const t=s+r,i=(0,p.N)(t),o="string"==typeof n?(0,g.P)(n):u.mr,{saltLength:c}=o,m="string"===a?(0,h.R)(a):this.randomValuesGetter.get(c);return this.flexibleEncryptor.encrypt((0,l.u)(i),e,o,d.Nw,{salt:m})}throw new Error("Wrong types for local data key")},failure:()=>{throw new Error("Failure getting state list")}})))}};v=(0,s.__decorate)([(0,n.GS)(),(0,s.__metadata)("design:paramtypes",[i.w,m._,y.Y])],v)},97045:(e,t,r)=>{"use strict";r.d(t,{_:()=>de});var s=r(88802),a=r(99634),n=r(24208),i=r(37935),o=r(53576),c=r(25029),u=r(95681),d=r(23347);class l extends((0,u.Q)({initialValue:{},storeName:"session-key-store",scope:c.F.Device,capacity:d.Y._010KB,persist:!1})){}var p=r(87918),h=r(73378),m=r(12642),y=r(57924),g=r(25594),v=r(54066),f=r(95087);class w extends((0,u.Q)({storeName:"sessions-state-store",initialValue:{},scope:c.F.Device,capacity:d.Y._010KB,persist:!1})){}let S=class{constructor(e,t,r){this.flexibleDecryptor=e,this.sessionsStateStore=t,this.sessionKeyStore=r}async decrypt(e){const t=await this.sessionsStateStore.getState(),r=Object.keys(t).find((e=>"open"===t[e].status));if(!r)throw new Error("No active login");const s=await this.sessionKeyStore.getState();if(!(r in s))throw new Error("No session ciphering data found for active login");const a=s[r];let n;switch(a.type){case"sso":n=(0,v.u)(a.ssoKey);break;case"mp":n=(0,v.u)(a.masterPassword+a.secondaryKey);break;default:(0,f.U)(a)}return this.flexibleDecryptor.decrypt(n,e)}};S=(0,s.__decorate)([(0,y.GS)(),(0,s.__metadata)("design:paramtypes",[g.a,w,l])],S);var _=r(60399),b=r(87279),E=r(56268),A=r(16698),T=r(87065),C=r(10722);const x=e=>!(!e||"object"!=typeof e)&&(0===Object.keys(e).length||Object.entries(e).every((([,e])=>"object"==typeof e&&"derivation"in e&&"salt"in e)));class R extends((0,u.Q)({storeName:"sessions-crypto-settings-store",scope:c.F.Device,capacity:d.Y._010KB,persist:!0,storage:{schemaVersion:1,initialValue:{},typeGuard:x},codec:C.E})){}let I=class{constructor(e){this.sessionsCryptoSettingsStore=e}getConfig(e){return this.sessionsCryptoSettingsStore.state$.pipe((0,T.U)((t=>{if(e in t){const{derivation:r,salt:s}=t[e];return(0,b.Vp)({derivation:r,salt:s})}throw new Error("No crypto settings found for this user")})))}};I=(0,s.__decorate)([(0,y.GS)(),(0,s.__metadata)("design:paramtypes",[R])],I);let P=class{constructor(e,t,r,s){this.sessionKeyStore=e,this.cipheringSettingsService=t,this.sessionsStateStore=r,this.flexibleEncryptor=s}async encrypt(e){const t=await this.sessionsStateStore.getState(),r=Object.keys(t).find((e=>"open"===t[e].status)),s=await this.sessionKeyStore.getState();if(!r)throw new Error("No active login");if(!(r in s))throw new Error("No session ciphering data found for active login");const a=await(0,_.z)(this.cipheringSettingsService.getConfig(r));if((0,b.d6)(a)){const{derivation:t,salt:n}=a.data,{algorithm:i}=t;if("noderivation"===i)throw new Error("Session key requires derivation");const o=s[r];let c;switch(o.type){case"sso":c=(0,v.u)(o.ssoKey);break;case"mp":c=(0,v.u)(o.masterPassword+o.secondaryKey);break;default:(0,f.U)(o)}return this.flexibleEncryptor.encrypt(c,e,t,A.Nw,{salt:(0,v.u)(n)})}throw new Error("Unable to read user crypto settings / salt")}};P=(0,s.__decorate)([(0,y.GS)(),(0,s.__metadata)("design:paramtypes",[l,I,w,E._])],P);let D=class{constructor(e,t){this.sessionEncryptor=e,this.sessionDecryptor=t}async decode(e){return await this.sessionDecryptor.decrypt(e)}async encode(e){return await this.sessionEncryptor.encrypt(e)}};D=(0,s.__decorate)([(0,y.GS)(),(0,s.__metadata)("design:paramtypes",[P,S])],D);var U=r(63663),F=r(71949),O=r(42858);let N=class{constructor(e){this.storeFlusher=e}async execute(){return await this.storeFlusher.flush(),Promise.resolve((0,b.Vp)(void 0))}};N=(0,s.__decorate)([(0,U.W)(O.e),(0,s.__metadata)("design:paramtypes",[F.X])],N);var k=r(15473);let L=class{constructor(e){this.storeFlusher=e}async execute(){return await this.storeFlusher.prepare(),Promise.resolve((0,b.Vp)(void 0))}};L=(0,s.__decorate)([(0,U.W)(k.X),(0,s.__metadata)("design:paramtypes",[F.X])],L);var M=r(69207);let V=class{execute(){return Promise.resolve((0,b.Vp)(void 0))}};V=(0,s.__decorate)([(0,U.W)(M.lk)],V);var G=r(81459);let q=class extends G.f{};q=(0,s.__decorate)([(0,y.GS)()],q);var j=r(66134),K=r(86334),W=r(69008);let B=class{constructor(e,t){this.emitter=e,this.requestContextClient=t}async execute({body:{email:e}}){return await this.emitter.sendEvent("sessionClosing",void 0),await this.emitter.sendEvent("sessionClosed",{email:e,mode:j.K.Close}),await this.requestContextClient.commands.setActiveUser({userName:void 0}),Promise.resolve((0,b.Vp)(void 0))}};B=(0,s.__decorate)([(0,U.W)(K.V),(0,s.__metadata)("design:paramtypes",[q,W.Q])],B);var H=r(37334);let z=class{constructor(e,t){this.emitter=e,this.requestContextClient=t}async execute({body:{email:e}}){return await this.requestContextClient.commands.setActiveUser({userName:e}),await this.emitter.sendEvent("sessionOpening",void 0),await this.emitter.sendEvent("sessionOpened",void 0),Promise.resolve((0,b.Vp)(void 0))}};z=(0,s.__decorate)([(0,U.W)(H.Dx),(0,s.__metadata)("design:paramtypes",[q,W.Q])],z);var $=r(20754),Q=r(55510);let Y=class{constructor(e){this.sessionsStateStore=e}execute({body:e}){const t=e.email;return this.sessionsStateStore.state$.pipe((0,T.U)((e=>t in e?(0,b.Vp)(e[t].status):(0,b.Vp)(Q.sM.NotCreated))))}};Y=(0,s.__decorate)([(0,$.e)(Q.ZP),(0,s.__metadata)("design:paramtypes",[w])],Y);let X=class{constructor(e){this.sessionsStateStore=e}execute(){return this.sessionsStateStore.state$.pipe((0,T.U)((e=>{const t={};for(const r in e)"open"===e[r].status?t[r]=Q.XL.Open:t[r]=Q.XL.Closed;return(0,b.Vp)(t)})))}};X=(0,s.__decorate)([(0,$.e)(Q.iH),(0,s.__metadata)("design:paramtypes",[w])],X);var J=r(31839);let Z=class{constructor(e){this.sessionsStateStore=e}execute(){return this.sessionsStateStore.state$.pipe((0,T.U)((e=>{let t;for(const r in e)e[r].status===Q.sM.Open&&(t=r);return(0,b.Vp)(t)})))}};Z=(0,s.__decorate)([(0,$.e)(J._),(0,s.__metadata)("design:paramtypes",[w])],Z);var ee=r(54703);let te=class{execute(){return Promise.resolve((0,b.Vp)(void 0))}};te=(0,s.__decorate)([(0,U.W)(ee.G)],te);var re=r(64987),se=r(68307),ae=r(94805),ne=r(19603),ie=r(32109),oe=r(89685);const ce=new re.WU;let ue=class{constructor(e,t,r,s,a,n){this.carbon=e,this.sessionKeyStore=t,this.sessionsStateStore=r,this.sessionsCryptoSettingsStore=s,this.eventEmitter=a,this.randomValuesGetter=n}async getUserCryptoSettings(){const{getUserCryptoSettings:e}=this.carbon.queries,t=await(0,_.z)(e());if(!(0,b.d6)(t))throw new Error("Fail to fetch crypto settings from carbon");const{cryptoUserPayload:r,cryptoFixedSalt:s}=t.data;return{cryptoUserPayload:r,cryptoFixedSalt:s}}async getSessionKey(){const{getMasterPasswordAndServerKey:e}=this.carbon.queries,t=await(0,_.z)(e());if(!(0,b.d6)(t))throw new Error("Fail to fetch master password and server key from carbon");const{password:r,serverKey:s}=t.data;return{type:"mp",masterPassword:r,secondaryKey:s}}async handleLogin(e){await ce.runExclusive((async()=>{const{cryptoUserPayload:t,cryptoFixedSalt:r}=await this.getUserCryptoSettings(),s=t?(0,ie.P)(t):ae.mr,a=r||(0,oe.v)(this.randomValuesGetter.get(s.saltLength)),n=await this.sessionsCryptoSettingsStore.getState();this.sessionsCryptoSettingsStore.set({...n,[e]:{derivation:s,salt:a}})})),await ce.runExclusive((async()=>{const t=await this.sessionsStateStore.getState();this.sessionsStateStore.set({...t,[e]:{status:Q.sM.Open,unencryptedLocalKey:""}})})),await ce.runExclusive((async()=>{const t=await this.getSessionKey(),r=await this.sessionKeyStore.getState();this.sessionKeyStore.set({...r,[e]:t})})),await this.eventEmitter.sendEvent("sessionOpening",void 0),await this.eventEmitter.sendEvent("sessionOpened",void 0)}async handleLogout(e){await ce.runExclusive((async()=>{let e=await this.sessionsStateStore.getState();e=Object.keys(e).reduce(((e,t)=>({...e,[t]:{status:Q.sM.Closed}})),{}),this.sessionsStateStore.set(e)})),await this.eventEmitter.sendEvent("sessionClosed",{mode:j.K.Close,email:e})}async handle(e){if("loginStatusChanged"!==e.body.eventName)return;const t=e.body.eventData;t.loggedIn?await this.handleLogin(t.login):await this.handleLogout(t.login)}};ue=(0,s.__decorate)([(0,se.b)(o.CarbonLegacyEvent),(0,s.__metadata)("design:paramtypes",[o.CarbonLegacyClient,l,w,R,q,ne.Y])],ue);let de=class{};de=(0,s.__decorate)([(0,a.Y)({api:n.Q,handlers:{commands:{flushLocalData:N,prepareLocalDataFlush:L,closeUserSession:B,createUserSession:V,openUserSession:z,deleteLocalSession:te},events:{...(0,a.g)(o.carbonLegacyApi,{carbonLegacy:ue})},queries:{createdSessionsState:X,sessionState:Y,selectedOpenedSession:Z}},providers:[q,p.t,h.n,m.Y,D,S,P,I],exports:[p.t,h.n,m.Y],stores:[l,w,R],imports:[i.D]})],de)},13843:(e,t,r)=>{"use strict";r.d(t,{r:()=>f});var s=r(88802),a=r(99634),n=r(65766),i=r(53576),o=r(20754),c=r(87279),u=r(10468),d=r(85390),l=r(30523),p=r(87065);const h=e=>!!e?.name&&e.name!==i.LoginDeviceLimitFlowStage.DeviceLimitDone&&e.name!==i.LoginDeviceLimitFlowStage.OpeningSessionAfterDeviceLimitRemoval,m={[i.SSOMigrationType.MP_TO_SSO]:u.Oq.RequiresMP2SSOMigration,[i.SSOMigrationType.MP_TO_SSO_WITH_INFO]:u.Oq.RequiresMP2SSOMigration,[i.SSOMigrationType.SSO_TO_MP]:u.Oq.RequiresSSO2MPMigration};let y=class{constructor(e){this.carbon=e}execute(){const{liveSSOMigrationInfo:e,liveLoginDeviceLimitFlow:t,liveTwoFactorAuthenticationInfo:r}=this.carbon.queries,s=e(void 0),a=t(void 0),n=r(void 0);return(0,d.a)({ssoMigrationInfo:s,loginDeviceLimitFlow:a,twoFactorAuthenticationInfo:n}).pipe((0,l.h)((({twoFactorAuthenticationInfo:e})=>!!(0,c.d6)(e)&&e.data.status===i.TwoFactorAuthenticationInfoRequestStatus.READY)),(0,p.U)((({ssoMigrationInfo:e,loginDeviceLimitFlow:t,twoFactorAuthenticationInfo:r})=>{if(!(0,c.d6)(e)||!(0,c.d6)(t)||!(0,c.d6)(r)||r.data.status!==i.TwoFactorAuthenticationInfoRequestStatus.READY)throw new Error("One query failed");const s=h(t.data);if(!e.data.migration&&!s&&!r.data.shouldEnforceTwoFactorAuthentication)return(0,c.Vp)({isAllowed:!0});const a={isAllowed:!1,reasons:[]};return e.data.migration&&a.reasons.push(m[e.data.migration]),s&&a.reasons.push(u.Oq.DeviceLimited),r.data.shouldEnforceTwoFactorAuthentication&&a.reasons.push(u.Oq.Requires2FAEnforcement),(0,c.Vp)(a)})))}};y=(0,s.__decorate)([(0,o.e)(u.bY),(0,s.__metadata)("design:paramtypes",[i.CarbonLegacyClient])],y);var g=r(49273);let v=class{constructor(e){this.carbon=e}execute(){const{liveLoginDeviceLimitFlow:e}=this.carbon.queries;return e(void 0).pipe((0,p.U)((e=>{if(!(0,c.d6)(e))throw new Error("liveLoginDeviceLimitFlow failed");return(0,c.Vp)({isLimited:h(e.data)})})))}};v=(0,s.__decorate)([(0,o.e)(g.X),(0,s.__metadata)("design:paramtypes",[i.CarbonLegacyClient])],v);let f=class{};f=(0,s.__decorate)([(0,a.Y)({api:n.Y,handlers:{commands:{},events:{},queries:{isAllowed:y,deviceLimit:v}}})],f)},72721:(e,t,r)=>{"use strict";r.d(t,{a:()=>f});var s=r(86952),a=r(67591),n=r(24249),i=r(38164),o=r(11578),c=r(6233),u=r(99676),d=r(46629),l=r(11527),p=r(50384),h=r(89074),m=r(68827),y=r(86590),g=r(5363),v=r(15507);const f=(0,s.Q)({name:"sharingCollections",commands:{addItemsToCollection:u.Z,addItemToCollections:d.$,createSharedCollection:l.I,deleteSharedCollection:p.U,inviteCollectionMembers:h.Q,removeItemFromCollections:m.B,renameCollection:y.r,revokeCollectionMembers:g.q,updateSharedCollections:v.M},events:{},queries:{getItemIdsInSharedCollections:a.q,getSharedCollections:n.$,isCollectionSharable:i.l,sharedCollectionsWithItems:o.MO,usersAndGroupsInCollection:c.O}})},46629:(e,t,r)=>{"use strict";r.d(t,{$:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},99676:(e,t,r)=>{"use strict";r.d(t,{Z:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},11527:(e,t,r)=>{"use strict";r.d(t,{I:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},50384:(e,t,r)=>{"use strict";r.d(t,{U:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},89074:(e,t,r)=>{"use strict";r.d(t,{Q:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},68827:(e,t,r)=>{"use strict";r.d(t,{B:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},86590:(e,t,r)=>{"use strict";r.d(t,{r:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},5363:(e,t,r)=>{"use strict";r.d(t,{q:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},15507:(e,t,r)=>{"use strict";r.d(t,{M:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},67591:(e,t,r)=>{"use strict";r.d(t,{q:()=>n});var s=r(99059),a=r(25029);class n extends((0,s.k)({scope:a.F.User})){}},24249:(e,t,r)=>{"use strict";r.d(t,{$:()=>n});var s=r(99059),a=r(25029);class n extends((0,s.k)({scope:a.F.User})){}},38164:(e,t,r)=>{"use strict";r.d(t,{l:()=>n});var s=r(99059),a=r(25029);class n extends((0,s.k)({scope:a.F.User})){}},11578:(e,t,r)=>{"use strict";r.d(t,{JQ:()=>o,MO:()=>c});var s=r(7165),a=r(99059),n=r(25029);const i=s.z.object({id:s.z.string(),type:s.z.string()}),o=s.z.object({id:s.z.string(),name:s.z.string(),spaceId:s.z.string(),vaultItems:s.z.array(i),isShared:s.z.optional(s.z.boolean())});class c extends((0,a.k)({scope:n.F.User})){}},6233:(e,t,r)=>{"use strict";r.d(t,{O:()=>n});var s=r(99059),a=r(25029);class n extends((0,s.k)({scope:a.F.User})){}},4400:(e,t,r)=>{"use strict";r.d(t,{Iy:()=>o,MX:()=>p,qb:()=>a,y3:()=>s});var s,a,n=r(7165);!function(e){e.Admin="admin",e.Limited="limited"}(s||(s={})),function(e){e.Pending="pending",e.Accepted="accepted",e.Refused="refused",e.Revoked="revoked"}(a||(a={}));const i=n.z.nativeEnum(a),o=n.z.nativeEnum(s),c=n.z.union([n.z.literal("noKey"),n.z.literal("publicKey"),n.z.literal("sharingKeys")]),u=n.z.object({acceptSignature:n.z.optional(n.z.nullable(n.z.string())),collectionKey:n.z.optional(n.z.nullable(n.z.string())),login:n.z.string(),permission:o,proposeSignature:n.z.optional(n.z.string()),proposeSignatureUsingAlias:n.z.optional(n.z.boolean()),referrer:n.z.string(),rsaStatus:n.z.optional(c),status:i}),d=n.z.object({acceptSignature:n.z.optional(n.z.nullable(n.z.string())),collectionKey:n.z.optional(n.z.nullable(n.z.string())),name:n.z.string(),permission:o,proposeSignature:n.z.optional(n.z.string()),referrer:n.z.optional(n.z.string()),status:i,uuid:n.z.string()}),l=n.z.object({label:n.z.string(),status:i,permission:o,id:n.z.string()}),p=n.z.object({name:n.z.string(),privateKey:n.z.string(),publicKey:n.z.string(),revision:n.z.number(),userGroups:n.z.optional(n.z.array(d)),users:n.z.optional(n.z.array(u)),uuid:n.z.string()});n.z.object({userGroups:n.z.optional(n.z.array(l)),users:n.z.optional(n.z.array(l))}),n.z.array(n.z.string())},58425:(e,t,r)=>{"use strict";r.d(t,{t:()=>p});var s=r(86952),a=r(31609),n=r(68096),i=r(55677),o=r(84009),c=r(79517),u=r(32004),d=r(36610),l=r(36469);const p=(0,s.Q)({name:"sharingInvites",commands:{AcceptCollectionInviteCommand:a.cD,RefuseCollectionInviteCommand:n.UC,RefuseItemGroupInviteCommand:i.gm,RefuseUserGroupInviteCommand:o.Fo,UpdatePendingCollectionsCommand:c.r},events:{},queries:{GetInvitesQuery:u.q,GetPendingCollectionsQuery:d.D,HasInvitesQuery:l._}})},31609:(e,t,r)=>{"use strict";r.d(t,{cD:()=>c,nu:()=>o});var s,a=r(74354),n=r(25029),i=r(96168);!function(e){e.AcceptFailed="AcceptFailed"}(s||(s={}));class o extends((0,i.Hu)(s.AcceptFailed,"Failed to accept collection")){}class c extends((0,a.g)({scope:n.F.User})){}},68096:(e,t,r)=>{"use strict";r.d(t,{R$:()=>o,UC:()=>c});var s,a=r(74354),n=r(25029),i=r(96168);!function(e){e.RefuseFailed="RefuseFailed"}(s||(s={}));class o extends((0,i.Hu)(s.RefuseFailed,"Failed to refuse collection")){}class c extends((0,a.g)({scope:n.F.User})){}},55677:(e,t,r)=>{"use strict";r.d(t,{fL:()=>o,fr:()=>y,gm:()=>g});var s,a=r(74354),n=r(25029),i=r(96168);!function(e){e.ItemGroupNotFound="ItemGroupNotFound",e.AuthorHasInvalidStatus="AuthorHasInvalidStatus",e.GroupHasInvalidStatus="GroupHasInvalidStatus",e.UserIsNotInItemGroup="UserIsNotInItemGroup",e.UserGroupIsNotInItemGroup="UserGroupIsNotInItemGroup",e.InvalidItemGroupRevision="InvalidItemGroupRevision",e.NotEnoughAdmins="NotEnoughAdmins",e.UserIsNotInPendingStatus="UserIsNotInPendingStatus"}(s||(s={}));class o extends((0,i.Hu)(s.ItemGroupNotFound,"Item Group not found")){}class c extends((0,i.Hu)(s.AuthorHasInvalidStatus,"User is not in accepted/pending status (already refused or revoked)")){}class u extends((0,i.Hu)(s.GroupHasInvalidStatus,"UserGroup is not in accepted/pending status (already refused or revoked)")){}class d extends((0,i.Hu)(s.UserIsNotInItemGroup,"User is not part of item group")){}class l extends((0,i.Hu)(s.UserGroupIsNotInItemGroup,"User group is not part of item group")){}class p extends((0,i.Hu)(s.InvalidItemGroupRevision,"Item group revision is not valid")){}class h extends((0,i.Hu)(s.NotEnoughAdmins,"The operation would let the item group with no admin")){}class m extends((0,i.Hu)(s.UserIsNotInPendingStatus,'User is not in "pending" status or not part of a group')){}function y(e){switch(e){case"AUTHOR_HAS_INVALID_STATUS":return new c;case"GROUP_HAS_INVALID_STATUS":return new u;case"USER_IS_NOT_IN_ITEM_GROUP":return new d;case"USER_GROUP_IS_NOT_IN_ITEM_GROUP":return new l;case"INVALID_ITEM_GROUP_REVISION":return new p;case"NOT_ENOUGH_ADMINS":return new h;case"USER_IS_NOT_IN_PENDING_STATUS":return new m;default:throw new Error("Unknown server error")}}class g extends((0,a.g)({scope:n.F.User})){}},84009:(e,t,r)=>{"use strict";r.d(t,{Fo:()=>f,cz:()=>v});var s,a=r(74354),n=r(25029),i=r(96168);!function(e){e.UserGroupNotFound="UserGroupNotFound",e.InvalidTeamId="InvalidTeamId",e.UserGroupIsNotFound="UserGroupIsNotFound",e.InvalidItemGroupRevision="InvalidItemGroupRevision",e.UserGroupUpdateConflict="UserGroupUpdateConflict",e.InsufficientPrivileges="InsufficientPrivileges",e.UserIsNotInUserGroup="UserIsNotInUserGroup",e.UserIsNotInPendingStatus="UserIsNotInPendingStatus",e.GroupHasInvalidStatus="GroupHasInvalidStatus",e.AuthorHasInvalidStatus="AuthorHasInvalidStatus"}(s||(s={}));class o extends((0,i.Hu)(s.UserGroupNotFound,"User Group not found")){}class c extends((0,i.Hu)(s.InvalidTeamId,"Provided Team ID is not a number")){}class u extends((0,i.Hu)(s.UserGroupIsNotFound,"User group for provided ID does not exist")){}class d extends((0,i.Hu)(s.InvalidItemGroupRevision,"User group revision is not valid")){}class l extends((0,i.Hu)(s.UserGroupUpdateConflict,"Conflict between users attempting to update the same user group")){}class p extends((0,i.Hu)(s.InsufficientPrivileges,"The user does not have User Group permission to refuse the invitation")){}class h extends((0,i.Hu)(s.UserIsNotInUserGroup,"User is not part of a group")){}class m extends((0,i.Hu)(s.UserIsNotInPendingStatus,'User is not in "pending" status or not part of a group')){}class y extends((0,i.Hu)(s.GroupHasInvalidStatus,'UserGroup is not in "accepted" or "pending" status (already refused or revoked)')){}class g extends((0,i.Hu)(s.AuthorHasInvalidStatus,"User is not in accepted/pending status (already refused or revoked)")){}function v(e){switch(e){case"INVALID_TEAM_ID":return new c;case"USER_GROUP_IS_NOT_FOUND":return new u;case"INVALID_USER_GROUP_REVISION":return new d;case"USER_GROUP_UPDATE_CONFLICT":return new l;case"INSUFFICIENT_PRIVILEGES":return new p;case"USER_IS_NOT_IN_USER_GROUP":return new h;case"USER_IS_NOT_IN_PENDING_STATUS":return new m;case"GROUP_HAS_INVALID_STATUS":return new y;case"AUTHOR_HAS_INVALID_STATUS":return new g;default:throw new Error("Unknown server error")}}class f extends((0,a.g)({scope:n.F.User})){}},79517:(e,t,r)=>{"use strict";r.d(t,{r:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},32004:(e,t,r)=>{"use strict";r.d(t,{q:()=>n});var s=r(99059),a=r(25029);class n extends((0,s.k)({scope:a.F.User})){}},36610:(e,t,r)=>{"use strict";r.d(t,{D:()=>n});var s=r(99059),a=r(25029);class n extends((0,s.k)({scope:a.F.User})){}},36469:(e,t,r)=>{"use strict";r.d(t,{_:()=>n});var s=r(99059),a=r(25029);class n extends((0,s.k)({scope:a.F.User})){}},48958:(e,t,r)=>{"use strict";r.d(t,{X:()=>u});var s=r(86952),a=r(31485),n=r(54003),i=r(54326),o=r(20920),c=r(4975);const u=(0,s.Q)({name:"sharingItems",commands:{},events:{},queries:{getSharingTeamLogins:a.G,sharingEnabled:n.N,getItemGroupForItem:i.i,getSharingStatusForItem:o.S,getPermissionForItem:c.C}})},54326:(e,t,r)=>{"use strict";r.d(t,{i:()=>n});var s=r(99059),a=r(25029);class n extends((0,s.k)({scope:a.F.User})){}},4975:(e,t,r)=>{"use strict";r.d(t,{C:()=>n});var s=r(99059),a=r(25029);class n extends((0,s.k)({scope:a.F.User})){}},20920:(e,t,r)=>{"use strict";r.d(t,{S:()=>n});var s=r(99059),a=r(25029);class n extends((0,s.k)({scope:a.F.User})){}},31485:(e,t,r)=>{"use strict";r.d(t,{G:()=>n});var s=r(99059),a=r(25029);class n extends((0,s.k)({scope:a.F.User})){}},54003:(e,t,r)=>{"use strict";r.d(t,{N:()=>n});var s=r(99059),a=r(25029);class n extends((0,s.k)({scope:a.F.User})){}},21822:(e,t,r)=>{"use strict";r.d(t,{E:()=>p});var s=r(88802),a=r(53576),n=r(57924),i=r(94189),o=r(48844),c=r(63877);function u(e){switch(e){case"admin":return c.y3.Admin;case"limited":return c.y3.Limited}}function d(e){switch(e){case"pending":return c.qb.Pending;case"accepted":return c.qb.Accepted;case"refused":return c.qb.Refused;case"revoked":return c.qb.Revoked}}function l(e){return{groupId:e.groupId,revision:e.revision,type:e.type,teamId:e.teamId,items:e.items,users:e.users?[...e.users.map((e=>({...e,permission:u(e.permission),status:d(e.status)})))]:void 0,groups:e.groups?[...e.groups.map((e=>({...e,permission:u(e.permission),status:d(e.status)})))]:void 0,collections:e.collections?[...e.collections?.map((e=>({...e,permission:u(e.permission),status:d(e.status)})))??[]]:void 0}}let p=class{constructor(e){this.client=e}get(){const{queries:{carbonState:e}}=this.client.getClient(a.carbonLegacyApi);return e({path:"userSession.sharingData.itemGroups"}).pipe((0,o.Qn)((e=>e.map(l))))}getForItemId(e){return this.get().pipe((0,o.Qn)((t=>t.find((t=>t.items?.some((t=>e===t.itemId)))))))}getForItemsIds(e){return this.get().pipe((0,o.Qn)((t=>t.filter((t=>t.items?.some((t=>e.includes(t.itemId))))))))}getForCollectionId(e){return this.get().pipe((0,o.Qn)((t=>t.filter((t=>t.collections?.some((t=>e.includes(t.uuid))))))))}};p=(0,s.__decorate)([(0,n.GS)(),(0,s.__metadata)("design:paramtypes",[i.w])],p)},38834:(e,t,r)=>{"use strict";r.d(t,{n:()=>u});var s=r(88802),a=r(53576),n=r(57924),i=r(94189),o=r(48844);const c=e=>{if(!e)return{teamId:"",isSharingEnabled:!1};const t=e;if(!((r=t.spaces)&&Array.isArray(r)&&0!==r.length&&(e=>{if(!e)return!1;const t=e;return!!(t.associatedEmail&&t.billingAdmins&&t.color&&t.info&&t.letter&&t.planType&&t.status&&t.teamAdmins&&t.teamId&&t.teamName&&t.tier)})(r.find((e=>"accepted"===e.status)))))return{teamId:"",isSharingEnabled:!0};var r;const s=t.spaces.find((e=>"accepted"===e.status));return{teamId:s?.teamId??"",isSharingEnabled:Boolean(s&&!s.info.sharingDisabled)}};let u=class{constructor(e){this.client=e}get(){const{queries:{carbonState:e}}=this.client.getClient(a.carbonLegacyApi);return e({path:"userSession.localSettings.premiumStatus"}).pipe((0,o.Qn)(c))}};u=(0,s.__decorate)([(0,n.GS)(),(0,s.__metadata)("design:paramtypes",[i.w])],u)},62051:(e,t,r)=>{"use strict";r.d(t,{a:()=>c});var s=r(88802),a=r(60399),n=r(53576),i=r(57924),o=r(48844);let c=class{constructor(e){this.client=e}async getCurrentUserWithKeys(){const{queries:{carbonStateList:e}}=this.client;return await(0,a.z)(e({paths:["userSession.account.login","userSession.session.keyPair.publicKey","userSession.session.keyPair.privateKey"]}).pipe((0,o.nb)({success:([e,t,r])=>{if("string"!=typeof e||"string"!=typeof t||"string"!=typeof r)throw new Error("Invalid format of current user keys");return{login:e,publicKey:t,privateKey:r}},failure:()=>{throw new Error("Failure getting current user and key pair")}})))}};c=(0,s.__decorate)([(0,i.GS)(),(0,s.__metadata)("design:paramtypes",[n.CarbonLegacyClient])],c)},38602:(e,t,r)=>{"use strict";r.d(t,{B:()=>m});var s=r(88802),a=r(60399),n=r(7165),i=r(53576),o=r(57924),c=r(87279),u=r(63877);function d(e){switch(e){case"admin":return u.y3.Admin;case"limited":return u.y3.Limited}}function l(e){switch(e){case"pending":return u.qb.Pending;case"accepted":return u.qb.Accepted;case"refused":return u.qb.Refused;case"revoked":return u.qb.Revoked}}function p(e){return{groupId:e.groupId,revision:e.revision,type:e.type,teamId:e.teamId,name:e.name,privateKey:e.privateKey,publicKey:e.publicKey,externalId:e.externalId,familyId:e.familyId,users:[...e.users.map((e=>({...e,permission:d(e.permission),status:l(e.status)})))]}}const h=n.z.array(n.z.object({groupId:n.z.string(),name:n.z.string(),externalId:n.z.string().nullable().optional(),teamId:n.z.number().optional(),type:n.z.enum(["users","teamAdmins"]),publicKey:n.z.string(),privateKey:n.z.string(),revision:n.z.number(),users:n.z.array(n.z.object({userId:n.z.string(),alias:n.z.string(),referrer:n.z.string(),groupKey:n.z.string().nullable().optional(),acceptSignature:n.z.string().nullable().optional(),permission:n.z.enum(["admin","limited"]),rsaStatus:n.z.enum(["noKey","publicKey","sharingKeys"]),status:n.z.enum(["pending","accepted","refused","revoked"]),proposeSignatureUsingAlias:n.z.boolean().optional(),proposeSignature:n.z.string().optional()}))}));let m=class{constructor(e){this.client=e}async getRawCarbon(){const{queries:{carbonState:e}}=this.client,t=await(0,a.z)(e({path:"userSession.sharingData.userGroups"}));if((0,c.hx)(t))throw new Error("Failure getting user groups state from carbon sharing data");return t.data}async get(){const e=await this.getRawCarbon(),t=h.safeParse(e);if(!t.success)throw new Error("Invalid format of user group state");return t.data}async getForGroupIds(e){return(await this.get()).filter((t=>e.includes(t.groupId)))}async getCarbonUserGroups(){return(await this.getRawCarbon()).map(p)}};m=(0,s.__decorate)([(0,o.GS)(),(0,s.__metadata)("design:paramtypes",[i.CarbonLegacyClient])],m)},21656:(e,t,r)=>{"use strict";r.d(t,{W:()=>p});var s=r(88802),a=r(7165),n=r(60399),i=r(57924),o=r(73404),c=r(48844),u=r(87279);const d=/[<>]/g,l=a.z.array(a.z.object({email:a.z.string(),login:a.z.string().nullable(),publicKey:a.z.string().nullable()}));let p=class{constructor(e){this.serverApiClient=e}async getPublicKeysForUsers(e){const t=await(0,n.z)(this.serverApiClient.v1.sharingUserdevice.getUsersPublicKey({logins:e}).pipe((0,c.DZ)((()=>{throw new Error("Cannot get public keys of requested users.")})),(0,c.lk)((e=>(0,u.Vp)(e.data)))));if((0,u.hx)(t))throw new Error("Cannot get public keys of requested users.");const r=l.safeParse(t.data.data);if(!r.success)throw new Error("Invalid format of user public keys response");return r.data.map((e=>{return{login:e.login??(t=e.email,t.trim().toLowerCase().replace(d,"")),publicKey:e.publicKey};var t}))}};p=(0,s.__decorate)([(0,i.GS)(),(0,s.__metadata)("design:paramtypes",[o.l])],p)},14664:(e,t,r)=>{"use strict";r.d(t,{O:()=>I});var s=r(88802),a=r(57924),n=r(94189),i=r(31222),o=r(92258),c=r(40173),u=r(71634),d=r(83919),l=r(12554),p=r(77970),h=r(28008),m=r(54066),y=r(3417),g=r.n(y);function v(e){return e.replace(/(?:\\[r]|[\r\n]+)+/g,"\n")}var f=r(10370),w=r(83168),S=r(66122),_=r(89685),b=r(53576),E=r(87279);var A=r(43293),T=r(93347),C=r.n(T),x=r(82933);function R(e){const t=new Uint8Array([0,0,0,0]).buffer,r=new Uint8Array(e),s=C().deflate(r,{level:7}).buffer;return(0,x.K)(t,s)}let I=class{constructor(e,t,r,s,a,n,i,o,c){this.client=e,this.hmacSigner=t,this.keyGeneratorAes256=r,this.rsaKeyPairGenerator=s,this.kwc5Decryptor=a,this.kwc5Encryptor=n,this.rsaDecryptor=i,this.rsaEncryptor=o,this.rsaSigner=c}async createResourceKey(){return await this.keyGeneratorAes256.generate()}async encryptSecureData(e,t){return await this.kwc5Encryptor.encrypt(e,t)}async decryptSecureData(e,t){return await this.kwc5Decryptor.decrypt(e,t)}async createProposeSignature(e,t){return await this.hmacSigner.sign(e,t)}async createRecipientKeyPair(e){const{publicKey:t,privateKey:r}=await this.rsaKeyPairGenerator.generate(),s=(0,m.u)(function(e){const{asn1:t,pki:r,util:s}=g(),a=s.createBuffer(e),n=t.fromDer(a),i=r.privateKeyFromAsn1(n);return v(r.privateKeyToPem(i))}(r)),a=await this.encryptSecureData(e,s),n=function(e){const{asn1:t,pki:r,util:s}=g(),a=s.createBuffer(e),n=t.fromDer(a),i=r.publicKeyFromAsn1(n);return v(r.publicKeyToRSAPublicKeyPem(i))}(t);return{publicKey:n,privateKey:(0,f.s)(a)}}async createAcceptSignature(e,t,r){const s=`${t}-accepted-${(0,f.s)(r)}`,a=(0,m.u)(s);return await this.rsaSigner.sign(e,a)}async encryptResourceKey(e,t){return await this.rsaEncryptor.encrypt(e,t)}async decryptResourceKey(e,t){return await this.rsaDecryptor.decrypt(e,t)}async decryptResourceKeyToClearText(e,t,r){const s=await this.decryptResourceKey((0,w.B)(e),(0,S.R)(r)),a=await this.decryptSecureData(s,(0,S.R)(t));return(0,_.v)(a)}async encryptSharingItem(e,t){const{commands:{carbon:r}}=this.client.getClient(b.carbonLegacyApi),s=await r({name:"convertItemToDashlaneXml",args:[{item:t}]}),a=(n=s,(0,E.hx)(n)||"string"!=typeof n.data.carbonResult.xml?null:n.data.carbonResult.xml);var n;if(""===a||null===a)throw new Error("Unable to convert item to XML");const i=(e=>{const t=(0,A.N)(e);return R((0,m.u)(t))})(a);return await this.encryptSecureData(e,i)}async decryptEncapsulatedPrivateKey(e,t,r){const s=await this.decryptResourceKey(e,(0,S.R)(t)),a=await this.decryptSecureData(s,(0,S.R)(r));return(0,w.B)((0,_.v)(a))}};I=(0,s.__decorate)([(0,a.GS)(),(0,s.__metadata)("design:paramtypes",[n.w,i.q,o.c,c.e,u.$,d.o,l.g,p.H,h.k])],I)},78098:(e,t,r)=>{"use strict";r.d(t,{c:()=>l});var s=r(88802),a=r(57924),n=r(63877),i=r(83168),o=r(66122),c=r(14664),u=r(62051),d=r(38602);let l=class{constructor(e,t,r){this.sharingCrypto=e,this.currentUserGetter=t,this.userGroupsGetter=r}async decryptItemGroupKey(e,t){const r=await this.currentUserGetter.getCurrentUserWithKeys(),s=e.users?.find((e=>e.userId===r.login&&e.status===n.qb.Accepted&&e.groupKey));if(s?.groupKey)return await this.decryptItemGroupKeyViaUserMember(s,r);const a=(await this.userGroupsGetter.getCarbonUserGroups()).filter((e=>e.users.some((e=>e.userId===r.login&&e.status===n.qb.Accepted&&!e.proposeSignatureUsingAlias&&e.groupKey)))),i=e.groups?.find((e=>a.some((t=>t.groupId===e.groupId))&&e.status===n.qb.Accepted&&e.groupKey));if(i?.groupKey)return await this.decryptItemGroupKeyViaGroupMember(i,r,a);const o=t.filter((e=>e.users?.some((e=>e.login===r.login&&e.status===n.qb.Accepted&&!e.proposeSignatureUsingAlias&&e.collectionKey))||e.userGroups?.some((e=>a.some((t=>t.groupId===e.uuid))&&e.status===n.qb.Accepted&&e.collectionKey)))),c=e.collections?.find((e=>o.some((t=>t.uuid===e.uuid))&&e.status===n.qb.Accepted&&e.itemGroupKey));return c?.itemGroupKey?await this.decryptItemGroupKeyViaCollectionMember(c,r,o,a):null}async decryptItemGroupKeyViaUserMember(e,t){if(!e.groupKey)return null;try{return await this.sharingCrypto.decryptResourceKey((0,i.B)(t.privateKey),(0,o.R)(e.groupKey))}catch{return null}}async decryptItemGroupKeyViaGroupMember(e,t,r){if(!e.groupKey)return null;try{const s=r.find((({groupId:t})=>t===e.groupId)),a=s?.users.find((({userId:e})=>e===t.login));if(!a?.groupKey||!s)return null;const n=await this.sharingCrypto.decryptEncapsulatedPrivateKey((0,i.B)(t.privateKey),a.groupKey,s.privateKey);return await this.sharingCrypto.decryptResourceKey(n,(0,o.R)(e.groupKey))}catch(e){return null}}async decryptItemGroupKeyViaCollectionMember(e,t,r,s){if(!e.itemGroupKey)return null;const a=r.find((({uuid:t})=>t===e.uuid));if(!a)return null;const n=a.users?.find((({login:e})=>e===t.login)),c=a.userGroups?.find((({uuid:e})=>s.some((({groupId:t})=>t===e))));if(n?.collectionKey){const r=await this.sharingCrypto.decryptEncapsulatedPrivateKey((0,i.B)(t.privateKey),n.collectionKey,a.privateKey);return await this.sharingCrypto.decryptResourceKey(r,(0,o.R)(e.itemGroupKey))}if(c?.collectionKey){const r=s.find((({groupId:e})=>e===c.uuid)),n=r?.users.find((({userId:e})=>e===t.login));if(!n?.groupKey||!r)return null;const u=await this.sharingCrypto.decryptEncapsulatedPrivateKey((0,i.B)(t.privateKey),n.groupKey,r.privateKey),d=await this.sharingCrypto.decryptEncapsulatedPrivateKey(u,c.collectionKey,a.privateKey);return await this.sharingCrypto.decryptResourceKey(d,(0,o.R)(e.itemGroupKey))}return null}async decryptCollectionKey(e,t=n.qb.Accepted){const r=await this.currentUserGetter.getCurrentUserWithKeys(),s=e.users?.find((e=>e.login===r.login&&e.status===t&&e.collectionKey));if(s?.collectionKey)return await this.decryptCollectionKeyViaUserMember(s,r);const a=(await this.userGroupsGetter.getCarbonUserGroups()).filter((e=>e.users.some((e=>e.userId===r.login&&e.status===t&&!e.proposeSignatureUsingAlias&&e.groupKey)))),i=e.userGroups?.find((e=>a.some((t=>t.groupId===e.uuid))&&e.status===t&&e.collectionKey));return i?.collectionKey?await this.decryptCollectionKeyViaGroupMember(i,r,a):null}async decryptCollectionKeyViaUserMember(e,t){if(!e.collectionKey)return null;try{return await this.sharingCrypto.decryptResourceKey((0,i.B)(t.privateKey),(0,o.R)(e.collectionKey))}catch{return null}}async decryptCollectionKeyViaGroupMember(e,t,r){if(!e.collectionKey)return null;try{const s=r.find((({groupId:t})=>t===e.uuid)),a=s?.users.find((({userId:e})=>e===t.login));if(!a?.groupKey||!s)return null;const n=await this.sharingCrypto.decryptEncapsulatedPrivateKey((0,i.B)(t.privateKey),a.groupKey,s.privateKey);return await this.sharingCrypto.decryptResourceKey(n,(0,o.R)(e.collectionKey))}catch{return null}}};l=(0,s.__decorate)([(0,a.GS)(),(0,s.__metadata)("design:paramtypes",[c.O,u.a,d.B])],l)},98726:(e,t,r)=>{"use strict";r.d(t,{h:()=>p,v:()=>l});var s=r(88802),a=r(7165),n=r(57924),i=r(4761),o=r(10370),c=r(54066),u=r(83168),d=r(14664);const l=a.z.object({resourceKey:a.z.string(),acceptSignature:a.z.string().optional(),proposeSignature:a.z.string(),proposeSignatureUsingAlias:a.z.boolean().optional()});let p=class{constructor(e){this.sharingCrypto=e}async createSignedInvite(e,t,r,s){const a=await this.sharingCrypto.encryptResourceKey((0,i.M)(r),t.resourceKey),n=(0,o.s)(a),d=(0,c.u)(e),l=await this.sharingCrypto.createProposeSignature(t.resourceKey,d),p=(0,o.s)(l),h=s?await this.sharingCrypto.createAcceptSignature((0,u.B)(s),t.uuid,t.resourceKey):void 0;return{proposeSignature:p,acceptSignature:h?(0,o.s)(h):void 0,resourceKey:n,proposeSignatureUsingAlias:!r}}};p=(0,s.__decorate)([(0,n.GS)(),(0,s.__metadata)("design:paramtypes",[d.O])],p)},54103:(e,t,r)=>{"use strict";r.d(t,{k:()=>g});var s=r(88802),a=r(60399),n=r(57924),i=r(94189),o=r(63877),c=r(73404),u=r(10370),d=r(53576),l=r(87279),p=r(40896),h=r(14664),m=r(20965);function y(e){const t=(0,d.isCredential)(e)?"password":"note";return{type:t,name:e.Title||`Untitled ${t}`}}let g=class{constructor(e,t,r,s){this.client=e,this.serverApiClient=t,this.sharingCrypto=r,this.sharingUsers=s}async createItemGroup(e){const t=(0,p.R)(),r=await this.sharingCrypto.createResourceKey(),s=(await this.sharingUsers.createSignedUserInvites([],o.y3.Admin,{resourceKey:r,uuid:t})).map((e=>{if(!e.id)throw new Error("Cannot create itemGroup upload.");const{acceptSignature:t,alias:r,proposeSignature:s,id:a,proposeSignatureUsingAlias:n,permission:i,resourceKey:o}=e;return{acceptSignature:t,alias:r,proposeSignature:s,proposeSignatureUsingAlias:n,permission:i,userId:a,groupKey:o}})),n=await this.sharingCrypto.createResourceKey(),i=await this.sharingCrypto.encryptSecureData(r,n),c=await this.sharingCrypto.encryptSharingItem(n,e),d=await(0,a.z)(this.serverApiClient.v1.sharingUserdevice.createItemGroup({groupId:t,items:[{itemId:e.Id,itemType:"KWSecureNote"===e.kwType?"SECURENOTE":"AUTHENTIFIANT",itemKey:(0,u.s)(i),content:(0,u.s)(c)}],users:s,itemsForEmailing:[y(e)]}));if((0,l.hx)(d))throw new Error("Failed to create item group");const h=d.data.data.itemGroups?.find((e=>e.groupId===t));if(!h)throw new Error("Error creating item group");return h}async getCarbonCredentialsByItemIds(e){const{queries:{carbonState:t}}=this.client.getClient(d.carbonLegacyApi),r=await(0,a.z)(t({path:"userSession.personalData.credentials"}));if((0,l.hx)(r))throw new Error("Unable to access credentials from carbon");const s=r.data;if(!s)throw new Error("No credentials found");return s.filter((({Id:t})=>e.includes(t)))}};g=(0,s.__decorate)([(0,n.GS)(),(0,s.__metadata)("design:paramtypes",[i.w,c.l,h.O,m.EH])],g)},75002:(e,t,r)=>{"use strict";r.d(t,{D:()=>h});var s=r(88802),a=r(87279),n=r(60399),i=r(30523),o=r(57924),c=r(76183),u=r(67837),d=r(33470);class l extends((0,u.E)(d.r)){}(0,u.K)(d.r,l);var p=r(92233);let h=class{constructor(e){this.syncClient=e}async scheduleSync(){const{commands:e,queries:t}=this.syncClient;return await(0,n.z)(t.syncProgress().pipe((0,i.h)(a.d6),(0,i.h)((e=>e.data.status!==c.L.IN_PROGRESS)))),await e.sync({trigger:p.Trigger.Sharing}),(0,a.Vp)(void 0)}};h=(0,s.__decorate)([(0,o.GS)(),(0,s.__metadata)("design:paramtypes",[l])],h)},9697:(e,t,r)=>{"use strict";r.d(t,{o:()=>u});var s=r(88802),a=r(57924),n=r(14664),i=r(62051),o=r(38602),c=r(98726);let u=class{constructor(e,t,r,s){this.userGroupsGetter=e,this.sharingCrypto=t,this.sharingInvitesCrypto=r,this.currentUserGetter=s}async createSignedUserGroupInvites(e,t,r){const s=await this.currentUserGetter.getCurrentUserWithKeys(),a=await this.userGroupsGetter.getForGroupIds(e);return await Promise.all(a.map((async e=>{const a=e.users.find((e=>e.userId===s.login)),n=a?.groupKey;if(!n)throw new Error("Unable to get user group key.");const i=await this.sharingCrypto.decryptResourceKeyToClearText(s.privateKey,e.privateKey,n),{proposeSignature:o,acceptSignature:c,resourceKey:u}=await this.sharingInvitesCrypto.createSignedInvite(e.groupId,r,e.publicKey,i);return{permission:t,proposeSignature:o,acceptSignature:c,id:e.groupId,resourceKey:u}})))}};u=(0,s.__decorate)([(0,a.GS)(),(0,s.__metadata)("design:paramtypes",[o.B,n.O,c.h,i.a])],u)},20965:(e,t,r)=>{"use strict";r.d(t,{EH:()=>d});var s=r(88802),a=r(7165),n=r(57924),i=r(4400),o=r(98726),c=r(21656),u=r(62051);o.v.extend({id:a.z.string(),permission:i.Iy}).extend({alias:a.z.string()});let d=class{constructor(e,t,r){this.currentUserGetter=e,this.invitesCryptoService=t,this.sharingGateway=r}async createSignedUserInvites(e,t,r,s=!0){const a=await this.sharingGateway.getPublicKeysForUsers(e),n=await this.currentUserGetter.getCurrentUserWithKeys(),o=[...s?[{login:n.login,publicKey:n.publicKey}]:[],...a.map((e=>({...e})))];return await Promise.all(o.map((async e=>{const s=n.login===e.login;if(!e.publicKey)throw new Error("missing user public key");return{...await this.invitesCryptoService.createSignedInvite(e.login,r,e.publicKey,s?n.privateKey:void 0),id:e.login,alias:e.login,permission:s?i.y3.Admin:t}})))}};d=(0,s.__decorate)([(0,n.GS)(),(0,s.__metadata)("design:paramtypes",[u.a,o.h,c.W])],d)},36458:(e,t,r)=>{"use strict";r.d(t,{S:()=>d});var s=r(95681),a=r(23347),n=r(25029),i=r(7165),o=r(4400);const c=i.z.object({sharedCollections:i.z.array(o.MX)}),u=e=>c.safeParse(e).success;class d extends((0,s.Q)({capacity:a.Y._010KB,persist:!1,scope:n.F.User,storeName:"collections-store",storeTypeGuard:u,initialValue:{sharedCollections:[]}})){}},2226:(e,t,r)=>{"use strict";r.d(t,{a:()=>Ce});var s=r(88802),a=r(99634),n=r(72721),i=r(6447),o=r(37935),c=r(63663),u=r(87279),d=r(99676),l=r(60399),p=r(69885),h=r(21869),m=r(57924),y=r(63877),g=r(4761),v=r(66122),f=r(83168),w=r(89685),S=r(10370),_=r(54066),b=r(73404),E=r(48844),A=r(14664),T=r(20965),C=r(9697),x=r(78098),R=r(21822),I=r(38602);let P=class{constructor(e,t,r,s,a,n,i,o){this.serverApiClient=e,this.sharingCrypto=t,this.sharingUserGroups=r,this.sharingUsers=s,this.sharingDecryption=a,this.itemGroupsGetter=n,this.userGroupGetter=i,this.context=o}async addItemGroupsToCollection(e,t,r){const s=await Promise.all(r.map((async r=>{const s=await this.sharingDecryption.decryptItemGroupKey(r,t);if(null===s)throw new Error("Unable to decrypt item group key");const a=await this.sharingCrypto.encryptResourceKey((0,g.M)(e.publicKey),s),n=await this.sharingDecryption.decryptCollectionKey(e);if(null===n)throw new Error("Unable to decrypt collection key");const i=await this.sharingCrypto.decryptSecureData(n,(0,v.R)(e.privateKey)),o=(0,f.B)((0,w.v)(i));return{uuid:r.groupId,permission:y.y3.Admin,itemGroupKey:(0,S.s)(a),proposeSignature:(0,S.s)(await this.sharingCrypto.createProposeSignature(s,(0,_.u)(e.uuid))),acceptSignature:(0,S.s)(await this.sharingCrypto.createAcceptSignature(o,r.groupId,s))}}))),a=await(0,l.z)(this.serverApiClient.v1.sharingUserdevice.addItemGroupsToCollection({collectionUUID:e.uuid,itemGroups:s,revision:e.revision}));if((0,u.hx)(a))throw new Error("Failed to add items to collection");if(0===((0,u.db)(a).data.collections||[]).length)throw new Error("Failed to add items to collection")}async canShareItemGroup(e,t){const r=this.getCurrentUserLogin();if(!r)return!1;const s=await this.userGroupGetter.getCarbonUserGroups(),a=t,n=e.users?.some((e=>e.userId===r&&e.status===y.qb.Accepted&&!e.proposeSignatureUsingAlias&&e.permission===y.y3.Admin&&e.groupKey))??!1,i=s.filter((e=>e.users.some((e=>e.userId===r&&e.status===y.qb.Accepted&&!e.proposeSignatureUsingAlias&&e.groupKey)))),o=e.groups?.some((e=>i.some((t=>t.groupId===e.groupId))&&e.status===y.qb.Accepted&&e.permission===y.y3.Admin&&e.groupKey))??!1,c=a.filter((e=>e.users?.some((e=>e.login===r&&e.status===y.qb.Accepted&&!e.proposeSignatureUsingAlias&&e.collectionKey))||e.userGroups?.some((e=>i.some((t=>t.groupId===e.uuid))&&e.status===y.qb.Accepted&&e.collectionKey)))),u=e.collections?.some((e=>c.some((t=>t.uuid===e.uuid))&&e.status===y.qb.Accepted&&e.permission===y.y3.Admin&&e.itemGroupKey))??!1;return n||o||u}async removeItemGroupsFromCollection(e,t){const r=await(0,l.z)(this.serverApiClient.v1.sharingUserdevice.removeItemGroupsFromCollection({collectionUUID:e.uuid,itemGroupUUIDs:t,revision:e.revision}));if((0,u.hx)(r))throw new Error("Failure to remove item from collection")}canShareItems(e,t){return 0===e.length?(0,p.of)((0,u.Vp)(!0)):this.itemGroupsGetter.getForItemsIds(e).pipe((0,E.Gx)((async e=>(await Promise.all(e.map((e=>this.canShareItemGroup(e,t))))).every(Boolean))))}async revokeCollectionMembers(e,t,r,s){const a=this.serverApiClient.v1.sharingUserdevice.revokeCollectionMembers({collectionUUID:e,revision:t,userLogins:s,userGroupUUIDs:r}),n=await(0,l.z)(a);if((0,u.hx)(n)||!n.data.data.collections)throw new Error("Failed to revoke access to collection");return n.data.data.collections[0]}async inviteCollectionMembers(e,t,r){const{revision:s}=e,a=await this.sharingDecryption.decryptCollectionKey(e);if(!a)throw new Error("Cannot decrypt collection key.");const n=t.length?this.sharingUsers.createSignedUserInvites(t,y.y3.Admin,{resourceKey:a,uuid:e.uuid},!1):void 0,i=r.length?this.sharingUserGroups.createSignedUserGroupInvites(r,y.y3.Admin,{resourceKey:a,uuid:e.uuid}):void 0,[o,c]=await Promise.all([n,i]),d=o?.map((e=>{const{acceptSignature:t,alias:r,proposeSignature:s,id:a,proposeSignatureUsingAlias:n,permission:i,resourceKey:o}=e;return{acceptSignature:t,alias:r,proposeSignature:s,proposeSignatureUsingAlias:n,permission:i,login:a,collectionKey:o}})),p=c?.map((e=>{const{acceptSignature:t,proposeSignature:r,permission:s,resourceKey:a,id:n}=e;return{acceptSignature:t,proposeSignature:r,collectionKey:a,permission:s,groupUUID:n}})),h={revision:s,collectionUUID:e.uuid,users:d,userGroups:p},m=this.serverApiClient.v1.sharingUserdevice.inviteCollectionMembers(h),g=await(0,l.z)(m);if((0,u.hx)(g)||!g.data.data.collections)throw new Error("Failed to add users to collection");return g.data.data.collections[0]}getCurrentUserLogin(){return this.context.get(h.l.UserName)}};P=(0,s.__decorate)([(0,m.GS)(),(0,s.__metadata)("design:paramtypes",[b.l,A.O,C.o,T.EH,x.c,R.E,I.B,h.f])],P);var D=r(54103);let U=class{constructor(e,t,r){this.sharingManager=e,this.sharingItemGroups=t,this.itemGroupsGetter=r}async addItemsToCollections(e,t,r){const s=await(0,l.z)(this.itemGroupsGetter.getForItemsIds(t));if((0,u.hx)(s))throw new Error("Unable to find item groups for items");const a=(0,u.db)(s);if(a.some((t=>t.collections?.some((t=>e.some((({uuid:e})=>e===t.uuid)))))))throw new Error("Items are already shared in the collections");if(!(await Promise.all(a.map((e=>this.sharingManager.canShareItemGroup(e,r))))).every(Boolean))throw new Error("User does not have access to share selected items");const n=[...(await this.sharingItemGroups.getCarbonCredentialsByItemIds(t)).filter((({Id:e})=>!a.some((t=>t.items?.some((t=>t.itemId===e))))))],i=await Promise.all(n.map((e=>this.sharingItemGroups.createItemGroup(e)))),o=[...a,...i];return await Promise.all(e.map((e=>this.sharingManager.addItemGroupsToCollection(e,r,o)))),(0,u.Vp)(void 0)}};U=(0,s.__decorate)([(0,m.GS)(),(0,s.__metadata)("design:paramtypes",[P,D.k,R.E])],U);var F=r(75002),O=r(36458),N=r(87065);let k=class{constructor(e){this.store=e}async getCollections(){return(await this.store.getState()).sharedCollections}collections$(){return this.store.state$.pipe((0,N.U)((e=>e.sharedCollections)))}collection$(e){return this.collections$().pipe((0,N.U)((t=>t.find((t=>t.uuid===e)))))}async getCollection(e){const t=(await this.store.getState()).sharedCollections.find((t=>t.uuid===e));if(t)return t}async updateCollections(e){await this.store.set({sharedCollections:[...e]})}};k=(0,s.__decorate)([(0,m.GS)(),(0,s.__metadata)("design:paramtypes",[O.S])],k);let L=class{constructor(e,t,r){this.sharingCollectionItems=e,this.sharingSync=t,this.collectionsRepository=r}async execute({body:e}){const{collectionId:t,itemIds:r}=e,s=await this.collectionsRepository.getCollection(t);if(!s)throw new Error("Unable to find collection");const a=await this.collectionsRepository.getCollections(),n=await this.sharingCollectionItems.addItemsToCollections([s],r,a);if((0,u.hx)(n))throw new Error("Failed adding items to collection");return await this.sharingSync.scheduleSync(),(0,u.Vp)(void 0)}};L=(0,s.__decorate)([(0,c.W)(d.Z),(0,s.__metadata)("design:paramtypes",[U,F.D,k])],L);var M=r(11527),V=r(87969);class G{}let q=class{constructor(e){this.serverApiClient=e}async createCollection(e){const t=await(0,l.z)(this.serverApiClient.v1.sharingUserdevice.createCollection((e=>{const{collectionId:t,collectionName:r,users:s,userGroups:a,publicKey:n,privateKey:i,teamId:o}=e;return{collectionUUID:t,collectionName:r,publicKey:n,privateKey:i,teamId:o,users:s.map((({id:e,resourceKey:t,proposeSignature:r,proposeSignatureUsingAlias:s,acceptSignature:a,alias:n,permission:i})=>({login:e,collectionKey:t,proposeSignature:r,proposeSignatureUsingAlias:s,acceptSignature:a,alias:n,permission:i}))),userGroups:a?.map((({id:e,resourceKey:t,proposeSignature:r,proposeSignatureUsingAlias:s,acceptSignature:a,permission:n})=>({groupUUID:e,collectionKey:t,proposeSignature:r,proposeSignatureUsingAlias:s,acceptSignature:a,permission:n})))}})(e)));if((0,u.hx)(t))throw new Error("Failed to create shared collection from private one");const r=(0,u.db)(t).data.collections?.find((t=>t.uuid===e.collectionId));if(!r)throw new Error("Unable to find collection");return r}async renameCollection(e){const{collectionId:t,revision:r,updatedName:s}=e,a=await(0,l.z)(this.serverApiClient.v1.sharingUserdevice.renameCollection({collectionUUID:t,revision:r,updatedName:s}));if((0,u.hx)(a))throw new Error("Failed to rename shared collection")}async deleteCollection(e,t){const r={collectionUUID:e,revision:t},s=await(0,l.z)(this.serverApiClient.v1.sharingUserdevice.deleteCollection(r));if((0,u.hx)(s))throw new Error("Failed to delete shared collection")}};q=(0,s.__decorate)([(0,m.GS)(),(0,s.__metadata)("design:paramtypes",[b.l])],q);let j=class{constructor(e,t,r,s){this.sharingCollectionsGateway=e,this.sharingCrypto=t,this.sharingUserGroups=r,this.sharingUsers=s}async createCollection(e,t,r,s,a,n){const i=await this.sharingCrypto.createResourceKey(),o={resourceKey:i,uuid:e},c=await this.sharingUsers.createSignedUserInvites(s,n,o),u=a.length>0?await this.sharingUserGroups.createSignedUserGroupInvites(a,n,o):void 0,{publicKey:d,privateKey:l}=await this.sharingCrypto.createRecipientKeyPair(i);return this.sharingCollectionsGateway.createCollection({collectionId:e,collectionName:r,publicKey:d,privateKey:l,users:c,userGroups:u,teamId:Number(t)})}async renameCollection(e,t){const{revision:r,uuid:s}=e;await this.sharingCollectionsGateway.renameCollection({collectionId:s,revision:r,updatedName:t})}};j=(0,s.__decorate)([(0,m.GS)(),(0,s.__metadata)("design:paramtypes",[G,A.O,C.o,T.EH])],j);var K=r(40896);let W=class{constructor(e,t,r,s,a,n,i){this.sharingCollections=e,this.collectionsRepository=t,this.sharingCollectionsGateway=r,this.sharingCollectionItems=s,this.sharingManager=a,this.vaultClient=n,this.sharingSync=i}async execute({body:e}){const{teamId:t,collectionName:r,privateCollectionId:s,users:a,groups:n,permission:i,itemIds:o}=e,c=(0,K.R)(),d=await this.sharingCollections.createCollection(c,t,r,a,n,i);if(o.length>0)try{const e=await this.collectionsRepository.getCollections();await this.sharingCollectionItems.addItemsToCollections([d],o,e)}catch(e){const t=await this.sharingManager.revokeCollectionMembers(d.uuid,d.revision,n.length>0?n:void 0,a.length>0?a:void 0);throw await this.sharingCollectionsGateway.deleteCollection(t.uuid,t.revision),await this.sharingSync.scheduleSync(),e}const{commands:l}=this.vaultClient;return s?await l.deleteCollection({id:s}):await this.sharingSync.scheduleSync(),(0,u.Vp)(void 0)}};W=(0,s.__decorate)([(0,c.W)(M.I),(0,s.__metadata)("design:paramtypes",[j,k,G,U,P,V.C,F.D])],W);var B=r(50384);let H=class{constructor(e,t,r){this.sharingSync=e,this.collectionsRepository=t,this.sharingCollectionsApi=r}async execute({body:e}){const{id:t}=e,r=await this.collectionsRepository.getCollection(t);if(!r)throw new Error("Failed to find collection revision");return await this.sharingCollectionsApi.deleteCollection(r.uuid,r.revision),await this.sharingSync.scheduleSync(),(0,u.Vp)(void 0)}};H=(0,s.__decorate)([(0,c.W)(B.U),(0,s.__metadata)("design:paramtypes",[F.D,k,G])],H);var z=r(89074);let $=class{constructor(e,t){this.sharingManager=e,this.collectionsRepository=t}async execute({body:e}){const t=await this.collectionsRepository.getCollection(e.collectionUUID);if(!t)throw new Error("Collection not found");const r=await this.sharingManager.inviteCollectionMembers(t,e.userLogins||[],e.userGroupIds||[]),s=(await this.collectionsRepository.getCollections()).filter((e=>e.uuid!==r.uuid));return await this.collectionsRepository.updateCollections([...s,r]),(0,u.Vp)(void 0)}};$=(0,s.__decorate)([(0,c.W)(z.Q),(0,s.__metadata)("design:paramtypes",[P,k])],$);var Q=r(68827);let Y=class{constructor(e,t,r,s){this.sharingManager=e,this.collectionsRepository=t,this.itemGroupsGetter=r,this.sharingSync=s}async removeItemToCollection(e,t){const r=await this.collectionsRepository.getCollection(t);if(!r)throw new Error("Unable to find collection");const s=await(0,l.z)(this.itemGroupsGetter.getForItemId(e));if((0,u.hx)(s)||!s.data)throw new Error("Item group to remove cannot be found");await this.sharingManager.removeItemGroupsFromCollection(r,[s.data.groupId])}async execute({body:e}){const{collectionIds:t,itemId:r}=e;for(const e of t)await this.removeItemToCollection(r,e);return await this.sharingSync.scheduleSync(),(0,u.Vp)(void 0)}};Y=(0,s.__decorate)([(0,c.W)(Q.B),(0,s.__metadata)("design:paramtypes",[P,k,R.E,F.D])],Y);var X=r(86590);let J=class{constructor(e,t,r){this.sharingCollections=e,this.collectionsRepository=t,this.sharingSync=r}async execute({body:e}){const{collectionId:t,newName:r}=e,s=await this.collectionsRepository.getCollection(t);if(!s)throw new Error("Failed to find collection revision");return await this.sharingCollections.renameCollection(s,r),await this.sharingSync.scheduleSync(),(0,u.Vp)(void 0)}};J=(0,s.__decorate)([(0,c.W)(X.r),(0,s.__metadata)("design:paramtypes",[j,k,F.D])],J);var Z=r(5363);let ee=class{constructor(e,t){this.collectionsRepository=e,this.sharingManager=t}async execute({body:e}){const{collectionUUID:t,userGroupUUIDs:r,userLogins:s}=e,a=await this.collectionsRepository.getCollection(t);if(!a)throw new Error("Cannot access the requested collection.");const{revision:n}=a,i=await this.sharingManager.revokeCollectionMembers(t,n,r,s),o=(await this.collectionsRepository.getCollections()).filter((e=>e.uuid!==i.uuid));return await this.collectionsRepository.updateCollections([...o,i]),(0,u.Vp)(void 0)}};ee=(0,s.__decorate)([(0,c.W)(Z.q),(0,s.__metadata)("design:paramtypes",[k,P])],ee);var te=r(15507);let re=class{constructor(e){this.collectionsRepository=e}async execute({body:e}){return await this.collectionsRepository.updateCollections(e.collections),(0,u.Vp)(void 0)}};re=(0,s.__decorate)([(0,c.W)(te.M),(0,s.__metadata)("design:paramtypes",[k])],re);var se=r(61076),ae=r(20754),ne=r(67591),ie=r(38834),oe=r(11578),ce=r(82706);const ue=e=>{if(!e.items||1!==e.items.length)throw new Error("Corrupted item group");return{id:e.items[0].itemId,type:ce.U.Credential}},de=(e,t,r)=>{const s=((e,t,r)=>({name:e.name,id:e.uuid,spaceId:r,isShared:!0,vaultItems:t.filter((t=>t.collections?.some((t=>t.uuid===e.uuid)))).map(ue)}))(e,t,r);if(oe.JQ.safeParse(s).success)return s;throw new Error("Failure to convert shared collection")};let le=class{constructor(e,t,r){this.currentSpaceGetter=e,this.itemGroupsGetter=t,this.collectionsRepository=r}execute({body:e}){const{itemIds:t}=e;return this.collectionsRepository.collections$().pipe((0,se.V)(this.currentSpaceGetter.get(),this.itemGroupsGetter.get()),(0,N.U)((([e,r,s])=>{if((0,u.hx)(r)||(0,u.hx)(s))throw new Error("Unable to access sharing data");const a=e.map((e=>de(e,s.data,r.data.teamId))).flatMap((e=>e.vaultItems)),n=t.filter((e=>a.some((t=>t.id===e))));return(0,u.Vp)(n)})))}};le=(0,s.__decorate)([(0,ae.e)(ne.q),(0,s.__metadata)("design:paramtypes",[ie.n,R.E,k])],le);var pe=r(24249);let he=class{constructor(e){this.collectionsRepository=e}execute(){return this.collectionsRepository.collections$().pipe((0,N.U)((e=>(0,u.Vp)(e))))}};he=(0,s.__decorate)([(0,ae.e)(pe.$),(0,s.__metadata)("design:paramtypes",[k])],he);var me=r(43978),ye=r(38164);let ge=class{constructor(e,t,r){this.sharingManager=e,this.vaultOrganization=t,this.collectionsRepository=r}execute({body:e}){const{privateCollectionId:t}=e,{queries:{queryCollections:r}}=this.vaultOrganization;return r({ids:[t]}).pipe((0,se.V)(this.collectionsRepository.collections$()),(0,N.U)((([e,r])=>{if((0,u.hx)(e))throw new Error("Error accessing private collections");const s=(0,u.db)(e).collections.find((({id:e})=>e===t));return{itemIds:s?s.vaultItems.map((({id:e})=>e)):[],allCollections:r}})),(0,me.w)((({itemIds:e,allCollections:t})=>this.sharingManager.canShareItems(e,t))))}};ge=(0,s.__decorate)([(0,ae.e)(ye.l),(0,s.__metadata)("design:paramtypes",[P,V.C,k])],ge);let ve=class{constructor(e,t,r){this.collectionsRepository=e,this.currentSpaceGetter=t,this.itemGroupsGetter=r}execute(){return this.collectionsRepository.collections$().pipe((0,se.V)(this.currentSpaceGetter.get(),this.itemGroupsGetter.get()),(0,N.U)((([e,t,r])=>{if((0,u.hx)(t)||(0,u.hx)(r))throw new Error("Failed to load shared collections");return(0,u.Vp)(e.map((e=>de(e,r.data,t.data.teamId))))})))}};ve=(0,s.__decorate)([(0,ae.e)(oe.MO),(0,s.__metadata)("design:paramtypes",[k,ie.n,R.E])],ve);var fe=r(6233);let we=class{constructor(e){this.collectionsRepository=e}execute({body:e}){const{collectionUUIDs:t}=e;return this.collectionsRepository.collections$().pipe((0,N.U)((e=>{const r=e.filter((e=>t.includes(e.uuid))),s=r.flatMap((e=>e.users?e.users:[])).map((e=>({id:e.login,label:e.login,status:e.status,permission:e.permission}))),a=r.flatMap((e=>e.userGroups?e.userGroups:[])).map((e=>({id:e.uuid,label:e.name,status:e.status,permission:e.permission})));return(0,u.Vp)({userGroups:a,users:s})})))}};we=(0,s.__decorate)([(0,ae.e)(fe.O),(0,s.__metadata)("design:paramtypes",[k])],we);var Se=r(46629);function _e(e){return void 0!==e}let be=class{constructor(e,t,r){this.sharingCollectionItems=e,this.sharingSync=t,this.collectionsRepository=r}async execute({body:e}){const{collectionIds:t,itemId:r,shouldSkipSync:s}=e,a=await Promise.all(t.map((e=>this.collectionsRepository.getCollection(e))));if(a.some((e=>void 0===e)))throw new Error("Unable to find collection");const n=await this.collectionsRepository.getCollections(),i=await this.sharingCollectionItems.addItemsToCollections(a.filter(_e),[r],n);if((0,u.hx)(i))throw new Error("Failed adding items to collection");return s||await this.sharingSync.scheduleSync(),(0,u.Vp)(void 0)}};be=(0,s.__decorate)([(0,c.W)(Se.$),(0,s.__metadata)("design:paramtypes",[U,F.D,k])],be);var Ee=r(62051),Ae=r(98726),Te=r(21656);let Ce=class{};Ce=(0,s.__decorate)([(0,a.Y)({api:n.a,stores:[O.S],providers:[A.O,j,D.k,C.o,T.EH,x.c,P,R.E,ie.n,U,F.D,k,Ee.a,Ae.h,Te.W,{provide:G,useClass:q},I.B],handlers:{commands:{addItemsToCollection:L,addItemToCollections:be,createSharedCollection:W,deleteSharedCollection:H,inviteCollectionMembers:$,removeItemFromCollections:Y,renameCollection:J,revokeCollectionMembers:ee,updateSharedCollections:re},events:{},queries:{getItemIdsInSharedCollections:le,getSharedCollections:he,isCollectionSharable:ge,sharedCollectionsWithItems:ve,usersAndGroupsInCollection:we}},imports:[i.n,o.D],requiredFeatureFlips:["sharing_web_collectionsSharing_dev","sharing_web_collectionsSharing_internal","sharing_web_collectionsSharing","sharing_web_invalidSignatureAutoRevoke_prod"]})],Ce)},98444:(e,t,r)=>{"use strict";r.d(t,{p:()=>le});var s=r(88802),a=r(99634),n=r(58425),i=r(6447),o=r(37935),c=r(21869),u=r(20754),d=r(94189),l=r(32004),p=r(48844),h=r(87279),m=r(53576);const y=e=>{if(!e)return!1;const t=e;return!!t.pendingItemGroups&&!!t.pendingUserGroups};var g=r(85390),v=r(87065),f=r(7165),w=r(95681),S=r(23347),_=r(25029),b=r(4400);const E=f.z.object({pendingCollections:f.z.array(b.MX)}),A=e=>E.safeParse(e).success;class T extends((0,w.Q)({capacity:S.Y._010KB,persist:!1,scope:_.F.User,storeName:"pending-shared-collections-state",storeTypeGuard:A,initialValue:{pendingCollections:[]}})){}const C=e=>void 0!==e.referrer&&void 0!==e.permission,x=(e,t)=>e.map((e=>{const r=(e.users||[]).find((e=>e.login===t&&e.status===b.qb.Pending));return{uuid:e.uuid,name:e.name,referrer:r?.referrer,permission:r?.permission,seen:!0}})).filter(C);let R=class{constructor(e,t,r){this.client=e,this.store=t,this.context=r}execute(){const{queries:{carbonState:e}}=this.client.getClient(m.carbonLegacyApi),t=e({path:"userSession.sharingSync"}),r=this.getCurrentUserLogin(),s=t.pipe((0,p.Qn)((e=>{if(!y(e))throw new Error("Bad SharingSync format");return e}))),a=this.store.state$;return(0,g.a)([s,a]).pipe((0,v.U)((([e,t])=>{const s=(0,h.d6)(e)?e.data:{pendingItemGroups:[],pendingUserGroups:[]},a=r?x(t.pendingCollections,r):[];return(0,h.Vp)({pendingItemGroups:s.pendingItemGroups,pendingUserGroups:s.pendingUserGroups,pendingCollections:a})})))}getCurrentUserLogin(){return this.context.get(c.l.UserName)}};R=(0,s.__decorate)([(0,u.e)(l.q),(0,s.__metadata)("design:paramtypes",[d.w,T,c.f])],R);var I=r(36610);let P=class{constructor(e,t){this.store=e,this.context=t}execute(){const e=this.getCurrentUserLogin();if(void 0===e)throw new Error("Unable to get pending collections, user login not found");return this.store.state$.pipe((0,v.U)((t=>{const r=x(t.pendingCollections,e);return(0,h.Vp)(r)})))}getCurrentUserLogin(){return this.context.get(c.l.UserName)}};P=(0,s.__decorate)([(0,u.e)(I.D),(0,s.__metadata)("design:paramtypes",[T,c.f])],P);var D=r(36469),U=r(70493);let F=class{constructor(e,t){this.client=e,this.store=t}execute(){const{queries:{carbonState:e}}=this.client.getClient(m.carbonLegacyApi),t=e({path:"userSession.sharingSync"}).pipe((0,p.Qn)((e=>{if(!y(e))throw new Error("Bad SharingSync format");return e}))),r=this.store.state$,{userFeatureFlips:s}=this.client.getClient(U.cV).queries,a=s();return(0,g.a)([t,r,a]).pipe((0,v.U)((([e,t,r])=>{const s=(0,h.d6)(e)?e.data:{pendingItemGroups:[],pendingUserGroups:[]},a=s.pendingItemGroups.length>0,n=s.pendingUserGroups.length>0,i=t.pendingCollections.length>0;if((0,h.hx)(r))return(0,h.Vp)(a||n);const o=r.data.sharing_web_collectionsSharing_dev||r.data.sharing_web_collectionsSharing_internal||r.data.sharing_web_collectionsSharing?a||n||i:a||n;return(0,h.Vp)(o)})))}};F=(0,s.__decorate)([(0,u.e)(D._),(0,s.__metadata)("design:paramtypes",[d.w,T])],F);var O=r(60399),N=r(63663),k=r(73404),L=r(31609),M=r(63877),V=r(83168),G=r(10370),q=r(14664),j=r(78098),K=r(75002),W=r(62051);let B=class{constructor(e,t,r,s,a,n){this.serverApiClient=e,this.sharingCrypto=t,this.sharingDecryption=r,this.pendingCollectionsStore=s,this.sharingSync=a,this.currentUserGetter=n}async execute(e){const{body:{collectionId:t}}=e,r=(await this.pendingCollectionsStore.getState()).pendingCollections.find((({uuid:e})=>e===t));if(!r)throw new Error("Pending Collection not found");const s=await this.sharingDecryption.decryptCollectionKey(r,M.qb.Pending);if(!s)throw new Error("Unable to decrypt Collection Key for pending collection");const a=await this.currentUserGetter.getCurrentUserWithKeys(),n=await this.sharingCrypto.createAcceptSignature((0,V.B)(a.privateKey),t,s),i=await(0,O.z)(this.serverApiClient.v1.sharingUserdevice.acceptCollection({collectionUUID:t,revision:r.revision,acceptSignature:(0,G.s)(n)}));return(0,h.hx)(i)?(0,h.Rn)(new L.nu):(await this.sharingSync.scheduleSync(),(0,h.Vp)(void 0))}};B=(0,s.__decorate)([(0,N.W)(L.cD),(0,s.__metadata)("design:paramtypes",[k.l,q.O,j.c,T,K.D,W.a])],B);var H=r(68096);let z=class{constructor(e,t){this.serverApiClient=e,this.pendingCollectionsStore=t}async execute(e){const{body:{collectionId:t}}=e,r=(await this.pendingCollectionsStore.getState()).pendingCollections.find((({uuid:e})=>e===t));if(!r)throw new Error("Pending Collection not found");const s=await(0,O.z)(this.serverApiClient.v1.sharingUserdevice.refuseCollection({collectionUUID:t,revision:r.revision}));return(0,h.hx)(s)?(0,h.Rn)(new H.R$):(0,h.Vp)(void 0)}};z=(0,s.__decorate)([(0,N.W)(H.UC),(0,s.__metadata)("design:paramtypes",[k.l,T])],z);var $=r(82567),Q=r(55677),Y=r(92233),X=r(64718);const J=e=>{if(!e||"object"!=typeof e)return!1;const t=e;return r=t.items,!!Array.isArray(r)&&(0===r.length||r.every((e=>{const t=e;return"string"==typeof t.content&&"string"==typeof t.itemId&&"number"==typeof t.timestamp})))&&(e=>!!Array.isArray(e)&&(0===e.length||e.every((e=>{const t=e;return"string"==typeof t.groupId&&"string"==typeof t.type&&"number"==typeof t.revision}))))(t.itemGroups)&&(e=>!!Array.isArray(e)&&(0===e.length||e.every((e=>{const t=e;return"string"==typeof t.groupId&&"string"==typeof t.name&&"string"==typeof t.publicKey&&"string"==typeof t.privateKey&&"number"==typeof t.revision}))))(t.userGroups);var r};let Z=class{constructor(e,t){this.client=e,this.serverApiClient=t}async execute(e){const{body:{itemGroupId:t}}=e,{queries:{carbonState:r},commands:{carbonLegacyLeeloo:s}}=this.client.getClient(m.carbonLegacyApi),{queries:{getInvites:a}}=this.client.getClient(n.t),i=a().pipe((0,p.Qn)((e=>{const r=e.pendingItemGroups.find((e=>e.itemGroupId===t));if(!r)throw new Error(`Pending item group not found for id ${t}`);if(r.items.length<1)throw new Error(`Missing item content for pending item group with id ${t}`);return r.items[0]}))),o=await(0,O.z)(i);if((0,h.hx)(o))throw new Error(`Failed to retrieve item content for pending item group with id ${t}`);const c=o.data,u=r({path:"userSession.sharingData"}).pipe((0,p.Qn)((e=>{if(!J(e))throw new Error("Bad sharingData");return e}))).pipe((0,p.lk)((e=>{const r=e.itemGroups.find((({groupId:e})=>e===t));return(0,h.Vp)(r)}))),d=await(0,O.z)(u);if((0,h.hx)(d))throw new Error(`Failed to retrieve item group for pending item group with id ${t}`);if(void 0===d.data)return(0,h.Rn)(new Q.fL);const l=r({path:"userSession.localSettings.premiumStatus"}).pipe((0,p.Qn)((e=>(e=>(e.spaces??[]).filter((e=>"accepted"===e.status)))(e)[0]))),y=await(0,O.z)(l),{userFeatureFlips:g}=this.client.getClient(U.cV).queries,v=await(0,O.z)(g());if((0,h.hx)(v))throw new Error("Failed to retrieve user features");const f=v.data.audit_logs_sharing&&v.data.send_activity_log&&(0,h.d6)(y)?((e,t)=>{const r=(!!t?.SpaceId&&e?.info.collectSensitiveDataAuditLogsEnabled)??!1,s=t&&(0,m.isCredential)(t),a=s?new X.Y(t.Url).getRootDomain():"";return r?{captureLog:r,domain:s?a||"":void 0,type:s?"AUTHENTIFIANT":"SECURENOTE"}:void 0})(y.data,c):void 0;return(0,O.z)(this.serverApiClient.v1.sharingUserdevice.refuseItemGroup({groupId:d.data.groupId,revision:d.data.revision,itemsForEmailing:[(w=c,{type:(0,m.isCredential)(w)?"password":"note",name:w.Title})],auditLogDetails:f}).pipe((0,p.DZ)((e=>{if("BusinessError"===e.tag)return(0,Q.fr)(e.code);throw new Error(e.message)})),(0,p.lk)((e=>{if(void 0===e.data.itemGroupErrors||0===e.data.itemGroupErrors.length)return(0,h.Vp)(void 0);if(e.data.itemGroupErrors.length>0)throw new Error(`Error for item group ${e.data.itemGroupErrors[0].groupId}: ${e.data.itemGroupErrors[0].message}`);throw new Error("Unknown server error")})),(0,$.b)((async e=>{(0,h.d6)(e)&&await s({name:"sessionForceSync",arg:[{trigger:Y.Trigger.Sharing}]})}))));var w}};Z=(0,s.__decorate)([(0,N.W)(Q.gm),(0,s.__metadata)("design:paramtypes",[d.w,k.l])],Z);var ee=r(84009);let te=class{constructor(e,t){this.client=e,this.serverApiClient=t}async execute(e){const{body:{userGroupId:t}}=e,{queries:{carbonState:r},commands:{carbonLegacyLeeloo:s}}=this.client.getClient(m.carbonLegacyApi),a=r({path:"userSession.sharingData"}).pipe((0,p.Qn)((e=>{if(!J(e))throw new Error("Bad sharingData");return e}))).pipe((0,p.Qn)((e=>{const r=e.userGroups.find((({groupId:e})=>e===t));if(!r)throw new Error("Could not find userGroup");return r}))),n=await(0,O.z)(a);if((0,h.hx)(n))throw new Error(`Failed to retrieve user group for pending user group with id ${t}`);return await(0,O.z)(this.serverApiClient.v1.sharingUserdevice.refuseUserGroup({groupId:n.data.groupId,revision:n.data.revision,provisioningMethod:M.ET.USER}).pipe((0,p.DZ)((e=>{if("BusinessError"===e.tag)return(0,ee.cz)(e.code);throw new Error(e.message)})),(0,p.lk)((e=>{if(void 0===e.data.userGroupErrors||0===e.data.userGroupErrors.length)return(0,h.Vp)(void 0);if(e.data.userGroupErrors.length>0)throw new Error(`Error for user group ${e.data.userGroupErrors[0].groupId}: ${e.data.userGroupErrors[0].message}`);throw new Error("Unknown server error")})),(0,$.b)((async e=>{(0,h.d6)(e)&&await s({name:"sessionForceSync",arg:[{trigger:Y.Trigger.Sharing}]})}))))}};te=(0,s.__decorate)([(0,N.W)(ee.Fo),(0,s.__metadata)("design:paramtypes",[d.w,k.l])],te);var re=r(79517);let se=class{constructor(e,t){this.store=e,this.context=t}execute({body:e}){const t=e,r=this.getCurrentUserLogin(),s=t.filter((e=>(e.users||[]).some((e=>e.login===r&&e.status===b.qb.Pending))));return this.store.set({pendingCollections:s}),Promise.resolve((0,h.Vp)(void 0))}getCurrentUserLogin(){return this.context.get(c.l.UserName)}};se=(0,s.__decorate)([(0,N.W)(re.r),(0,s.__metadata)("design:paramtypes",[T,c.f])],se);var ae=r(54103),ne=r(20965),ie=r(36458),oe=r(9697),ce=r(98726),ue=r(21656),de=r(38602);let le=class{};le=(0,s.__decorate)([(0,a.Y)({api:n.t,stores:[T,ie.S],handlers:{commands:{acceptCollectionInvite:B,refuseCollectionInvite:z,refuseItemGroupInvite:Z,refuseUserGroupInvite:te,updatePendingCollections:se},events:{},queries:{getInvites:R,getPendingCollections:P,hasInvites:F}},imports:[i.n,o.D],requiredFeatureFlips:["audit_logs_sharing","sharing_web_collectionsSharing_dev","sharing_web_collectionsSharing_internal","sharing_web_collectionsSharing","send_activity_log"],providers:[ae.k,q.O,j.c,K.D,ne.EH,oe.o,W.a,ce.h,ue.W,de.B]})],le)},44862:(e,t,r)=>{"use strict";r.d(t,{F:()=>P});var s=r(88802),a=r(99634),n=r(48958),i=r(6447),o=r(20754),c=r(31485),u=r(73404),d=r(48844);let l=class{constructor(e){this.serverApiClient=e}execute(){return this.serverApiClient.v1.sharingUserdevice.getTeamLogins().pipe((0,d.Qn)((e=>({userLogins:e.data.teamLogins}))),(0,d.DZ)((e=>{throw e})))}};l=(0,s.__decorate)([(0,o.e)(c.G),(0,s.__metadata)("design:paramtypes",[u.l])],l);var p=r(54003),h=r(38834);let m=class{constructor(e){this.currentSpaceGetter=e}execute(){return this.currentSpaceGetter.get().pipe((0,d.Qn)((e=>e.isSharingEnabled)))}};m=(0,s.__decorate)([(0,o.e)(p.N),(0,s.__metadata)("design:paramtypes",[h.n])],m);var y=r(53576),g=r(20920),v=r(7165);const f=v.z.object({itemGroups:v.z.array(v.z.object({groupId:v.z.string()}))}),w=e=>f.safeParse(e).success;let S=class{constructor(e){this.carbonLegacyClient=e}execute({body:e}){const{queries:{carbonState:t}}=this.carbonLegacyClient,{itemId:r}=e;return t({path:"userSession.sharingData"}).pipe((0,d.Qn)((e=>{if(!w(e))throw new Error("Incorrect type");const t=e.itemGroups.find((e=>e.items?.some((e=>e.itemId===r))));return{isShared:!!t?.groupId}})))}};S=(0,s.__decorate)([(0,o.e)(g.S),(0,s.__metadata)("design:paramtypes",[y.CarbonLegacyClient])],S);var _=r(87065),b=r(61076),E=r(87279),A=r(4975);var T;!function(e){e.Admin="admin",e.Limited="limited"}(T||(T={}));let C=class{constructor(e){this.carbonLegacyClient=e,this.getUserLogin=()=>{const{queries:{carbonState:e}}=this.carbonLegacyClient;return e({path:"state.userSession.account.login"}).pipe((0,_.U)((e=>{if((0,E.d6)(e)&&"string"==typeof e.data)return e.data;throw new Error("No active login")})))}}execute({body:e}){const{queries:{carbonState:t}}=this.carbonLegacyClient,{itemId:r}=e;return t({path:"userSession.sharingData"}).pipe((0,b.V)(this.getUserLogin()),(0,_.U)((([e,t])=>{if(!(0,E.d6)(e)||!w(e.data))throw new Error("Incorrect type");const s=((e,t,r)=>{const{collections:s,itemGroups:a}=e,n=e.userGroups.filter((e=>e.users.some((e=>e.userId===t&&"accepted"===e.status)))),i=new Set(n.map((e=>e.groupId))),o=(c=a)&&c.length>0?c.reduce(((e,t)=>({...e,[t.groupId]:t})),{}):{};var c;const u=s.filter((e=>(e.users??[]).some((e=>e.login===t&&"accepted"===e.status))||(e.userGroups??[]).some((e=>i.has(e.uuid)&&"accepted"===e.status)))),d=new Set(u.map((e=>e.uuid)));return e.itemGroups.some((e=>{const s=e.items?.some((e=>e.itemId===r));if(s){const r=e.users?.some((e=>e.userId===t&&"admin"===e.permission&&"accepted"===e.status)),s=e.groups?.some((e=>i.has(e.groupId)&&"admin"===e.permission&&"accepted"===e.status)),a=o[e.groupId].collections?.some((e=>d.has(e.uuid)&&"admin"===e.permission&&"accepted"===e.status));return!(r||s||a)}return!1}))})(e.data,t,r)?T.Limited:T.Admin;return(0,E.Vp)({permission:s})})))}};C=(0,s.__decorate)([(0,o.e)(A.C),(0,s.__metadata)("design:paramtypes",[y.CarbonLegacyClient])],C);var x=r(54326),R=r(21822);let I=class{constructor(e){this.itemGroupsGetter=e}execute({body:e}){const{itemId:t}=e;return this.itemGroupsGetter.getForItemId(t).pipe((0,d.Qn)((e=>({itemGroupId:e?.groupId,collectionIds:e?.collections?.map((e=>e.uuid))??[]}))))}};I=(0,s.__decorate)([(0,o.e)(x.i),(0,s.__metadata)("design:paramtypes",[R.E])],I);let P=class{};P=(0,s.__decorate)([(0,a.Y)({api:n.X,providers:[h.n,R.E],handlers:{commands:{},events:{},queries:{getSharingTeamLogins:l,sharingEnabled:m,getItemGroupForItem:I,getSharingStatusForItem:S,getPermissionForItem:C}},imports:[i.n]})],P)},40896:(e,t,r)=>{"use strict";r.d(t,{R:()=>a});var s=r(69183);const a=()=>`{${(0,s.Z)().toUpperCase()}}`},77007:(e,t,r)=>{"use strict";r.d(t,{S:()=>s});const s=(0,r(86952).Q)({name:"enclaveSdkApi",commands:{},events:{},queries:{}})},64483:(e,t,r)=>{"use strict";r.d(t,{m:()=>i});var s=r(86952),a=r(15181),n=r(49540);const i=(0,s.Q)({name:"scim",commands:{updateScimConfiguration:a.G},events:{},queries:{scimConfiguration:n.I}})},15181:(e,t,r)=>{"use strict";r.d(t,{G:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},49540:(e,t,r)=>{"use strict";r.d(t,{I:()=>n});var s=r(99059),a=r(25029);class n extends((0,s.k)({scope:a.F.User})){}},95082:(e,t,r)=>{"use strict";r.d(t,{y:()=>g});var s=r(86952),a=r(85355),n=r(26758),i=r(2073),o=r(41689),c=r(39118),u=r(80974),d=r(94603),l=r(50179),p=r(74746),h=r(82249),m=r(66012),y=r(1434);const g=(0,s.Q)({name:"confidentialSSOApi",commands:{CheckDNSValidationCommand:a.o,ClearSettingsCommand:n.h,CreateTeamCommand:i.p,DeleteDomainCommand:o.k,EnableSsoCommand:c.F,InitSsoProvisioningCommand:u.S,LoginUserWithEnclaveSSOCommand:d.B,ProvisionDomainCommand:l.p,TestLoginUserWithEnclaveSSOCommand:p.b,UpdateMetadataCommand:h.o,ValidateMetadataCommand:m.l},events:{},queries:{SsoProvisioningQuery:y._}})},85355:(e,t,r)=>{"use strict";r.d(t,{o:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},26758:(e,t,r)=>{"use strict";r.d(t,{h:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},2073:(e,t,r)=>{"use strict";r.d(t,{p:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},41689:(e,t,r)=>{"use strict";r.d(t,{k:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},39118:(e,t,r)=>{"use strict";r.d(t,{F:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},80974:(e,t,r)=>{"use strict";r.d(t,{S:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},94603:(e,t,r)=>{"use strict";r.d(t,{B:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.Device})){}},50179:(e,t,r)=>{"use strict";r.d(t,{p:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},74746:(e,t,r)=>{"use strict";r.d(t,{b:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},82249:(e,t,r)=>{"use strict";r.d(t,{o:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},66012:(e,t,r)=>{"use strict";r.d(t,{l:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},1434:(e,t,r)=>{"use strict";r.d(t,{_:()=>n});var s=r(99059),a=r(25029);class n extends((0,s.k)({scope:a.F.User})){}},36577:(e,t,r)=>{"use strict";r.d(t,{$m:()=>o,Ep:()=>i,N6:()=>n,xp:()=>a});const s=["local","staging","prod"];function a(e){return s.includes(e)}class n{constructor(e,t,r){this.cloudflareHeaders=e,this.enclaveUrl=t,this.environment=r}}const i=e=>"local"===e?"MIICqzCCAjKgAwIBAgIUGdKnU0kGWeXtXL7BK1VpIbnjXZkwCgYIKoZIzj0EAwMwgYQxCzAJBgNVBAYTAkZSMQ8wDQYDVQQIDAZGcmFuY2UxDjAMBgNVBAcMBVBhcmlzMQswCQYDVQQKDAJETDELMAkGA1UECwwCREwxFjAUBgNVBAMMDU5pdHJvIFRlc3QgQ0ExIjAgBgkqhkiG9w0BCQEWE3NlcnZlckBkYXNobGFuZS5jb20wHhcNMjIwNDI3MTI0NTQ5WhcNNDIwNDIyMTI0NTQ5WjCBhDELMAkGA1UEBhMCRlIxDzANBgNVBAgMBkZyYW5jZTEOMAwGA1UEBwwFUGFyaXMxCzAJBgNVBAoMAkRMMQswCQYDVQQLDAJETDEWMBQGA1UEAwwNTml0cm8gVGVzdCBDQTEiMCAGCSqGSIb3DQEJARYTc2VydmVyQGRhc2hsYW5lLmNvbTB2MBAGByqGSM49AgEGBSuBBAAiA2IABLeu4raurW6XA9/c13rzPwzbk1aYAR/fPj49YoaZI+K0PFfo75rKUr0m7LawW/jpwkAqWad44SXxj2fF+REDz4ii8tUjVl8Ijp1ohrQEAvDZLcxS98bQV+NFmoyx6QxbQKNjMGEwHQYDVR0OBBYEFM5p3QEkzjDGWRntWRdqC0aWiGiaMB8GA1UdIwQYMBaAFM5p3QEkzjDGWRntWRdqC0aWiGiaMA8GA1UdEwEB/wQFMAMBAf8wDgYDVR0PAQH/BAQDAgGGMAoGCCqGSM49BAMDA2cAMGQCMGdird9+5r9vw9vt2x4q86nMJwu2eGXbcOE6sVRSQ92nWYHk2VX2NZix1tBX3nMGiQIwRHALNGgnkUofNBOoxZ/Pntk14Djv5Kt3/fKd6NWFRhyFZ97jho4c+slS7u9LrttE":"MIICETCCAZagAwIBAgIRAPkxdWgbkK/hHUbMtOTn+FYwCgYIKoZIzj0EAwMwSTELMAkGA1UEBhMCVVMxDzANBgNVBAoMBkFtYXpvbjEMMAoGA1UECwwDQVdTMRswGQYDVQQDDBJhd3Mubml0cm8tZW5jbGF2ZXMwHhcNMTkxMDI4MTMyODA1WhcNNDkxMDI4MTQyODA1WjBJMQswCQYDVQQGEwJVUzEPMA0GA1UECgwGQW1hem9uMQwwCgYDVQQLDANBV1MxGzAZBgNVBAMMEmF3cy5uaXRyby1lbmNsYXZlczB2MBAGByqGSM49AgEGBSuBBAAiA2IABPwCVOumCMHzaHDimtqQvkY4MpJzbolL//Zy2YlES1BR5TSksfbb48C8WBoyt7F2Bw7eEtaaP+ohG2bnUs990d0JX28TcPQXCEPZ3BABIeTPYwEoCWZEh8l5YoQwTcU/9KNCMEAwDwYDVR0TAQH/BAUwAwEB/zAdBgNVHQ4EFgQUkCW1DdkFR+eWw5b6cp3PmanfS5YwDgYDVR0PAQH/BAQDAgGGMAoGCCqGSM49BAMDA2kAMGYCMQCjfy+Rocm9Xue4YnwWmNJVA44fA0P5W2OpYow9OYCVRaEevL8uO1XYru5xtMPWrfMCMQCi85sWBbJwKKXdS6BptQFuZbT73o/gBh1qUxl/nNr12UO8Yfwr6wPLb+6NIwLz3/Y=",o=e=>"local"===e?{0:"9e33eca6497ec3b68ae13735cd28b1a9be1235d3440f10121327150495de4a4f854eb902a62991b366757f3d87ce57e4"}:"staging"===e?{3:"90528150e0f0537fa9e96b067137f6494d525f2fcfd15b478ce28ab2cfaf38dd4e24ad73f9d9d6f238a7f39f2d1956b7"}:{3:"dfb6428f132530b8c021bea8cbdba2c87c96308ba7e81c7aff0655ec71228122a9297fd31fe5db7927a7322e396e4c16",8:"4dbb92401207e019e132d86677857081d8e4d21f946f3561b264b7389c6982d3a86bcf9560cef4a2327eac5c5c6ab820"}},57318:(e,t,r)=>{"use strict";r.d(t,{E:()=>d});var s=r(88802),a=r(99634),n=r(25504),i=r(77007),o=r(15203),c=r(36577),u=r(44985);let d=class{};d=(0,s.__decorate)([(0,a.Y)({api:i.S,imports:[n.X,u.i],providers:[o.d],exports:[o.d],configurations:{enclaveApiSettings:{token:c.N6}},handlers:{commands:{},events:{},queries:{}}})],d)},15203:(e,t,r)=>{"use strict";r.d(t,{d:()=>O});var s=r(88802),a=r(57924),n=r(73774),i=r(58895),o=r(36577),c=r(56695),u=r(839);var d=r(60399),l=r(87279),p=r(7165);const h=e=>{const t=e.match(/[\da-f]{2}/gi);return t?new Uint8Array(t.map((e=>parseInt(e,16)))).buffer:(new Uint8Array).buffer},m=p.z.object({data:p.z.object({attestation:p.z.string(),clientIdentifier:p.z.string()}),requestId:p.z.string()});class y{decode(e){const t=m.safeParse(e);if(!t.success)throw new Error("Invalid response format");return{attestation:h(t.data.data.attestation),clientIdentifier:t.data.data.clientIdentifier}}}const g=async(e,t)=>{const{headers:r,httpClient:s,publicKey:a}=t,n=await(async e=>(await c.ready,{clientPublicKey:c.to_hex(e)}))(a),i=await(0,d.z)(s.post(e,n,{observe:"body",responseType:"json",responseBodyDecoder:new y,withCredentials:!0,headers:r}));if((0,l.hx)(i))throw new Error("string"==typeof i.error?i.error:"HTTP Error");return i.data};var v=r(73155);const f=p.z.object({requestId:p.z.string(),errors:p.z.array(p.z.object({status:p.z.string(),code:p.z.string(),message:p.z.string()}))});class w{assertData(e){if(!e)throw new Error("toDecode expected to be truthy");if("[object Object]"!=`${e}`||Array.isArray(e))throw new Error("toDecode expected to be object");if(!Object.prototype.hasOwnProperty.call(e,"data"))throw new Error('toDecode expected to contain a "data" property');const t=e;if("string"!=typeof t.data)throw new Error("toDecode.data expected to be type string but was "+typeof t.data)}decode(e){return this.assertData(e),e.data}}var S=r(76465);function _(e){return(0,S.Jx)(new Uint8Array(e))}const b=e=>{const t=_(new Uint8Array(e)),r=(s=t,Array.isArray(s)?s:s.value);var s;const[a,,n,i]=r;if(!a)throw new Error("parseSignedMessage: no protected header field");if(!n)throw new Error("parseSignedMessage: no payload field");if(!i)throw new Error("parseSignedMessage: no signature field");return{payload:new Uint8Array(n).buffer,protectedHeaders:new Uint8Array(a).buffer,signature:new Uint8Array(i).buffer}};var E=r(89685),A=r(66122);const T=p.z.object({module_id:p.z.string(),timestamp:p.z.bigint(),digest:p.z.string(),pcrs:p.z.record(p.z.string(),p.z.instanceof(Uint8Array)),certificate:p.z.instanceof(Uint8Array),cabundle:p.z.array(p.z.instanceof(Uint8Array)),user_data:p.z.instanceof(Uint8Array),nonce:p.z.instanceof(Uint8Array).nullable()}),C=p.z.object({header:p.z.string(),publicKey:p.z.string()});var x=r(71833);const R=async(e,t,r,s)=>{const a=x.KBB.fromBER(s),n=await a.getPublicKey(),i=["Signature1",t,new ArrayBuffer(0),r],o=(c=i,(0,S.cv)(c));var c;return await crypto.subtle.verify({name:"ECDSA",hash:"SHA-384"},n,e,o)};var I=r(96303);const P=e=>(0,I.k)((e=>new Uint8Array(e).buffer)(e)),D=async e=>{const{attestation:t,rootCertBER:r,expectedPCRs:s}=e,{protectedHeaders:a,payload:n,signature:i}=b(t),o=(e=>{const t=_(e),r=T.safeParse(t);if(!r.success)throw new Error("failed to parse attestation document");const s=r.data,a=(0,E.v)(s.user_data),n=JSON.parse(a),i=C.safeParse(n);if(!i.success)throw new Error("failed to parse server crypto info");const o=i.data;return{moduleId:s.module_id,timestamp:s.timestamp,digest:s.digest,pcrs:s.pcrs,certificate:new Uint8Array(s.certificate).buffer,cabundle:(c=s.cabundle,c.map((e=>new Uint8Array(e).buffer))),serverHeader:(0,A.R)(o.header),serverPublicKey:(0,A.R)(o.publicKey),nonce:null!==s.nonce?new Uint8Array(s.nonce).buffer:null};var c})(n),c=await(async(e,t,r)=>{const s=x.KBB.fromBER(e),a=t.map((e=>x.KBB.fromBER(e)));a.push(s);const n=[x.KBB.fromBER((0,A.R)(r))],i=new x.DMg({trustedCerts:n,certs:a});return(await i.verify()).result})(o.certificate,o.cabundle,r);if(!c)throw new Error("Invalid cert chain!");if(!await R(i,a,n,o.certificate))throw new Error("Invalid signature!");return((e,t)=>{for(const[r,s]of Object.entries(t))if(s!==P(e[Number(r)]))throw new Error("PCRs did not match")})(o.pcrs,s),{serverPublicKey:o.serverPublicKey,serverHeader:o.serverHeader}};var U;!function(e){e.CLIENT_HELLO="api/tunnel/ClientHello",e.TERMINATE_HELLO="api/tunnel/TerminateHello"}(U||(U={}));const F=async(e,t)=>{await c.ready;const{enclaveApiSettings:{cloudflareHeaders:r,enclaveUrl:s},rootCertBER:a,expectedPCRs:n,httpClient:i,platformInfo:o,data:p}=t,h={};h["dashlane-client-agent"]=JSON.stringify({platform:o.platformName,osversion:o.osVersion,version:o.appVersion}),r.accessKey&&r.secretKey&&(h["CF-Access-Client-Id"]=r.accessKey,h["CF-Access-Client-Secret"]=r.secretKey);const m=c.crypto_kx_keypair(),{clientHelloUrl:y,terminateHelloUrl:S,secureContentUrl:_}=((e,t)=>({clientHelloUrl:`${e}${U.CLIENT_HELLO}`,terminateHelloUrl:`${e}${U.TERMINATE_HELLO}`,secureContentUrl:`${e}${t}`}))(s,e),b=await g(y,{headers:h,httpClient:i,publicKey:m.publicKey}),{serverPublicKey:E,serverHeader:A}=await D({attestation:b.attestation,rootCertBER:a,expectedPCRs:n});var T;T={url:s,name:"ClientIdentifier",value:b.clientIdentifier,expirationDate:(new Date).getTime()+15e5,sameSite:"strict",secure:!0},new Promise(((e,t)=>{(0,u.qX)(["cookies"])?(0,u.Ez)("cookies.set")?chrome.cookies.set(T,(r=>{if(chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError",r=new Error(`cookies/set: ${e}`);t(r)}else e(r)})):t(new Error("No cookies.set support")):t(new Error("No cookies.set support, permission is missing"))}));const C=await(async(e,t)=>{const{headers:r,clientKeyPair:s,httpClient:a,serverPublicKey:n}=t;await c.ready;const i=c.crypto_kx_client_session_keys(s.publicKey,s.privateKey,new Uint8Array(n)),o=c.crypto_secretstream_xchacha20poly1305_init_push(i.sharedRx),u=o.state,p=o.header,h={clientHeader:c.to_hex(p)},m=await(0,d.z)(a.post(e,h,{observe:"response",responseType:"json",withCredentials:!0,headers:r}));if((0,l.hx)(m))throw new Error("HTTP error");return{clientStateOut:u,sessionKeys:i}})(S,{headers:h,httpClient:i,clientKeyPair:m,serverPublicKey:E});return await(async(e,t)=>{const{clientStateOut:r,serverHeader:s,sessionKeys:a,headers:n,httpClient:i}=t;await c.ready;const o=c.crypto_secretstream_xchacha20poly1305_push(r,c.from_string(t.data),null,c.crypto_secretstream_xchacha20poly1305_TAG_MESSAGE),u={data:c.to_hex(o)},p=await(0,d.z)(i.post(e,u,{observe:"body",responseType:"json",responseBodyDecoder:new w,withCredentials:!0,headers:n}));if((0,l.hx)(p)){if(p.error instanceof v.R){const e=await JSON.parse(await p.error.response.text()),t=f.safeParse(e);if(t.success){const e=t.data.errors[0];throw new Error(e.code)}}throw new Error("HTTP error")}const h=c.crypto_secretstream_xchacha20poly1305_init_pull(new Uint8Array(s),a.sharedTx),m=c.crypto_secretstream_xchacha20poly1305_pull(h,c.from_hex(p.data)).message;return{decryptedResponse:c.to_string(m)}})(_,{data:p,headers:h,httpClient:i,clientStateOut:C.clientStateOut,sessionKeys:C.sessionKeys,serverHeader:A})};let O=class{constructor(e,t,r){this.platformInfoService=e,this.httpClient=t,this.enclaveApiSettings=r}async callEnclaveEndpoint(e){const{body:t,endpoint:r,responseSchema:s}=e,a=JSON.stringify(t),n=await this.platformInfoService.getPlatformInfo(),i=(0,o.Ep)(this.enclaveApiSettings.environment),c=(0,o.$m)(this.enclaveApiSettings.environment),{decryptedResponse:u}=await F(r,{data:a,httpClient:this.httpClient,enclaveApiSettings:this.enclaveApiSettings,rootCertBER:i,expectedPCRs:c,platformInfo:n}),d=s.safeParse(JSON.parse(u));if(d.success)return d.data;throw new Error("Enclave response parsing failed")}};O=(0,s.__decorate)([(0,a.GS)(),(0,s.__metadata)("design:paramtypes",[i.t,n.e,o.N6])],O)},50482:(e,t,r)=>{"use strict";r.d(t,{i:()=>h});var s=r(88802),a=r(99634),n=r(64483),i=r(63663),o=r(87279),c=r(15181);let u=class{async execute({body:e}){return(0,o.Rn)({tag:"not-implemented"})}};u=(0,s.__decorate)([(0,i.W)(c.G)],u);var d=r(20754),l=r(49540);let p=class{execute(){throw new Error("not-implemented")}};p=(0,s.__decorate)([(0,d.e)(l.I)],p);let h=class{};h=(0,s.__decorate)([(0,a.Y)({api:n.m,handlers:{commands:{updateScimConfiguration:u},events:{},queries:{scimConfiguration:p}}})],h)},94563:(e,t,r)=>{"use strict";r.d(t,{D:()=>ze});var s=r(88802),a=r(99634),n=r(25504),i=r(44985),o=r(95082);class c{}var u,d=r(63663),l=r(87279),p=r(94603),h=r(7165);!function(e){e.AUTH_CONFIRM_LOGIN="api/authentication/ConfirmLogin2",e.AUTH_REQUEST_LOGIN="api/authentication/RequestLogin2",e.AUTH_REQUEST_TEST_LOGIN="api/authentication/RequestTestLogin2",e.AUTH_CONFIRM_TEST_LOGIN="api/authentication/ConfirmTestLogin2",e.DOMAINS_CREATE_DOMAIN="api/domains/CreateDomain",e.DOMAINS_DELETE_DOMAIN="api/domains/DeleteDomain2",e.DOMAINS_UPDATE_DOMAIN="api/domains/UpdateDomain2",e.DOMAINS_CHECK_DNS_VALIDATION="api/domains/CheckDNSValidation2",e.TEAMS_CREATE_TEAM="api/teams/CreateTeam",e.TEAMS_GET_TEAM="api/teams/GetTeam",e.TEAMS_DELETE_TEAM="api/teams/DeleteTeam",e.IDPS_CREATE_IDP="api/idps/CreateIdp",e.IDPS_UPDATE_IDP="api/idps/UpdateIdp",e.IDPS_DELETE_IDP="api/idps/DeleteIdp",e.TEAMS_GET_TEAM_STATUS="api/teams/GetTeamStatus"}(u||(u={}));const m=h.z.object({idpAuthorizeUrl:h.z.string(),teamUuid:h.z.string(),spCallbackUrl:h.z.string(),domainName:h.z.string()}),y=h.z.object({exists:h.z.boolean(),ssoToken:h.z.string(),userServiceProviderKey:h.z.string(),currentAuthenticationMethods:h.z.string().array(),expectedAuthenticationMethods:h.z.string().array()});var g=r(53576),v=r(15203);let f=class{constructor(e,t,r){this.enclaveService=e,this.enclaveLoginContext=t,this.carbonLegacyClient=r}async execute(e){const t=e.body.userEmailAddress,r=t.slice(t.indexOf("@")+1);try{const s=await(async(e,t)=>await e.callEnclaveEndpoint({endpoint:u.AUTH_REQUEST_LOGIN,body:t,responseSchema:m}))(this.enclaveService,{login:t}),{idpAuthorizeUrl:a,teamUuid:n}=s,{samlToken:i}=await this.enclaveLoginContext.getSamlFromLogin(a,!0),o=btoa(atob(i).replace(/\n/g,"")),c={...await(async(e,t)=>await e.callEnclaveEndpoint({endpoint:u.AUTH_CONFIRM_LOGIN,body:t,responseSchema:y}))(this.enclaveService,{domainName:r,samlResponse:o,teamUuid:n}),login:e.body.userEmailAddress};return await this.enclaveLoginContext.redirectUserIntoLoginFlow(c),(0,l.Vp)(void 0)}catch{return(0,l.Rn)({tag:"Failure",errorMessage:"Failed to login"})}}};f=(0,s.__decorate)([(0,d.W)(p.B),(0,s.__metadata)("design:paramtypes",[v.d,c,g.CarbonLegacyClient])],f);var w=r(21242);const S=h.z.object({idpUuid:h.z.string().uuid(),certificates:h.z.array(h.z.string()),entrypoint:h.z.string(),creationDateUnix:h.z.number(),updateDateUnix:h.z.number()}),_=h.z.enum(["valid","pending","expired","invalid"]),b=h.z.enum(["tokenNotFound","invalidToken"]),E=h.z.object({status:_.nullable(),verificationToken:h.z.string(),lastCheckDateUnix:h.z.number(),pendingReason:b.nullable(),expiryDateUnix:h.z.number()}),A=h.z.object({creationDateUnix:h.z.number(),dnsCheckStatus:E,domainName:h.z.string(),idpUuid:h.z.ostring(),updateDateUnix:h.z.number()}),T=h.z.enum(["NitroComplete","NitroIncomplete","SelfHostedComplete","SelfHostedIncomplete","SsoConnectorIncomplete","SsoConnectorComplete","SsoConnectorToSelfHostedMigration","None","Unknown"]),C=h.z.object({subdomainValue:h.z.string().nullable(),txtValue:h.z.string().nullable(),verificationStatus:_.nullable(),tokenFound:h.z.string().nullable(),pendingReason:b.nullable()}),x=h.z.array(h.z.object({domainName:h.z.string().url(),verificationStatus:_,idpUuid:h.z.string().optional().nullable()})),R=h.z.object({global:h.z.object({adminProvisioningKey:h.z.string().nullable(),isTeamProvisionedInNitro:h.z.boolean().nullable(),inferredSsoState:T,teamUuid:h.z.string().nullable(),ssoCapable:h.z.boolean().nullable()}),idpApplication:h.z.object({entityId:h.z.string().nullable(),acsUrl:h.z.string().nullable(),signOnUrl:h.z.string().nullable()}),idpMetadata:h.z.object({metadataValue:h.z.string().nullable(),idpUuid:h.z.string().nullable()}),domainSetup:x,domainVerificationInfo:h.z.record(h.z.string().url(),C),enableSSO:h.z.object({ssoEnabled:h.z.boolean().nullable()})});var I=r(50179),P=r(64718);const D=h.z.object({error:h.z.string()}),U=h.z.object({data:h.z.object({samlIdpEntryPoint:h.z.string(),samlIdpCertificate:h.z.string()})}),F=async(e,t)=>{if(null===t)return{samlIdpEntryPoint:"",samlIdpCertificate:""};let r="";if(new P.Y(t).isUrlValid()){const e=await fetch(t);r=await e.text()}else r=t;const s=await e({name:"parseMetadataFields",args:[{ssoIdpMetadata:r}]});if((0,l.d6)(s))return U.parse(s.data.carbonResult).data;throw new Error("failed to parse metadata, please validate first.")};var O=r(57924),N=r(25029),k=r(95681),L=r(23347);const M=e=>R.safeParse(e).success,V={global:{adminProvisioningKey:null,teamUuid:null,isTeamProvisionedInNitro:null,inferredSsoState:T.enum.Unknown,ssoCapable:null},idpApplication:{entityId:null,acsUrl:null,signOnUrl:null},idpMetadata:{metadataValue:null,idpUuid:null},domainSetup:[],domainVerificationInfo:{},enableSSO:{ssoEnabled:null}};class G extends((0,k.Q)({persist:!1,capacity:L.Y._010KB,initialValue:V,scope:N.F.User,storeName:"nitro-sso-provisioning-state",storeTypeGuard:M})){}const q="_dashlane-challenge";let j=class{constructor(e){this.store=e}async reset(){await this.store.init({global:{adminProvisioningKey:null,teamUuid:null,isTeamProvisionedInNitro:null,inferredSsoState:T.enum.Unknown,ssoCapable:null},idpApplication:{entityId:null,acsUrl:null,signOnUrl:null},idpMetadata:{metadataValue:null,idpUuid:null},domainSetup:[],domainVerificationInfo:{},enableSSO:{ssoEnabled:null}})}async update(e,t){const r=await this.store.getState(),s=((e,t)=>({...e,...t}))(r,{[t]:{...r[t],...e}});await this.store.set(s)}set(e){return this.store.set(e)}};j=(0,s.__decorate)([(0,O.GS)(),(0,s.__metadata)("design:paramtypes",[G])],j);const K=h.z.object({dnsVerificationToken:h.z.string()});let W=class{constructor(e,t,r,s,a){this.enclaveService=e,this.ssoProvisioningStoreUpdater=t,this.ssoProvisioningStore=r,this.featureFlipsClient=s,this.carbonLegacyClient=a}async execute({body:e}){const t=await this.ssoProvisioningStore.getState();if(!t.global.teamUuid)return(0,l.Rn)({tag:"Missing team UUID. Are you logged in?"});if(!t.global.adminProvisioningKey)return(0,l.Rn)({tag:"Missing provisioning key. Has the team been provisioned in the enclave environment?"});if(!e.domainName)return(0,l.Rn)({tag:"Domain name was not provided."});const r=t.idpMetadata.metadataValue?await F(this.carbonLegacyClient.commands.carbon,t.idpMetadata.metadataValue):null,s={domainName:e.domainName,adminProvisioningKey:t.global.adminProvisioningKey,idpMetadata:r?{certificate:r.samlIdpCertificate,entrypoint:r.samlIdpEntryPoint}:void 0,teamUuid:t.global.teamUuid};try{if(new Set(t.domainSetup.map((e=>e.domainName))).has(e.domainName))return(0,l.Rn)({tag:"Domain already provisioned"});const{dnsVerificationToken:r}=await(async(e,t)=>await e.callEnclaveEndpoint({body:t,endpoint:u.DOMAINS_CREATE_DOMAIN,responseSchema:K}))(this.enclaveService,s),a=[...t.domainSetup,{idpUuid:t.idpMetadata.idpUuid,domainName:e.domainName,verificationStatus:_.enum.pending}];await this.ssoProvisioningStoreUpdater.set({...t,domainSetup:a});const n={...t.domainVerificationInfo,[e.domainName]:{txtValue:r,verificationStatus:_.enum.pending,subdomainValue:q,pendingReason:null,tokenFound:null}};return await this.ssoProvisioningStoreUpdater.update(n,"domainVerificationInfo"),(0,l.Vp)(void 0)}catch(e){return Promise.resolve((0,l.Rn)({tag:e instanceof Error?e.message:"Unable to provision domain"}))}}};W=(0,s.__decorate)([(0,d.W)(I.p),(0,s.__metadata)("design:paramtypes",[v.d,j,G,w.P,g.CarbonLegacyClient])],W);var B=r(2073);const H=h.z.object({data:h.z.object({deviceAccessKey:h.z.string(),deviceSecretKey:h.z.string()})}),z=h.z.object({data:h.z.object({devicePrivateKey:h.z.string(),devicePublicKey:h.z.string()})}),$=async(e,t)=>{await e({name:"updateTeamSettings",args:[{...t}]})},Q=h.z.object({adminProvisioningKey:h.z.string()}),Y=async(e,t)=>{const r=await e({name:"deactivateTeamDevice",args:[{teamDeviceAccessKey:t}]});return!(0,l.hx)(r)};var X=r(36577);let J=class{constructor(e,t,r,s,a){this.enclaveService=e,this.enclaveApiSettings=t,this.ssoProvisioningStoreUpdater=r,this.ssoProvisioningStore=s,this.carbonClient=a}async execute(){const{carbon:e}=this.carbonClient.commands,t=(await this.ssoProvisioningStore.getState()).global.teamUuid;if(!t)throw new Error("Team UUID not available. Are you logged in?");const{deviceAccessKey:r,devicePublicKey:s,deviceSecretKey:a,devicePrivateKey:n}=await(async e=>{const t=await e({name:"registerTeamDevice",args:[{platform:"nitro_encryption_service",deviceName:"Nitro Encryption Service"}]});if("success"!==t.tag)throw new Error("Failed to register a team device during team provisioning");const{data:{deviceAccessKey:r,deviceSecretKey:s}}=H.parse(t.data.carbonResult),a=await e({name:"registerTeamDeviceAccount",args:[{deviceAccessKey:r,shouldGenerateDeviceKeyPair:!0}]});if("success"!==a.tag)throw new Error("Failed to register a team device account during team provisioning");const{data:{devicePrivateKey:n,devicePublicKey:i}}=z.parse(a.data.carbonResult);return{deviceAccessKey:r,deviceSecretKey:s,devicePrivateKey:n,devicePublicKey:i}})(e),i=new URL(this.enclaveApiSettings.enclaveUrl).origin;await $(e,{ssoServiceProviderUrl:i}),await this.ssoProvisioningStoreUpdater.update({inferredSsoState:T.enum.NitroIncomplete},"global");let o=null;try{o=(await(async(e,t)=>await e.callEnclaveEndpoint({endpoint:u.TEAMS_CREATE_TEAM,body:t,responseSchema:Q}))(this.enclaveService,{teamDeviceCredentials:{teamUuid:t,accessKey:r,secretKey:a,sharingPublicKey:s,sharingPrivateKey:n}})).adminProvisioningKey}catch(t){return await $(e,{ssoServiceProviderUrl:null}),await Y(e,r),await this.ssoProvisioningStoreUpdater.update({inferredSsoState:T.enum.None},"global"),(0,l.Rn)({tag:t instanceof Error?t.message:"HTTP Error"})}return o?(await e({name:"persistAdminProvisioningKey",args:[{adminProvisioningKey:o}]}),await this.ssoProvisioningStoreUpdater.update({adminProvisioningKey:o,isTeamProvisionedInNitro:!0},"global"),(0,l.Vp)(void 0)):(0,l.Rn)({tag:"parsed result does not have a provisioning key"})}};J=(0,s.__decorate)([(0,d.W)(B.p),(0,s.__metadata)("design:paramtypes",[v.d,X.N6,j,G,g.CarbonLegacyClient])],J);var Z=r(41689);h.z.object({domainName:h.z.string(),teamUuid:h.z.string(),adminProvisioningKey:h.z.string()});const ee=["DOMAIN_NOT_FOUND","DOMAIN_CONFIGURATION_NOT_FOUND"];let te=class{constructor(e,t,r,s){this.enclaveService=e,this.ssoProvisioningStoreUpdater=t,this.ssoProvisioningStore=r,this.featureFlipsClient=s}async execute({body:e}){const t=await this.ssoProvisioningStore.getState();if(!t.global.teamUuid)return(0,l.Rn)({tag:"Missing team UUID. Are you logged in?"});if(!t.global.adminProvisioningKey)return(0,l.Rn)({tag:"Missing provisioning key. Has the team been provisioned in the enclave environment?"});if(!e.domainName)return(0,l.Rn)({tag:"Missing domain name. Nothing to delete."});const r={domainName:e.domainName,teamUuid:t.global.teamUuid,adminProvisioningKey:t.global.adminProvisioningKey};try{return await(async(e,t)=>{await e.callEnclaveEndpoint({endpoint:u.DOMAINS_DELETE_DOMAIN,body:t,responseSchema:h.z.object({})})})(this.enclaveService,r),await this._applyDeleteDomainOnState(t,e.domainName),(0,l.Vp)(void 0)}catch(r){const s=r instanceof Error?r.message:"Unable to delete domain.";return ee.includes(s)&&await this._applyDeleteDomainOnState(t,e.domainName),Promise.resolve((0,l.Rn)({tag:s}))}}async _applyDeleteDomainOnState(e,t){e.domainSetup=e.domainSetup.filter((e=>e.domainName!==t)),delete e.domainVerificationInfo[t],await this.ssoProvisioningStoreUpdater.set(e)}};te=(0,s.__decorate)([(0,d.W)(Z.k),(0,s.__metadata)("design:paramtypes",[v.d,j,G,w.P])],te);var re=r(58895),se=r(74746);const ae=h.z.object({idpAuthorizeUrl:h.z.string(),spCallbackUrl:h.z.ostring()});let ne=class{constructor(e,t,r,s,a,n){this.enclaveService=e,this.enclaveLoginContext=t,this.enclaveApiSettings=r,this.platformInfoService=s,this.ssoProvisioningStore=a,this.featureFlips=n}async execute(e){const t=await this.ssoProvisioningStore.getState(),{global:{adminProvisioningKey:r,teamUuid:s},idpMetadata:{idpUuid:a}}=t,n=e.body.domainName;if(!(r&&n&&s&&a))return(0,l.Rn)({tag:"error",errorMessage:""});try{const e=await(async(e,t)=>await e.callEnclaveEndpoint({endpoint:u.AUTH_REQUEST_TEST_LOGIN,body:t,responseSchema:ae}))(this.enclaveService,{adminProvisioningKey:r,teamUuid:s,idpUuid:a}),{samlToken:t}=await this.enclaveLoginContext.getSamlFromLogin(e.idpAuthorizeUrl,!1);return await(async(e,t)=>{await e.callEnclaveEndpoint({endpoint:u.AUTH_CONFIRM_TEST_LOGIN,body:t,responseSchema:h.z.object({})})})(this.enclaveService,{domainName:n,samlResponse:t,adminProvisioningKey:r,teamUuid:s}),await this.enclaveLoginContext.cleanupTestLogin(),(0,l.Vp)(void 0)}catch{return(0,l.Rn)({tag:"Failure",errorMessage:"Failed to login"})}}};ne=(0,s.__decorate)([(0,d.W)(se.b),(0,s.__metadata)("design:paramtypes",[v.d,c,X.N6,re.t,G,w.P])],ne);var ie=r(65255),oe=r(80974);const ce=h.z.enum(["sso_connector","encryption_service","nitro_encryption_service","command_line"]),ue=h.z.object({platform:ce,accessKey:h.z.string(),deviceName:h.z.string().nullable(),activated:h.z.boolean(),creationDateUnix:h.z.number(),updateDateUnix:h.z.number()}),de=h.z.object({data:h.z.object({teamDevices:h.z.array(ue)})}),le=async e=>{const t=await e({name:"listTeamDevices",args:[]});if((0,l.hx)(t))throw new Error("Failed to get team devices");const{data:{carbonResult:r}}=t,{data:{teamDevices:s}}=de.parse(r);return s.filter((e=>"command_line"!==e.platform)).reduce(((e,t)=>!e&&t.activated||e&&t.activated&&t.updateDateUnix>e.updateDateUnix?t:e),null)},pe=(e,t,r,s)=>{if(!r)return T.enum.None;if(s&&r.platform===ce.enum.sso_connector)return T.enum.SsoConnectorToSelfHostedMigration;if(t)return e?T.enum.NitroComplete:T.enum.NitroIncomplete;switch(r.platform){case ce.enum.sso_connector:return e?T.enum.SsoConnectorComplete:T.enum.SsoConnectorIncomplete;case ce.enum.encryption_service:return e?T.enum.SelfHostedComplete:T.enum.SelfHostedIncomplete;case ce.enum.nitro_encryption_service:return e?T.enum.NitroComplete:T.enum.NitroIncomplete}return T.enum.Unknown},he=h.z.object({}),me=(h.z.object({teamUuid:h.z.string().uuid(),adminProvisioningKey:h.z.string(),idpUuid:h.z.string().uuid()}),h.z.object({idpUuid:h.z.string().uuid()})),ye=h.z.record(h.z.string(),A),ge=h.z.object({domains:ye,idps:h.z.record(h.z.string(),S),updateDateUnix:h.z.number()}),ve=h.z.object({enabled:h.z.boolean()}).optional(),fe=h.z.object({data:h.z.object({teamInfo:h.z.object({uuid:h.z.ostring().nullable(),ssoEnabled:h.z.boolean(),ssoIsNitroProvider:h.z.boolean(),ssoServiceProviderUrl:h.z.ostring().nullable(),ssoIdpMetadata:h.z.ostring().nullable(),ssoIdpEntrypoint:h.z.ostring().nullable()}),capabilities:h.z.object({sso:ve})})}),we=async e=>{const t=await e({name:"getTeamInfo",args:[]});if("success"!==t.tag)throw new Error("failed to get team info");const{data:{teamInfo:r,capabilities:s}}=fe.parse(t.data.carbonResult);return{teamInfo:r,capabilities:s}};var Se=r(60399),_e=r(48844);const be=h.z.object({adminProvisioningKey:h.z.object({adminProvisioningKey:h.z.ostring().nullable(),itemId:h.z.ostring().nullable()}).optional().nullable()}),Ee=async(e,t)=>{const r=t({path:`userSession.teamAdminData.teams.${e}`}).pipe((0,_e.nb)({success:e=>{const t=be.safeParse(e);return t.success?{success:!0,value:t.data.adminProvisioningKey?.adminProvisioningKey??null}:{success:!1}},failure:()=>({success:!1})}));return await(0,Se.z)(r)};var Ae=r(87065);let Te=class{constructor(e,t,r,s,a){this.enclaveService=e,this.enclaveApiSettings=t,this.ssoProvisioningStoreUpdater=r,this.carbonLegacyClient=s,this.featureFlipsClient=a,this.fetchInitialStateInfo=async e=>{const{queries:{carbonState:t},commands:{carbon:r}}=this.carbonLegacyClient,s=[Ee(e,t),we(r),le(r)],[a,{teamInfo:n,capabilities:i},o]=await Promise.all(s);let c=this.makeGetTeamDecryptedResponse(),u=null;a.success&&a.value&&n.uuid&&(u=a.value,c=await this.performGetTeam(a.value,n.uuid));return{provisioningKey:u,teamInfo:n,teamStatus:c,capabilities:this.extractCapabilities(i),currentTeamDevice:o}},this.makeGetTeamDecryptedResponse=()=>({domains:{},idps:{},updateDateUnix:0})}async execute({body:{teamId:e}}){if(!e)return(0,l.Rn)({tag:"No teamId provided. Are you logged in?"});try{await this.ssoProvisioningStoreUpdater.reset();const{teamStatus:r,teamInfo:s,provisioningKey:a,capabilities:n,currentTeamDevice:i}=await this.fetchInitialStateInfo(e);return s.uuid?(await this.ssoProvisioningStoreUpdater.set({global:{adminProvisioningKey:a??null,isTeamProvisionedInNitro:!!a,inferredSsoState:pe(s.ssoEnabled,s.ssoIsNitroProvider,i,!!await this._shouldUseSSOMigration()),ssoCapable:n.sso,teamUuid:s.uuid},idpApplication:{acsUrl:(t=this.enclaveApiSettings.enclaveUrl,t?`${new URL(t).origin}/saml/callback`:""),entityId:"dashlane-nitro-sso",signOnUrl:"https://app.dashlane.com"},idpMetadata:{idpUuid:Object.keys(r.idps)[0]??null,metadataValue:s.ssoIdpMetadata??null},domainSetup:this.getDomainSetupState(r.domains),domainVerificationInfo:this.getDomainVerificationInfo(r.domains),enableSSO:{ssoEnabled:s.ssoEnabled}}),(0,l.Vp)(void 0)):(0,l.Rn)({tag:"No teamUUID. Are you logged in?"})}catch(e){return(0,l.Rn)({tag:e instanceof Error?e.message:"Error initializing SSO Provisioning state."})}var t}getDomainSetupState(e){return Object.entries(e).map((([e,t])=>({domainName:e,verificationStatus:t.dnsCheckStatus.status??"pending"})))}getDomainVerificationInfo(e){return Object.entries(e).reduce(((e,[t,r])=>(e[t]={txtValue:r.dnsCheckStatus.verificationToken,verificationStatus:_.parse(r.dnsCheckStatus.status),subdomainValue:q,pendingReason:r.dnsCheckStatus.pendingReason,tokenFound:null},e)),{})}fixTeamStatus(e,t,r){const s=Object.values(e.idps);if(s.length<=1)return Promise.resolve(e);const a=s.sort(((e,t)=>e.updateDateUnix-t.updateDateUnix)).pop();return a?(Object.values(e.domains).reduce(((e,s)=>s.idpUuid!==a.idpUuid?e.then((()=>(async(e,t)=>await e.callEnclaveEndpoint({endpoint:u.DOMAINS_UPDATE_DOMAIN,body:t,responseSchema:he}))(this.enclaveService,{domainName:s.domainName,adminProvisioningKey:t,teamUuid:r,idpUuid:a.idpUuid}).then((()=>(s.idpUuid=a.idpUuid,Promise.resolve()))))):Promise.resolve()),Promise.resolve()),s.reduce(((e,s)=>a.idpUuid!==s.idpUuid?e.then((()=>(async(e,t)=>await e.callEnclaveEndpoint({body:t,endpoint:u.IDPS_DELETE_IDP,responseSchema:me}))(this.enclaveService,{teamUuid:r,adminProvisioningKey:t,idpUuid:s.idpUuid}))).then((()=>Promise.resolve())):Promise.resolve()),Promise.resolve()),e.idps={[a.idpUuid]:a},Promise.resolve(e)):Promise.resolve(e)}async performGetTeam(e,t){let r=await(async(e,t)=>t.teamUuid&&t.adminProvisioningKey?await e.callEnclaveEndpoint({endpoint:u.TEAMS_GET_TEAM,body:t,responseSchema:ge}):{domains:{},idps:{},updateDateUnix:0})(this.enclaveService,{adminProvisioningKey:e,teamUuid:t});return r=await this.fixTeamStatus(r,e,t),r}extractCapabilities(e){return Object.entries(e).reduce(((e,[t,r])=>({...e,[t]:r.enabled})),{})}_shouldUseSSOMigration(){return this._getFeatureFlip(ie.w.ItadminTacEncryptionserviceSSOmigrationReset)}_getFeatureFlip(e){const{userFeatureFlips:t}=this.featureFlipsClient.queries;return(0,Se.z)(t().pipe((0,Ae.U)((t=>{if((0,l.d6)(t)){return(0,l.db)(t)[e]}}))))}};Te=(0,s.__decorate)([(0,d.W)(oe.S),(0,s.__metadata)("design:paramtypes",[v.d,X.N6,j,g.CarbonLegacyClient,w.P])],Te);var Ce=r(94189),xe=r(66012);let Re=class{constructor(e){this.carbonLegacy=e.getClient(g.carbonLegacyApi)}async execute({body:e}){const{commands:{carbon:t}}=this.carbonLegacy,r=await(async(e,t)=>{if(null===t)return;const r=await e({name:"parseMetadataFields",args:[{ssoIdpMetadata:t}]});return(0,l.d6)(r)?void 0:D.parse(r.error).error})(t,e.metadata);return r?(0,l.Rn)({tag:r}):(0,l.Vp)(void 0)}};Re=(0,s.__decorate)([(0,d.W)(xe.l),(0,s.__metadata)("design:paramtypes",[Ce.w])],Re);var Ie=r(82249);h.z.object({teamUuid:h.z.string().uuid(),adminProvisioningKey:h.z.string(),idpMetadata:h.z.object({certificates:h.z.array(h.z.string()),entrypoint:h.z.string()})});const Pe=h.z.object({idpUuid:h.z.string().uuid()}),De=(h.z.object({teamUuid:h.z.string().uuid(),adminProvisioningKey:h.z.string(),idpMetadata:h.z.object({idpUuid:h.z.string(),certificates:h.z.array(h.z.string()),entrypoint:h.z.string()})}),h.z.object({}));var Ue;!function(e){e.INTERNAL_ERROR="internal_error",e.DOMAIN_UPDATE_FAILED="domain_update_failed",e.DELETE_METADATA_FAILED="delete_metadata_failed",e.SAVE_METADATA_FAILED="save_metadata_failed",e.INVALID_METADATA_URL="invalid_metadata_url",e.INVALID_METADATA_CONTENT="invalid_metadata_content"}(Ue||(Ue={}));let Fe=class{constructor(e,t,r,s,a,n){this.enclaveService=e,this.enclaveApiSettings=t,this.platformInfoService=r,this.ssoProvisioningStoreUpdater=s,this.ssoProvisioningStore=a,this.carbon=n}async execute({body:e}){const t=await this.ssoProvisioningStore.getState();if(!t.global.adminProvisioningKey||!t.global.teamUuid)return(0,l.Rn)({tag:Ue.INTERNAL_ERROR});const{metadata:r}=e;let s,a="",n="";const i=new P.Y(r).isUrlValid();if(r&&i)try{const e=await fetch(r);s=await e.text()}catch{return(0,l.Rn)({tag:Ue.INVALID_METADATA_URL})}else s=r;try{if(s){const e=await F(this.carbon.commands.carbon,s);n=e.samlIdpEntryPoint,a=e.samlIdpCertificate}}catch{const e=i?Ue.INVALID_METADATA_URL:Ue.INVALID_METADATA_CONTENT;return(0,l.Rn)({tag:e})}const{adminProvisioningKey:o,teamUuid:c}=t.global;try{let e="";if(t.idpMetadata.idpUuid){const r={adminProvisioningKey:o,teamUuid:c,idpMetadata:{idpUuid:t.idpMetadata.idpUuid||"",certificates:[a],entrypoint:n}};await(async(e,t)=>await e.callEnclaveEndpoint({endpoint:u.IDPS_UPDATE_IDP,body:t,responseSchema:De}))(this.enclaveService,r),e=t.idpMetadata.idpUuid}else{const t={adminProvisioningKey:o,teamUuid:c,idpMetadata:{certificates:[a],entrypoint:n}},{idpUuid:r}=await(async(e,t)=>await e.callEnclaveEndpoint({endpoint:u.IDPS_CREATE_IDP,body:t,responseSchema:Pe}))(this.enclaveService,t);e=r}await this.ssoProvisioningStoreUpdater.set({...t,idpMetadata:{...t.idpMetadata,idpUuid:e,metadataValue:r}});try{await(async(e,{metadata:t,entrypoint:r})=>{const s={ssoIdpMetadata:t||null,ssoIdpEntrypoint:t?r:null};await e({name:"updateTeamSettings",args:[s]})})(this.carbon.commands.carbon,{metadata:r,entrypoint:n})}catch(e){return(0,l.Rn)({tag:Ue.SAVE_METADATA_FAILED})}}catch(e){return(0,l.Rn)({tag:Ue.DOMAIN_UPDATE_FAILED})}return await this.ssoProvisioningStoreUpdater.set({...t,idpMetadata:{...t.idpMetadata,metadataValue:r}}),(0,l.Vp)(void 0)}};Fe=(0,s.__decorate)([(0,d.W)(Ie.o),(0,s.__metadata)("design:paramtypes",[v.d,X.N6,re.t,j,G,g.CarbonLegacyClient])],Fe);var Oe=r(85355);const Ne=h.z.object({previousStatus:h.z.string(),status:h.z.enum(["valid","pending","expired","invalid"]),verificationToken:h.z.string(),lastCheckDateUnix:h.z.number(),pendingReason:h.z.enum(["tokenNotFound","invalidToken"]).nullable(),tokenFound:h.z.string().optional()});let ke=class{constructor(e,t,r,s){this.enclaveService=e,this.ssoProvisioningStoreUpdater=t,this.ssoProvisioningStore=r,this.featureFlips=s}async execute(e){const t=await this.ssoProvisioningStore.getState(),{global:{adminProvisioningKey:r},domainVerificationInfo:s,domainSetup:a}=t,n=e.body.domainName;if(!r)throw new Error("Admin Provisioning Key is not available. Is state initialized and has the team been provisioned in the enclave?");if(!n)throw new Error("Missing domain name. Is state initialized and has a domain been provisioned in the enclave?");try{const e=await(async(e,t)=>await e.callEnclaveEndpoint({endpoint:u.DOMAINS_CHECK_DNS_VALIDATION,body:t,responseSchema:Ne}))(this.enclaveService,{domainName:n,adminProvisioningKey:r,teamUuid:t.global.teamUuid??""}),i=s[n];i.txtValue=e.verificationToken,i.verificationStatus=e.status,i.tokenFound=e.tokenFound??null,i.pendingReason=e.pendingReason;const o=a.map((t=>(t.domainName===n&&(t.verificationStatus=e.status),t)));await this.ssoProvisioningStoreUpdater.set({...t,domainSetup:o,domainVerificationInfo:{...s,[n]:i}})}catch(e){return(0,l.Rn)({tag:"failed to parse response"})}return(0,l.Vp)(void 0)}};ke=(0,s.__decorate)([(0,d.W)(Oe.o),(0,s.__metadata)("design:paramtypes",[v.d,j,G,w.P])],ke);var Le=r(39118);let Me=class{constructor(e,t,r){this.ssoProvisioningStoreUpdater=e,this.ssoProvisioningStore=t,this.carbonLegacy=r.getClient(g.carbonLegacyApi)}async execute(){if((await this.ssoProvisioningStore.getState()).enableSSO.ssoEnabled)return(0,l.Rn)({tag:"SSO is already enabled"});try{const{commands:{carbon:e}}=this.carbonLegacy,t=await(async(e,{ssoEnabled:t})=>{const r=await e({name:"updateTeamSettings",args:[{ssoEnabled:t}]});return!(0,l.hx)(r)})(e,{ssoEnabled:!0});if(!t)return(0,l.Rn)({tag:"Something went wrong. Please contact our Customer Support."});await this.ssoProvisioningStoreUpdater.update({inferredSsoState:T.enum.NitroComplete},"global"),await this.ssoProvisioningStoreUpdater.update({ssoEnabled:!0},"enableSSO")}catch(e){return(0,l.Rn)({tag:"Unknown error"+(e instanceof Error?`: ${e.message}`:".")})}return(0,l.Vp)(void 0)}};Me=(0,s.__decorate)([(0,d.W)(Le.F),(0,s.__metadata)("design:paramtypes",[j,G,Ce.w])],Me);var Ve=r(26758);const Ge=h.z.object({});let qe=class{constructor(e,t,r,s){this.enclaveService=e,this.ssoProvisioningStoreUpdater=t,this.ssoProvisioningStore=r,this.carbonLegacy=s.getClient(g.carbonLegacyApi)}async execute(){const{global:e,enableSSO:t}=await this.ssoProvisioningStore.getState(),{carbon:r}=this.carbonLegacy.commands;try{const e=await le(r);e&&e.platform===ce.enum.nitro_encryption_service&&await Y(r,e.accessKey)}catch{return(0,l.Rn)({tag:"Error deleting latest active team device"})}if(t.ssoEnabled)return(0,l.Rn)({tag:"SSO Already enabled"});if(!e.teamUuid)return(0,l.Rn)({tag:"Missing team UUID. Are you logged in?"});if(!e.adminProvisioningKey)return(0,l.Rn)({tag:"Missing provisioning key. Has the team been provisioned in the enclave environment?"});if(e.isTeamProvisionedInNitro){const t={teamUuid:e.teamUuid,adminProvisioningKey:e.adminProvisioningKey};try{await(async(e,t)=>await e.callEnclaveEndpoint({endpoint:u.TEAMS_DELETE_TEAM,body:t,responseSchema:Ge}))(this.enclaveService,t)}catch(e){return(0,l.Rn)({tag:e instanceof Error?e.message:"Error deleting team in Nitro."})}try{await $(r,{ssoServiceProviderUrl:null,ssoIdpMetadata:null,ssoIdpEntrypoint:null})}catch(e){return(0,l.Rn)({tag:e instanceof Error?e.message:"Error updating team settings."})}}if(e.adminProvisioningKey)try{await r({name:"removeAdminProvisioningKey",args:[]})}catch(e){return(0,l.Rn)({tag:e instanceof Error?e.message:"Error removing provisioning key."})}return await this.ssoProvisioningStoreUpdater.reset(),(0,l.Vp)(void 0)}};qe=(0,s.__decorate)([(0,d.W)(Ve.h),(0,s.__metadata)("design:paramtypes",[v.d,j,G,Ce.w])],qe);var je=r(20754),Ke=r(73774),We=r(1434);let Be=class{constructor(e,t){this.httpClient=e,this.ssoProvisioningStore=t}execute(){return this.ssoProvisioningStore.state$.pipe((0,Ae.U)((e=>(0,l.Vp)(e))))}};Be=(0,s.__decorate)([(0,je.e)(We._),(0,s.__metadata)("design:paramtypes",[Ke.e,G])],Be);var He=r(57318);let ze=class{};ze=(0,s.__decorate)([(0,a.Y)({api:o.y,handlers:{commands:{loginUserWithEnclaveSSO:f,provisionDomain:W,createTeam:J,deleteDomain:te,testLoginUserWithEnclaveSSO:ne,initSsoProvisioning:Te,validateMetadata:Re,updateMetadata:Fe,checkDNSValidation:ke,enableSso:Me,clearSettings:qe},events:{},queries:{ssoProvisioning:Be}},configurations:{enclaveApiSettings:{token:X.N6},enclaveLoginContextInfrastructure:{token:c}},imports:[n.X,i.i,He.E],stores:[G],providers:[j],requiredFeatureFlips:["itadmin_tac_encryptionservice_SSOmigration_reset","provisioning_multiple_domains_confidential_sso_prod","provisioning_nitro_api_v2_prod","setup_rollout_confidential_scim_dev"]})],ze)},52886:(e,t,r)=>{"use strict";r.d(t,{X:()=>f});var s=r(7165),a=r(56773),n=r(37298),i=r(839);const o={addListener:function(e){const t=(t,r,s)=>{if(chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError";throw new Error(`runtime/onMessage: ${e}`)}return e(t,r,s)};if(!(0,i.Ez)("runtime.onMessage.addListener"))throw new Error("No runtime.onMessage.addListener support");return chrome.runtime.onMessage.addListener(t),t},removeListener:function(e){chrome.runtime.onMessage.removeListener(e)}};var c=r(21763);const u={addListener:function(e){if(!(0,i.Ez)("tabs.onUpdated.addListener"))throw new Error("No tabs.onUpdated.addListener support");const t=(t,r,s)=>{if(chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError";throw new Error(`tabs/onUpdated: ${e}`)}return e(t,r,s)};return chrome.tabs.onUpdated.addListener(t),t},removeListener:function(e){if(!(0,i.Ez)("tabs.onUpdated.removeListener"))throw new Error("No tabs.onUpdated.removeListener support");chrome.tabs.onUpdated.removeListener(e)}};const d={addListener:function(e){if(!(0,i.Ez)("tabs.onRemoved.addListener"))throw new Error("No tabs.onRemoved.addListener support");const t=(t,r)=>{if(chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError";throw new Error(`tabs/onRemoved: ${e}`)}return e(t,r)};return chrome.tabs.onRemoved.addListener(t),t},removeListener:function(e){if(!(0,i.Ez)("tabs.onRemoved.removeListener"))throw new Error("No tabs.onRemoved.removeListener support");chrome.tabs.onRemoved.removeListener(e)}};var l=r(31460),p=r(72733),h=r(24715),m=r(61222),y=r(92204),g=r(49259);const v=s.z.object({type:s.z.string(),saml:s.z.string()});class f{constructor(){this.interceptedTabId=void 0,this.originalTabId=void 0,this.samlReceived=!1,this.expectedMessageType="SamlAssertionIntercepted";try{this.onMessageListener=new n.j(o,this.checkMessageType.bind(this))}catch{}}checkMessageType(e){return!this.samlReceived&&e.type===this.expectedMessageType}interceptSamlFromTab(e){return new Promise(((t,r)=>{if(!this.onMessageListener)return r(new Error("OnMessage event listener is not available in current context"));const s=u.addListener(((t,r)=>{t===e.id&&r.url&&e.id&&(0,c.k)({target:{tabId:e.id,allFrames:!0},files:["content/contentScripts/dashlane-saml-intercept-script.js"],injectImmediately:!0})})),n=d.addListener((t=>{t===e.id&&(u.removeListener(s),d.removeListener(n),r(new Error("Intercepting SAML - tab closed unexpectedly")))}));this.onMessageListener.events$.pipe((0,a.P)()).subscribe((([e])=>{const a=v.safeParse(e);a.success?(this.samlReceived=!0,u.removeListener(s),d.removeListener(n),t({samlToken:a.data.saml})):r(new Error("Intercepting SAML - received message could not be parsed"))}))}))}async redirectTabToUrl(e){if(this.interceptedTabId)return await(0,l.V)(this.interceptedTabId,{url:e});{const t=(await(0,p.T)({windowTypes:["normal"]})).id;return await(0,h.U)({windowId:t,url:e})}}async getActiveExtensionTabId(){const e=await(0,m.I)({currentWindow:!0,active:!0}),t=e.length>0?e[0]:null,r=(0,y.A)("");if(t?.id&&t.url?.includes(r))return t.id}getSamlFromLogin(e,t){this.samlReceived=!1,this.originalTabId=void 0,this.interceptedTabId&&((0,g.O)([this.interceptedTabId]),this.interceptedTabId=void 0);const r=()=>(0,h.U)({url:e}).then((e=>(this.interceptedTabId=e.id,this.interceptSamlFromTab(e)))),s=t=>(0,l.V)(t,{url:e}).then((e=>{if(e)return this.interceptedTabId=e.id,this.interceptSamlFromTab(e);throw new Error("Tab disappeared during nitro login")}));return t?this.getActiveExtensionTabId().then((e=>e?s(e):r())):this.getActiveExtensionTabId().then((e=>(this.originalTabId=e,r())))}async redirectUserIntoLoginFlow(e){const t={ssoToken:e.ssoToken,exists:e.exists,currentAuths:e.currentAuthenticationMethods,expectedAuths:e.expectedAuthenticationMethods,key:e.userServiceProviderKey,login:e.login},r=Object.entries(t).map((e=>`${e[0]}=${encodeURIComponent(e[1].toString())}`)).join("&"),s=(0,y.A)(`index.html#/sso?${r}`);await this.redirectTabToUrl(s)}async redirectUserToLoginPage(){const e=(0,y.A)("index.html#/login");await this.redirectTabToUrl(e)}async cleanupTestLogin(){this.interceptedTabId&&await(0,g.O)([this.interceptedTabId]),this.originalTabId&&(0,l.V)(this.originalTabId,{active:!0})}}},33470:(e,t,r)=>{"use strict";r.d(t,{r:()=>i});var s=r(86952),a=r(20417),n=r(9599);const i=(0,s.Q)({name:"sync",commands:{SyncCommand:a.t},queries:{SyncProgressQuery:n.F},events:{}})},20417:(e,t,r)=>{"use strict";r.d(t,{t:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.Device})){}},9599:(e,t,r)=>{"use strict";r.d(t,{F:()=>n});var s=r(99059),a=r(25029);class n extends((0,s.k)({scope:a.F.Device})){}},76183:(e,t,r)=>{"use strict";var s;r.d(t,{L:()=>s,_:()=>a}),function(e){e.READY="ready",e.IN_PROGRESS="in_progress",e.SUCCESS="success",e.FAILURE="failure"}(s||(s={}));class a{}},80310:(e,t,r)=>{"use strict";r.d(t,{R:()=>x});var s=r(88802),a=r(99634),n=r(25029),i=r(33470),o=r(76183),c=r(87279),u=r(63663),d=r(20417);let l=class{constructor(e){this.syncService=e}execute(e){const{trigger:t}=e.body;return this.syncService.attemptSync(t),Promise.resolve((0,c.Vp)(void 0))}};l=(0,s.__decorate)([(0,u.W)(d.t),(0,s.__metadata)("design:paramtypes",[o._])],l);var p=r(20754),h=r(9599);let m=class{constructor(e){this.syncService=e}execute(){return this.syncService.getSyncState()}};m=(0,s.__decorate)([(0,p.e)(h.F),(0,s.__metadata)("design:paramtypes",[o._])],m);var y=r(30523),g=r(60399),v=r(57924),f=r(94189),w=r(53576),S=r(48844);const _=e=>"object"==typeof e&&null!==e&&"status"in e&&Object.values(o.L).includes(e.status);var b=r(96168);class E extends((0,b.Hu)("SyncError","An error occoured while trying to sync the vault")){}let A=class{constructor(e){this.carbonLegacy=e.getClient(w.carbonLegacyApi)}async attemptSync(e){await this.carbonLegacy.commands.carbonLegacyLeeloo({name:"sessionForceSync",arg:[{trigger:e}]})}async waitForSync(e){const t=this.getSyncState().pipe((0,y.h)((e=>!(!(0,c.d6)(e)||!_(e.data))&&[o.L.FAILURE,o.L.SUCCESS].includes(e.data.status))),(0,S.DZ)((()=>new E)),(0,S.lk)((e=>e.status===o.L.FAILURE?(0,c.Rn)({tag:"Sync failed"}):(0,c.Vp)(void 0))));return await this.attemptSync(e),(0,g.z)(t)}getSyncState(){return this.carbonLegacy.queries.carbonState({path:"userSession.sync"}).pipe((0,S.Qn)((e=>{if(!_(e))throw new Error("Bad sync state format");return{status:e.status}})))}};A=(0,s.__decorate)([(0,v.GS)(),(0,s.__metadata)("design:paramtypes",[f.w])],A);var T=r(92233);let C=class{constructor(e){this.syncService=e}async run(){return await this.syncService.attemptSync(T.Trigger.Periodic),Promise.resolve()}};C=(0,s.__decorate)([(0,v.GS)(),(0,s.__metadata)("design:paramtypes",[o._])],C);let x=class{};x=(0,s.__decorate)([(0,a.Y)({api:i.r,handlers:{commands:{sync:l},events:{},queries:{syncProgress:m}},crons:[{handler:C,periodInMinutes:5,name:"periodic-sync-cron",scope:n.F.User}],providers:[{provide:o._,useClass:A}],exports:[o._]})],x)},17305:(e,t,r)=>{"use strict";r.d(t,{t:()=>c});var s=r(86952),a=r(5633),n=r(35997),i=r(48317),o=r(90109);const c=(0,s.Q)({name:"teamAdminNotifications",commands:{markOfferToExtendFreeTrialSeen:a.R,markNotificationTrialExtendedSeen:n.D},events:{},queries:{hasSeenNotificationTrialExtended:i.q,hasSeenOfferToExtendFreeTrial:o.U}})},35997:(e,t,r)=>{"use strict";r.d(t,{D:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},5633:(e,t,r)=>{"use strict";r.d(t,{R:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},48317:(e,t,r)=>{"use strict";r.d(t,{q:()=>a});var s=r(99059);class a extends((0,s.k)()){}},90109:(e,t,r)=>{"use strict";r.d(t,{U:()=>a});var s=r(99059);class a extends((0,s.k)()){}},49003:(e,t,r)=>{"use strict";r.d(t,{h:()=>p});var s=r(86952),a=r(55958),n=r(56524),i=r(48975),o=r(88313),c=r(78651),u=r(59448),d=r(76560),l=r(6725);const p=(0,s.Q)({name:"teamGetStarted",commands:{markVaultAsVisited:u.R,markGetStartedAsSeen:d.g,markNotificationAsSeen:l.f},events:{},queries:{hasVisitedVault:a.V,hasSeenGetStarted:n.U,hasSeenNotification:i.C,isTeamCreator:o.G,teamTasksCompletion:c.M}})},76560:(e,t,r)=>{"use strict";r.d(t,{g:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},6725:(e,t,r)=>{"use strict";r.d(t,{f:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},59448:(e,t,r)=>{"use strict";r.d(t,{R:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},56524:(e,t,r)=>{"use strict";r.d(t,{U:()=>a});var s=r(99059);class a extends((0,s.k)()){}},48975:(e,t,r)=>{"use strict";r.d(t,{C:()=>a});var s=r(99059);class a extends((0,s.k)()){}},55958:(e,t,r)=>{"use strict";r.d(t,{V:()=>a});var s=r(99059);class a extends((0,s.k)()){}},88313:(e,t,r)=>{"use strict";r.d(t,{G:()=>o});var s=r(99059),a=r(25029),n=r(96168);class i extends((0,n.Hu)("UserNotLogged","Please log the user")){}class o extends((0,s.k)({scope:a.F.User,noUserError:new i})){}},78651:(e,t,r)=>{"use strict";r.d(t,{M:()=>a});var s=r(99059);class a extends((0,s.k)()){}},13823:(e,t,r)=>{"use strict";r.d(t,{L:()=>n});var s=r(86952),a=r(2564);const n=(0,s.Q)({name:"teamMembers",commands:{ProposeMembersCommand:a.og},events:{},queries:{}})},2564:(e,t,r)=>{"use strict";r.d(t,{Wv:()=>m,og:()=>y});var s,a=r(74354),n=r(25029),i=r(96168);!function(e){e.InvalidOrigin="InvalidOrigin",e.NoFreeSlot="NoFreeSlot",e.NoFreeSlotFreePlan="NoFreeSlotFreePlan",e.UserTeamInviteTokenNotFound="UserTeamInviteTokenNotFound",e.PaymentFailed="PaymentFailed",e.NotBillingAdmin="NotBillingAdmin",e.CannotAddSeatDuringGracePeriod="CannotAddSeatDuringGracePeriod"}(s||(s={}));class o extends((0,i.Hu)(s.InvalidOrigin,"Invalid origin")){}class c extends((0,i.Hu)(s.NoFreeSlot,"No free slot")){}class u extends((0,i.Hu)(s.NoFreeSlotFreePlan,"No free slot in free plan")){}class d extends((0,i.Hu)(s.UserTeamInviteTokenNotFound,"No invite token to a team available for user")){}class l extends((0,i.Hu)(s.PaymentFailed,"Payment failed")){}class p extends((0,i.Hu)(s.NotBillingAdmin,"User is not the billing admin")){}class h extends((0,i.Hu)(s.CannotAddSeatDuringGracePeriod,"Seats cannot be added during grace period")){}function m(e){switch(e){case"invalid_origin":return new o;case"no_free_slot":return new c;case"no_free_slot_free_plan":return new u;case"USER_TEAM_INVITE_TOKEN_NOT_FOUND":return new d;case"payment_failed":return new l;case"not_billing_admin":return new p;case"cannot_add_seat_during_grace_period":return new h;default:throw new Error("Unknown server error")}}class y extends((0,a.g)({scope:n.F.User})){}},46888:(e,t,r)=>{"use strict";r.d(t,{B:()=>n});var s=r(86952),a=r(42014);const n=(0,s.Q)({name:"teamPasswordHealth",commands:{},events:{},queries:{getReport:a.z}})},42014:(e,t,r)=>{"use strict";r.d(t,{z:()=>n});var s=r(99059),a=r(25029);class n extends((0,s.k)({scope:a.F.User})){}},13511:(e,t,r)=>{"use strict";r.d(t,{o:()=>p});var s=r(86952),a=r(25904),n=r(29188),i=r(82276),o=r(26992),c=r(9128),u=r(30525),d=r(19068),l=r(207);const p=(0,s.Q)({name:"teamPlanDetails",commands:{extendFreeTrial:a.N,refreshTeamTrialStatus:n.h,requestTeamPlanCancellation:i.y},events:{},queries:{getTeamBillingInformation:o._,getTeamCancellationStatus:c.F,getTeamCapabilities:u.Y,getTeamId:d.e,getTeamTrialStatus:l.P}})},25904:(e,t,r)=>{"use strict";r.d(t,{N:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},29188:(e,t,r)=>{"use strict";r.d(t,{h:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},82276:(e,t,r)=>{"use strict";r.d(t,{y:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},26992:(e,t,r)=>{"use strict";r.d(t,{_:()=>n});var s=r(99059),a=r(25029);class n extends((0,s.k)({scope:a.F.User})){}},9128:(e,t,r)=>{"use strict";r.d(t,{F:()=>n});var s=r(99059),a=r(25029);class n extends((0,s.k)({scope:a.F.User})){}},30525:(e,t,r)=>{"use strict";r.d(t,{Y:()=>n});var s=r(99059),a=r(25029);class n extends((0,s.k)({scope:a.F.User})){}},19068:(e,t,r)=>{"use strict";r.d(t,{e:()=>n});var s=r(99059),a=r(25029);class n extends((0,s.k)({scope:a.F.User})){}},207:(e,t,r)=>{"use strict";r.d(t,{P:()=>n});var s=r(99059),a=r(25029);class n extends((0,s.k)({scope:a.F.User})){}},1701:(e,t,r)=>{"use strict";r.d(t,{a:()=>o});var s=r(86952),a=r(57220),n=r(36767),i=r(56333);const o=(0,s.Q)({name:"teamVat",commands:{DeleteTeamVatCommand:a.Hy,GetTeamVatCommand:n.cf,UpsertTeamVatCommand:i.XW},events:{},queries:{}})},57220:(e,t,r)=>{"use strict";r.d(t,{Hy:()=>d,zK:()=>u});var s,a=r(74354),n=r(25029),i=r(96168);!function(e){e.TeamNotFound="TeamNotFound",e.NotBillingAdmin="NotBillingAdmin"}(s||(s={}));class o extends((0,i.Hu)(s.TeamNotFound,"The given user is not part of a single team")){}class c extends((0,i.Hu)(s.NotBillingAdmin,"The user is not Billing Admin")){}function u(e){switch(e){case"TEAM_NOT_FOUND":return new o;case"not_billing_admin":return new c;default:throw new Error("Unknown server error")}}class d extends((0,a.g)({scope:n.F.User})){}},36767:(e,t,r)=>{"use strict";r.d(t,{K$:()=>d,cf:()=>l});var s,a=r(74354),n=r(25029),i=r(96168);!function(e){e.TeamNotFound="TeamNotFound",e.VatNumberNotFound="VatNumberNotFound",e.NotBillingAdmin="NotBillingAdmin"}(s||(s={}));class o extends((0,i.Hu)(s.TeamNotFound,"The given user is not part of a single team")){}class c extends((0,i.Hu)(s.VatNumberNotFound,"The given Team does not have a VAT number")){}class u extends((0,i.Hu)(s.NotBillingAdmin,"The user is not Billing Admin")){}function d(e){switch(e){case"TEAM_NOT_FOUND":return new o;case"VAT_NUMBER_NOT_FOUND":return new c;case"not_billing_admin":return new u;default:throw new Error("Unknown server error")}}class l extends((0,a.g)({scope:n.F.User})){}},56333:(e,t,r)=>{"use strict";r.d(t,{XW:()=>l,q5:()=>d});var s,a=r(74354),n=r(25029),i=r(96168);!function(e){e.TeamNotFound="TeamNotFound",e.NotBillingAdmin="NotBillingAdmin",e.VatNumberNotUpserted="VatNumberNotUpserted"}(s||(s={}));class o extends((0,i.Hu)(s.TeamNotFound,"The given user is not part of a single team")){}class c extends((0,i.Hu)(s.NotBillingAdmin,"The user is not Billing Admin")){}class u extends((0,i.Hu)(s.VatNumberNotUpserted,"The VAT number couldn't be upserted")){}function d(e){switch(e){case"TEAM_NOT_FOUND":return new o;case"not_billing_admin":return new c;case"VAT_NUMBER_NOT_UPSERTED":return new u;default:throw new Error("Unknown server error")}}class l extends((0,a.g)({scope:n.F.User})){}},13814:(e,t,r)=>{"use strict";r.d(t,{E:()=>R});var s,a=r(88802),n=r(99634),i=r(6447),o=r(17305),c=r(63663),u=r(87279),d=r(5633),l=r(25029),p=r(95681),h=r(23347),m=r(10722),y=r(7165);!function(e){e.OfferToExtendFreeTrial="offerToExtendFreeTrial",e.NotificationTrialExtended="notificationTrialExtended"}(s||(s={}));const g=y.z.object({seenNotifications:y.z.record(y.z.nativeEnum(s),y.z.boolean())}),v=e=>g.safeParse(e).success;class f extends((0,p.Q)({storage:{schemaVersion:1,initialValue:{seenNotifications:{offerToExtendFreeTrial:!1,notificationTrialExtended:!1}},typeGuard:v},persist:!0,scope:l.F.User,storeName:"team-admin-notifications-store",capacity:h.Y._010KB,codec:m.E})){}let w=class{constructor(e){this.store=e}async execute(){const e=await this.store.getState(),t={...e.seenNotifications,offerToExtendFreeTrial:!0};return await this.store.set({...e,seenNotifications:t}),Promise.resolve((0,u.Vp)(void 0))}};w=(0,a.__decorate)([(0,c.W)(d.R),(0,a.__metadata)("design:paramtypes",[f])],w);var S=r(35997);let _=class{constructor(e){this.store=e}async execute(){const e=await this.store.getState(),t={...e.seenNotifications,notificationTrialExtended:!0};return await this.store.set({...e,seenNotifications:t}),Promise.resolve((0,u.Vp)(void 0))}};_=(0,a.__decorate)([(0,c.W)(S.D),(0,a.__metadata)("design:paramtypes",[f])],_);var b=r(87065),E=r(20754),A=r(48317);let T=class{constructor(e){this.store=e}execute(){return this.store.state$.pipe((0,b.U)((e=>(0,u.Vp)(!!e.seenNotifications.notificationTrialExtended))))}};T=(0,a.__decorate)([(0,E.e)(A.q),(0,a.__metadata)("design:paramtypes",[f])],T);var C=r(90109);let x=class{constructor(e){this.store=e}execute(){return this.store.state$.pipe((0,b.U)((e=>(0,u.Vp)(!!e.seenNotifications.offerToExtendFreeTrial))))}};x=(0,a.__decorate)([(0,E.e)(C.U),(0,a.__metadata)("design:paramtypes",[f])],x);let R=class{};R=(0,a.__decorate)([(0,n.Y)({api:o.t,imports:[i.n],stores:[f],handlers:{commands:{markOfferToExtendFreeTrialSeen:w,markNotificationTrialExtendedSeen:_},events:{},queries:{hasSeenNotificationTrialExtended:T,hasSeenOfferToExtendFreeTrial:x}}})],R)},93200:(e,t,r)=>{"use strict";r.d(t,{q:()=>$});var s=r(88802),a=r(99634),n=r(6447),i=r(49003),o=r(25029),c=r(95681),u=r(23347),d=r(10722),l=r(7165);const p=l.z.object({hasVisitedVault:l.z.boolean(),hasSeenGetStarted:l.z.boolean(),notifications:l.z.record(l.z.string(),l.z.boolean())}),h=e=>p.safeParse(e).success;class m extends((0,c.Q)({storage:{schemaVersion:1,initialValue:{hasVisitedVault:!1,hasSeenGetStarted:!1,notifications:{}},typeGuard:h},persist:!0,scope:o.F.User,storeName:"team-admin-store",capacity:u.Y._010KB,codec:d.E})){}var y=r(87065),g=r(20754),v=r(56524),f=r(87279);let w=class{constructor(e){this.store=e}execute(){return this.store.state$.pipe((0,y.U)((e=>(0,f.Vp)(e.hasSeenGetStarted))))}};w=(0,s.__decorate)([(0,g.e)(v.U),(0,s.__metadata)("design:paramtypes",[m])],w);var S=r(48975);let _=class{constructor(e){this.store=e}execute({body:e}){return this.store.state$.pipe((0,y.U)((t=>(0,f.Vp)(!!t.notifications[e.notification]))))}};_=(0,s.__decorate)([(0,g.e)(S.C),(0,s.__metadata)("design:paramtypes",[m])],_);var b=r(55958);let E=class{constructor(e){this.store=e}execute(){return this.store.state$.pipe((0,y.U)((e=>(0,f.Vp)(e.hasVisitedVault))))}};E=(0,s.__decorate)([(0,g.e)(b.V),(0,s.__metadata)("design:paramtypes",[m])],E);var A=r(43978),T=r(69885),C=r(61076),x=r(94189),R=r(53576),I=r(88313),P=r(67837),D=r(13511);class U extends((0,P.E)(D.o)){}(0,P.K)(D.o,U);var F=r(48844),O=r(57924),N=r(73404);let k=class{constructor(e){this.serverApiClient=e,this.get=e=>this.serverApiClient.v1.teams.getTeamMembers({teamId:parseInt(e,10),orderBy:"joinedDateUnix",limit:0}).pipe((0,F.Qn)((({data:e})=>e)),(0,F.DZ)((e=>{throw e})))}};k=(0,s.__decorate)([(0,O.GS)(),(0,s.__metadata)("design:paramtypes",[N.l])],k);let L=class{constructor(e,t,r){this.cqrsClient=e,this.getTeamMembersData=t,this.teamPlanDetailsClient=r,this.getUserLogin=()=>{const{carbonState:e}=this.cqrsClient.getClient(R.carbonLegacyApi).queries;return e({path:"state.userSession.account.login"}).pipe((0,y.U)((e=>{if((0,f.d6)(e)&&"string"==typeof e.data)return e.data;throw new Error("No active login")})))},this.getTeamId=()=>{const{getTeamId:e}=this.teamPlanDetailsClient.queries;return e().pipe((0,A.w)((e=>{if((0,f.hx)(e)||!e.data.teamId||""===e.data.teamId)throw new Error("Error : could not retrieve teamId");return(0,T.of)(e.data.teamId)})))}}execute(){const e=this.getUserLogin();return this.getTeamId().pipe((0,A.w)((t=>this.getTeamMembersData.get(t).pipe((0,C.V)(e),(0,y.U)((([e,t])=>{if((0,f.hx)(e))throw new Error("Error : could not retrieve team's members");const{data:r}=e,s=r.members.filter((e=>e.isTeamCaptain&&"accepted"===e.status)).sort(((e,t)=>(e.joinedDateUnix??0)-(t.joinedDateUnix??0)));return(0,f.Vp)(s[0]?.login===t)}))))))}};L=(0,s.__decorate)([(0,g.e)(I.G),(0,s.__metadata)("design:paramtypes",[x.w,k,U])],L);var M=r(78651);let V=class{constructor(e){this.serverApiClient=e,this.get=()=>this.serverApiClient.v1.teams.teamStatus({}).pipe((0,F.Qn)((({data:e})=>e)),(0,F.DZ)((e=>{throw e})))}};V=(0,s.__decorate)([(0,O.GS)(),(0,s.__metadata)("design:paramtypes",[N.l])],V);let G=class{constructor(e,t,r){this.getTeamStatusData=e,this.getTeamMembersData=t,this.teamPlanDetailsClient=r}execute(){return this.teamPlanDetailsClient.queries.getTeamId().pipe((0,A.w)((e=>{if((0,f.hx)(e)||!e.data.teamId||""===e.data.teamId)throw new Error("Error : could not retrieve teamId");return this.getTeamStatusData.get().pipe((0,C.V)(this.getTeamMembersData.get(e.data.teamId)),(0,y.U)((([e,t])=>{if((0,f.hx)(e)||(0,f.hx)(t))throw new Error("Error : could not retrieve team status or team's members");const{data:r}=e,{data:s}=t,a=r.seats.paid+r.seats.extraFree-r.seats.remaining,n=s.members.filter((e=>"accepted"===e.status));return(0,f.Vp)({hasMinimumMemberCount:a>=2,hasMoreThanOneAdmin:Object.keys(r.info.teamCaptains).length>1,hasSecurityScore:!!r.securityScore,hasOnlyOneMember:1===n.length,isSharingDisabled:r.info.sharingDisabled??!1})})))})))}};G=(0,s.__decorate)([(0,g.e)(M.M),(0,s.__metadata)("design:paramtypes",[V,k,U])],G);var q=r(63663),j=r(59448);let K=class{constructor(e){this.store=e}async execute(){const e=await this.store.getState();return await this.store.set({...e,hasVisitedVault:!0}),Promise.resolve((0,f.Vp)(void 0))}};K=(0,s.__decorate)([(0,q.W)(j.R),(0,s.__metadata)("design:paramtypes",[m])],K);var W=r(76560);let B=class{constructor(e){this.store=e}async execute(){const e=await this.store.getState();return await this.store.set({...e,hasSeenGetStarted:!0}),Promise.resolve((0,f.Vp)(void 0))}};B=(0,s.__decorate)([(0,q.W)(W.g),(0,s.__metadata)("design:paramtypes",[m])],B);var H=r(6725);let z=class{constructor(e){this.store=e}async execute({body:e}){const t=await this.store.getState(),r={...t.notifications,[e.notification]:!0};return await this.store.set({...t,notifications:r}),Promise.resolve((0,f.Vp)(void 0))}};z=(0,s.__decorate)([(0,q.W)(H.f),(0,s.__metadata)("design:paramtypes",[m])],z);let $=class{};$=(0,s.__decorate)([(0,a.Y)({api:i.h,stores:[m],imports:[n.n],providers:[V,k],handlers:{commands:{markVaultAsVisited:K,markGetStartedAsSeen:B,markNotificationAsSeen:z},events:{},queries:{hasSeenGetStarted:w,hasSeenNotification:_,hasVisitedVault:E,isTeamCreator:L,teamTasksCompletion:G}},requiredFeatureFlips:["onboarding_web_tacgetstarted"]})],$)},92447:(e,t,r)=>{"use strict";r.d(t,{X:()=>g});var s=r(88802),a=r(99634),n=r(6447),i=r(13823),o=r(63663),c=r(2564),u=r(60399),d=r(57924),l=r(73404),p=r(48844),h=r(87279);let m=class{constructor(e){this.serverApiClient=e}async callProposeMembers({proposedMemberLogins:e,force:t,origin:r,notificationOptions:s}){try{return await(0,u.z)(this.serverApiClient.v1.teams.proposeMembers({proposedMemberLogins:e,force:t,origin:r,notificationOptions:s}).pipe((0,p.DZ)((e=>{if("BusinessError"===e.tag)return(0,c.Wv)(e.code);throw new Error(e.message)})),(0,p.lk)((e=>(0,h.Vp)(e.data)))))}catch(e){return(0,h.Rn)({tag:"failure",error:`Propose Members failed - ${e}`})}}};m=(0,s.__decorate)([(0,d.GS)(),(0,s.__metadata)("design:paramtypes",[l.l])],m);let y=class{constructor(e){this.proposeMembersService=e}execute({body:{proposedMemberLogins:e,force:t,origin:r,notificationOptions:s}}){return this.proposeMembersService.callProposeMembers({proposedMemberLogins:e,force:t,origin:r,notificationOptions:s})}};y=(0,s.__decorate)([(0,o.W)(c.og),(0,s.__metadata)("design:paramtypes",[m])],y);let g=class{};g=(0,s.__decorate)([(0,a.Y)({api:i.L,imports:[n.n],providers:[m],handlers:{commands:{proposeMembers:y},events:{},queries:{}}})],g)},65529:(e,t,r)=>{"use strict";r.d(t,{V:()=>g});var s=r(88802),a=r(99634),n=r(6447),i=r(46888),o=r(20754),c=r(42014),u=r(57924),d=r(73404),l=r(87279),p=r(48844),h=r(87065);let m=class{constructor(e){this.serverApiClient=e,this.getTeamReport=()=>this.getTeamReportData().pipe((0,h.U)((e=>{if((0,l.hx)(e))throw new Error("could't retrieve team report");const{data:t}=e;return(0,l.Vp)(t)}))),this.getTeamReportData=()=>this.serverApiClient.v1.teams.report({}).pipe((0,p.Qn)((({data:e})=>e)),(0,p.DZ)((e=>{throw e})))}};m=(0,s.__decorate)([(0,u.GS)(),(0,s.__metadata)("design:paramtypes",[d.l])],m);let y=class{constructor(e){this.teamReportService=e}execute(){return this.teamReportService.getTeamReport()}};y=(0,s.__decorate)([(0,o.e)(c.z),(0,s.__metadata)("design:paramtypes",[m])],y);let g=class{};g=(0,s.__decorate)([(0,a.Y)({api:i.B,imports:[n.n],providers:[m],handlers:{commands:{},events:{},queries:{getReport:y}}})],g)},76519:(e,t,r)=>{"use strict";r.d(t,{H:()=>ie});var s=r(88802),a=r(99634),n=r(6447),i=r(13511),o=r(63663),c=r(87279),u=r(25904),d=r(60399),l=r(57924),p=r(73404),h=r(48844);let m=class{constructor(e){this.serverApiClient=e,this.extendFreeTrial=async()=>await(0,d.z)(this.serverApiClient.v1.teams.extendFreeTrial({}).pipe((0,h.DZ)((e=>(0,c.Rn)({tag:`ExtendFreeTrial command failed with message: ${e.message}`}))),(0,h.lk)((()=>(0,c.Vp)(void 0)))))}};m=(0,s.__decorate)([(0,l.GS)(),(0,s.__metadata)("design:paramtypes",[p.l])],m);var y,g,v,f,w,S=r(87065),_=r(85390),b=r(53576),E=r(94189);!function(e){e.Legacy="legacy",e.Starter="starter",e.Team="team",e.Business="business",e.Enterprise="entreprise"}(y||(y={})),function(e){e.ProcessOut="processout",e.Invoice="invoice"}(g||(g={})),function(e){e.USD="usd",e.EUR="eur"}(v||(v={})),function(e){e.Pending="pending",e.Canceled="canceled",e.None="none"}(f||(f={})),function(e){e.NoInteralUsage="no_internal_usage",e.NoNeedForPasswordManager="no_need_for_password_manager",e.ChoseOtherPasswordManager="chose_other_password_manager",e.MissingCriticalFeatures="missing_critical_features",e.TechnicalIssues="technical_issues",e.TooExpensive="too_expensive",e.Other="other"}(w||(w={}));var A=r(95557),T=r(10994),C=r(92481),x=r(50793);const R=e=>{if(!e)return new Date;const t=(0,A.Z)(e,"yyyy-MM-dd",new Date);return"Invalid Date"!==t.toString()?t:new Date(e)},I=e=>{const t=R((0,T.Z)(e).toString());return(0,C.Z)(t,"yyyy-MM-dd")===(0,C.Z)(R((new Date).toString()),"yyyy-MM-dd")},P=e=>{const t=new Date,r=(0,T.Z)(e);return r.setDate(r.getDate()+6),s=r,t.setHours(0,0,0,0)<=s.setHours(0,0,0,0);var s},D=e=>(0,x.Z)((0,T.Z)(e),new Date);var U=r(95681),F=r(23347),O=r(25029),N=r(7165);const k=N.z.object({isFreeTrial:N.z.boolean(),isGracePeriod:N.z.boolean(),isFirstDayOfTrial:N.z.boolean(),isSecondStageOfTrial:N.z.boolean(),daysLeftInTrial:N.z.number(),spaceTier:N.z.custom()}),L=e=>k.safeParse(e).success;class M extends((0,U.Q)({initialValue:void 0,storeTypeGuard:L,persist:!1,scope:O.F.User,storeName:"team-trial-status-store",capacity:F.Y._010KB})){}const V=e=>{switch(e){case"legacy":default:return y.Legacy;case"starter":return y.Starter;case"team":return y.Team;case"business":return y.Business;case"entreprise":return y.Enterprise}};let G=class{constructor(e,t,r){this.cqrsClient=e,this.serverApiClient=t,this.teamTrialStatusStore=r,this.updateTeamFreeTrialDetails=async()=>await(0,d.z)(this.getTeamStatusData().pipe((0,S.U)((e=>{if((0,c.hx)(e))throw new Error("Error : could not retrieve team status");const{data:t}=e,r={isFreeTrial:t.billing.isFreeTrial,isGracePeriod:t.billing.isGracePeriod,isFirstDayOfTrial:I(t.creationDateUnix),isSecondStageOfTrial:P(t.creationDateUnix),daysLeftInTrial:D(t.billing.nextBillingDetails.dateUnix),spaceTier:V(t.planTier)};return this.teamTrialStatusStore.set(r),r})))),this.getTeamBillingDetails=()=>(0,_.a)([this.getTeamStatusData(),this.getTeamSubscriptionInformation()]).pipe((0,S.U)((([e,t])=>{if(!(0,c.d6)(e))throw new Error("Error : could not retrieve team status");const{data:r}=e,s={amount:r.billing.nextBillingDetails.amount,currency:"usd"===r.billing.nextBillingDetails.currency?v.USD:v.EUR,dateUnix:r.billing.nextBillingDetails.dateUnix};return(0,c.Vp)({billingType:"invoice"===t.billingInformation?.billingType?g.Invoice:g.ProcessOut,spaceTier:V(r.planTier),creditCardLastDigits:t.billingInformation?.last4??null,lastBillingDateUnix:r.billing.lastBillingDateUnix,nextBillingDetails:s,seatsNumber:r.seats.paid+r.seats.extraFree,usersToBeRenewedCount:r.billing.usersToBeRenewedCount,daysLeftUntilNextBillingPeriod:D(r.billing.nextBillingDetails.dateUnix)})}))),this.getTeamCapabilities=()=>this.getTeamStatusData().pipe((0,S.U)((e=>{if((0,c.hx)(e))throw new Error("Error : could not retrieve team status");const{data:t}=e;return(0,c.Vp)(t.capabilities)}))),this.getTeamStatusData=()=>this.serverApiClient.v1.teams.teamStatus({}).pipe((0,h.Qn)((({data:e})=>e)),(0,h.DZ)((e=>{throw e}))),this.getTeamSubscriptionInformation=()=>{const{queries:{carbonState:e}}=this.cqrsClient.getClient(b.carbonLegacyApi);return e({path:"state.userSession.localSettings.subscriptionInformation.b2bSubscription"}).pipe((0,S.U)((e=>{if(!(0,c.d6)(e))throw new Error("Cannot retrieve subscription information from Carbon");return e.data})))}}};G=(0,s.__decorate)([(0,l.GS)(),(0,s.__metadata)("design:paramtypes",[E.w,p.l,M])],G);let q=class{constructor(e,t){this.freeTrialService=e,this.teamPlanDetailsService=t}async execute(){const e=await this.freeTrialService.extendFreeTrial();return(0,c.d6)(e)&&await this.teamPlanDetailsService.updateTeamFreeTrialDetails(),e}};q=(0,s.__decorate)([(0,o.W)(u.N),(0,s.__metadata)("design:paramtypes",[m,G])],q);var j=r(29188);let K=class{constructor(e){this.teamPlanDetailsService=e}async execute(){return await this.teamPlanDetailsService.updateTeamFreeTrialDetails(),Promise.resolve((0,c.Vp)(void 0))}};K=(0,s.__decorate)([(0,o.W)(j.h),(0,s.__metadata)("design:paramtypes",[G])],K);var W=r(82276);let B=class{execute(){return Promise.resolve((0,c.Vp)(void 0))}};B=(0,s.__decorate)([(0,o.W)(W.y)],B);var H=r(162),z=r(20754),$=r(26992);let Q=class{constructor(e){this.getTeamPlanDetailsService=e}execute(){return(0,H.D)(this.getTeamPlanDetailsService.getTeamBillingDetails())}};Q=(0,s.__decorate)([(0,z.e)($._),(0,s.__metadata)("design:paramtypes",[G])],Q);var Y=r(69885),X=r(9128);let J=class{execute(){return(0,Y.of)((0,c.Vp)(f.None))}};J=(0,s.__decorate)([(0,z.e)(X.F)],J);var Z=r(30525);let ee=class{constructor(e){this.getTeamPlanDetailsService=e}execute(){return(0,H.D)(this.getTeamPlanDetailsService.getTeamCapabilities())}};ee=(0,s.__decorate)([(0,z.e)(Z.Y),(0,s.__metadata)("design:paramtypes",[G])],ee);var te=r(19068);let re=class{constructor(e){this.cqrsClient=e}execute(){const{queries:{carbonState:e}}=this.cqrsClient.getClient(b.carbonLegacyApi);return e({path:"state.userSession.spaceData.spaces"}).pipe((0,S.U)((e=>{if(!(0,c.d6)(e))throw new Error("Cannot retrieve user spaces");const t=e.data.find((e=>"accepted"===e.details.status));return t?{teamId:t.teamId}:{teamId:null}}))).pipe((0,S.U)(c.Vp))}};re=(0,s.__decorate)([(0,z.e)(te.e),(0,s.__metadata)("design:paramtypes",[E.w])],re);var se=r(43978),ae=r(207);let ne=class{constructor(e,t){this.teamTrialStatusStore=e,this.teamPlanDetailsService=t}execute(){return this.teamTrialStatusStore.state$.pipe((0,se.w)((async e=>e||await this.teamPlanDetailsService.updateTeamFreeTrialDetails())),(0,S.U)((e=>(0,c.Vp)(e))))}};ne=(0,s.__decorate)([(0,z.e)(ae.P),(0,s.__metadata)("design:paramtypes",[M,G])],ne);let ie=class{};ie=(0,s.__decorate)([(0,a.Y)({api:i.o,imports:[n.n],providers:[m,G],stores:[M],handlers:{commands:{extendFreeTrial:q,refreshTeamTrialStatus:K,requestTeamPlanCancellation:B},events:{},queries:{getTeamBillingInformation:Q,getTeamCancellationStatus:J,getTeamCapabilities:ee,getTeamId:re,getTeamTrialStatus:ne}}})],ie)},34431:(e,t,r)=>{"use strict";r.d(t,{K:()=>S});var s=r(88802),a=r(99634),n=r(6447),i=r(1701),o=r(63663),c=r(57220),u=r(60399),d=r(57924),l=r(73404),p=r(48844),h=r(87279),m=r(36767),y=r(56333);let g=class{constructor(e){this.serverApiClient=e}async deleteTeamVat(){return await(0,u.z)(this.serverApiClient.v1.teams.deleteTeamVat().pipe((0,p.DZ)((e=>{if("BusinessError"===e.tag)return(0,c.zK)(e.code);throw new Error(e.message)})),(0,p.lk)((e=>(0,h.Vp)(e.data)))))}async getTeamVat(){return await(0,u.z)(this.serverApiClient.v1.teams.getTeamVat().pipe((0,p.DZ)((e=>{if("BusinessError"===e.tag)return(0,m.K$)(e.code);throw new Error(e.message)})),(0,p.lk)((e=>(0,h.Vp)(e.data)))))}async upsertTeamVat({newVATNumber:e}){return await(0,u.z)(this.serverApiClient.v1.teams.upsertTeamVat({newVATNumber:e}).pipe((0,p.DZ)((e=>{if("BusinessError"===e.tag)return(0,y.q5)(e.code);throw new Error(e.message)})),(0,p.lk)((e=>(0,h.Vp)(e.data)))))}};g=(0,s.__decorate)([(0,d.GS)(),(0,s.__metadata)("design:paramtypes",[l.l])],g);let v=class{constructor(e){this.teamVatService=e}execute(){return this.teamVatService.deleteTeamVat()}};v=(0,s.__decorate)([(0,o.W)(c.Hy),(0,s.__metadata)("design:paramtypes",[g])],v);let f=class{constructor(e){this.teamVatService=e}execute(){return this.teamVatService.getTeamVat()}};f=(0,s.__decorate)([(0,o.W)(m.cf),(0,s.__metadata)("design:paramtypes",[g])],f);let w=class{constructor(e){this.teamVatService=e}execute({body:{newVATNumber:e}}){return this.teamVatService.upsertTeamVat({newVATNumber:e})}};w=(0,s.__decorate)([(0,o.W)(y.XW),(0,s.__metadata)("design:paramtypes",[g])],w);let S=class{};S=(0,s.__decorate)([(0,a.Y)({api:i.a,imports:[n.n],providers:[g],handlers:{commands:{deleteTeamVat:v,getTeamVat:f,upsertTeamVat:w},events:{},queries:{}}})],S)},86392:(e,t,r)=>{"use strict";r.r(t),r.d(t,{CollectionsQuery:()=>F.I,Country:()=>s,CreateCollectionCommand:()=>P.e,CreateVaultItemCommand:()=>n._,CreatedEvent:()=>u.J,DeleteCollectionCommand:()=>I.T,DeleteVaultItemsCommand:()=>i.c,DeletedEvent:()=>d.s,DomainIconDetailsMapSchema:()=>f.x,DomainIconDetailsQuery:()=>p.s,DomainIconDetailsSchema:()=>f.N,EmailType:()=>v,EmitTemporaryVaultItemEventCommand:()=>c.c,EventType:()=>c.t,FilterOperators:()=>h.l,GetVaultNotificationsStatusQuery:()=>x.M,IdentityTitle:()=>S.t,MigrateCategoriesCommand:()=>U._,NoteColors:()=>b.L,OperationType:()=>D.C,PaymentCardColorType:()=>w.X,PhoneType:()=>_.z,SetVaultNotificationsStatusCommand:()=>C.x,SortDirection:()=>m.S,TempCredentialPreferencesQuery:()=>g.M,UpdateCollectionCommand:()=>D.s,UpdateVaultItemCommand:()=>o.K,UpdatedEvent:()=>l.V,VaultItemType:()=>E.U,VaultItemTypeToResultDictionary:()=>A,VaultItemsQuery:()=>y.W,VaultOrganizationClient:()=>O.C,VaultSearchQuery:()=>k.W,vaultItemsCrudApi:()=>a.L,vaultNotificationsApi:()=>T.e,vaultOrganizationApi:()=>R.v,vaultSearchApi:()=>N.R});var s,a=r(48430),n=r(273),i=r(31154),o=r(54547),c=r(47412),u=r(3137),d=r(49135),l=r(72989),p=r(55713),h=r(9531),m=r(24652),y=r(96342),g=r(11907);!function(e){e.NO_TYPE="NO_TYPE",e.UNIVERSAL="UNIVERSAL",e.AD="AD",e.AE="AE",e.AF="AF",e.AG="AG",e.AI="AI",e.AL="AL",e.AM="AM",e.AO="AO",e.AQ="AQ",e.AR="AR",e.AS="AS",e.AT="AT",e.AU="AU",e.AW="AW",e.AX="AX",e.AZ="AZ",e.BA="BA",e.BB="BB",e.BD="BD",e.BE="BE",e.BF="BF",e.BG="BG",e.BH="BH",e.BI="BI",e.BJ="BJ",e.BL="BL",e.BM="BM",e.BN="BN",e.BO="BO",e.BR="BR",e.BS="BS",e.BT="BT",e.BV="BV",e.BW="BW",e.BY="BY",e.BZ="BZ",e.CA="CA",e.CC="CC",e.CD="CD",e.CF="CF",e.CG="CG",e.CH="CH",e.CI="CI",e.CK="CK",e.CL="CL",e.CM="CM",e.CN="CN",e.CO="CO",e.CR="CR",e.CU="CU",e.CV="CV",e.CX="CX",e.CY="CY",e.CZ="CZ",e.DE="DE",e.DJ="DJ",e.DK="DK",e.DM="DM",e.DO="DO",e.DZ="DZ",e.EC="EC",e.EE="EE",e.EG="EG",e.EH="EH",e.ER="ER",e.ES="ES",e.ET="ET",e.FI="FI",e.FJ="FJ",e.FK="FK",e.FM="FM",e.FO="FO",e.FR="FR",e.GA="GA",e.GB="GB",e.GD="GD",e.GE="GE",e.GF="GF",e.GG="GG",e.GH="GH",e.GI="GI",e.GL="GL",e.GM="GM",e.GN="GN",e.GP="GP",e.GQ="GQ",e.GR="GR",e.GS="GS",e.GT="GT",e.GU="GU",e.GW="GW",e.GY="GY",e.HK="HK",e.HM="HM",e.HN="HN",e.HR="HR",e.HT="HT",e.HU="HU",e.ID="ID",e.IE="IE",e.IL="IL",e.IM="IM",e.IN="IN",e.IO="IO",e.IQ="IQ",e.IR="IR",e.IS="IS",e.IT="IT",e.JE="JE",e.JM="JM",e.JO="JO",e.JP="JP",e.KE="KE",e.KG="KG",e.KH="KH",e.KI="KI",e.KM="KM",e.KN="KN",e.KP="KP",e.KR="KR",e.KW="KW",e.KY="KY",e.KZ="KZ",e.LA="LA",e.LB="LB",e.LC="LC",e.LI="LI",e.LK="LK",e.LR="LR",e.LS="LS",e.LT="LT",e.LU="LU",e.LV="LV",e.LY="LY",e.MA="MA",e.MC="MC",e.MD="MD",e.ME="ME",e.MF="MF",e.MG="MG",e.MH="MH",e.MK="MK",e.ML="ML",e.MM="MM",e.MN="MN",e.MO="MO",e.MP="MP",e.MQ="MQ",e.MR="MR",e.MS="MS",e.MT="MT",e.MU="MU",e.MV="MV",e.MW="MW",e.MX="MX",e.MY="MY",e.MZ="MZ",e.NA="NA",e.NC="NC",e.NE="NE",e.NF="NF",e.NG="NG",e.NI="NI",e.NL="NL",e.NO="NO",e.NP="NP",e.NR="NR",e.NU="NU",e.NZ="NZ",e.OM="OM",e.PA="PA",e.PE="PE",e.PF="PF",e.PG="PG",e.PH="PH",e.PK="PK",e.PL="PL",e.PM="PM",e.PN="PN",e.PR="PR",e.PS="PS",e.PT="PT",e.PW="PW",e.PY="PY",e.QA="QA",e.RE="RE",e.RO="RO",e.RS="RS",e.RU="RU",e.RW="RW",e.SA="SA",e.SB="SB",e.SC="SC",e.SD="SD",e.SE="SE",e.SG="SG",e.SH="SH",e.SI="SI",e.SJ="SJ",e.SK="SK",e.SL="SL",e.SM="SM",e.SN="SN",e.SO="SO",e.SR="SR",e.ST="ST",e.SV="SV",e.SY="SY",e.SZ="SZ",e.TC="TC",e.TD="TD",e.TF="TF",e.TG="TG",e.TH="TH",e.TJ="TJ",e.TK="TK",e.TL="TL",e.TM="TM",e.TN="TN",e.TO="TO",e.TR="TR",e.TT="TT",e.TV="TV",e.TW="TW",e.TZ="TZ",e.UA="UA",e.UG="UG",e.UM="UM",e.US="US",e.UY="UY",e.UZ="UZ",e.VA="VA",e.VC="VC",e.VE="VE",e.VG="VG",e.VI="VI",e.VN="VN",e.VU="VU",e.WF="WF",e.WS="WS",e.XK="XK",e.YE="YE",e.YT="YT",e.ZA="ZA",e.ZM="ZM",e.ZW="ZW"}(s||(s={}));var v,f=r(19074),w=r(45146);!function(e){e.Perso="PERSO",e.Pro="PRO",e.NoType="NO_TYPE"}(v||(v={}));var S=r(11329),_=r(82009),b=r(7149),E=r(82706);const A={[E.U.Address]:"addressesResult",[E.U.BankAccount]:"bankAccountsResult",[E.U.Company]:"companiesResult",[E.U.Credential]:"credentialsResult",[E.U.DriversLicense]:"driversLicensesResult",[E.U.Email]:"emailsResult",[E.U.FiscalId]:"fiscalIdsResult",[E.U.IdCard]:"idCardsResult",[E.U.Identity]:"identitiesResult",[E.U.Passkey]:"passkeysResult",[E.U.Passport]:"passportsResult",[E.U.PaymentCard]:"paymentCardsResult",[E.U.Phone]:"phonesResult",[E.U.SecureNote]:"secureNotesResult",[E.U.SocialSecurityId]:"socialSecurityIdsResult",[E.U.Website]:"websitesResult"};var T=r(22499),C=r(12338),x=r(42160),R=r(99074),I=r(25041),P=r(533),D=r(96862),U=r(65378),F=r(6519),O=r(87969),N=r(73883),k=r(88994)},48430:(e,t,r)=>{"use strict";r.d(t,{L:()=>m});var s=r(86952),a=r(273),n=r(31154),i=r(54547),o=r(47412),c=r(3137),u=r(49135),d=r(72989),l=r(55713),p=r(96342),h=r(11907);const m=(0,s.Q)({name:"vaultItemsCrud",commands:{createVaultItem:a._,deleteVaultItems:n.c,updateVaultItem:i.K,emitTemporaryVaultItemEvent:o.c},events:{createdEvent:c.J,deletedEvent:u.s,updatedEvent:d.V},queries:{domainIconDetails:l.s,query:p.W,tempCredentialPreferences:h.M}})},273:(e,t,r)=>{"use strict";r.d(t,{_:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},31154:(e,t,r)=>{"use strict";r.d(t,{c:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},47412:(e,t,r)=>{"use strict";r.d(t,{c:()=>i,t:()=>s});var s,a=r(74354),n=r(25029);!function(e){e.Deleted="deleted",e.Updated="updated",e.Created="created"}(s||(s={}));class i extends((0,a.g)({scope:n.F.User})){}},54547:(e,t,r)=>{"use strict";r.d(t,{K:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},77649:(e,t,r)=>{"use strict";r.d(t,{D:()=>n});var s=r(88885),a=r(25029);class n extends((0,s.d)({scope:a.F.User})){}},3137:(e,t,r)=>{"use strict";r.d(t,{J:()=>a});var s=r(77649);class a extends s.D{}},49135:(e,t,r)=>{"use strict";r.d(t,{s:()=>a});var s=r(77649);class a extends s.D{}},72989:(e,t,r)=>{"use strict";r.d(t,{V:()=>a});var s=r(77649);class a extends s.D{}},55713:(e,t,r)=>{"use strict";r.d(t,{s:()=>n});var s=r(99059),a=r(25029);class n extends((0,s.k)({scope:a.F.User})){}},9531:(e,t,r)=>{"use strict";var s;r.d(t,{l:()=>s}),function(e){e.Equal="equal",e.LessThan="lessThan",e.GreaterThan="greaterThan"}(s||(s={}))},24652:(e,t,r)=>{"use strict";var s;r.d(t,{S:()=>s}),function(e){e.Ascend="ascend",e.Descend="descend"}(s||(s={}))},11907:(e,t,r)=>{"use strict";r.d(t,{M:()=>n});var s=r(99059),a=r(25029);class n extends((0,s.k)({scope:a.F.User})){}},96342:(e,t,r)=>{"use strict";r.d(t,{W:()=>n});var s=r(99059),a=r(25029);class n extends((0,s.k)({scope:a.F.User})){}},19074:(e,t,r)=>{"use strict";r.d(t,{N:()=>i,x:()=>o});var s=r(7165);const a=["crawled","xs","sm","sm@2x","md","md.tiff","xmd","xmd@2x","l","l@2x","xl","xl@2x","46x30","46x30@2x","50x33","50x33@2x","56x56","56x56@2x","118x98","118x98@2x","160x106","160x106@2x"],n=(s.z.enum(a),a.reduce(((e,t)=>e.setKey(t,s.z.string().optional().nullable())),s.z.object({}))),i=s.z.object({backgroundColor:s.z.string(),mainColor:s.z.string(),urls:n}),o=s.z.map(s.z.string(),i)},45146:(e,t,r)=>{"use strict";var s;r.d(t,{X:()=>s}),function(e){e.Black="BLACK",e.Blue1="BLUE1",e.Blue2="BLUE2",e.Gold="GOLD",e.Green1="GREEN1",e.Green2="GREEN2",e.Orange="ORANGE",e.Red="RED",e.Silver="SILVER",e.White="WHITE"}(s||(s={}))},11329:(e,t,r)=>{"use strict";var s;r.d(t,{t:()=>s}),function(e){e.Mr="MR",e.Mrs="MRS",e.Miss="MISS",e.Ms="MS",e.Mx="MX",e.NoneOfThese="NONEOFTHESE"}(s||(s={}))},82009:(e,t,r)=>{"use strict";var s;r.d(t,{z:()=>s}),function(e){e.Any="ANY",e.Fax="FAX",e.Landline="LANDLINE",e.Mobile="MOBILE",e.WorkFax="WORKFAX",e.WorkLandline="WORKLANDLINE",e.WorkMobile="WORKMOBILE"}(s||(s={}))},7149:(e,t,r)=>{"use strict";var s;r.d(t,{L:()=>s}),function(e){e.BLUE="BLUE",e.BROWN="BROWN",e.GRAY="GRAY",e.GREEN="GREEN",e.ORANGE="ORANGE",e.PINK="PINK",e.PURPLE="PURPLE",e.RED="RED",e.YELLOW="YELLOW"}(s||(s={}))},82706:(e,t,r)=>{"use strict";var s;r.d(t,{U:()=>s}),function(e){e.Address="KWAddress",e.BankAccount="KWBankStatement",e.Company="KWCompany",e.Credential="KWAuthentifiant",e.DriversLicense="KWDriverLicence",e.Email="KWEmail",e.FiscalId="KWFiscalStatement",e.IdCard="KWIDCard",e.Identity="KWIdentity",e.Passkey="KWPasskey",e.Passport="KWPassport",e.PaymentCard="KWPaymentMean_creditCard",e.Phone="KWPhone",e.SecureNote="KWSecureNote",e.SocialSecurityId="KWSocialSecurityStatement",e.Website="KWPersonalWebsite"}(s||(s={}))},22499:(e,t,r)=>{"use strict";r.d(t,{e:()=>i});var s=r(86952),a=r(12338),n=r(42160);const i=(0,s.Q)({name:"vaultNotifications",commands:{setVaultNotificationsStatus:a.x},events:{},queries:{getVaultNotificationsStatus:n.M}})},12338:(e,t,r)=>{"use strict";r.d(t,{x:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},42160:(e,t,r)=>{"use strict";r.d(t,{M:()=>n});var s=r(99059),a=r(25029);class n extends((0,s.k)({scope:a.F.User})){}},99074:(e,t,r)=>{"use strict";r.d(t,{v:()=>u});var s=r(86952),a=r(25041),n=r(533),i=r(65378),o=r(96862),c=r(6519);const u=(0,s.Q)({name:"vaultOrganization",commands:{deleteCollection:a.T,createCollection:n.e,migrateCategories:i._,updateCollection:o.s},events:{},queries:{queryCollections:c.I}})},533:(e,t,r)=>{"use strict";r.d(t,{e:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},25041:(e,t,r)=>{"use strict";r.d(t,{T:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},65378:(e,t,r)=>{"use strict";r.d(t,{_:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},96862:(e,t,r)=>{"use strict";r.d(t,{C:()=>s,s:()=>i});var s,a=r(74354),n=r(25029);!function(e){e.SUBSTRACT_VAULT_ITEMS="subtract_vault_items",e.APPEND_VAULT_ITEMS="append_vault_items"}(s||(s={}));class i extends((0,a.g)({scope:n.F.User})){}},6519:(e,t,r)=>{"use strict";r.d(t,{I:()=>n});var s=r(99059),a=r(25029);class n extends((0,s.k)({scope:a.F.User})){}},87969:(e,t,r)=>{"use strict";r.d(t,{C:()=>n});var s=r(67837),a=r(99074);class n extends((0,s.E)(a.v)){}(0,s.K)(a.v,n)},73883:(e,t,r)=>{"use strict";r.d(t,{R:()=>n});var s=r(86952),a=r(88994);const n=(0,s.Q)({name:"vaultSearch",commands:{},events:{},queries:{search:a.W}})},88994:(e,t,r)=>{"use strict";r.d(t,{W:()=>n});var s=r(99059),a=r(25029);class n extends((0,s.k)({scope:a.F.User})){}},76422:(e,t,r)=>{"use strict";r.d(t,{z:()=>V});var s,a=r(88802),n=r(99634),i=r(37935),o=r(48430);!function(e){e.PasskeysInVaultDev="vault_web_passkey_dev",e.PasskeysInVaultProd="vault_web_passkey_prod"}(s||(s={}));var c=r(63663),u=r(94189),d=r(87279),l=r(53576),p=r(273),h=r(81459),m=r(57924);let y=class extends h.f{};y=(0,a.__decorate)([(0,m.GS)()],y);let g=class{constructor(e,t){this.client=e,this.eventEmitter=t}async execute({body:e}){const{vaultItemType:t,content:r}=e,{commands:s}=this.client.getClient(l.carbonLegacyApi),a=await s.carbonLegacyLeeloo({name:"savePersonalDataItem",arg:[{kwType:t,origin:"MANUAL",content:{...r,id:void 0}}]});if((0,d.hx)(a))throw new Error(`Failed to create ${t}`);return this.eventEmitter.sendEvent("created",{ids:[],vaultItemType:t}),Promise.resolve((0,d.Vp)(void 0))}};g=(0,a.__decorate)([(0,c.W)(p._),(0,a.__metadata)("design:paramtypes",[u.w,y])],g);var v=r(31154);let f=class{constructor(e,t){this.client=e,this.eventEmitter=t}async execute({body:e}){const{vaultItemType:t,ids:r}=e,{commands:s}=this.client.getClient(l.carbonLegacyApi),a=[],n=r.map((e=>s.carbonLegacyLeeloo({name:"removePersonalDataItem",arg:[{id:e}]}).then((t=>{(0,d.d6)(t)&&a.push(e)}))));return await Promise.allSettled(n),a.length>0&&this.eventEmitter.sendEvent("deleted",{ids:a,vaultItemType:t}),a.length!==r.length?Promise.resolve((0,d.Rn)({tag:"error",errorMessage:`Error: Failed to delete all ${t}s`,failedDeletionIds:Array.from(new Set(...r,...a))})):Promise.resolve((0,d.Vp)(void 0))}};f=(0,a.__decorate)([(0,c.W)(v.c),(0,a.__metadata)("design:paramtypes",[u.w,y])],f);var w=r(54547);let S=class{constructor(e,t){this.client=e,this.eventEmitter=t}async execute({body:e}){const{content:t,id:r,vaultItemType:s}=e,{commands:a}=this.client.getClient(l.carbonLegacyApi),n=await a.carbonLegacyLeeloo({name:"savePersonalDataItem",arg:[{kwType:s,origin:"MANUAL",content:{...t,id:r}}]});if((0,d.hx)(n))throw new Error(`Failed to update ${s}`);return this.eventEmitter.sendEvent("updated",{ids:[r],vaultItemType:s}),Promise.resolve((0,d.Vp)(void 0))}};S=(0,a.__decorate)([(0,c.W)(w.K),(0,a.__metadata)("design:paramtypes",[u.w,y])],S);var _=r(82706),b=r(47412);let E=class{constructor(e){this.eventEmitter=e}execute({body:e}){const{ids:t,eventType:r}=e;return this.eventEmitter.sendEvent(r,{ids:t,vaultItemType:_.U.Credential}),Promise.resolve((0,d.Vp)(void 0))}};E=(0,a.__decorate)([(0,c.W)(b.c),(0,a.__metadata)("design:paramtypes",[y])],E);var A=r(20754),T=r(55713),C=r(48844),x=r(60733),R=r(96303),I=r(54066),P=r(19074);let D=class{constructor(e,t){this.carbonLegacyClient=e,this.md5Hasher=t}execute({body:{domain:e}}){const{queries:{carbonState:t}}=this.carbonLegacyClient;return t({path:"userSession.iconsCache.domains"}).pipe((0,C.Qn)((t=>{if(r=t,!P.x.safeParse(r).success)throw new Error("Bad domain icons cache format");var r;return t.get((0,R.k)(this.md5Hasher.compute((0,I.u)(e))))})))}};D=(0,a.__decorate)([(0,A.e)(T.s),(0,a.__metadata)("design:paramtypes",[l.CarbonLegacyClient,x.f])],D);var U=r(96342),F=r(8266);let O=class{constructor(e){this.vaultRepository=e}execute({body:e}){return this.vaultRepository.fetchVaultItems$(e)}};O=(0,a.__decorate)([(0,A.e)(U.W),(0,a.__metadata)("design:paramtypes",[F.g])],O);var N=r(87065),k=r(11907),L=r(17426);let M=class{constructor(e){this.carbonLegacyClient=e}execute({body:{credentialId:e}}){const{queries:{carbonState:t}}=this.carbonLegacyClient;return t({path:"userSession.personalData.credentials"}).pipe((0,N.U)((t=>{if((0,d.hx)(t)||!(0,L.J)(t.data))throw new Error("Bad credentials format");const r=t.data.find((t=>t.Id===e));if(!r)throw new Error("Credential matching provided id not found");return(0,d.Vp)({useAutoLogin:Boolean(r.AutoLogin),onlyAutofillExactDomain:Boolean(r.SubdomainOnly),requireMasterPassword:Boolean(r.AutoProtected)})})))}};M=(0,a.__decorate)([(0,A.e)(k.M),(0,a.__metadata)("design:paramtypes",[l.CarbonLegacyClient])],M);let V=class{};V=(0,a.__decorate)([(0,n.Y)({api:o.L,handlers:{commands:{createVaultItem:g,deleteVaultItems:f,updateVaultItem:S,emitTemporaryVaultItemEvent:E},events:{},queries:{domainIconDetails:D,query:O,tempCredentialPreferences:M}},imports:[i.D],providers:[y,F.g],requiredFeatureFlips:Object.values(s)})],V)},20491:(e,t,r)=>{"use strict";r.d(t,{K:()=>S});var s=r(88802),a=r(99634),n=r(22499),i=r(95681),o=r(23347),c=r(25029),u=r(10722);const d=e=>!(!e||"object"!=typeof e)&&"isCollectionGuidedIntroEnabled"in e;class l extends((0,i.Q)({persist:!0,storage:{initialValue:{isCollectionGuidedIntroEnabled:!0},typeGuard:d,schemaVersion:1},scope:c.F.User,storeName:"vault-notifications",capacity:o.Y._001KB,codec:u.E})){}var p=r(63663),h=r(87279),m=r(12338);let y=class{constructor(e){this.store=e}async execute({body:e}){const{notificationName:t,isEnabled:r}=e;try{const e=await this.store.getState();return await this.store.set({...e,[t]:r}),(0,h.Vp)(void 0)}catch{throw new Error("SetVaultNotificationsStatus command from vault-core failed")}}};y=(0,s.__decorate)([(0,p.W)(m.x),(0,s.__metadata)("design:paramtypes",[l])],y);var g=r(87065),v=r(20754),f=r(42160);let w=class{constructor(e){this.store=e}execute(){return this.store.state$.pipe((0,g.U)(h.Vp))}};w=(0,s.__decorate)([(0,v.e)(f.M),(0,s.__metadata)("design:paramtypes",[l])],w);let S=class{};S=(0,s.__decorate)([(0,a.Y)({api:n.e,handlers:{commands:{setVaultNotificationsStatus:y},events:{},queries:{getVaultNotificationsStatus:w}},stores:[l]})],S)},55808:(e,t,r)=>{"use strict";r.d(t,{H:()=>O});var s=r(88802),a=r(99634),n=r(99074),i=r(60399),o=r(25041),c=r(63663),u=r(94189),d=r(53576),l=r(87279),p=r(92233),h=r(48844);const m=e=>!!Array.isArray(e)&&(0===e.length||e.every((e=>{const t=e;return"string"==typeof t.Id&&"string"==typeof t.Name&&Array.isArray(t.VaultItems)})));function y(e,t){const{queries:{carbonState:r}}=e.getClient(d.carbonLegacyApi);return r({path:"userSession.personalData.collections"}).pipe((0,h.Qn)((e=>{if(!m(e))throw new Error("Collection array has a wrong format");return{collections:(t&&t.length>0?e.filter((e=>t.includes(e.Id))):e).map((e=>({id:e.Id,name:e.Name,spaceId:e.SpaceId,vaultItems:e.VaultItems.map((e=>({id:e.Id,type:e.Type})))})))}})))}function g(e,t,r,s){const a=new p.UserUpdateCollectionEvent({collectionId:r,action:t,itemCount:s,isShared:!1});return e.commands.carbon({name:"logEvent",args:[{event:a}]})}let v=class{constructor(e){this.client=e}async execute({body:e}){const{id:t}=e,r=await(0,i.z)(y(this.client,[t]));if((0,l.hx)(r))throw new Error(`Failed to fetch additional collection info: ${r.error}`);const s=await this.client.getClient(d.carbonLegacyApi).commands.carbon({name:"deleteCollection",args:[{id:t}]});if((0,l.hx)(s))throw new Error(`Failed to delete collection: ${s.error}`);return g(this.client.getClient(d.carbonLegacyApi),p.CollectionAction.Delete,t,r.data.collections[0]?.vaultItems?.length),Promise.resolve((0,l.Vp)(void 0))}};v=(0,s.__decorate)([(0,c.W)(o.T),(0,s.__metadata)("design:paramtypes",[u.w])],v);var f=r(533),w=r(28489);let S=class{constructor(e){this.carbonLegacy=e.getClient(d.carbonLegacyApi)}async execute({body:e}){const{content:{name:t,spaceId:r="",vaultItems:s=[]}}=e,a=await this.carbonLegacy.commands.carbon({name:"addCollection",args:[{name:t,spaceId:r,vaultItems:s}]});if((0,l.hx)(a))throw new Error(`Failed to create collection: ${a.error}`);if("object"!=typeof(n=a.data.carbonResult)||null===n||!(0,w.l$)(n,"id")||"string"!=typeof n.id||!(0,w.l$)(n,"success")||"boolean"!=typeof n.success)throw new Error("Failed to find created collection id");var n;return g(this.carbonLegacy,p.CollectionAction.Add,a.data.carbonResult.id,s.length),s.length&&g(this.carbonLegacy,p.CollectionAction.AddCredential,a.data.carbonResult.id,s.length),(0,l.Vp)({id:a.data.id})}};S=(0,s.__decorate)([(0,c.W)(f.e),(0,s.__metadata)("design:paramtypes",[u.w])],S);var _=r(65378),b=r(25029),E=r(95681),A=r(23347),T=r(10722);const C=e=>!0;class x extends((0,E.Q)({persist:!0,scope:b.F.Device,storeName:"collections-store",storeTypeGuard:C,capacity:A.Y._001KB,codec:T.E,storage:{schemaVersion:3,initialValue:{isCredentialCategoriesMigrated:{}},typeGuard:C,migrateStorageSchema:()=>({isCredentialCategoriesMigrated:{}})}})){}let R=class{constructor(e,t){this.client=e,this.store=t}updateCollection(e,t){const{commands:r}=this.client.getClient(n.v);return r.updateCollection({id:e,collection:t})}createCollection(e){const{commands:t}=this.client.getClient(n.v);return t.createCollection({content:e})}fetchCategories(){const{queries:{carbonState:e}}=this.client.getClient(d.carbonLegacyApi);return e({path:"userSession.personalData.credentialCategories"}).pipe((0,h.Qn)((e=>e)))}async fetchCredentials(){const{queries:{carbonState:e}}=this.client.getClient(d.carbonLegacyApi),t=await(0,i.z)(this.fetchCategories());if((0,l.hx)(t))throw new Error("Failed to fetch categories");const r=t.data;return e({path:"userSession.personalData.credentials"}).pipe((0,h.Qn)((e=>{if(t=e,!Array.isArray(t))throw new Error("Bad credential format");var t;return e.map((e=>{const t=r.find((t=>t.Id===e.Category))?.CategoryName;return{...e,CategoryName:t}}))})))}async finalizeMigration(e,t){return t.isCredentialCategoriesMigrated[e]=!0,await this.store.set(t),Promise.resolve((0,l.Vp)(void 0))}async execute({body:e}){const t=e;if(!t)throw new Error("Failed to fetch username");const r=await this.store.getState();if(r.isCredentialCategoriesMigrated[t])return Promise.resolve((0,l.Vp)(void 0));const s=await(0,i.z)(await this.fetchCredentials());if((0,l.hx)(s))throw new Error("Failed to fetch credentials");const a=s.data;if(0===a.length)return this.finalizeMigration(t,r);const n=await(0,i.z)(y(this.client));if((0,l.hx)(n))throw new Error("Failed to fetch collections");const o=n.data.collections;o.forEach((e=>{"string"!=typeof e.spaceId&&(e.spaceId="")}));const c=[];for(let e=0;e<a.length;e++){const t=a[e];if(!t.CategoryName)continue;const r=t.CategoryName,s=t.SpaceId??"",n=o.find((e=>e.name===r&&e.spaceId===s));if(n){n.vaultItems.push({id:t.Id,type:"KWAuthentifiant"});continue}const i=c.find((e=>e.name===r&&e.spaceId===s));i?i.vaultItems.push({id:t.Id,type:"KWAuthentifiant"}):c.push({name:r,spaceId:s,vaultItems:[{id:t.Id,type:"KWAuthentifiant"}]})}for(const e of o)await this.updateCollection(e.id,e);for(const e of c)await this.createCollection(e);return this.finalizeMigration(t,r)}};R=(0,s.__decorate)([(0,c.W)(_._),(0,s.__metadata)("design:paramtypes",[u.w,x])],R);var I=r(96862);let P=class{constructor(e){this.client=e}async execute({body:e}){const{id:t,collection:r,operationType:s=I.C.APPEND_VAULT_ITEMS}=e,a=await(0,i.z)(y(this.client,[t]));if((0,l.hx)(a))throw new Error(`Failed to fetch additional collection info: ${a.error}`);const n=a.data.collections[0];r.vaultItems&&(n.vaultItems=this.mutateCollectionVaultItems(n,s,r.vaultItems));const o=await this.client.getClient(d.carbonLegacyApi).commands.carbon({name:"updateCollection",args:[{id:n.id,name:r.name??n.name,spaceId:r.spaceId??n.spaceId,vaultItems:n.vaultItems}]});if((0,l.hx)(o))throw new Error(`Failed to update collection: ${o.error}`);return this.handleLogs(n,r,s),Promise.resolve((0,l.Vp)(void 0))}handleLogs(e,t,r){t.name&&g(this.client.getClient(d.carbonLegacyApi),p.CollectionAction.Edit,e.id,e.vaultItems.length),t.vaultItems&&g(this.client.getClient(d.carbonLegacyApi),r===I.C.SUBSTRACT_VAULT_ITEMS?p.CollectionAction.DeleteCredential:p.CollectionAction.AddCredential,e.id,1)}getDeduplicatedList(e){return[...new Map(e.map((e=>[e.id,e]))).values()]}mutateCollectionVaultItems(e,t,r){return t===I.C.SUBSTRACT_VAULT_ITEMS?e.vaultItems.filter((e=>!r.some((t=>t.id===e.id)))):this.getDeduplicatedList([...e.vaultItems,...r])}};P=(0,s.__decorate)([(0,c.W)(I.s),(0,s.__metadata)("design:paramtypes",[u.w])],P);var D=r(6519),U=r(20754);let F=class{constructor(e){this.client=e}execute({body:e}){const{ids:t}=e;return y(this.client,t)}};F=(0,s.__decorate)([(0,U.e)(D.I),(0,s.__metadata)("design:paramtypes",[u.w])],F);let O=class{};O=(0,s.__decorate)([(0,a.Y)({api:n.v,stores:[x],handlers:{commands:{deleteCollection:v,createCollection:S,migrateCategories:R,updateCollection:P},events:{},queries:{queryCollections:F}},requiredFeatureFlips:["vault_web_collection_migration_space_prod_v2","vault_web_popupSavedState_release"]})],O)},17426:(e,t,r)=>{"use strict";r.d(t,{J:()=>a});var s=r(89722);const a=e=>(0,s.w)(e,["Id"])},89722:(e,t,r)=>{"use strict";function s(e,t){if(!Array.isArray(e))return!1;if(0===e.length)return!0;const r=e[0];for(let e=0;e<t.length;e++){const s=t[e];if(!Object.prototype.hasOwnProperty.call(r,s))return!1}return!0}r.d(t,{w:()=>s})},8266:(e,t,r)=>{"use strict";r.d(t,{g:()=>te});var s=r(88802),a=r(85390),n=r(87065),i=r(57924),o=r(87279),c=r(48844),u=r(53576),d=r(82706);function l(e,t){return e in t}function p(e){const t={};for(const r in e)t[r.charAt(0).toLowerCase()+r.slice(1)]=e[r];return t}var h=r(9531);function m(e,t,r){return t||r?e.filter((e=>!(t&&!t.every((t=>l(t.property,e)&&function(e,t,r=h.l.Equal){return{[h.l.Equal]:()=>e===t,[h.l.LessThan]:()=>e<t,[h.l.GreaterThan]:()=>e>t}[r]()}(e[t.property],t.value,t.operator))))&&(r?.(e)??!0))):e}var y=r(24652);var g=r(89722);const v=e=>(0,g.w)(e,["AddressName"]),f=e=>(0,g.w)(e,["Name"]),w=e=>(0,g.w)(e,["Email"]),S=e=>(0,g.w)(e,["FirstName","LastName"]),_=e=>(0,g.w)(e,["Number"]),b=e=>(0,g.w)(e,["Website"]),E=e=>(0,g.w)(e,["BankAccountIBAN","BankAccountBIC","BankAccountName"]);var A=r(17426);const T=e=>(0,g.w)(e,[]),C=e=>(0,g.w)(e,[]),x=e=>(0,g.w)(e,[]),R=e=>(0,g.w)(e,[]),I=e=>(0,g.w)(e,["SocialSecurityNumber"]),P=e=>(0,g.w)(e,["PrivateKey"]),D=e=>(0,g.w)(e,["CardNumber"]),U=e=>(0,g.w)(e,["Content","Title"]),F=e=>{const{AddressName:t,LinkedPhone:r,StreetName:s,AddressFull:a,StateLevel2:n,...i}=e;return{...p(i),itemName:t,linkedPhoneId:r,streetName:s||a}},O=e=>{const{BankAccountName:t,BankAccountOwner:r,BankAccountIBAN:s,BankAccountBIC:a,BankAccountBank:n,...i}=e;return{...p(i),accountName:t,bankCode:n||"",BIC:a,country:i.LocaleFormat,IBAN:s,ownerName:r}},N=e=>{const{Name:t,JobTitle:r,PersonalNote:s,...a}=e;return{...p(a),companyName:t,jobTitle:r}},k=e=>{const{AnonId:t,CreationDatetime:r,Email:s,Id:a,LastBackupTime:n,LastUse:i,LinkedServices:o,LocaleFormat:c,Login:u,Note:d,OtpSecret:l,OtpUrl:h,Password:m,SecondaryLogin:y,SpaceId:g,Title:v,Url:f,UserModificationDatetime:w}=e;return{...p({AnonId:t,CreationDatetime:r,Email:s,Id:a,LastBackupTime:n,LastUse:i,LocaleFormat:c,Note:d,Password:m,SpaceId:g,UserModificationDatetime:w}),alternativeUsername:y,itemName:v,linkedURLs:o?.associated_domains.map((e=>e.domain))??[],otpURL:h??l,URL:f,username:u}},L=e=>{const{DeliveryDate:t,ExpireDate:r,Fullname:s,LinkedIdentity:a,Number:n,DateOfBirth:i,Sex:o,...c}=e;return{...p(c),idName:s,idNumber:n,issueDate:t,expirationDate:r,country:c.LocaleFormat}},M=e=>{const{EmailName:t,Email:r,Type:s,...a}=e;return{...p(a),itemName:t,emailAddress:r,type:s}},V=e=>({...p(e),country:e.LocaleFormat}),G=e=>{const{DateOfBirth:t,DeliveryDate:r,ExpireDate:s,Fullname:a,LinkedIdentity:n,Number:i,Sex:o,...c}=e;return{...p(c),idName:a,idNumber:i,issueDate:r,expirationDate:s,country:c.LocaleFormat}};var q=r(11329);const j={"":void 0,MR:q.t.Mr,MME:q.t.Mrs,MLLE:q.t.Miss,MS:q.t.Ms,MX:q.t.Mx,NONE_OF_THESE:q.t.NoneOfThese},K=e=>{const{Title:t,...r}=e;return{...p(r),title:j[t]}},W=e=>{const{DeliveryDate:t,DeliveryPlace:r,ExpireDate:s,Fullname:a,LinkedIdentity:n,Number:i,DateOfBirth:o,Sex:c,...u}=e;return{...p(u),idName:a,idNumber:i||"",issueDate:t,issuePlace:r||"",expirationDate:s,country:u.LocaleFormat}};var B=r(45146);const H={BLACK:B.X.Black,BLUE_1:B.X.Blue1,BLUE_2:B.X.Blue2,GOLD:B.X.Gold,GREEN_1:B.X.Green1,GREEN_2:B.X.Green2,ORANGE:B.X.Orange,RED:B.X.Red,SILVER:B.X.Silver,WHITE:B.X.White},z=e=>{const{Name:t,CCNote:r,Color:s,Bank:a,CardNumberLastDigits:n,IssueNumber:i,StartMonth:o,StartYear:c,Type:u,...d}=e;return{...p(d),itemName:t,color:H[s],note:r||""}};var $=r(82009);const Q={[u.PhoneType.PHONE_TYPE_ANY]:$.z.Any,[u.PhoneType.PHONE_TYPE_FAX]:$.z.Fax,[u.PhoneType.PHONE_TYPE_LANDLINE]:$.z.Landline,[u.PhoneType.PHONE_TYPE_MOBILE]:$.z.Mobile,[u.PhoneType.PHONE_TYPE_WORK_FAX]:$.z.WorkFax,[u.PhoneType.PHONE_TYPE_WORK_LANDLINE]:$.z.WorkLandline,[u.PhoneType.PHONE_TYPE_WORK_MOBILE]:$.z.WorkMobile},Y=e=>{const{PhoneName:t,Number:r,Type:s,...a}=e;return{...p(a),itemName:t,phoneNumber:r,type:Q[s]}};var X=r(7149);const J=e=>{const{Secured:t,Type:r,...s}=e;return{...p(s),isSecured:t,color:X.L[r]}},Z=e=>{const{DateOfBirth:t,LinkedIdentity:r,Sex:s,SocialSecurityFullname:a,SocialSecurityNumber:n,...i}=e;return{...p(i),idName:a,idNumber:n,country:i.LocaleFormat}},ee=e=>{const{Website:t,Name:r,PersonalNote:s,...a}=e;return{...p(a),itemName:r,URL:t}};let te=class{constructor(e){this.carbonLegacyClient=e,this.getVaultItems$TypeDictionary={[d.U.Address]:this.getVaultItems$("addressesResult",v,F),[d.U.BankAccount]:this.getVaultItems$("bankAccountsResult",E,O),[d.U.Company]:this.getVaultItems$("companiesResult",f,N),[d.U.Credential]:this.getVaultItems$("credentialsResult",A.J,k),[d.U.DriversLicense]:this.getVaultItems$("driversLicensesResult",T,L,"driverLicenses"),[d.U.Email]:this.getVaultItems$("emailsResult",w,M),[d.U.FiscalId]:this.getVaultItems$("fiscalIdsResult",C,V),[d.U.IdCard]:this.getVaultItems$("idCardsResult",x,G),[d.U.Identity]:this.getVaultItems$("identitiesResult",S,K),[d.U.Passkey]:this.getVaultItems$("passkeysResult",P,p),[d.U.Passport]:this.getVaultItems$("passportsResult",R,W),[d.U.PaymentCard]:this.getVaultItems$("paymentCardsResult",D,z),[d.U.Phone]:this.getVaultItems$("phonesResult",_,Y),[d.U.SecureNote]:this.getVaultItems$("secureNotesResult",U,J,"notes"),[d.U.SocialSecurityId]:this.getVaultItems$("socialSecurityIdsResult",I,Z),[d.U.Website]:this.getVaultItems$("websitesResult",b,ee,"personalWebsites")},this.getEmptyVaultItemsQueryResult=()=>({addressesResult:this.getEmptyItemsQueryResult(),bankAccountsResult:this.getEmptyItemsQueryResult(),companiesResult:this.getEmptyItemsQueryResult(),credentialsResult:this.getEmptyItemsQueryResult(),driversLicensesResult:this.getEmptyItemsQueryResult(),emailsResult:this.getEmptyItemsQueryResult(),fiscalIdsResult:this.getEmptyItemsQueryResult(),idCardsResult:this.getEmptyItemsQueryResult(),identitiesResult:this.getEmptyItemsQueryResult(),passkeysResult:this.getEmptyItemsQueryResult(),passportsResult:this.getEmptyItemsQueryResult(),paymentCardsResult:this.getEmptyItemsQueryResult(),phonesResult:this.getEmptyItemsQueryResult(),secureNotesResult:this.getEmptyItemsQueryResult(),socialSecurityIdsResult:this.getEmptyItemsQueryResult(),websitesResult:this.getEmptyItemsQueryResult()}),this.getEmptyItemsQueryResult=()=>({items:[],matchCount:0})}initializeVaultItemsQueryParams(e){const{ids:t,pageSize:r,pageNumber:s,propertyFilters:a,propertySorting:n}=e;this.ids=t,this.propertyFilters=a,this.propertySorting=n,this.pageSize=r,this.pageNumber=s}fetchVaultItems$(e,t){const{vaultItemTypes:r,...s}=e;this.initializeVaultItemsQueryParams(s),this.additionalFilterFunc=t;const i=(0,a.a)(r.map((e=>this.getVaultItems$TypeDictionary[e]))),c=this.getEmptyVaultItemsQueryResult();return i.pipe((0,n.U)((e=>(e.forEach((e=>{if("failure"===e.tag)throw new Error("Error while fetching vault items");Object.assign(c,e.data)})),(0,o.Vp)(c)))))}getVaultItems$(e,t,r,s){return s=s??e.replace("Result",""),(0,a.a)([this.getCarbonVaultItems$(e,t,s),this.getQuarantinedSpaces$()],((e,t)=>(0,o.Vp)(function(e,t,r,s){return e.flatMap((e=>t.some((t=>t.teamId===e.SpaceId))||s&&!s.some((t=>t.toUpperCase()===e.Id.toUpperCase()))?[]:r(e)))}(e,t,r,this.ids)))).pipe((0,c.Qn)((t=>{const r=function(e,t){if(!t||!e.length||!l(t.property,e[0]))return e;const r=t.property,s=t.direction||y.S.Ascend;return e.sort(((e,t)=>{const a=e[r],n=t[r];return"string"==typeof a&&"string"==typeof n?s===y.S.Ascend?a.localeCompare(n):n.localeCompare(a):"number"==typeof a&&"number"==typeof n?s===y.S.Ascend?a-n:n-a:0}))}(m(t,this.propertyFilters,this.additionalFilterFunc),this.propertySorting);return{[e]:{items:this.getPage(r),matchCount:r.length}}})))}getPage(e){return this.pageNumber&&this.pageSize?e.slice(this.pageSize*(this.pageNumber-1),this.pageSize*this.pageNumber):e}getCarbonVaultItems$(e,t,r){const{queries:{carbonState:s}}=this.carbonLegacyClient;return s({path:`userSession.personalData.${r}`}).pipe((0,n.U)((r=>{if((0,o.hx)(r)||!t(r.data))throw new Error(`Bad ${e} format`);return r.data})))}getQuarantinedSpaces$(){const{queries:{carbonState:e}}=this.carbonLegacyClient;return e({path:"userSession.spaceData.spaces"}).pipe((0,n.U)((e=>{if((0,o.hx)(e)||(t=e.data,!(0,g.w)(t,["teamId"])))throw new Error("Bad spaces format");var t;return e.data.filter((e=>this.isPremiumStatusSpaceQuarantined(e.details)))})))}isPremiumStatusSpaceQuarantined(e){return"accepted"!==e.status.toLowerCase()&&Array.isArray(e.info.teamDomains)&&e.info.teamDomains.length>0&&Boolean(e.info.removeForcedContentEnabled)}};te=(0,s.__decorate)([(0,i.GS)(),(0,s.__metadata)("design:paramtypes",[u.CarbonLegacyClient])],te)},17053:(e,t,r)=>{"use strict";r.d(t,{U:()=>w});var s=r(88802),a=r(99634),n=r(73883),i=r(85390),o=r(43978),c=r(20754),u=r(87279),d=r(48844),l=r(67837),p=r(72721);class h extends((0,l.E)(p.a)){}(0,l.K)(p.a,h);var m=r(82706),y=r(88994),g=r(87969),v=r(8266);let f=class{constructor(e,t,r){this.vaultRepository=e,this.vaultOrganizationClient=t,this.sharingCollectionsClient=r,this.separator=",",this.collections=[],this.searchQuery="",this.normalizeString=e=>e.normalize("NFD"),this.isVaultItemMatch=e=>{let t="";return this.collections.forEach((r=>{r.vaultItems.some((t=>t.id===e.id))&&(t+=`${r.name}${this.separator}`)})),this.isMatch(e,t)}}execute({body:e}){const{vaultItemTypes:t,searchQuery:r,...s}=e;this.searchQuery=r;const{queries:{queryCollections:a}}=this.vaultOrganizationClient,{queries:{sharedCollectionsWithItems:n}}=this.sharingCollectionsClient;return(0,i.a)([a({}),n()]).pipe((0,o.w)((([e,r])=>{if((0,u.hx)(e)||(0,u.hx)(r))throw new Error("Error querying collections");return this.collections=e.data.collections.concat(r.data),t?this.vaultRepository.fetchVaultItems$({vaultItemTypes:t,...s},this.isVaultItemMatch):this.vaultRepository.fetchVaultItems$({vaultItemTypes:Object.values(m.U),...s},this.isVaultItemMatch)})),(0,d.Qn)((e=>{let r;if(t)r={items:[],matchCount:0};else{const e=this.collections.filter((e=>this.isMatch(e)));r={items:e,matchCount:e.length}}return{...e,collectionsResult:r}})))}isMatch(e,t=""){return t+=Object.values(e).filter((e=>"object"!=typeof e)).join(this.separator),this.normalizeString(t).includes(this.normalizeString(this.searchQuery))}};f=(0,s.__decorate)([(0,c.e)(y.W),(0,s.__metadata)("design:paramtypes",[v.g,g.C,h])],f);let w=class{};w=(0,s.__decorate)([(0,a.Y)({api:n.R,handlers:{commands:{},events:{},queries:{search:f}},providers:[v.g]})],w)},43866:(e,t,r)=>{"use strict";r.d(t,{d:()=>s});class s{constructor(){this.shutdownHooks=[],this.externalComponentReadyConditions=[],this.appReadyHooks=[]}addExternalComponentReadyCondition(e){this.externalComponentReadyConditions.push(e)}addAppReadyHook(e){this.appReadyHooks.push(e)}addShutdownHook(e){this.shutdownHooks.push(e)}removeShutdownHook(e){const t=this.shutdownHooks.indexOf(e);t>=0&&this.shutdownHooks.splice(t,1)}startup(){const e=this.waitAndTriggerAppReady();if(!this.externalComponentReadyConditions.length)return e;this.addShutdownHook((async()=>await e))}async shutDown(){for(;this.shutdownHooks.length>0;){const e=this.shutdownHooks.pop();e&&await e()}}async waitAndTriggerAppReady(){await Promise.all(this.externalComponentReadyConditions.map((e=>e()))),await this.executeStartupHooks(this.appReadyHooks)}async executeStartupHooks(e){for(;e.length>0;){const t=e.shift();if(t){const e=await t();e&&this.addShutdownHook(e)}}}}},21904:(e,t,r)=>{"use strict";r.d(t,{O:()=>c,r:()=>u});var s=r(60399),a=r(24966),n=r(87065),i=r(30523),o=r(58376);class c{async waitTimeout(e){await(0,s.z)(this.createObservableTimer(e,e))}}class u extends c{constructor(){super(...arguments),this.subscribers$=new a.X(new Set),this.time=0,this.pendingTimerCount$=this.subscribers$.pipe((0,n.U)((e=>e.size)))}fireTimer(e=1){this.time+=e,[...this.subscribers$.value].forEach((e=>{e.next(this.time)}))}async allSubscribersDisconnected(){await(0,s.z)(this.pendingTimerCount$.pipe((0,i.h)((e=>!e))))}createObservableTimer(){return new o.y((e=>(this.subscribers$.next(new Set([...this.subscribers$.value,e])),()=>{this.subscribers$.next(new Set([...this.subscribers$.value].filter((t=>t!==e))))})))}}},96259:(e,t,r)=>{"use strict";r.d(t,{t:()=>n,u:()=>i});var s=r(8987),a=r(49329);const n=(e,t)=>(()=>{const e=t=>({define:()=>t,with:r=>{const s={api:r.module,main:r.on,queryOnly:r.queryOnly??[]},a={[r.module.name]:s};return e({...t,...a})}});return e({})})().with({module:s.t$,on:e}).with({module:a.e,on:e}),i=n("node",[])},26457:(e,t,r)=>{"use strict";r.d(t,{V:()=>s,W:()=>a});class s{}class a extends s{log(){}error(){}warn(){}trace(){}}},10514:(e,t,r)=>{"use strict";r.d(t,{H:()=>n,Y:()=>s});r(5373);var s,a=r(21869);!function(e){e.Command="command",e.Query="query",e.Event="event",e.Init="init",e.Cron="cron"}(s||(s={}));const n={body:void 0,context:new a.f,module:"module",name:"command",type:s.Command}},93417:(e,t,r)=>{"use strict";r.d(t,{u:()=>Ve,W:()=>Ge});var s=r(10722),a=r(30523),n=r(60399),i=r(70695),o=r(28489);var c=r(73201),u=r(42949),d=r(94189),l=r(96917),p=r(16855),h=r(83081),m=r(43866),y=r(26457),g=r(88802),v=r(32875),f=r(10514);const w={name:"api",commands:{},events:{},queries:{}};var S=r(25029),_=r(95087),b=r(87279),E=r(8987);async function A(e){const t=await(0,n.z)(e.getClient(E.t$).queries.activeUser());if((0,b.d6)(t)&&t.data.userName)return t.data.userName}var T=r(21869),C=r(22838);let x=class{constructor(e,t,r){this.introspection=e,this.moduleRef=t,this.clients=r}async execute(e){const t=i.ContextIdFactory.getByRequest(e),{type:r}=e,s=()=>e.context.getOrAdd(T.l.UserName,(async()=>await A(this.clients)));if(!(e.module in this.introspection.modules))throw new Error("Unknown module "+e.module);const a=this.introspection.modules[e.module],n=a.api??w,o=a.handlers??C.TB;switch(r){case f.Y.Query:{const{queries:r}=n;if(e.name in r){const a=r[e.name],n=new a(e.body),i=o.queries[e.name];a.metadata.scope===S.F.User&&await s();return{result:(await this.moduleRef.resolve(i,t,{strict:!1})).execute(n,{name:e.name})}}throw new Error("Unknown query "+e.name)}case f.Y.Command:{const{commands:r}=n;if(e.name in r){const a=r[e.name],n=new a(e.body),i=o.commands[e.name];a.metadata.scope===S.F.User&&await s();const c=await this.moduleRef.resolve(i,t,{strict:!1});return{result:await c.execute(n,{name:e.name})}}throw new Error("Unknown command "+e.name)}case f.Y.Event:{const{events:r}=n;if(e.name in r){const a=r[e.name],n=new a(e.body),i=Object.values(this.introspection.modules).flatMap((t=>(t.handlers??C.TB).events[e.module]?.events[e.name]));a.metadata.scope===S.F.User&&await s();const o=await Promise.all(i.filter((e=>this.introspection.supportedEventHandlers.has(e))).map((async e=>await this.moduleRef.resolve(e,t,{strict:!1}))));return void await Promise.all(o.map((e=>e.handle(n))))}throw new Error("Unknown event "+e.name)}case f.Y.Cron:{const r=(a.crons??[]).find((t=>t.name===e.name));if(!r)throw new Error("unknown cron "+e.name);if(r.scope===S.F.User){if(!await s())return{result:!1}}const n=await this.moduleRef.resolve(r.handler,t,{strict:!1});return n.isRunnable&&!await n.isRunnable()?{result:!1}:(await n.run(),{result:!0})}}(0,_.U)(r)}};(0,g.__decorate)([(0,v.All)(),(0,g.__param)(0,(0,v.Req)()),(0,g.__metadata)("design:type",Function),(0,g.__metadata)("design:paramtypes",[Object]),(0,g.__metadata)("design:returntype",Promise)],x.prototype,"execute",null),x=(0,g.__decorate)([(0,v.Controller)({scope:v.Scope.REQUEST,durable:!1}),(0,g.__metadata)("design:paramtypes",[C.Q1,i.ModuleRef,d.m])],x);var R=r(21904),I=r(11053),P=r(38144),D=r(23711),U=r(43702),F=r(91199),O=r(4603),N=r(75994),k=r(9671),L=r(71949),M=r(56860);let V=class{catch(e,t){t.switchToHttp().getResponse().fail(e)}};V=(0,g.__decorate)([(0,v.Catch)(Error)],V);const G={provide:T.f,scope:v.Scope.REQUEST,inject:[i.REQUEST],useFactory:e=>{const t=(()=>{switch(e.type){case f.Y.Command:case f.Y.Event:case f.Y.Query:case f.Y.Cron:return e.context;case f.Y.Init:return new T.f;default:(0,_.U)(e)}})();return t.getOrAdd(T.l.UseCaseId,(()=>String(i.ContextIdFactory.getByRequest(e).id))),t}};var q=r(97631);class j{static create({brokers:{cqrs:e,event:t},configProviders:r,keyValueStorageInfrastructure:a,lifeCycle:n,logger:o,modules:g,nodeConfiguration:v,storeInfrastructureFactory:f,timers:w,jsonFetcher:S,defaultDeviceStorageEncryptionCodecProvider:_,defaultUserStorageEncryptionCodecProvider:b,storeList:E,interceptors:A,introspection:K,moduleClientsProviders:W,userUseCaseScopeProvider:B}){return{module:j,providers:[c.ExplorerService,{provide:F.QI,useValue:a},{provide:m.d,useValue:n},{provide:p.$,useValue:v},{provide:u.d,useValue:e},{provide:l.a,useValue:t},{provide:N.X,useValue:S},d.w,d.m,...r,{provide:y.V,useValue:o},G,{provide:h.G,useValue:f},{provide:R.O,useValue:w},I.u1,{provide:O.u,useValue:new O.u(a)},D.z,_,b,U.b,s.E,{provide:C.Q1,useValue:K},{provide:M.D,useValue:E},L.X,k.J,{provide:i.APP_FILTER,useClass:V},...A.flatMap((e=>[{provide:i.APP_INTERCEPTOR,useClass:e},e])),...W,B],imports:[...g],exports:[m.d,p.$,u.d,l.a,d.w,d.m,...r.map((({provide:e})=>e)),y.V,T.f,h.G,R.O,I.u1,D.z,P.h,P.s,U.b,s.E,O.u,F.QI,N.X,L.X,k.J,C.Q1,...W.map((({provide:e})=>e)),q.g],controllers:[x],global:!0}}}var K=r(24966),W=r(17350),B=r(162),H=r(74081);const z=()=>{},$=()=>{throw new Error("Not supported")};class Q{constructor(e,t,r){this.cqrsBroker=e,this.eventsBroker=t,this.cronsBroker=r,this.isListening$=new K.X(!1),this.use=$,this.get=$,this.post=$,this.head=$,this.delete=$,this.put=$,this.options=$,this.patch=$,this.end=$,this.applyVersionFilter=$,this.disconnect=z,this.close=z,this.status=$,this.render=$,this.redirect=$,this.setHeader=$,this.enableCors=$,this.initHttpServer=$,this.registerParserMiddleware=$,this.createMiddlewareFactory=$}isHeadersSent(){return!1}bindHandler(e){if(this.cqrsCallbacks||this.eventCallbacks)throw new Error("Handler already registered");this.cqrsCallbacks={onCommand:(t,r,s,a)=>new Promise(((n,i)=>{e({type:f.Y.Command,module:t,name:r,body:s,context:a},{type:f.Y.Command,value:{result:(0,b.Vp)(void 0)},reply:e=>n(e),fail:e=>i(e)})})),onQuery:(t,r,s,a)=>{const n=new Promise(((n,i)=>{e({type:f.Y.Query,module:t,name:r,body:s,context:a},{type:f.Y.Query,value:{result:W.E},reply:e=>n(e),fail:e=>i(e)})}));return(0,B.D)(n).pipe((0,H.J)())}},this.eventCallbacks={onLocalEvent:(t,r,s,a,n)=>new Promise(((r,i)=>{e({type:f.Y.Event,body:a,context:n,name:s,module:t},{type:f.Y.Event,reply:()=>r(),fail:e=>i(e)})}))},this.cronCallbacks=(t,r)=>new Promise(((s,a)=>{e({type:f.Y.Cron,context:new T.f,module:t,name:r},{type:f.Y.Cron,value:{result:!1},reply:e=>s(e),fail:e=>a(e)})}))}all(e,t){if(!t)throw new Error("Provide a handler");return this.bindHandler(t)}async listen(){if(!this.cqrsCallbacks||!this.eventCallbacks||!this.cronCallbacks)throw new Error("Please call `all(path, handler)` first");const e=await this.cqrsBroker.connect(this.cqrsCallbacks).start(),t=await this.eventsBroker.connect(this.eventCallbacks).start(),r=await this.cronsBroker.connect(this.cronCallbacks).start(),{isListening$:s}=this;this.disconnect=()=>{e.stop(),t.stop(),r.stop(),s.complete()},this.close=this.disconnect,this.isListening$.next(!0)}reply(e,t){switch(e.type){case f.Y.Query:case f.Y.Command:e.reply(t.result);break;case f.Y.Event:e.reply();break;case f.Y.Cron:e.reply(t.result);break;default:(0,_.U)(e)}}getInstance(){return this}getHttpServer(){return{once:z,address:()=>"",removeListener:z}}getType(){return"AppCoreNode"}}const Y=()=>{};class X extends i.AbstractHttpAdapter{constructor(e,t,r){super(new Q(e,t,r)),this.createMiddlewareFactory=this.instance.createMiddlewareFactory,this.close=this.instance.close,this.reply=this.instance.reply,this.useStaticAssets=Y,this.setViewEngine=Y,this.getRequestHostname=Y,this.status=Y,this.render=Y,this.redirect=Y,this.setNotFoundHandler=Y,this.setHeader=Y,this.registerParserMiddleware=Y,this.enableCors=Y,this.setErrorHandler=Y,this.end=Y,this.isListening$=this.instance.isListening$}initHttpServer(){this.setHttpServer({once:Y,address:()=>"",removeListener:Y})}getRequestMethod(){return v.RequestMethod.ALL}getRequestUrl(){return"/"}getType(){return"CoreApp"}isHeadersSent(){return!1}applyVersionFilter(){throw new Error("Versioning not supported")}}var J=r(40945),Z=r(90171);class ee extends y.V{log(){}warn(e,...t){return console.warn(e,t)}error(e,...t){return console.error(e,t)}trace(e,...t){return console.trace(e,t)}}class te extends R.O{get time(){return Date.now()}createObservableTimer(e,t){return(0,Z.H)(e,t)}}class re extends N.X{fetch(){return Promise.reject(new Error("Please add a jsonFetcher to the application. Probably you are seing that in unit tests.\nIf this is the case, please mock whatever service is requiring to fetch the data"))}}var se=r(79063);const ae=(e,t)=>t.reduce(((t,r)=>{const s=Reflect.getMetadata(se.o,r.module);if(!(0,C.Vy)(s))return t;s.onFrameworkInit&&(s.onFrameworkInit instanceof Array?t.onFrameworkInits=t.onFrameworkInits.concat(s.onFrameworkInit):t.onFrameworkInits.push(s.onFrameworkInit));const a=s.api?.name??s.sharedModuleName??"unnamed";return t.configProviders.push(...function(e,t,r,s){if(!r.configurations)return[];const{configurations:a}=r,n=[];return Object.keys(a).forEach((e=>{const r=a[e].token,i=s.configurations?.[e];if(!i)throw new Error(`Missing '${e}' configuration for '${t}' module`);n.push({...i,provide:r})})),Object.keys(s.configurations??{}).forEach((s=>{r.configurations?.[s]||e.error(`Unknown '${s}' configuration for '${t}' module will be unused`)})),n}(e,a,s,r)),s.api?.name&&t.modulesMetadata.set(s.api.name,s),t.modules.push(r.module),s.crons&&t.crons.push(...s.crons.map((e=>({...e,moduleName:a})))),s.handlers?.events&&t.eventHandlers.push(...Object.values(s.handlers.events).flatMap((e=>Object.values(e.events)))),s.stores&&t.stores.push(...s.stores),t.allDeclarations[a]=s,t}),{configProviders:new Array,modules:new Array,modulesMetadata:new Map,onFrameworkInits:new Array,crons:new Array,eventHandlers:new Array,stores:new Array,allDeclarations:(0,o.Ay)({})});var ne=r(54452),ie=r(15524),oe=r(69594),ce=r(17321),ue=r(5373);function de(e){const{parameterProvider:t,token:r}=e;switch(t.type){case ce.j.CLASS_PROVIDER:return{provide:r,useClass:t.useClass};case ce.j.VALUE_PROVIDER:return{provide:r,useValue:t.useValue};default:(0,_.U)(t)}}var le=r(99634),pe=r(37920),he=r(63364),me=r(57924);let ye=class{constructor(e,t){this.infra=e,this.lifeCycle=t}onFrameworkInit(){this.lifeCycle.addAppReadyHook((async()=>{const{stop:e}=await this.infra.start();return()=>{e()}}))}};ye=(0,g.__decorate)([(0,me.ar)(),(0,g.__metadata)("design:paramtypes",[he.q,m.d])],ye);var ge,ve=r(68475),fe=r(428);let we=ge=class{static configure(e){return{module:ge,configurations:{sink:e.sink}}}};we=ge=(0,g.__decorate)([(0,le.Y)({sharedModuleName:"exception-logging",providers:[pe.v,{provide:i.APP_INTERCEPTOR,useClass:ve.x},fe.F],configurations:{sink:{token:he.q}},exports:[pe.v,fe.F],onFrameworkInit:ye,requiredFeatureFlips:[]})],we);var Se=r(31638);const _e={sink:(0,Se.z)(new class{logException(){return Promise.resolve()}start(){return Promise.resolve({stop:()=>Promise.resolve()})}})};var be=r(6220),Ee=r(69885);const Ae={tag:""};let Te=class{constructor(e,t,r,s){this.request=e,this.clients=t,this.config=r,this.introspection=s}intercept(e,t){const{request:r}=this,{appDefinition:s}=this.config;if(r.type===f.Y.Cron)return this.checkCronActiveUser(t,r);if(!(r.module in s))return t.handle();const a=s[r.module].api;switch(r.type){case f.Y.Query:return this.checkQueryActiveUser(t,r,a);case f.Y.Command:return this.checkCommandActiveUser(t,r,a);case f.Y.Event:return this.checkEventActiveUser(t,r,a);default:(0,_.U)(r)}}checkCronActiveUser(e,t){const r=(this.introspection.modules[t.module].crons??[]).find((e=>e.name===t.name));if(!r)throw new Error("No such cron "+t.name);return r.scope===S.F.Device?e.handle():this.checkActiveUser(e,t.context,{noUserError:Ae,scope:S.F.User},"Cron")}checkQueryActiveUser(e,t,r){const{queries:s}=r;if(t.name in s){const r=s[t.name],{metadata:a}=r;return this.checkActiveUser(e,t.context,a,`Query ${t.module}.${t.name}`)}return e.handle()}checkCommandActiveUser(e,t,r){const{commands:s}=r;if(t.name in s){const r=s[t.name],{metadata:a}=r;return this.checkActiveUser(e,t.context,a,`Command ${t.module}.${t.name}`)}return e.handle()}checkEventActiveUser(e,t,r){const{events:s}=r;if(t.name in s){const r=s[t.name],{metadata:a}=r;return this.checkActiveUser(e,t.context,a,`Event ${t.module}.${t.name}`)}return e.handle()}checkActiveUser(e,t,r,s){if(r.scope!==S.F.User)return e.handle();const{noUserError:a}=r;return(0,B.D)(t.getOrAdd(T.l.UserName,(()=>A(this.clients)))).pipe((0,be.z)((t=>{if(t)return e.handle();if(a)return(0,Ee.of)({result:(0,b.Rn)(a)});throw new Error(`Not logged in : ${s}`)})))}};Te=(0,g.__decorate)([(0,v.Injectable)({scope:v.Scope.REQUEST}),(0,g.__param)(0,(0,v.Inject)(i.REQUEST)),(0,g.__metadata)("design:paramtypes",[Object,d.m,p.$,C.Q1])],Te);class Ce{constructor(e,t){this.storage=e,this.storageKey=`crons.${t}`}async setState(e){await this.storage.set(this.storageKey,JSON.stringify(e))}async getState(){const e=await this.storage.get(this.storageKey);if(!e)return{entries:[]};const t=JSON.parse(e);return(r=t)&&"object"==typeof r&&"entries"in r&&Array.isArray(r.entries)&&r.entries.every((e=>function(e){return!!e&&"object"==typeof e&&"dueTimestamp"in e&&"moduleName"in e&&"name"in e&&"string"==typeof e.name&&"string"==typeof e.moduleName&&"number"==typeof e.dueTimestamp}(e)))?t:{entries:[]};var r}}var xe=r(34987);const Re=6e4;function Ie(e){return Math.ceil(e/Re)*Re}function Pe(e){return Math.floor(e/Re)*Re}class De{constructor(e,t){this.infra=e,this.definitions=t}async init(){const e=Ie(this.infra.timers.time),t=await this.infra.repository.getState(),r=this.definitions.filter((e=>!t.entries.find((t=>t.name===e.name&&t.moduleName===e.moduleName)))),s={entries:[...t.entries.filter((e=>this.definitions.find((t=>t.name===e.name&&t.moduleName===e.moduleName)))),...r.map((t=>({...t,dueTimestamp:e+t.periodInMinutes*Re})))]};await this.infra.repository.setState(s)}connect(e){const{infra:t,definitions:r}=this;return{start:async()=>{await this.init();const s=t.cronSource.alarm$.pipe((0,xe.b)((async()=>{const s=await t.repository.getState(),a=Ie(t.timers.time),n=Pe(t.timers.time),i=s.entries.filter((e=>e.dueTimestamp<=a));await Promise.allSettled(i.map((a=>{const i=r.find((e=>e.moduleName===a.moduleName&&e.name===a.name));if(!i)throw new Error("we should have a declaration");return async function(r,s,a,n){let i=!1;try{i=await e(a.moduleName,a.name)}finally{i&&(a.dueTimestamp=Pe(r+n.periodInMinutes*Re),await t.repository.setState(s))}}(n,s,a,i)})))}))).subscribe();return{stop:()=>{s.unsubscribe()}}}}}}let Ue=class{constructor(e,t){this.request=e,this.useCaseStacktraceRepo=t}intercept(e,t){return this.useCaseStacktraceRepo.append(this.request.name),t.handle()}};Ue=(0,g.__decorate)([(0,v.Injectable)({scope:v.Scope.REQUEST}),(0,g.__param)(0,(0,v.Inject)(i.REQUEST)),(0,g.__metadata)("design:paramtypes",[Object,fe.F])],Ue);class Fe{constructor(e,t){this.client=e.getClient(t)}get commands(){return this.client.commands}get queries(){return this.client.queries}}var Oe=r(69008),Ne=r(33920);let ke;var Le=r(73656);const Me=[Ue,Te],Ve=async({appDefinition:e,channels:t,currentNode:r,implementations:c,otherModules:y=[],logger:g=new ee,storeInfrastructureFactory:v=new h.N,channelsListener:w=ne.y,timers:S=new te,keyValueStorageInfrastructure:_=new ie.s,jsonFetcher:b=new re,cronSource:E=new oe._C(S),defaultDeviceStorageEncryptionCodec:A={type:ce.j.CLASS_PROVIDER,useClass:s.E},defaultUserStorageEncryptionCodec:x={type:ce.j.CLASS_PROVIDER,useClass:s.E},exceptionLogging:R=_e})=>{const I=()=>{throw new Error("Aborted")};Le.abort=I,Le.exit=I;const D=[...[we.configure(R)],...y,...Object.keys(c).map((e=>e)).map((e=>c[e]))],{configProviders:U,modules:F,modulesMetadata:O,onFrameworkInits:N,crons:k,eventHandlers:L,stores:V,allDeclarations:G}=ae(g,D),K=new M.D;V.forEach((e=>{K.registerClass(e)})),((e,t,r)=>{const s=new Set([...r.keys()]),a=new Set(Object.values(e).filter((e=>e.main===t||e.queryOnly.includes(t))).map((e=>e.api.name))),n=[...a].filter((e=>!s.has(e))),i=[...s].filter((e=>!a.has(e)));if(n.length>0)throw new Error("These APIs are not implemented "+JSON.stringify(n));if(i.length>0)throw new Error("Some implementations do not have APIS "+JSON.stringify(i))})(e,r,O);const W=(e=>[...e.entries()].reduce(((e,[t,r])=>{const s=r.handlers?.events??{};return e[t]=Object.values(s).reduce(((e,t)=>t.name?(e[t.name]=Object.keys(t.events),e):e),(0,o.Ay)({})),e}),(0,o.Ay)({})))(O),B=new p.$({appDefinition:e,channels:t,channelsListener:w,currentNode:r,subscriptions:W}),H=new u.d(B),z=new l.a(B),$=new De({cronSource:E,repository:new Ce(_,r),timers:S},k),Q=new X(H,z,$),Y=de({token:P.h,parameterProvider:A}),Z=de({token:P.s,parameterProvider:x}),se=new m.d,le=new C.Q1(new Set(L),G),pe=function(e){const t=[];return Object.values(e).forEach((e=>{const{api:r}=e,{ClientClass:s}=r;s&&((0,me.GS)()(s),t.push({provide:s,useFactory:e=>new Fe(e,r),inject:[d.w]}))})),t}(e),he={useFactory:(e,t,r)=>{const s=e.get(T.l.UserName);if(s)return ke&&ke.status!==Ne.p.Closed||(ke=new q.g(s,r,t)),Promise.resolve(ke)},provide:q.g,inject:[T.f,Oe.Q,m.d]},ye=j.create({nodeConfiguration:B,brokers:{cqrs:H,event:z},modules:F,configProviders:U,logger:g,lifeCycle:se,storeInfrastructureFactory:v,timers:S,keyValueStorageInfrastructure:_,jsonFetcher:b,defaultDeviceStorageEncryptionCodecProvider:Y,defaultUserStorageEncryptionCodecProvider:Z,storeList:K,interceptors:Me,introspection:le,moduleClientsProviders:pe,userUseCaseScopeProvider:he}),ge=await i.NestFactory.create(ye,Q,{logger:g}),ve=await ge.init();await async function(e,t){const r=Object.freeze({id:-1}),s=e.map((async e=>{const s={type:f.Y.Init,[ue.REQUEST_CONTEXT_ID]:r};t.registerRequestByContextId(s,r);const a=await t.resolve(e,r,{strict:!1});await a.onFrameworkInit()}));await Promise.all(s)}(N,ve),ge.listen("");const fe=Q.isListening$.pipe((0,a.h)((e=>!!e)));return await(0,n.z)(fe),se.addShutdownHook((()=>ge.close())),await se.startup(),{stop:()=>se.shutDown(),createClient:()=>(0,J.R)(e,H),sendEvent:(e,t,r,s)=>z.publishEvent(e,t,r,s??new T.f)}},Ge=e=>Ve({...e,appDefinition:e.appDefinition,channels:{},currentNode:"node"})},42949:(e,t,r)=>{"use strict";r.d(t,{d:()=>y});var s=r(162),a=r(60399),n=r(30523),i=r(87065),o=r(17350),c=r(95087),u=r(28489);const d=e=>"response"===e.type,l=(e,t,r,s)=>Object.keys(e).reduce(((a,n)=>{const{commandMailbox:i,queryMailbox:o}=(a=>{const{main:n,queryOnly:i}=e[a],o={type:"local",onMessage:s};if(n===t)return{commandMailbox:o,queryMailbox:o};const c={type:"remote",channel:r[n]};return{commandMailbox:c,queryMailbox:t&&i.includes(t)?o:c}})(n);return a[`command-${n}`]=i,a[`query-${n}`]=o,a}),(0,u.Ay)({}));var p=r(65488),h=r(21869);const m=()=>(0,s.D)([]);class y{constructor(e){this.config=e}async sendCommand(e,t,r,s){if(!this.broker)throw new Error("call connect() first");return await(0,a.z)(this.broker.sendMessage(`command-${e}`,{type:"command",module:e,commandName:String(t),command:r,context:s.toSerializable()}).pipe((0,n.h)(d),(0,i.U)((e=>e.response))))}sendQuery(e,t,r,s){if(!this.broker)throw new Error("call connect() first");return this.broker.sendMessage(`query-${e}`,{type:"query",module:e,queryName:String(t),query:r,context:s.toSerializable()}).pipe((0,n.h)(d),(0,i.U)((e=>e.response)))}connect(e){const t=e?(t,r,a)=>{switch(r.type){case"response":return o.E;case"command":return(0,s.D)(e.onCommand(r.module,r.commandName,r.command,h.f.fromSerializable(r.context),{isReminder:a.isReminder})).pipe((0,i.U)((e=>({type:"response",response:e}))));case"query":return(0,s.D)(e.onQuery(r.module,r.queryName,r.query,h.f.fromSerializable(r.context))).pipe((0,i.U)((e=>({type:"response",response:e}))))}(0,c.U)(r)}:m,r=l(this.config.appDefinition,this.config.currentNode,this.config.channels,t);return this.broker=new p.U(r),this.broker.connect(Object.values(this.config.channels),this.config.channelsListener)}}},94189:(e,t,r)=>{"use strict";r.d(t,{m:()=>d,w:()=>u});var s=r(88802),a=r(57924),n=r(16855),i=r(42949),o=r(40945),c=r(21869);let u=class{constructor(e,t,r){this.broker=e,this.configuration=t,this.context=r}getClient(e){return(0,o.c)(this.configuration.appDefinition,this.broker,e.name,this.context)}};u=(0,s.__decorate)([(0,a.GS)(),(0,s.__metadata)("design:paramtypes",[i.d,n.$,c.f])],u);let d=class{constructor(e,t){this.configuration=e,this.broker=t}getClient(e){return(0,o.c)(this.configuration.appDefinition,this.broker,e.name)}};d=(0,s.__decorate)([(0,a.GS)(),(0,s.__metadata)("design:paramtypes",[n.$,i.d])],d)},40945:(e,t,r)=>{"use strict";r.d(t,{R:()=>i,c:()=>n});var s=r(28489),a=r(21869);const n=(e,t,r,n)=>({commands:Object.keys(e[r].api.commands).reduce(((e,s)=>(e[s]=e=>{const i=n??new a.f;return t.sendCommand(r,s,e,i)},e)),(0,s.Ay)({})),queries:Object.keys(e[r].api.queries).reduce(((e,s)=>(e[s]=e=>{const i=n??new a.f;return t.sendQuery(r,s,e,i)},e)),(0,s.Ay)({}))}),i=(e,t,r)=>{const n=n=>Object.keys(e[n].api.commands).reduce(((e,s)=>(e[s]=e=>{const i=r??new a.f;return t.sendCommand(n,s,e,i)},e)),(0,s.Ay)({})),i=n=>Object.keys(e[n].api.queries).reduce(((e,s)=>(e[s]=e=>{const i=r??new a.f;return t.sendQuery(n,s,e,i)},e)),(0,s.Ay)({}));return Object.keys(e).map((e=>e)).reduce(((e,t)=>(e[t]={commands:n(t),queries:i(t)},e)),{})}},81459:(e,t,r)=>{"use strict";r.d(t,{C:()=>d,f:()=>u});var s=r(88802),a=r(32875),n=r(57924),i=r(92542),o=r(96917),c=r(21869);let u=class{constructor(e,t,r){this.apiName=e,this.broker=t,this.context=r}sendEvent(e,t){return this.broker.publishEvent(this.apiName,e,t,this.context)}};u=(0,s.__decorate)([(0,n.GS)(),(0,s.__param)(0,(0,a.Inject)(i.r)),(0,s.__metadata)("design:paramtypes",[Object,o.a,c.f])],u);let d=class{constructor(e,t){this.apiName=e,this.broker=t}sendEvent(e,t,r){return this.broker.publishEvent(this.apiName,e,t,r??new c.f)}};d=(0,s.__decorate)([(0,n.GS)(),(0,s.__param)(0,(0,a.Inject)(i.r)),(0,s.__metadata)("design:paramtypes",[Object,o.a])],d)},96917:(e,t,r)=>{"use strict";r.d(t,{a:()=>y});var s=r(88802),a=r(162),n=r(87065),i=r(17350),o=r(69885),c=r(65488),u=r(28489);const d={type:"ask"},l={type:"eventResponse"};var p=r(57924),h=r(16855),m=r(21869);let y=class{constructor(e){this.regenerateReverseSubscriptionMap=()=>{const{configuration:e,subscriberToEvent:t}=this,r=e.getModuleNames().reduce(((e,t)=>({...e,[t]:new Map})),{});return e.getNodeList().reduce(((e,r)=>{const s=t[r];return Object.entries(s).forEach((([t,s])=>{const a=e[t];s.forEach((e=>{const t=[...a.get(e)??[],r];a.set(e,t)}))})),e}),r)},this.configuration=e;const t=Object.entries(e.appDefinition).reduce(((e,[t,r])=>(e[t]=Object.keys(r.api.events),e)),{});this.subscriberToEvent=this.configuration.getNodeList().reduce(((e,r)=>(e[r]={...t},e)),{}),this.eventToSubscriber=this.regenerateReverseSubscriptionMap()}async publishEvent(e,t,r,s){const{broker:a,eventToSubscriber:n}=this;if(!a)throw new Error("Not started");const i=(n[e].get(t)??[]).map((a=>({type:"event",context:s.toSerializable(),event:r,eventName:t,moduleSource:e,nodeDestination:a})));await Promise.all(i.map((async e=>{await a.trySendMessage(`event-${e.nodeDestination}`,e)})))}connect(e){const{configuration:t}=this,r=Object.keys(t.subscriptions).reduce(((e,r)=>({...e,...t.subscriptions[r]})),(0,u.Ay)({})),s={type:"subscriptions",nodeName:t.currentNode,subscribesTo:r},p=((e,t)=>e.getNodeList().reduce(((r,s)=>(s===e.currentNode?r[`event-${s}`]={type:"local",onMessage:t}:r[`event-${s}`]={type:"remote",channel:e.channels[s]},r)),(0,u.Ay)({})))(this.configuration,((t,r,c)=>{switch(r.type){case"event":return(0,a.D)(e.onLocalEvent(r.moduleSource,r.nodeDestination,r.eventName,r.event,m.f.fromSerializable(r.context),c)).pipe((0,n.U)((()=>l)));case"eventResponse":return i.E;case"subscriptions":return this.subscriberToEvent[r.nodeName]=r.subscribesTo,this.eventToSubscriber=this.regenerateReverseSubscriptionMap(),(0,o.of)(l);case"ask":return(0,o.of)(s)}})),h=new c.U(p);return t.getNodeList().map((async e=>{await h.trySendMessage(`event-${e}`,s),await h.trySendMessage(`event-${e}`,d)})),this.broker=h,h.connect(Object.values(t.channels),t.channelsListener)}};y=(0,s.__decorate)([(0,p.GS)(),(0,s.__metadata)("design:paramtypes",[h.$])],y)},63663:(e,t,r)=>{"use strict";r.d(t,{W:()=>a});var s=r(57924);function a(e){const t=(0,s.GS)();return r=>{Reflect.defineMetadata("dl-handler",r,e),t(r)}}},11053:(e,t,r)=>{"use strict";r.d(t,{Tx:()=>l,b2:()=>d,u1:()=>p});var s=r(88802),a=r(6220),n=r(7074),i=r(58376),o=r(57924),c=r(21904),u=r(94189);function d(e){return e}class l{constructor(e,t,{args:r,commandName:s}){const i=t.commands[s];this.refreshObservable$=e.pipe((0,a.z)((async()=>{await i(r)})),(0,n.B)({}))}withRefresh(){return e=>new i.y((t=>{const r=this.refreshObservable$.subscribe();return r.add(e.subscribe(t)),r}))}}let p=class{constructor(e,t){this.timers=e,this.cqrsClient=t,this.map=new WeakMap}getRefresher(e){const t=this.map.get(e);if(t)return t;return new l(this.timers.createObservableTimer(e.period,e.period),this.cqrsClient.getClient(e.api),e)}};p=(0,s.__decorate)([(0,o.GS)(),(0,s.__metadata)("design:paramtypes",[c.O,u.m])],p)},68307:(e,t,r)=>{"use strict";r.d(t,{b:()=>a});var s=r(57924);function a(e){const t=(0,s.GS)();return r=>{if(Reflect.hasMetadata("dl-handlers",e)){const t=Reflect.getMetadata("dl-handlers",e);Reflect.defineMetadata("dl-handlers",[...t,r],e)}else Reflect.defineMetadata("dl-handlers",[r],e);t(r)}}},20754:(e,t,r)=>{"use strict";r.d(t,{e:()=>a});var s=r(57924);function a(e){const t=(0,s.GS)();return r=>{Reflect.defineMetadata("dl-handler",r,e),t(r)}}},79063:(e,t,r)=>{"use strict";r.d(t,{o:()=>s});const s="dl-module"},38679:(e,t,r)=>{"use strict";r.d(t,{H:()=>c});var s=r(70695),a=r(69183),n=r(57924),i=r(64987),o=r(43866);const c=(e,t)=>{const r=t.token??(0,a.Z)();class c{constructor(){this.mutex=new i.WU}getOrCreate(e,t){return this.mutex.runExclusive((async()=>(this.instance||(t.addShutdownHook((()=>{this.invalidate()})),this.instance=await e()),this.instance)))}invalidate(){this.instance=void 0}}(0,n.GS)()(c);const u=c,d={token:e,inject:[c,o.d,s.ModuleRef,s.REQUEST],asyncFactory:(e,t,a,n)=>{const i=s.ContextIdFactory.getByRequest(n);return e.getOrCreate((()=>a.resolve(r,i)),t)}};return[{...t,token:r},u,d]}},57924:(e,t,r)=>{"use strict";r.d(t,{GS:()=>n,ar:()=>i,xB:()=>a});var s=r(32875);function a(){return(0,s.Global)()}function n(e){return(0,s.Injectable)({scope:e?.neverReuseInstance?s.Scope.TRANSIENT:s.Scope.DEFAULT})}const i=()=>n()},99634:(e,t,r)=>{"use strict";r.d(t,{Y:()=>f,g:()=>g});r(60171);var s=r(79063),a=r(32875),n=r(92542),i=r(88802),o=r(43702),c=r(23711),u=r(91199),d=r(21869);const l=new o.b,p=new c.z;let h=class{constructor(e,t,r){this.kv=e,this.prefix=`batch-storage.${r}.${t.get(d.l.UserName)}`}async getBatchState(e){const t=await this.kv.get(`${this.prefix}.${e}`);return t?this.stringToState(t):{queue:[]}}async setBatchState(e,t){const r=this.stateToString(t);return await this.kv.set(`${this.prefix}.${e}`,r)}stateToString(e){const t=l.encode(e);return p.encode(t)}stringToState(e){const t=p.decode(e);return l.decode(t)}};h=(0,i.__decorate)([(0,i.__param)(2,(0,a.Inject)(n.r)),(0,i.__metadata)("design:paramtypes",[u.QI,d.f,String])],h);class m{getProviders(e){if(!e.length)return[];return[...e.map((e=>({provide:e,inject:[h,e.Definition.chunkProcessor],useFactory:(t,r)=>new e(t,r)}))),...e.map((({Definition:{chunkProcessor:e}})=>e)),h]}}var y=r(5711);const g=(e,t)=>({[e.name]:{name:e.name,events:t}}),v=(e,t)=>{const{exports:r=[],imports:s=[],providers:a=[],onFrameworkInit:n=[],stores:i=[],crons:o=[]}=e,c=[n,t.onFrameworkInit??[]].flat();return{...e,exports:r.concat(t.exports??[]),imports:s.concat(t.imports??[]),providers:a.concat(t.providers??[]),onFrameworkInit:c,stores:i.concat(t.stores??[]),crons:o.concat(t.crons??[])}};function f(e){const{composes:t=[]}=e;e=t.reduce(((e,t)=>v(e,t)),e);const{exports:r=[],imports:i=[],handlers:o={commands:{},events:{},queries:{}},providers:c=[],onFrameworkInit:u=[],stores:d,batchExecutors:l,crons:p}=e,h=e.api?.name??e.sharedModuleName,g=h?(0,y.N)(...d??[]):[],f=h?(new m).getProviders(l??[]):[],w=[...c,...(p??[]).map((e=>e.handler)),...g,...f,...Object.values(o.commands),...Object.values(o.queries),...Object.values(o.events).map((e=>Object.values(e.events))).reduce(((e,t)=>[...e,...t]),new Array),...u instanceof Array?u:[u],{provide:n.r,useValue:h}],{asyncProviders:S,basicClassProviders:_}=w.reduce(((e,t)=>{return"object"==typeof(r=t)&&"token"in r&&"asyncFactory"in r&&"function"==typeof r.asyncFactory?{asyncProviders:[...e.asyncProviders,t],basicClassProviders:e.basicClassProviders}:{asyncProviders:e.asyncProviders,basicClassProviders:[...e.basicClassProviders,t]};var r}),{asyncProviders:new Array,basicClassProviders:new Array}),b=[..._,...S.map((e=>({provide:e.token,useFactory:e.asyncFactory,inject:e.inject})))],E=(0,a.Module)({exports:r,imports:i,providers:b});return t=>(Reflect.defineMetadata(s.o,e,t),E(t))}},92542:(e,t,r)=>{"use strict";r.d(t,{r:()=>s});const s="frameworkModuleName"},22838:(e,t,r)=>{"use strict";r.d(t,{Q1:()=>n,TB:()=>s,Vy:()=>a});const s={commands:{},events:{},queries:{}},a=e=>!(!e||"object"!=typeof e)&&(!(e.api&&!(e.api.commands&&e.api.events&&e.api.name&&e.api.queries&&e.handlers))&&(!(e.exports&&!Array.isArray(e.exports))&&(!(e.handlers&&!e.api)&&(!(e.imports&&!Array.isArray(e.imports))&&!(e.providers&&!Array.isArray(e.providers))))));class n{constructor(e,t){this.supportedEventHandlers=e,this.modules=t}}},31638:(e,t,r)=>{"use strict";r.d(t,{$:()=>n,z:()=>a});var s=r(17321);function a(e){return{type:s.j.VALUE_PROVIDER,useValue:e}}function n(e){return{type:s.j.CLASS_PROVIDER,useClass:e}}},17321:(e,t,r)=>{"use strict";var s;r.d(t,{j:()=>s}),function(e){e.VALUE_PROVIDER="value_provider",e.CLASS_PROVIDER="class_provider"}(s||(s={}))},63411:(e,t,r)=>{"use strict";r.d(t,{B:()=>o});var s=r(25029),a=r(95087),n=r(38679),i=r(97956);const o=(e,t,r)=>{switch(e){case s.F.Device:return(0,n.H)(t,r);case s.F.User:return(0,i.M)(t,r);default:(0,a.U)(e)}}},97956:(e,t,r)=>{"use strict";r.d(t,{M:()=>c});var s=r(70695),a=r(69183),n=r(64987),i=r(21869),o=r(97631);const c=(e,t)=>{const r=t.token??(0,a.Z)();class c{constructor(){this.instances=new Map,this.mutex=new n.WU}getOrCreate(e,t,r){return this.mutex.runExclusive((async()=>{const s=this.instances.get(e);if(s)return s;r.addCloseHook((()=>{this.invalidate(e)}));const a=await t();return this.instances.set(e,a),a}))}invalidate(e){this.instances.delete(e)}}const u=c,d={token:e,inject:[c,i.f,s.ModuleRef,s.REQUEST,o.g],asyncFactory:(t,a,n,o,c)=>{const u=s.ContextIdFactory.getByRequest(o),d=a.getOrDefault(i.l.UserName,"");if(""===d)throw new Error(`Provider ${e} is a user-scoped singleton but there is no user`);if(!c)throw new Error("No user scope available");return t.getOrCreate(d,(()=>n.resolve(r,u)),c)}};return[{token:r,asyncFactory:t.asyncFactory,inject:[...t.inject??[],i.f]},u,d]}},9671:(e,t,r)=>{"use strict";r.d(t,{J:()=>v,f:()=>f});var s=r(88802),a=r(70695),n=r(32875),i=r(60399),o=r(87065),c=r(70493),u=r(87279),d=r(10514),l=r(43004),p=r(37920),h=r(21869),m=r(68475),y=r(428),g=r(94189);let v=class{constructor(e,t,r,s){this.request=e,this.logger=t,this.useCaseStacktraceRepo=r,this.cqrsClient=s}async do(...e){return(await Promise.all(e.map((e=>this.doOne(e))))).every((e=>!!e))}async doOne(e,t="method"){try{const r=await e();if((0,u.AZ)(r)&&(0,u.hx)(r))throw new Error(`Allowed to fail ${t} has failed`);return!0}catch(e){const{request:t,useCaseStacktraceRepo:r}=this,[s,a]=e instanceof m.c?[e.exception,e.useCaseStacktrace]:[e,r.read()];try{await Promise.race([new Promise((e=>setTimeout(e,100))),this.logger.captureException(s,{moduleName:t?.module,useCaseId:t?.context.get(h.l.UseCaseId),useCaseName:t?.name,useCaseStacktrace:a,featureFlips:await this.getUserFeatureFlips()},l.w.WARNING)])}catch(e){}return!1}}async conditionallyAllowToFailOne(e,t){return t?this.doOne(e):(await e(),!0)}getUserFeatureFlips(){const{queries:{userFeatureFlips:e}}=this.cqrsClient.getClient(c.cV);return Promise.race([new Promise((e=>setTimeout((()=>e({})),50))),(0,i.z)(e().pipe((0,o.U)((e=>(0,u.d6)(e)?(0,u.db)(e):{}))))])}};function f(){return new v(d.H,(0,p.G)(),y.U,{})}v=(0,s.__decorate)([(0,s.__param)(0,(0,n.Inject)(a.REQUEST)),(0,s.__metadata)("design:paramtypes",[Object,p.v,y.F,g.w])],v)},73774:(e,t,r)=>{"use strict";r.d(t,{e:()=>h});var s=r(88802),a=r(69885),n=r(34987),i=r(48844),o=r(95087);class c{constructor(e,t){this.pipeline=this.initPipeline(e,this.dedupeInterceptorsById(t))}handle(e){return this.pipeline.handle(e)}dedupeInterceptorsById(e){const t=e.reduce(((e,t)=>(e.set(t.id,t),e)),new Map);return Array.from(t.values())}initPipeline(e,t){return t.reduceRight(((e,t)=>({handle:r=>t.intercept(r,e.handle.bind(e))})),e)}}var u=r(4043);class d{constructor(e){this.backend=e,this.interceptors=new Map}addInterceptor(e){this.interceptors.set(e.id,e)}request(...e){return this.makeRequest(...e)}delete(e,t){return this.makeRequest("DELETE",e,t)}get(e,t){return this.makeRequest("GET",e,t)}head(e,t){return this.makeRequest("HEAD",e,t)}options(e,t){return this.makeRequest("OPTIONS",e,t)}patch(e,t,r){return this.makeRequest("PATCH",e,{body:t,...r})}post(e,t,r){return this.makeRequest("POST",e,{body:t,...r})}put(e,t,r){return this.makeRequest("PUT",e,{body:t,...r})}makeRequest(...e){let t,r,s;if(1===e.length)t=e[0],r="response";else{const[a,n,i]=e;t=new u.a(a,n,void 0!==i.body?i.body:null,{headers:i.headers,params:i.params,responseType:i.responseType??"json",withCredentials:i.withCredentials}),r=i.observe??"body","json"===i.responseType&&"body"===i.observe&&(s=i.responseBodyDecoder)}const d=new c(this.backend,Array.from(this.interceptors.values())),l=(0,a.of)(this.addContentTypeRequestHeader(t)).pipe((0,n.b)((e=>d.handle(e))));switch(r){case"body":switch(t.responseType){case"arraybuffer":return l.pipe((0,i.Gx)((e=>e.arrayBuffer())));case"text":return l.pipe((0,i.Gx)((e=>e.text())));case"json":return l.pipe((0,i.Gx)((e=>e.json(s))));default:(0,o.U)(t.responseType)}break;case"response":return l;default:(0,o.U)(r)}}addContentTypeRequestHeader(e){if(!e.headers.has("content-type")){const t=e.detectContentTypeHeader();if(t)return e.clone({headers:e.headers.set("content-type",t)})}return e}}var l=r(22253),p=r(57924);let h=class extends d{constructor(e){super(e)}};h=(0,s.__decorate)([(0,p.GS)(),(0,s.__metadata)("design:paramtypes",[l.j])],h)},25504:(e,t,r)=>{"use strict";r.d(t,{X:()=>o});var s=r(88802),a=r(22253),n=r(99634),i=r(73774);let o=class{};o=(0,s.__decorate)([(0,n.Y)({providers:[i.e],configurations:{infrastructure:{token:a.j}},exports:[i.e],sharedModuleName:"http"})],o)},64827:(e,t,r)=>{"use strict";r.r(t),r.d(t,{AcknowledgedChannel:()=>D.N,AllowedToFail:()=>ne.J,AppLifeCycle:()=>i.d,AppLogger:()=>a.V,AppTimers:()=>o.O,BadStatus:()=>_.R,BaseEventEmitter:()=>W.f,ChannelMessageBroker:()=>R.U,ChannelState:()=>I.D,CommandHandler:()=>O.W,CommandRefresherFactory:()=>L.u1,ContextLessCqrsClient:()=>K.m,ContextlessBaseEventEmitter:()=>W.C,CqrsBroker:()=>M.d,CqrsClient:()=>K.w,CqrsCommandRefresher:()=>L.Tx,CronLowLevelSource:()=>we.R_,DefaultEncryptionCodecForDeviceData:()=>re.h,DefaultEncryptionCodecForUserData:()=>re.s,EventHandler:()=>k.b,ExceptionCriticality:()=>A.w,ExceptionLogger:()=>C.v,ExceptionLoggingSink:()=>T.q,FetchFailedError:()=>_.a,FrameworkInit:()=>l.ar,FrameworkRequestContextValues:()=>H.l,Global:()=>l.xB,HttpClient:()=>b.e,HttpHeaders:()=>g.W,HttpModule:()=>E.X,HttpParams:()=>v.L,HttpRequest:()=>f.a,HttpResponse:()=>w.Z,HttpStatusCode:()=>S.W,Injectable:()=>l.GS,JsonApplicationResourceFetcher:()=>Se.X,JsonApplicationResourceLoader:()=>_e.K,KeyValueStorageFactory:()=>te.u,KeyValueStorageInfrastructure:()=>ee.QI,ManualTriggeredTimers:()=>o.r,MemoryChannel:()=>I.q,MemoryKeyValueStorageInfrastructure:()=>se.s,MemoryStoreInfrastructureFactory:()=>ae.N,MockJsonApplicationResourceFetcher:()=>Se.W,Module:()=>d.Y,NoDynamicChannels:()=>P.y,NodeConfiguration:()=>F.$,NodeEventBroker:()=>V.a,NodeModulesIntrospection:()=>p.Q1,NodeToModuleEventBroker:()=>q,NullCronTaskHandler:()=>we.ql,NullLogger:()=>a.W,NullStorage:()=>ee.hL,ParameterProviderType:()=>c.j,QueryHandler:()=>N.e,RequestContext:()=>H.f,RequestContextModule:()=>Z.q,SingleNodeAppBuilder:()=>n.u,Store:()=>he.y,StoreCapacity:()=>de.Y,StoreFlusher:()=>pe.X,StoreInfrastructureFactory:()=>ae.G,TaskTrackingModule:()=>x.c,TimerBasedCronSource:()=>we._C,createApplicationClient:()=>$,createClientFactory:()=>z,createCqrsClient:()=>j.c,createCqrsClients:()=>j.R,createNullAllowedToFail:()=>ne.f,createSingleChannelListener:()=>P.v,defineApplication:()=>n.t,defineBatchExecutor:()=>fe,defineStore:()=>ue.Q,deviceScopedSingletonProvider:()=>y.H,getQueryValue:()=>J,getStoresProviders:()=>le.N,isExceptionLogEntry:()=>A.h,isSendMessageRequest:()=>U.F,isVersionedData:()=>ee.Ot,mockStore:()=>ce,provideClass:()=>u.$,provideValue:()=>u.z,refresherCreationToken:()=>L.b2,scopedSingleton:()=>m.B,sendMessageRequest:()=>U.k,startApplicationNode:()=>s.u,startSingleApplicationNode:()=>s.W,useEventsOfModule:()=>d.g,userScopedSingletonProvider:()=>h.M});var s=r(93417),a=r(26457),n=r(96259),i=r(43866),o=r(21904),c=r(17321),u=r(31638),d=r(99634),l=r(57924),p=r(22838),h=r(97956),m=r(63411),y=r(38679),g=r(4607),v=r(69912),f=r(4043),w=r(12964),S=r(25994),_=r(73155),b=r(73774),E=r(25504),A=r(43004),T=r(63364),C=r(37920),x=r(7876),R=r(65488),I=r(15572),P=r(54452),D=r(58649),U=r(45244),F=r(16855),O=r(63663),N=r(20754),k=r(68307),L=r(11053),M=r(42949),V=r(96917),G=r(28489);class q{constructor(e){this.publishEvent=(e,t,r,s)=>this.broker.publishEvent(e,t,r,s),this.broker=new V.a(e);const t=e.getModuleNames().reduce(((t,r)=>({...t,[r]:Object.keys(e.appDefinition[r].api.events).reduce(((e,t)=>(e[t]=[],e)),(0,G.Ay)({}))})),(0,G.Ay)({}));this.localSubscribersMap=Object.keys(e.subscriptions).map((e=>e)).reduce(((t,r)=>{const s=e.subscriptions[r];return Object.keys(s).map((e=>e)).forEach((e=>{const a=s[e]??[],n=t[e];a.forEach((e=>{n[e].push(r)}))})),t}),t)}connect(e){const{localSubscribersMap:t,broker:r}=this;return r.connect({onLocalEvent:async(r,s,a,n,i,o)=>{const c=t[r][a];await Promise.all(c.map((async t=>{await e.onEvent(r,t,a,n,i,o)})))}})}}var j=r(40945),K=r(94189),W=r(81459);function B(e){const t=e=>({build:()=>e,withMockedCommand:(r,s)=>(e.commands[r]=s,t(e)),withMockedQuery:(r,s)=>(e.queries[r]=s,t(e))}),r={commands:{},queries:{}};for(const t of Object.keys(e.commands))r.commands[t]=jest.fn((()=>{throw new Error(`command ${t} of module ${e.name} is called but not mocked`)}));for(const t of Object.keys(e.queries))r.queries[t]=jest.fn((()=>{throw new Error(`query ${t} of module ${e.name} is called but not mocked`)}));return t(r)}var H=r(21869);const z=()=>{const e=(t,r)=>{const s=new F.$({appDefinition:t,channels:{},channelsListener:P.y,currentNode:"",subscriptions:{}}),a=new M.d(s);let n;const i=async()=>{if(n)return n;const e=r.build(),t=a.connect({onCommand:(t,r,s)=>{if(!(t in e))throw new Error(`${t} is not mocked`);return e[t].commands[r](s)},onQuery:(t,r,s)=>{if(!(t in e))throw new Error(`${t} is not mocked`);return e[t].queries[r](s)}});return n=await t.start(),n};return{buildClient:async e=>{const t=new K.w(a,s,e??new H.f);return await i(),t},buildContextlessClient:async()=>{const e=new K.m(s,a);return await i(),e},withMock:(s,a)=>{const n={...t,...(0,G.Ay)({[s.name]:{api:s,main:"",queryOnly:[]}})},i=r.withModule(s,a);return e(n,i)}}};return e({},function(){const e=new Map,t={withModule:(r,s)=>{const a=r.name;if(void 0===s){const s=B(r).build();return e.set(a,s),t}if("function"==typeof s){const n=B(r);return e.set(a,s(n).build()),t}return e.set(a,s),t},build:t=>{const r=t?Object.keys(t):[...e.keys()];return Array.from(r).reduce(((r,s)=>({...r,[s]:e.get(s)??B(t?t[s].api:{name:"",commands:{},events:{},queries:{}}).build()})),{})}};return t}())};function $({appDefinition:e,channels:t,channelsListener:r}){const s=new F.$({appDefinition:e,channels:t,channelsListener:r,currentNode:null,subscriptions:{}}),a=new M.d(s),n=()=>{throw new Error("Unexpected request received by detached application client")},i=a.connect({onCommand:n,onQuery:n}).start();return{client:(0,j.R)(e,a),stop:async()=>(await i).stop()}}var Q=r(27149),Y=r(60399),X=r(89618);async function J(e,t=1e4){if(!(0,Q.b)(e))throw new Error("Error in getQueryValue: the argument is not an observable");try{return await(0,Y.z)(e.pipe((0,X.V)({first:t})))}catch(e){throw new Error("Error in getQueryValue: "+e)}}var Z=r(14463),ee=r(91199),te=r(4603),re=r(38144),se=r(15524),ae=r(83081),ne=r(9671),ie=r(10722);const oe=new ae.N;async function ce(e,t){const r=new e("mockedModuleName",e.Definition,oe,"user",(0,ne.f)(),ee.hL,new ie.E);return t&&await r.set(t),r}var ue=r(95681),de=r(23347),le=r(5711),pe=r(71949),he=r(49959),me=r(64987);const ye=16,ge=.5,ve=1.3;function fe(e){var t;const{chunkControl:{decrement:r=ge,increment:s=ve,initialSize:a=ye}={decrement:ge,increment:ve,initialSize:ye}}=e;const n=new me.WU;return(t=class{constructor(e,t){this.repository=e,this.processor=t}async dispatchBatch(e){await n.runExclusive((async()=>{const t=await this.pushItemsInQueue(e);for(;t.queue.length>0;)await this.processOneChunkFromQueue(t)}))}async pushItemsInQueue(t){const r=await this.repository.getBatchState(e.name),s=t.filter((e=>!r.queue.find((t=>t===e))));return s.length&&(r.queue.push(...s),await this.repository.setBatchState(e.name,r)),r}async processOneChunkFromQueue(t){const n=function(e){const{lastStartedChunkFirstId:t,lastStartedChunkSize:n=a}=e;if(!t)return a;const i=!e.queue.find((e=>e===t));return Math.max(1,i?Math.ceil(n*s):Math.floor(n*r))}(t),i=Math.min(n,t.queue.length);if(!i)throw new Error("Should have something to process");await this.repository.setBatchState(e.name,{...t,lastStartedChunkSize:i,lastStartedChunkFirstId:t.queue[0]});const o=t.queue.splice(0,i);await this.processor.processChunk(o),await this.repository.setBatchState(e.name,t)}}).Definition=e,t}var we=r(69594),Se=r(75994),_e=r(67978)},37920:(e,t,r)=>{"use strict";r.d(t,{G:()=>u,v:()=>c});var s=r(88802),a=r(32875),n=r(26457),i=r(63364),o=r(43004);let c=class{constructor(e,t){this.sink=e,this.logger=t}captureException(e,t,r=o.w.CRITICAL){try{const s=e instanceof Error?e:new Error("Invalid exception type"),a=this.createExceptionLogEntry(t,s,r);return this.sink.logException(a)}catch(r){this.logger.error("Failed to capture exception",r,e,t)}return Promise.resolve()}createExceptionLogEntry(e,t,r){return{criticality:r,message:t.message,callStack:t.stack??"",moduleName:e.moduleName,useCaseId:e.useCaseId,useCaseName:e.useCaseName,useCaseStacktrace:e.useCaseStacktrace,timestamp:Date.now(),featuresFlipped:this.mapFeatures(e.featureFlips??{})}}mapFeatures(e){return Object.keys(e).reduce(((t,r)=>e[r]?[r,...t]:t),[])}};function u(){return new c(new i.p,new n.W)}c=(0,s.__decorate)([(0,a.Injectable)(),(0,s.__metadata)("design:paramtypes",[i.q,n.V])],c)},63364:(e,t,r)=>{"use strict";r.d(t,{p:()=>a,q:()=>s});class s{}class a extends s{logException(){return Promise.resolve()}start(){return Promise.resolve({stop:()=>Promise.resolve()})}}},68475:(e,t,r)=>{"use strict";r.d(t,{c:()=>y,x:()=>g});var s=r(88802),a=r(32875),n=r(25313),i=r(60399),o=r(37182),c=r(87065),u=r(70493),d=r(87279),l=r(21869),p=r(37920),h=r(428),m=r(94189);class y extends Error{constructor(e,t){super("ApplicationRequestError"),this.exception=e,this.useCaseStacktrace=t}}let g=class{constructor(e,t,r){this.logger=e,this.useCaseStacktraceRepo=t,this.cqrsClient=r}intercept(e,t){const r=e.getArgByIndex(0);return t.handle().pipe((0,o.K)(this.handleException(r)))}handleException(e){const{useCaseStacktraceRepo:t}=this;return r=>{if(t.isInitialUseCase()){const[s,a]=r instanceof y?[r.exception,r.useCaseStacktrace]:[r,t.read()];return this.captureException(e,s,a),(0,n._)((()=>s))}const s=r instanceof y?r:new y(r,t.read());return(0,n._)((()=>s))}}async getUserFeatureFlips(){const{queries:{userFeatureFlips:e}}=this.cqrsClient.getClient(u.cV);return await(0,i.z)(e().pipe((0,c.U)((e=>{if((0,d.d6)(e))return(0,d.db)(e);throw new Error("Failed to retrieve user featureFlips")}))))}async captureException(e,t,r){this.logger.captureException(t,{moduleName:e.module,useCaseName:e.name,useCaseId:e.context.get(l.l.UseCaseId),featureFlips:await this.getUserFeatureFlips(),useCaseStacktrace:r})}};g=(0,s.__decorate)([(0,a.Injectable)({scope:a.Scope.REQUEST}),(0,s.__metadata)("design:paramtypes",[p.v,h.F,m.w])],g)},43004:(e,t,r)=>{"use strict";var s;function a(e){return!(!e||"object"!=typeof e)&&("criticality"in e&&"timestamp"in e&&"message"in e&&"callStack"in e&&((e.criticality===s.CRITICAL||e.criticality===s.WARNING)&&"string"==typeof e.message&&"string"==typeof e.callStack))}r.d(t,{h:()=>a,w:()=>s}),function(e){e.WARNING="warning",e.CRITICAL="critical"}(s||(s={}))},428:(e,t,r)=>{"use strict";r.d(t,{F:()=>o,U:()=>c});var s=r(88802),a=r(32875),n=r(21869);const i="USE_CASE_STACKTRACE";let o=class{constructor(e){this.requestContext=e}isInitialUseCase(){return(this.requestContext.get(i)??[]).length<=1}read(){return this.requestContext.getOrAddSync(i,(()=>[]))??[]}append(e){const{requestContext:t}=this,r=t.get(i)??[];t.set(i,[...r,e])}};o=(0,s.__decorate)([(0,a.Injectable)(),(0,s.__metadata)("design:paramtypes",[n.f])],o);const c=new o(new n.f)},7876:(e,t,r)=>{"use strict";r.d(t,{c:()=>A});var s=r(88802),a=r(49329),n=r(99634),i=r(42339),o=r(87279),c=r(63663),u=r(25029),d=r(95681),l=r(23347);const p=e=>"object"==typeof e&&null!==e&&"swStartTime"in e&&"taskTrackingList"in e&&"string"==typeof e.swStartTime&&"object"==typeof e.taskTrackingList;class h extends((0,d.Q)({persist:!1,initialValue:{swStartTime:"",taskTrackingList:{}},scope:u.F.Device,storeName:"task-tracking",storeTypeGuard:p,capacity:l.Y._001KB})){}let m=class{constructor(e){this.store=e}async execute({body:e}){const t=(new Date).toISOString(),{taskName:r,feature:s,businessDomain:a}=e,n={taskName:r,feature:s,businessDomain:a,startTime:t,serviceWorkerInterruptionCount:0},i=await this.store.getState();return await this.store.set({...i,taskTrackingList:{...i.taskTrackingList,[t]:n}}),Promise.resolve((0,o.Vp)({id:t}))}};m=(0,s.__decorate)([(0,c.W)(i.g),(0,s.__metadata)("design:paramtypes",[h])],m);var y=r(53576),g=r(92233),v=r(43866),f=r(94189),w=r(57924);let S=class{constructor(e,t,r){this.store=e,this.cqrsClient=t,this.appLifecycle=r}onFrameworkInit(){this.appLifecycle.addAppReadyHook((async()=>{const e=await this.store.getState(),t={...e.taskTrackingList},r=Object.keys(e.taskTrackingList).map((async r=>{const{taskName:s,feature:a,businessDomain:n,startTime:i}=e.taskTrackingList[r],o=new g.UserMv3ExtensionTaskInterruptionEvent({businessDomain:n,feature:a,taskName:s,taskStartDateTime:i,serviceWorkerStartDateTime:e.swStartTime}),c=this.cqrsClient.getClient(y.carbonLegacyApi);await c.commands.carbon({name:"logEvent",args:[{event:o}]}),delete t[r]}));await Promise.all(r),await this.store.set({swStartTime:(new Date).toISOString(),taskTrackingList:t})}))}};S=(0,s.__decorate)([(0,w.ar)(),(0,s.__metadata)("design:paramtypes",[h,f.w,v.d])],S);var _=r(29876),b=r(26457);let E=class{constructor(e,t,r){this.store=e,this.cqrsClient=t,this.logger=r}async execute({body:e}){const{taskTrackingId:t}=e,r=await this.store.getState(),s=r.taskTrackingList[t];if(!s)return this.logger.trace("Trying to track a task that does not exist"),(0,o.Vp)(void 0);const{taskName:a,feature:n,businessDomain:i,startTime:c,serviceWorkerInterruptionCount:u}=s,d=new g.UserMv3ExtensionTaskReportEvent({businessDomain:i,feature:n,serviceWorkerInterruptionCount:u,serviceWorkerStartDateTime:r.swStartTime,taskName:a,taskStartDateTime:c,taskEndDateTime:(new Date).toISOString()}),l=this.cqrsClient.getClient(y.carbonLegacyApi);await l.commands.carbon({name:"logEvent",args:[{event:d}]});const p={...r.taskTrackingList};return delete p[t],await this.store.set({swStartTime:r.swStartTime,taskTrackingList:p}),(0,o.Vp)(void 0)}};E=(0,s.__decorate)([(0,c.W)(_.y),(0,s.__metadata)("design:paramtypes",[h,f.w,b.V])],E);let A=class{};A=(0,s.__decorate)([(0,n.Y)({api:a.e,handlers:{commands:{startTaskTracking:m,terminateTaskTracking:E},events:{},queries:{}},stores:[h],onFrameworkInit:S,providers:[]})],A)},58649:(e,t,r)=>{"use strict";r.d(t,{N:()=>f});var s=r(6136),a=r(98187),n=r(15023),i=r(30523),o=r(16433),c=r(89618),u=r(37182),d=r(17350),l=r(97280),p=r(42946),h=r(162),m=r(2049),y=r(6220),g=r(7074),v=r(69183);class f{constructor(e,t=3e4){const r=e.status$.pipe((0,s.x)());let f=!1;const w=new a.x,S=w.pipe((0,y.z)((async s=>{const a=(0,v.Z)();let y=!1;const g=e.messages$.pipe((0,n.o)((()=>!f)),(0,i.h)((e=>"acknowledgement"===e.type&&e.id===a)),(0,o.q)(1),(0,c.V)(t),(0,u.K)((()=>d.E)),(0,l.d)(1)),w=g.subscribe((()=>{y=!0,w.unsubscribe()})),S=r.pipe((0,n.o)((()=>!y&&!f)),(0,p.z)((()=>(0,h.D)(e.sendMessage({type:"send",id:a,message:s.message}))))).subscribe();try{await(0,m.n)(g),S.unsubscribe(),s.resolve()}catch(e){S.unsubscribe(),s.reject(e)}}))).subscribe();this.stop=()=>(f=!0,S.unsubscribe(),e.stop()),this.send=e=>new Promise(((t,r)=>{const s={message:e,resolve:t,reject:r};w.next(s)})),this.channelState$=e.status$,this.receivedMessages$=e.messages$.pipe((0,i.h)((e=>"send"===e.type)),(0,y.z)((async t=>{if("send"===t.type)return await e.sendMessage({type:"acknowledgement",id:t.id}),t.message})),(0,g.B)())}}},65488:(e,t,r)=>{"use strict";r.d(t,{U:()=>E});var s=r(24966),a=r(2049),n=r(30523),i=r(6220),o=r(162),c=r(87065),u=r(37182),d=r(69885),l=r(59891);const p=e=>{if(!e||"object"!=typeof e)return!1;return"unSubscription"===e.type},h=(e,t,r)=>{const s=new Set(r),a=new Map,h=t.receivedMessages$.pipe((0,n.h)(p)).subscribe((e=>{const t=a.get(e.id);t?.unsubscribe(),a.delete(e.id)})),m=t.receivedMessages$.pipe((0,n.h)((e=>{return!(!(t=e)||"object"!=typeof t)&&"start"===t.type&&s.has(e.definition.destination)&&!a.has(e.definition.id);var t})),(0,i.z)((e=>(0,o.D)((async e=>(a.set(e.definition.id,{unsubscribe:()=>{}}),await t.send({type:"initial-acknowledgement",id:e.definition.id}),e))(e))))).subscribe((r=>{const s=r.definition.destination,n=e(s,r.definition.content,r.metadata),p={type:"end",id:r.definition.id},h=n.pipe((0,c.U)((e=>({id:r.definition.id,data:e,type:"data"}))),(0,u.K)((e=>{const t={id:r.definition.id,type:"error",errorMessage:e.message};return(0,d.of)(t)})),(0,l.l)(p),(0,i.z)((e=>(0,o.D)(t.send(e))))).subscribe();a.set(r.definition.id,{unsubscribe:()=>{h.unsubscribe()}})}));return{unsubscribe:()=>{m.unsubscribe(),h.unsubscribe();for(const e of a.values())e.unsubscribe()}}};var m=r(58376),y=r(85390),g=r(15023),v=r(6136),f=r(42946),w=r(60399),S=r(15572),_=r(69183);var b=r(28489);class E{constructor(e){this.stopped$=new s.X(!1);const t={routes:(0,b.Ay)({})};this.routes=(()=>{const{routes:r}=Object.keys(e).reduce(((t,r)=>{const s=e[r];if("local"===s.type&&(t.routes[r]={send:s.onMessage,trySend:async(...e)=>(await(0,a.n)(s.onMessage(...e)),!0)}),"remote"===s.type){const e=((e,t)=>{const r=(r,s,a)=>{const i={content:s,destination:String(r),id:(0,_.Z)()};return new m.y((r=>{let s={type:"start",definition:i,metadata:a};const u=(0,y.a)({message:e.receivedMessages$,stopped:t}).pipe((0,g.o)((({stopped:e})=>!e)),(0,c.U)((({message:e})=>e))).subscribe((e=>{var t;(t=e)&&"object"==typeof t&&"initial-acknowledgement"===t.type&&e.id===i.id?s={...s,metadata:{...s.metadata,isReminder:!0}}:(e=>!(!e||"object"!=typeof e)&&"data"===e.type)(e)&&e.id===i.id?r.next(e.data):(e=>!(!e||"object"!=typeof e)&&"error"===e.type)(e)&&e.id===i.id?r.error(new Error(e.errorMessage)):(e=>!(!e||"object"!=typeof e)&&"end"===e.type)(e)&&e.id===i.id&&r.complete()})),d=(0,y.a)({sendTimes:e.channelState$.pipe((0,v.x)(),(0,n.h)((e=>e===S.D.Connected))),stopped:t}).pipe((0,g.o)((({stopped:e})=>!e)),(0,f.z)((()=>(0,o.D)(e.send(s))))).subscribe();return()=>{e.send({type:"unSubscription",id:i.id}),d.unsubscribe(),u.unsubscribe()}}))};return{send:r,trySend:async(t,s,n)=>await(0,w.z)(e.channelState$)===S.D.Connected&&(await(0,a.n)(r(t,s,n)),!0)}})(s.channel,this.stopped$);t.routes[r]=e}return t}),t);return r})()}connect(e,t){let r=!1;return{start:()=>{if(r)throw new Error("Already started");r=!0;const s=e=>h(((e,t,r)=>this.routes[e].send(e,t,r)),e,Object.keys(this.routes)),a=e.map(s),n=new Map,i=t.connectedChannels$.subscribe((e=>{const t=[...n.entries()].filter((([t])=>!(t in e))),r=Object.keys(e).filter((e=>!n.has(e)));t.forEach((([e,t])=>{n.delete(e),t.unsubscribe()})),r.forEach((t=>{const r=e[t],a=s(r);n.set(t,a)}))}));return Promise.resolve({stop:()=>([...a,i,...n.values()].forEach((e=>e.unsubscribe())),this.stopped$.next(!0),Promise.resolve())})}}}sendMessage(e,t){return this.routes[e].send(e,t,{isReminder:!1})}trySendMessage(e,t){return this.routes[e].trySend(e,t,{isReminder:!1})}}},15572:(e,t,r)=>{"use strict";r.d(t,{D:()=>s,q:()=>i});var s,a=r(98187),n=r(24966);!function(e){e.Connected="Connected",e.Disconnected="Disconnected"}(s||(s={}));class i{constructor(){this.sentMessages$=new a.x,this.receivedMessagesSubject$=new a.x,this.channelStateSubject$=new n.X(s.Disconnected)}send(e){if(this.channelStateSubject$.value!==s.Connected)throw new Error("Channel is not connected");return this.sentMessages$.next(e),Promise.resolve()}get receivedMessages$(){return this.receivedMessagesSubject$}get channelState$(){return this.channelStateSubject$}stop(){this.receivedMessages$.complete()}connect(e){if(this.channelStateSubject$.value===s.Connected)return{disconnect:()=>{}};const t=this.sentMessages$.subscribe((t=>{e.receivedMessages$.next(t)}));return this.channelState$.next(s.Connected),{disconnect:()=>{this.channelState$.next(s.Disconnected),t.unsubscribe()}}}}},54452:(e,t,r)=>{"use strict";r.d(t,{v:()=>n,y:()=>a});var s=r(24966);const a={connectedChannels$:new s.X({})},n=e=>({connectedChannels$:new s.X({channel:e})})},45244:(e,t,r)=>{"use strict";r.d(t,{F:()=>a,k:()=>s});const s=({channelName:e,message:t})=>({channelName:e,message:t,type:"graphene-message"}),a=e=>{if(!e||"object"!=typeof e)return!1;return"graphene-message"===e.type}},16855:(e,t,r)=>{"use strict";r.d(t,{$:()=>s});class s{constructor(e){this.appDefinition=e.appDefinition,this.currentNode=e.currentNode,this.channels=e.channels,this.subscriptions=e.subscriptions,this.channelsListener=e.channelsListener}getNodeList(){return this.currentNode?[...this.getRemoteNodeList(),this.currentNode]:this.getRemoteNodeList()}getRemoteNodeList(){return Object.keys(this.channels)}getModuleNames(){return Object.keys(this.appDefinition)}}},21869:(e,t,r)=>{"use strict";r.d(t,{f:()=>a,l:()=>s});const s={UseCaseId:"USE_CASE_ID",UserName:"USER_NAME"};class a{constructor(){this.entries={}}get(e){return this.entries[e]}getOrDefault(e,t){return this.entries[e]??t}getOrFail(e){if(!this.has(e))throw new Error(`No ${e} in request context`);return this.entries[e]}has(e){return e in this.entries}async getOrAdd(e,t){return this.has(e)||this.set(e,await t()),this.get(e)}getOrAddSync(e,t){return this.has(e)||this.set(e,t()),this.get(e)}set(e,t){this.entries[e]=t}toSerializable(){return this.entries}static fromSerializable(e){const t=new a;for(const[r,s]of Object.entries(e))t.entries[r]=s;return t}clone(){return a.fromSerializable(JSON.parse(JSON.stringify(this.toSerializable())))}withValue(e,t){return this.set(e,t),this}}},75994:(e,t,r)=>{"use strict";r.d(t,{W:()=>a,X:()=>s});class s{}class a extends s{constructor(e){super(),this.files=e}fetch(e){return e in this.files?Promise.resolve(this.files[e]):Promise.reject(new Error("404 not found :"+e))}}},67978:(e,t,r)=>{"use strict";r.d(t,{K:()=>c});var s=r(88802),a=r(162),n=r(25859),i=r(57924),o=r(75994);let c=class{constructor(e,t){this.url=e,this.fetcher=t,this.value$=(0,a.D)((0,n.P)((()=>this.get())))}async load(){await this.get()}async get(){const{value:e}=this;if(e)return e;const t=await this.fetcher.fetch(this.url),r=await this.loadResource(t);return this.value=r,r}};c=(0,s.__decorate)([(0,i.GS)(),(0,s.__metadata)("design:paramtypes",[String,o.X])],c)},14463:(e,t,r)=>{"use strict";r.d(t,{q:()=>_});var s=r(88802),a=r(87279),n=r(8987),i=r(87065),o=r(6136),c=r(25029),u=r(95681),d=r(23347);const l=e=>!(!e||"object"!=typeof e)&&"userName"in e;class p extends((0,u.Q)({initialValue:{userName:void 0},persist:!1,scope:c.F.Device,storeName:"active-user-store",storeTypeGuard:l,capacity:d.Y._001KB})){}var h=r(20754),m=r(63663),y=r(81459),g=r(57924);let v=class extends y.f{};v=(0,s.__decorate)([(0,g.GS)()],v);let f=class{constructor(e){this.activeUserStore=e}execute(){return this.activeUserStore.state$.pipe((0,i.U)((e=>e.userName)),(0,o.x)(),(0,i.U)((e=>(0,a.Vp)({userName:e}))))}};f=(0,s.__decorate)([(0,h.e)(n.p),(0,s.__metadata)("design:paramtypes",[p])],f);let w=class{constructor(e,t){this.activeUserStore=e,this.eventEmitter=t}async execute({body:{userName:e}}){return await this.activeUserStore.set({userName:e}),this.eventEmitter.sendEvent("activeUserChanged",{userName:e}),(0,a.Vp)(void 0)}};w=(0,s.__decorate)([(0,m.W)(n.r$),(0,s.__metadata)("design:paramtypes",[p,v])],w);var S=r(99634);let _=class{};_=(0,s.__decorate)([(0,S.Y)({api:n.t$,handlers:{commands:{setActiveUser:w},events:{},queries:{activeUser:f}},stores:[p],providers:[v]})],_)},38144:(e,t,r)=>{"use strict";r.d(t,{h:()=>n,s:()=>i});var s=r(88802),a=r(32875);let n=class{};n=(0,s.__decorate)([(0,a.Injectable)()],n);let i=class{};i=(0,s.__decorate)([(0,a.Injectable)()],i)},4603:(e,t,r)=>{"use strict";r.d(t,{u:()=>a});class s{constructor(e,t,r){this.storage=e,this.baseKey=t,this.initialValueFactory=r}clear(){return this.storage.remove(this.baseKey)}async read(){const e=await this.storage.get(this.baseKey);return!e&&this.initialValueFactory?await this.initialValueFactory():e}async write(e){await this.storage.set(this.baseKey,e)}}class a{constructor(e){this.storage=e}createBackend(e,t,r,a){const n=r?`${e}.${t}.${r}`:`${e}.${t}`;return new s(this.storage,n,a)}}},15524:(e,t,r)=>{"use strict";r.d(t,{s:()=>s});class s{constructor(){this.memory=new Map}set(e,t){return this.memory.set(e,t),Promise.resolve()}getAllKeys(){return Promise.resolve([...this.memory.keys()])}remove(e){return this.memory.get(e)?(this.memory.delete(e),Promise.resolve()):Promise.resolve()}get(e){return Promise.resolve(this.memory.get(e))}}},91199:(e,t,r)=>{"use strict";function s(e,t){return null!==e&&"object"==typeof e&&"version"in e&&"content"in e&&t(e.content)}r.d(t,{Ot:()=>s,QI:()=>n,hL:()=>a});const a={read:()=>Promise.resolve(void 0),write:()=>Promise.resolve(),clear:()=>Promise.resolve()};class n{}},95681:(e,t,r)=>{"use strict";r.d(t,{Q:()=>l});var s=r(57924),a=r(49499),n=r(10722),i=r(91199);class o{constructor(e,t,r,s,i){this.encryptionCodec=e,this.serializationCodec=t,this.transportStorageCodec=r,this.backend=s,this.definition=i,this.codec=(0,a.x)(r,e,t);const o=new n.E;this.bypassedDecryptionDecoder=(0,a.x)(r,o,t)}async read(){const e=await this.backend.read();if(!e)return;const{decoded:t,hasBypassedDecryption:r}=await this.decodeData(e),{definition:s}=this;if(!(0,i.Ot)(t,s.typeGuard)){if(!s.typeGuard(t))throw r&&await this.rawWrite(t),new Error(`Can't migrate non-versioned Storage : Typeguard ${s.typeGuard.name} check failed.`);return await this.write(t),t}if(t.version<s.schemaVersion){if(!s.migrateStorageSchema)throw r&&await this.rawWrite(t),new Error("migrateStorage is undefined");const e=s.migrateStorageSchema(t);return await this.write(e),e}r&&await this.write(t.content);const{content:a}=t;if(!s.typeGuard(a))throw new Error("Type guard failed");return a}async write(e){const t={version:this.definition.schemaVersion,content:e};await this.rawWrite(t)}clear(){return this.backend.clear()}async rawWrite(e){const t=await this.codec.encode(e);await this.backend.write(t)}async decodeData(e){const{codec:t,bypassedDecryptionDecoder:r}=this;try{return{decoded:await t.decode(e),hasBypassedDecryption:!1}}catch(t){try{return{decoded:await r.decode(e),hasBypassedDecryption:!0}}catch{throw t}}}}const c=e=>{var t;return(t=class extends o{constructor(t,r,s,a){super(t,r,s,a,e)}}).Definition=e,t};var u=r(49959);const d=e=>e.persist?{persist:!0,codec:e.codec,scope:e.scope,storeName:e.storeName,storeTypeGuard:e.storeTypeGuard,isCache:e.isCache,storage:c(e.storage)}:{persist:!1,initialValue:e.initialValue,scope:e.scope,storeName:e.storeName};function l(e){var t;const r=d(e),a=((t=class extends u.y{constructor(e,t,r,s,a,n,i){super(e,t,r,s,a,n,i)}}).Definition=r,t);return(0,s.GS)()(a),a}},23347:(e,t,r)=>{"use strict";var s;r.d(t,{Y:()=>s}),function(e){e._001KB="1KB",e._010KB="10KB",e._100KB="100KB",e.Unlimited="Unlimited"}(s||(s={}))},71949:(e,t,r)=>{"use strict";r.d(t,{X:()=>o});var s=r(88802),a=r(32875),n=r(70695),i=r(56860);let o=class{constructor(e,t,r){this.moduleRef=e,this.request=t,this.storeList=r}async prepare(){const e=n.ContextIdFactory.getByRequest(this.request);this.storeList.instances=await Promise.all(this.storeList.classes.map((t=>this.moduleRef.resolve(t,e,{strict:!1}))))}async flush(){const{instances:e}=this.storeList;if(!e.length)throw new Error("Stores not instantiated");const t=e.map((e=>e.persist()));await Promise.all(t)}};o=(0,s.__decorate)([(0,a.Injectable)(),(0,s.__param)(1,(0,a.Inject)(n.REQUEST)),(0,s.__metadata)("design:paramtypes",[n.ModuleRef,Object,i.D])],o)},83081:(e,t,r)=>{"use strict";r.d(t,{N:()=>i,G:()=>n});var s=r(24966);class a{constructor(e){this.initValue=e,this.state$=new s.X(e)}set(e){return this.state$.next(e),Promise.resolve()}init(e){return this.state$.next(e),Promise.resolve()}stop(){this.state$.complete()}getState(){return Promise.resolve(this.state$.value)}clear(){return this.state$.next(this.initValue),Promise.resolve()}update(e){return this.set(e(this.state$.value)),Promise.resolve()}persist(){return Promise.resolve()}load(){return Promise.resolve()}}class n{}class i extends n{createUserScopedInfrastructure(){return new a({timestamp:void 0})}createDeviceScopedInfrastructure(){return new a({timestamp:void 0})}}},56860:(e,t,r)=>{"use strict";r.d(t,{D:()=>s});class s{constructor(){this.registeredClasses=[],this.preparedInstances=[]}get classes(){return this.registeredClasses}get instances(){return this.preparedInstances}set instances(e){this.preparedInstances=e}registerClass(e){this.registeredClasses.push(e)}}},5711:(e,t,r)=>{"use strict";r.d(t,{N:()=>w});var s=r(70695),a=r(69183),n=r(25029),i=r(43866),o=r(63411),c=r(83081),u=r(92542),d=r(43702),l=r(23711),p=r(38144),h=r(4603),m=r(21869);const y={[n.F.Device]:p.h,[n.F.User]:p.s};var g=r(9671),v=r(97631);function f(e){const t=e.Definition.persist?function(e,t,r){const{EncryptionCodec:s=y[t],SerializationCodec:i=d.b,TransportStorageCodec:c=l.z,initialValue:p,schemaVersion:g}=r.Definition;class v{constructor(e,t,r,s){this.encryptionCodec=e,this.serializationCodec=t,this.transportStorageCodec=r,this.backend=s}}class f extends r{constructor(e){super(e.encryptionCodec,e.serializationCodec,e.transportStorageCodec,e.backend)}}const w={token:(0,a.Z)(),inject:[v],asyncFactory:e=>Promise.resolve(new f(e))};return[{token:v,inject:[u.r,s,i,c,h.u,...t===n.F.User?[m.f]:[]],asyncFactory:async(r,s,a,i,o,c)=>{const u=await o.createBackend(r,e,(t===n.F.User?c?.get(m.l.UserName):"")??"",(async()=>{const e={version:g,content:p},t=await a.encode(e),r=await s.encode(t);return await i.encode(r)}));return new v(s,a,i,u)}},...(0,o.B)(t,r,w)]}(e.Definition.storeName,e.Definition.scope,e.Definition.storage):[],r={token:(0,a.Z)(),inject:[u.r,i.d,c.G,e.Definition.scope===n.F.User?m.f:s.REQUEST,g.J,v.g,...e.Definition.persist?[e.Definition.storage,e.Definition.codec]:[]],asyncFactory:async(t,r,s,a,i,o,c,u)=>{const d=new e(t,e.Definition,s,(e.Definition.scope===n.F.User?a.get(m.l.UserName):"")??"",i,c,u),l=async()=>{await d.clear(),d.stop()};if(e.Definition.scope===n.F.User){if(!o)throw new Error("No user scope available");o.addCloseHook(l)}else r.addShutdownHook(l);return await d.load(),d}};return[...t,...(0,o.B)(e.Definition.scope,e,r)]}function w(...e){return e.flatMap((e=>f(e)))}},49959:(e,t,r)=>{"use strict";r.d(t,{y:()=>d});var s=r(24966),a=r(85390),n=r(87065),i=r(30523),o=r(60399),c=r(25029),u=r(95087);class d{constructor(e,t,r,o,d,l,p){this.conf=t,this.allowedToFail=d,this.storage=l,this.codec=p;this.infrastructure=(()=>{switch(t.scope){case c.F.Device:return r.createDeviceScopedInfrastructure(e,t.storeName,t.storeTypeGuard);case c.F.User:if(!o)throw new Error("Attempting to create a user-scoped store without a user");return r.createUserScopedInfrastructure(e,t.storeName,o,t.storeTypeGuard)}(0,u.U)(t.scope)})(),this.timeGetter=()=>Date.now(),this.localState$=new s.X({timestamp:void 0}),this.mergedState$=(0,a.a)({infra:this.infrastructure.state$,current:this.localState$}).pipe((0,n.U)((({current:e,infra:t})=>t.timestamp&&(!e.timestamp||t.timestamp>e.timestamp)?t:e)));const h=t.persist?void 0:t.initialValue;this.state$=this.mergedState$.pipe((0,i.h)((e=>!t.persist||!!e.timestamp)),(0,n.U)((e=>e.data??h)))}getState(){return(0,o.z)(this.state$)}async set(e){await this.setWithoutPersist(e),await this.persist()}async setWithoutPersist(e){const t={data:e,timestamp:this.timeGetter()};this.localState$.next(t),await this.infrastructure.set(t)}init(e){const t={data:e,timestamp:0};return this.localState$.next(t),Promise.resolve()}async clear(){this.localState$.next({timestamp:void 0}),await this.infrastructure.clear()}stop(){this.localState$.complete()}async update(e){const t=await this.getState();await this.set(e(t))}async load(){const{conf:e,codec:t,storage:r}=this;if(!e.persist)return;if(!t||!r)throw new Error("Persisted stores should have conf/storage");await this.allowedToFail.conditionallyAllowToFailOne((async()=>{const s=await r.read()??e.storage.Definition.initialValue,a=await t.decode(s);await this.setWithoutPersist(a)}),!!e.isCache)||await this.setWithoutPersist(await t.decode(e.storage.Definition.initialValue))}async persist(){const{conf:e,codec:t,storage:r}=this;if(!e.persist)return;if(!t||!r)throw new Error("Persisted stores should have conf/storage");const s=await this.getState(),a=await t.encode(s);await r.write(a)}}},69594:(e,t,r)=>{"use strict";r.d(t,{R_:()=>a,_C:()=>n,ql:()=>s});class s{run(){return Promise.resolve()}isRunnable(){return!1}}class a{}class n extends a{constructor(e){super(),this.alarm$=e.createObservableTimer(6e4,6e4)}}},33920:(e,t,r)=>{"use strict";r.d(t,{F:()=>a,p:()=>s});const s={Open:"open",Closed:"closed"};class a{constructor(e){this.lifecycle=e,this.status=s.Open,this.onAppShutdown=()=>this.close(),this.closeHooks=[],e.addShutdownHook(this.onAppShutdown)}async close(){for(;this.closeHooks.length>0;){const e=this.closeHooks.pop();e&&await e()}this.status=s.Closed,this.lifecycle.removeShutdownHook(this.onAppShutdown)}addCloseHook(e){this.closeHooks.push(e)}}},97631:(e,t,r)=>{"use strict";r.d(t,{g:()=>p});var s=r(88802),a=r(78263),n=r(30523),i=r(16433),o=r(32875),c=r(87279),u=r(69008),d=r(33920),l=r(43866);let p=class extends d.F{constructor(e,t,r){super(t),this.requestContext=r,r.queries.activeUser().pipe((0,a.G)(),(0,n.h)(this.thisUserGotDeactivated(e)),(0,i.q)(1)).subscribe((()=>{this.close()}))}thisUserGotDeactivated(e){return([t,r])=>{if(!(0,c.d6)(t)||!(0,c.d6)(r))return!1;const s=(0,c.db)(t).userName,a=(0,c.db)(r).userName;return s===e&&void 0===a}}};p=(0,s.__decorate)([(0,o.Injectable)(),(0,s.__metadata)("design:paramtypes",[String,l.d,u.Q])],p)},37204:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.analyticsApi=t.TrackPageViewCommand=t.TrackEventCommand=void 0;const s=r(85888),a=r(70986);class n extends((0,a.defineCommand)({scope:a.UseCaseScope.Device})){}t.TrackEventCommand=n;class i extends((0,a.defineCommand)({scope:a.UseCaseScope.Device})){}t.TrackPageViewCommand=i,t.analyticsApi=(0,s.defineModuleApi)({commands:{TrackEventCommand:n,TrackPageViewCommand:i},events:{},name:"analytics",queries:{}})},7022:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},52389:function(e,t,r){"use strict";var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var a=Object.getOwnPropertyDescriptor(t,r);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,a)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),a=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),a(r(37204),t),a(r(7022),t)},82142:(e,t)=>{"use strict";function r(e){const t=e=>({build:()=>e,withMockedCommand:(r,s)=>(e.commands[r]=s,t(e)),withMockedQuery:(r,s)=>(e.queries[r]=s,t(e))}),r={commands:{},queries:{}};for(const t of Object.keys(e.commands))r.commands[t]=jest.fn((()=>{throw new Error(`command ${t} of module ${e.name} is called but not mocked`)}));for(const t of Object.keys(e.queries))r.queries[t]=jest.fn((()=>{throw new Error(`query ${t} of module ${e.name} is called but not mocked`)}));return t(r)}Object.defineProperty(t,"__esModule",{value:!0}),t.appClientMockBuilder=void 0,t.appClientMockBuilder=function(){const e=new Map,t={withModule:(s,a)=>{const n=s.name;if(void 0===a){const a=r(s).build();return e.set(n,a),t}if("function"==typeof a){const i=r(s);return e.set(n,a(i).build()),t}return e.set(n,a),t},build:t=>{const s=t?Object.keys(t):[...e.keys()];return Array.from(s).reduce(((s,a)=>({...s,[a]:e.get(a)??r(t?t[a].api:{name:"",commands:{},events:{},queries:{}}).build()})),{})}};return t}},67202:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.appClientMockBuilder=void 0;var s=r(82142);Object.defineProperty(t,"appClientMockBuilder",{enumerable:!0,get:function(){return s.appClientMockBuilder}})},54072:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CommandMessage=void 0;const s=r(98653);class a extends s.RequestMessage{constructor(e){super(),this.body=e}}t.CommandMessage=a},98653:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UseCaseScope=t.RequestMessage=void 0;t.RequestMessage=class{},function(e){e.User="user",e.Device="device"}(t.UseCaseScope||(t.UseCaseScope={}))},85088:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EMPTY_QUERY_RESULT=t.PAGINATION_START_PAGE_INDEX=t.FilterOperationName=void 0,function(e){e.Equals="equals",e.Differs="differs",e.Matches="matches",e.In="in",e.Contains="contains"}(t.FilterOperationName||(t.FilterOperationName={})),t.PAGINATION_START_PAGE_INDEX=1,t.EMPTY_QUERY_RESULT={items:[],itemCount:0,page:t.PAGINATION_START_PAGE_INDEX,pageCount:1}},77939:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.defineCarbonCommand=t.defineCommand=void 0;const s=r(54072),a=r(98653);t.defineCommand=(...[e={scope:a.UseCaseScope.User}])=>{var t;return(t=class extends s.CommandMessage{}).metadata=e,t};t.defineCarbonCommand=(e={scope:a.UseCaseScope.User})=>{var t;return(t=class extends s.CommandMessage{}).metadata=e,t}},1941:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.defineQuery=void 0;const s=r(70522),a=r(98653);t.defineQuery=(e={scope:a.UseCaseScope.User})=>{var t;return(t=class extends s.QueryMessage{}).metadata=e,t}},70986:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.defineQuery=t.defineCarbonCommand=t.defineCommand=t.UseCaseScope=t.FilterOperationName=t.EMPTY_QUERY_RESULT=t.PAGINATION_START_PAGE_INDEX=t.QueryMessage=t.CommandMessage=void 0;var s=r(54072);Object.defineProperty(t,"CommandMessage",{enumerable:!0,get:function(){return s.CommandMessage}});var a=r(70522);Object.defineProperty(t,"QueryMessage",{enumerable:!0,get:function(){return a.QueryMessage}});var n=r(85088);Object.defineProperty(t,"PAGINATION_START_PAGE_INDEX",{enumerable:!0,get:function(){return n.PAGINATION_START_PAGE_INDEX}});var i=r(85088);Object.defineProperty(t,"EMPTY_QUERY_RESULT",{enumerable:!0,get:function(){return i.EMPTY_QUERY_RESULT}}),Object.defineProperty(t,"FilterOperationName",{enumerable:!0,get:function(){return i.FilterOperationName}});var o=r(98653);Object.defineProperty(t,"UseCaseScope",{enumerable:!0,get:function(){return o.UseCaseScope}});var c=r(77939);Object.defineProperty(t,"defineCommand",{enumerable:!0,get:function(){return c.defineCommand}}),Object.defineProperty(t,"defineCarbonCommand",{enumerable:!0,get:function(){return c.defineCarbonCommand}});var u=r(1941);Object.defineProperty(t,"defineQuery",{enumerable:!0,get:function(){return u.defineQuery}})},70522:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.QueryMessage=void 0;const s=r(98653);class a extends s.RequestMessage{constructor(e){super(),this.body=e}}t.QueryMessage=a},49631:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EventMessage=t.defineEvent=void 0;var s=r(84776);Object.defineProperty(t,"defineEvent",{enumerable:!0,get:function(){return s.defineEvent}}),Object.defineProperty(t,"EventMessage",{enumerable:!0,get:function(){return s.EventMessage}})},84776:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.defineEvent=t.EventMessage=void 0;const s=r(98653);class a{constructor(e){this.body=e}}t.EventMessage=a;t.defineEvent=(e={scope:s.UseCaseScope.User})=>{var t;return(t=class extends a{}).metadata=e,t}},90693:function(e,t,r){"use strict";var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var a=Object.getOwnPropertyDescriptor(t,r);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,a)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),a=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),a(r(52389),t),a(r(70986),t),a(r(35079),t),a(r(85888),t),a(r(49631),t),a(r(67202),t)},35079:function(e,t,r){"use strict";var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var a=Object.getOwnPropertyDescriptor(t,r);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,a)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),a=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),a(r(36518),t)},82397:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.taskTrackingApi=void 0;const s=r(85888),a=r(96609),n=r(7797);t.taskTrackingApi=(0,s.defineModuleApi)({name:"taskTracking",commands:{startTaskTracking:a.StartTaskTrackingCommand,terminateTaskTracking:n.TerminateTaskTrackingCommand},events:{},queries:{}})},39948:function(e,t,r){"use strict";var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var a=Object.getOwnPropertyDescriptor(t,r);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,a)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),a=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),a(r(96609),t),a(r(7797),t)},96609:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StartTaskTrackingCommand=void 0;const s=r(70986);class a extends((0,s.defineCommand)({scope:s.UseCaseScope.Device})){}t.StartTaskTrackingCommand=a},7797:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TerminateTaskTrackingCommand=void 0;const s=r(70986);class a extends((0,s.defineCommand)({scope:s.UseCaseScope.Device})){}t.TerminateTaskTrackingCommand=a},36518:function(e,t,r){"use strict";var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var a=Object.getOwnPropertyDescriptor(t,r);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,a)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),a=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),t.taskTrackingApi=void 0;var n=r(82397);Object.defineProperty(t,"taskTrackingApi",{enumerable:!0,get:function(){return n.taskTrackingApi}}),a(r(39948),t)},17286:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},24164:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.featureFlipsApi=t.UserFeatureFlipQuery=t.UserFeatureFlipsQuery=void 0;const s=r(70986),a=r(8369);class n extends((0,s.defineQuery)({scope:s.UseCaseScope.Device})){}t.UserFeatureFlipsQuery=n;class i extends((0,s.defineQuery)({scope:s.UseCaseScope.Device})){}t.UserFeatureFlipQuery=i,t.featureFlipsApi=(0,a.defineModuleApi)({commands:{},events:{},name:"featureFlips",queries:{UserFeatureFlipsQuery:n,UserFeatureFlipQuery:i}})},71057:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FeatureFlipsClient=void 0;const s=r(23767),a=r(24164);class n extends((0,s.defineModuleClient)(a.featureFlipsApi)){}t.FeatureFlipsClient=n,(0,s.registerModuleClient)(a.featureFlipsApi,n)},85888:function(e,t,r){"use strict";var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var a=Object.getOwnPropertyDescriptor(t,r);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,a)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),a=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),a(r(8369),t),a(r(21697),t),a(r(17286),t),a(r(6964),t),a(r(23767),t),a(r(24164),t),a(r(71057),t),a(r(27646),t)},23767:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.registerModuleClient=t.defineModuleClient=void 0,t.defineModuleClient=function(e){var t;return(t=class{get commands(){throw new Error("Not implemented")}get queries(){throw new Error("Not implemented")}}).api=e,t},t.registerModuleClient=function(e,t){e.ClientClass=t}},8369:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.defineModuleApi=void 0;const r=(e,t)=>Object.entries(e).reduce(((e,[r,s])=>(e[((e,t)=>e.endsWith(t)?e.charAt(0).toLowerCase()+e.substring(1,e.length-t.length):e)(r,t)]=s,e)),{});t.defineModuleApi=e=>({name:e.name,commands:r(e.commands,"Command"),queries:r(e.queries,"Query"),events:r(e.events,"Event")})},6964:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.requestContextApi=t.ActiveUserChangedEvent=t.SetActiveUserCommand=t.ActiveUserQuery=void 0;const s=r(70986),a=r(49631),n=r(8369);class i extends((0,s.defineQuery)({scope:s.UseCaseScope.Device})){}t.ActiveUserQuery=i;class o extends((0,s.defineCommand)({scope:s.UseCaseScope.Device})){}t.SetActiveUserCommand=o;class c extends((0,a.defineEvent)({scope:s.UseCaseScope.Device})){}t.ActiveUserChangedEvent=c,t.requestContextApi=(0,n.defineModuleApi)({commands:{SetActiveUserCommand:o},events:{activeUserChanged:c},name:"requestContext",queries:{ActiveUserQuery:i}})},27646:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RequestContextClient=void 0;const s=r(23767),a=r(6964);class n extends((0,s.defineModuleClient)(a.requestContextApi)){}t.RequestContextClient=n,(0,s.registerModuleClient)(a.requestContextApi,n)},21697:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NullModuleApi=void 0,t.NullModuleApi={name:"api",commands:{},events:{},queries:{}}},20587:(e,t,r)=>{"use strict";r.d(t,{L5:()=>i,Yu:()=>c,mf:()=>o});var s=r(86952),a=r(74354),n=r(25029);class i extends((0,a.g)({scope:n.F.Device})){}class o extends((0,a.g)({scope:n.F.Device})){}const c=(0,s.Q)({commands:{TrackEventCommand:i,TrackPageViewCommand:o},events:{},name:"analytics",queries:{}})},25029:(e,t,r)=>{"use strict";r.d(t,{F:()=>a,z:()=>s});class s{}var a;!function(e){e.User="user",e.Device="device"}(a||(a={}))},74354:(e,t,r)=>{"use strict";r.d(t,{g:()=>n});var s=r(25029);class a extends s.z{constructor(e){super(),this.body=e}}const n=(...[e={scope:s.F.User}])=>{var t;return(t=class extends a{}).metadata=e,t}},99059:(e,t,r)=>{"use strict";r.d(t,{k:()=>n});var s=r(25029);class a extends s.z{constructor(e){super(),this.body=e}}const n=(e={scope:s.F.User})=>{var t;return(t=class extends a{}).metadata=e,t}},88885:(e,t,r)=>{"use strict";r.d(t,{d:()=>n});var s=r(25029);class a{constructor(e){this.body=e}}const n=(e={scope:s.F.User})=>{var t;return(t=class extends a{}).metadata=e,t}},49329:(e,t,r)=>{"use strict";r.d(t,{e:()=>i});var s=r(86952),a=r(42339),n=r(29876);const i=(0,s.Q)({name:"taskTracking",commands:{startTaskTracking:a.g,terminateTaskTracking:n.y},events:{},queries:{}})},42339:(e,t,r)=>{"use strict";r.d(t,{g:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.Device})){}},29876:(e,t,r)=>{"use strict";r.d(t,{y:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.Device})){}},70493:(e,t,r)=>{"use strict";r.d(t,{cV:()=>c,fV:()=>o,r6:()=>i});var s=r(99059),a=r(25029),n=r(86952);class i extends((0,s.k)({scope:a.F.Device})){}class o extends((0,s.k)({scope:a.F.Device})){}const c=(0,n.Q)({commands:{},events:{},name:"featureFlips",queries:{UserFeatureFlipsQuery:i,UserFeatureFlipQuery:o}})},21242:(e,t,r)=>{"use strict";r.d(t,{P:()=>n});var s=r(67837),a=r(70493);class n extends((0,s.E)(a.cV)){}(0,s.K)(a.cV,n)},67837:(e,t,r)=>{"use strict";function s(e){var t;return(t=class{get commands(){throw new Error("Not implemented")}get queries(){throw new Error("Not implemented")}}).api=e,t}function a(e,t){e.ClientClass=t}r.d(t,{E:()=>s,K:()=>a})},86952:(e,t,r)=>{"use strict";r.d(t,{Q:()=>a});const s=(e,t)=>Object.entries(e).reduce(((e,[r,s])=>(e[((e,t)=>e.endsWith(t)?e.charAt(0).toLowerCase()+e.substring(1,e.length-t.length):e)(r,t)]=s,e)),{}),a=e=>({name:e.name,commands:s(e.commands,"Command"),queries:s(e.queries,"Query"),events:s(e.events,"Event")})},8987:(e,t,r)=>{"use strict";r.d(t,{KZ:()=>d,p:()=>c,r$:()=>u,t$:()=>l});var s=r(99059),a=r(25029),n=r(74354),i=r(88885),o=r(86952);class c extends((0,s.k)({scope:a.F.Device})){}class u extends((0,n.g)({scope:a.F.Device})){}class d extends((0,i.d)({scope:a.F.Device})){}const l=(0,o.Q)({commands:{SetActiveUserCommand:u},events:{activeUserChanged:d},name:"requestContext",queries:{ActiveUserQuery:c}})},69008:(e,t,r)=>{"use strict";r.d(t,{Q:()=>n});var s=r(67837),a=r(8987);class n extends((0,s.E)(a.t$)){}(0,s.K)(a.t$,n)},1665:(e,t,r)=>{"use strict";r.d(t,{I:()=>m});var s=r(88802),a=r(20587),n=r(99634),i=r(63663),o=r(87279),c=r(53576),u=r(57924),d=r(94189);let l=class{constructor(e){this.cqrsClient=e}async trackEvent(e){const{carbon:t}=this.cqrsClient.getClient(c.carbonLegacyApi).commands,r=await t({name:"logEvent",args:[{event:e}]});if((0,o.hx)(r))throw new Error("TrackEvent from carbon failed")}async trackPageView(e,t){const{carbon:r}=this.cqrsClient.getClient(c.carbonLegacyApi).commands,s=await r({name:"logPageView",args:[{pageView:e,browseComponent:t}]});if((0,o.hx)(s))throw new Error("TrackPageView from carbon failed")}};l=(0,s.__decorate)([(0,u.GS)(),(0,s.__metadata)("design:paramtypes",[d.w])],l);let p=class{constructor(e){this.analyticsService=e}async execute({body:{event:e}}){return await this.analyticsService.trackEvent(e),(0,o.Vp)(void 0)}};p=(0,s.__decorate)([(0,i.W)(a.L5),(0,s.__metadata)("design:paramtypes",[l])],p);let h=class{constructor(e){this.analyticsService=e}async execute({body:{pageView:e,browseComponent:t}}){return await this.analyticsService.trackPageView(e,t),(0,o.Vp)(void 0)}};h=(0,s.__decorate)([(0,i.W)(a.mf),(0,s.__metadata)("design:paramtypes",[l])],h);let m=class{};m=(0,s.__decorate)([(0,n.Y)({api:a.Yu,providers:[l],handlers:{commands:{trackEvent:p,trackPageView:h},events:{},queries:{}}})],m)},79256:(e,t,r)=>{"use strict";r.d(t,{y:()=>i});var s=r(88802),a=r(57924),n=r(114);let i=class{constructor(e){this.config=e}async derive(e,t,r){const{deriveKeyArgon2d:s}=this.config.crypto;return await s(e,t,r)}};i=(0,s.__decorate)([(0,a.GS)(),(0,s.__metadata)("design:paramtypes",[n.i])],i)},114:(e,t,r)=>{"use strict";r.d(t,{i:()=>i});var s=r(88802),a=r(57924);const n={computeHash:e=>Promise.resolve(e),decryptAes256:(e,t,r)=>Promise.resolve(r),deriveKeyArgon2d:e=>Promise.resolve(e),deriveKeyPbkdf2:e=>Promise.resolve(e),encryptAes256:e=>Promise.resolve(e),generateKeyAes256:()=>Promise.resolve(new ArrayBuffer(32)),generateKeyPairRsaOaep:()=>Promise.resolve({privateKey:new ArrayBuffer(32),publicKey:new ArrayBuffer(32)}),getRandomValues:e=>new Uint8Array(e),signHmacSha:()=>Promise.resolve(new ArrayBuffer(1)),unsafeComputeMd5Hash:()=>new ArrayBuffer(1),verifyHmacSha:()=>Promise.resolve(!0),decryptRsaOaep:function(e,t){return Promise.resolve(t)},encryptRsaOaep:function(e,t){return Promise.resolve(t)},signRsassaPkcs1:function(e,t){return Promise.resolve(t)}};let i=class{constructor(e){this.crypto=e}};i=(0,s.__decorate)([(0,a.GS)(),(0,s.__metadata)("design:paramtypes",[Object])],i);new i(n)},37935:(e,t,r)=>{"use strict";r.d(t,{D:()=>$});var s=r(88802),a=r(99634),n=r(79256),i=r(114),o=r(31186),c=r(25594),u=r(56268),d=r(31222),l=r(57924),p=r(74017);let h=class{constructor(e){this.config=e}async verify(e,t,r,s=p.x){const{verifyHmacSha:a}=this.config.crypto;return await a(e,t,r,s)}};h=(0,s.__decorate)([(0,l.GS)(),(0,s.__metadata)("design:paramtypes",[i.i])],h);var m=r(92258),y=r(71634),g=r(83919),v=r(56130),f=r(65613),w=r(40369),S=r(12554),_=r(77970),b=r(40173),E=r(28008),A=r(22513),T=r(60733),C=r(19603),x=r(95087),R=r(89685);const I="flexible";var P=r(69591);const D="KWC3",U=0;var F=r(38291);const O=32,N=4;function k(e){const t=e.slice(O,O+N),r=(0,R.v)(t);var s;if(s=r,[D,F.PD].includes(s))return r}function L(e){const t=k(e);return t||(function(e){const t=new Uint8Array(e).slice(0,1);return(0,R.v)(t.buffer)===P.F}(e)?I:void 0)}var M=r(60745),V=r(82933),G=r(94805),q=r(16698);const j={type:D,derivation:G.Yi,cipher:q.No};function K(e){const t=function({transportableData:e,marker:t}){const{derivation:r,type:s}=t,{saltLength:a}=r,n=U+a+s.length;return{salt:e.slice(U,U+a),encipheredContents:e.slice(n)}}({transportableData:e,marker:j});return{salt:t.salt,type:D,encipheredContents:t.encipheredContents,derivationConfig:G.Yi,cipherConfig:q.No}}var W=r(12087);async function B(e,t,r,s){const a=K(s),{deriveKeyPbkdf2:n}=t,{derivationConfig:i,salt:o}=a,c=await(0,W.E)(n,r,i,e,o),{computeHash:u}=t,{cipherConfig:{ivLength:d,bytesToKey:{iterations:l,keyLength:p}}}=a,h=await async function(e,t,r,s,a,n){const i=(0,V.K)(t,n.slice(0,8));let o=i,c=new ArrayBuffer(0);for(let t=0;t<r;t++){const t=await e(o,"SHA-1");c=(0,V.K)(c,t),o=(0,V.K)(t,i)}const u=a+s;return Promise.resolve(c.slice(a,u))}(u,c,l,d,p,o),{decryptAes256:m}=t,{encipheredContents:y}=a;return m(c,h,y)}var H=r(7449);let z=class{constructor(e,t){this.config=e,this.derivationCache=t}decrypt(e,t){return async function(e,t,r,s){const a=L(s);if(!a)throw new Error("Cannot find marker type");switch(a){case D:return await B(e,t,r,s);case F.PD:return await(0,H.I)(e,t,s);case I:return(0,M.F)(e,t,r,s);default:(0,x.U)(a)}}(e,this.config.crypto,this.derivationCache,t)}};z=(0,s.__decorate)([(0,l.GS)(),(0,s.__metadata)("design:paramtypes",[i.i,o.E])],z);let $=class{};$=(0,s.__decorate)([(0,a.Y)({sharedModuleName:"cryptography",configurations:{infrastructure:{token:i.i}},providers:[n.y,o.E,c.a,u._,d.q,h,m.c,y.$,g.o,v.k,f.n,w.F,C.Y,S.g,_.H,b.e,E.k,A.Z,z,T.f],exports:[n.y,o.E,c.a,u._,d.q,h,m.c,y.$,g.o,v.k,f.n,w.F,C.Y,S.g,_.H,b.e,E.k,A.Z,z,T.f]})],$)},31186:(e,t,r)=>{"use strict";r.d(t,{E:()=>c});var s=r(88802),a=r(57924),n=r(82933),i=r(10370);class o{constructor(){this.derivateKeyCache=new Map}getCacheKey(...e){const t=e.reduce(((e,t)=>(0,n.K)(e,t)),new ArrayBuffer(0));return(0,i.s)(t)}getCachedDerivation(e){return this.derivateKeyCache.get(e)}setCachedDerivation({cacheKey:e,data:t}){this.getCachedDerivation(e)||this.derivateKeyCache.set(e,t)}}let c=class extends o{};c=(0,s.__decorate)([(0,a.GS)()],c)},25594:(e,t,r)=>{"use strict";r.d(t,{a:()=>c});var s=r(88802),a=r(57924),n=r(60745),i=r(114),o=r(31186);let c=class{constructor(e,t){this.config=e,this.derivationCache=t}decrypt(e,t){return(0,n.F)(e,this.config.crypto,this.derivationCache,t)}};c=(0,s.__decorate)([(0,a.GS)(),(0,s.__metadata)("design:paramtypes",[i.i,o.E])],c)},56268:(e,t,r)=>{"use strict";r.d(t,{_:()=>f});var s=r(88802),a=r(57924),n=r(82933),i=r(95087),o=r(54066),c=r(69591),u=r(33055);function d(e){const t=c.F+e.join(c.F)+c.F;return(0,o.u)(t)}function l({cipher:e,derivation:t}){const{algorithm:r}=t;switch(r){case"argon2d":return function({cipher:e,derivation:t}){const{count:r,index:s}=u.ARGON2D_MARKER_SCHEMA,a=new Array(r);return a[s.version]=c.g,a[s.derivation]=t.algorithm,a[s.saltLength]=t.saltLength,a[s.tCost]=t.tCost,a[s.mCost]=t.mCost,a[s.parallelism]=t.parallelism,a[s.cipher]=e.algorithm,a[s.mode]=e.mode,a[s.ivLength]=e.ivLength,d(a)}({cipher:e,derivation:t});case"pbkdf2":return function({cipher:e,derivation:t}){const{count:r,index:s}=u.PBKDF2_MARKER_SCHEMA,a=new Array(r);return a[s.version]=c.g,a[s.derivation]=t.algorithm,a[s.saltLength]=t.saltLength,a[s.iterations]=t.iterations,a[s.hashAlgorithm]=t.hashAlgorithm,a[s.cipher]=e.algorithm,a[s.mode]=e.mode,a[s.ivLength]=e.ivLength,d(a)}({cipher:e,derivation:t});case"noderivation":return function({cipher:e,derivation:t}){const{count:r,index:s}=u.NODERIVATION_MARKER_SCHEMA,a=new Array(r);return a[s.version]=c.g,a[s.derivation]=t.algorithm,a[s.cipher]=e.algorithm,a[s.mode]=e.mode,a[s.ivLength]=e.ivLength,d(a)}({cipher:e,derivation:t});default:(0,i.U)(r)}}var p=r(58396),h=r(6424),m=r(6752);async function y(e,t,r,s,a,i,o){const{algorithm:c}=r,u="pbkdf2"===c||"argon2d"===c;if(u&&!o?.salt)throw new Error("Need salt for derivation");const{deriveKeyArgon2d:d,deriveKeyPbkdf2:y}=t,g=u&&o?.salt?await(0,m.b)(e,o.salt,y,d,r,s):e,{mode:v}=a,{computeHash:f}=t,{encryptionKey:w,signatureKey:S}="cbchmac64"===v?await(0,p.U)(g):await(0,h.Y)(g,f),{getRandomValues:_}=t,b=_(a.ivLength),{encryptAes256:E}=t,A=await E(w,b,i),{signHmacSha:T}=t,C=(0,n.K)(b,A),x=await T(S,C);return function(e){const{encipheredContents:t,cipherConfig:r,derivationConfig:s,salt:a,signature:i,iv:o}=e,c=l({cipher:r,derivation:s});return a&&"noderivation"!==s.algorithm?(0,n.K)(c,a,o,i,t):(0,n.K)(c,o,i,t)}({type:"flexible",version:1,derivationConfig:r,cipherConfig:a,salt:o?.salt,iv:b,signature:x,encipheredContents:A})}var g=r(114),v=r(31186);let f=class{constructor(e,t){this.config=e,this.derivationCache=t}async encrypt(e,t,r,s,a){return await y(e,this.config.crypto,r,this.derivationCache,s,t,a)}};f=(0,s.__decorate)([(0,a.GS)(),(0,s.__metadata)("design:paramtypes",[g.i,v.E])],f)},31222:(e,t,r)=>{"use strict";r.d(t,{q:()=>o});var s=r(88802),a=r(57924),n=r(74017),i=r(114);let o=class{constructor(e){this.config=e}async sign(e,t,r=n.x){const{signHmacSha:s}=this.config.crypto;return await s(e,t,r)}};o=(0,s.__decorate)([(0,a.GS)(),(0,s.__metadata)("design:paramtypes",[i.i])],o)},92258:(e,t,r)=>{"use strict";r.d(t,{c:()=>i});var s=r(88802),a=r(57924),n=r(114);let i=class{constructor(e){this.config=e}generate(){const{generateKeyAes256:e}=this.config.crypto;return e()}};i=(0,s.__decorate)([(0,a.GS)(),(0,s.__metadata)("design:paramtypes",[n.i])],i)},71634:(e,t,r)=>{"use strict";r.d(t,{$:()=>o});var s=r(88802),a=r(57924),n=r(7449),i=r(114);let o=class{constructor(e){this.config=e}decrypt(e,t){return(0,n.I)(e,this.config.crypto,t)}};o=(0,s.__decorate)([(0,a.GS)(),(0,s.__metadata)("design:paramtypes",[i.i])],o)},83919:(e,t,r)=>{"use strict";r.d(t,{o:()=>h});var s=r(88802),a=r(57924),n=r(16698),i=r(82933),o=r(54066),c=r(38291);var u=r(6424);async function d(e,t,r,s,a,n){const{computeHash:d}=t,{encryptionKey:l,signatureKey:p}=await(0,u.Y)(e,d),{getRandomValues:h}=t,{ivLength:m}=s,y=h(m),{encryptAes256:g}=t,v=await g(l,y,a),{signHmacSha:f}=t,w=(0,i.K)(y,v),S={type:"KWC5",derivationConfig:r,cipherConfig:s,iv:y,signature:await f(p,w),encipheredContents:v},{padding:_}=n;return function({secureData:e,randomValues:t}){if(t.byteLength!==c.en)throw new Error("Encoding kwc5 requires 16 random bytes");const{encipheredContents:r,iv:s,type:a,signature:n}=e,u=(0,o.u)(a);return(0,i.K)(s,t,u,n,r)}({secureData:S,randomValues:_})}var l=r(94805),p=r(114);let h=class{constructor(e){this.config=e}encrypt(e,t){const{getRandomValues:r}=this.config.crypto,s={padding:r(n.BU.padding)};return d(e,this.config.crypto,l.oo,n.BU,t,s)}};h=(0,s.__decorate)([(0,a.GS)(),(0,s.__metadata)("design:paramtypes",[p.i])],h)},55119:(e,t,r)=>{"use strict";function s(){return new Uint32Array([57920321,977424202,1999259334,3390546403,3917439743,16505144,3027631148,3235565160,2643335823,1420105356,998514539,2704347781,1011257802,823882961,790991339,3929284516]).buffer}r.d(t,{S:()=>s})},56130:(e,t,r)=>{"use strict";r.d(t,{k:()=>o});var s=r(88802),a=r(57924),n=r(25594),i=r(55119);let o=class{constructor(e){this.flexibleDecryptor=e}async decrypt(e){const t=(0,i.S)();return await this.flexibleDecryptor.decrypt(t,e)}};o=(0,s.__decorate)([(0,a.GS)(),(0,s.__metadata)("design:paramtypes",[n.a])],o)},65613:(e,t,r)=>{"use strict";r.d(t,{n:()=>c});var s=r(88802),a=r(57924),n=r(89685),i=r(56130),o=r(40369);let c=class{constructor(e,t){this.obfuscationKeyDecryptor=e,this.obfuscationKeyEncryptor=t}async encode(e){return await this.obfuscationKeyEncryptor.encrypt(e)}async decode(e){return(0,n.v)(e).startsWith("$1$noderivation$aes256$cbchmac64$16$")?await this.obfuscationKeyDecryptor.decrypt(e):e}};c=(0,s.__decorate)([(0,a.GS)(),(0,s.__metadata)("design:paramtypes",[i.k,o.F])],c)},40369:(e,t,r)=>{"use strict";r.d(t,{F:()=>u});var s=r(88802),a=r(57924),n=r(94805),i=r(16698),o=r(56268),c=r(55119);let u=class{constructor(e){this.flexibleEncryptor=e}async encrypt(e){const t=(0,c.S)();return await this.flexibleEncryptor.encrypt(t,e,n.oo,i.gO)}};u=(0,s.__decorate)([(0,a.GS)(),(0,s.__metadata)("design:paramtypes",[o._])],u)},19603:(e,t,r)=>{"use strict";r.d(t,{Y:()=>i});var s=r(88802),a=r(57924),n=r(114);let i=class{constructor(e){this.config=e}get(e){const{getRandomValues:t}=this.config.crypto;return t(e).buffer}};i=(0,s.__decorate)([(0,a.GS)(),(0,s.__metadata)("design:paramtypes",[n.i])],i)},12554:(e,t,r)=>{"use strict";r.d(t,{g:()=>i});var s=r(88802),a=r(57924),n=r(114);let i=class{constructor(e){this.config=e}decrypt(e,t,r="SHA-256"){const{decryptRsaOaep:s}=this.config.crypto;return s(e,t,r)}};i=(0,s.__decorate)([(0,a.GS)(),(0,s.__metadata)("design:paramtypes",[n.i])],i)},77970:(e,t,r)=>{"use strict";r.d(t,{H:()=>i});var s=r(88802),a=r(57924),n=r(114);let i=class{constructor(e){this.config=e}encrypt(e,t,r="SHA-256"){const{encryptRsaOaep:s}=this.config.crypto;return s(e,t,r)}};i=(0,s.__decorate)([(0,a.GS)(),(0,s.__metadata)("design:paramtypes",[n.i])],i)},40173:(e,t,r)=>{"use strict";r.d(t,{e:()=>i});var s=r(88802),a=r(57924),n=r(114);let i=class{constructor(e){this.config=e}generate(e="SHA-256"){const{generateKeyPairRsaOaep:t}=this.config.crypto;return t(e)}};i=(0,s.__decorate)([(0,a.GS)(),(0,s.__metadata)("design:paramtypes",[n.i])],i)},28008:(e,t,r)=>{"use strict";r.d(t,{k:()=>i});var s=r(88802),a=r(57924),n=r(114);let i=class{constructor(e){this.config=e}async sign(e,t,r="SHA-256"){const{signRsassaPkcs1:s}=this.config.crypto;return await s(e,t,r)}};i=(0,s.__decorate)([(0,a.GS)(),(0,s.__metadata)("design:paramtypes",[n.i])],i)},22513:(e,t,r)=>{"use strict";r.d(t,{Z:()=>i});var s=r(88802),a=r(57924),n=r(114);let i=class{constructor(e){this.config=e}async compute(e,t){const{computeHash:r}=this.config.crypto;return await r(e,t)}};i=(0,s.__decorate)([(0,a.GS)(),(0,s.__metadata)("design:paramtypes",[n.i])],i)},60733:(e,t,r)=>{"use strict";r.d(t,{f:()=>i});var s=r(88802),a=r(57924),n=r(114);let i=class{constructor(e){this.config=e}compute(e){const{unsafeComputeMd5Hash:t}=this.config.crypto;return t(e)}};i=(0,s.__decorate)([(0,a.GS)(),(0,s.__metadata)("design:paramtypes",[n.i])],i)},65255:(e,t,r)=>{"use strict";r.d(t,{w:()=>s});const s={AuthsyncExtensionArkRelease:"authsync_extension_ark_release",B2CWebPostTrialBanner:"b2c_web_postTrialBanner",BBCOM238Duo:"BBCOM-238-duo",SAEXSendSharing:"SAEXSendSharing",DarkwebMonitoringWebRelease:"darkwebMonitoringWebRelease",DwiMultipleDomainsProd:"dwi_multiple_domains_prod",DisableSecureNotes:"disableSecureNotes",EcommerceWebB2cTrialBanner:"ecommerce_web_b2cTrialBanner",EcommerceWebTrialDaysLeftBanner:"ecommerce_web_trialDaysLeftBanner",EcommerceWebOfferToExtendPhase1:"ecommerce_web_offerToExtend_phase1",EcommerceWebChromeratingV2:"ecommerce_web_chromerating_V2",EcommerceWebPaywallUpdate:"ecommerce_web_paywall_update",EcommerceWebSadPathDev:"ecommerce_web_cancel_subscription_flow_dev",GrowthproductDSLPaywallDemogorgon:"growthproduct_DSLPaywall_demogorgon",ImsWebWeakMpProd:"ims_web_weak_mp_prod",ItadminSAEXCryptoMigrationPhase3V1:"itadmin_SAEX_CryptoMigration_Phase3_v1",ItadminTacEncryptionserviceSSOmigrationReset:"itadmin_tac_encryptionservice_SSOmigration_reset",ItadminTacJitprovisioning:"itadmin_tac_jitprovisioning",ItadminTacPhonesupport:"itadmin_tac_phonesupport",OnboardingWebDisablepersonalspaceDevV2:"onboarding_web_disablepersonalspace_v2_dev",OnboardingWebTeamsignuppage:"onboarding_web_teamsignuppage",PasswordHealthWeb:"passwordHealthWeb",SaexOnboardingHubAddPasswords:"saexOnboardingHubAddPasswords",SaexSecureNoteAttachmentsForrelease:"saex_SecureNoteAttachments_forrelease",TechWeekWebDisplayLabs:"techWeek_web_displayLabs",TechweekWebAttachmentsForIdsV1:"techweek_web_attachmentsForIds_v1",TechweekWebExpiredLabelforIDDev:"techweek_web_expiredLabelforID_dev",WebplatformWebPrideColors:"webplatform_web_prideColors",WebproductExtensionActivateChangeMasterPasswordRelease:"webproduct_extension_ActivateChangeMasterPassword_release",WebproductExtensionShowUserConsentOptions:"webproduct_extension_ShowUserConsentOptions",WebproductMultiSelectDeleteRelease:"webproduct_multi_select_delete_release",SupportMarkdownInSecureNotes:"webproduct_extension_securenotesmarkdown_dev"}},45760:(e,t,r)=>{"use strict";r.d(t,{k:()=>k});var s=r(88802),a=r(99634),n=r(70493),i=r(8987),o=r(6447),c=r(85390),u=r(16433),d=r(87065),l=r(30523),p=r(68307),h=r(9671),m=r(22838),y=r(20754),g=r(69008),v=r(87279),f=r(60399),w=r(57924),S=r(48844),_=r(73404);let b=class{constructor(e){this.serverApiClient=e}getFeatureFlipsForActiveUser(e){return(0,f.z)(this.serverApiClient.v1.features.getAndEvaluateForUser({features:e}).pipe((0,S.nb)({success:e=>e.data.enabledFeatures,failure:()=>{throw new Error("Unable to fetch enabled feature flips for the active user")}})))}getAvailableFeatureFlips(){return(0,f.z)(this.serverApiClient.v1.features.listAvailableFeatureFlips({}).pipe((0,S.nb)({success:e=>e.data.features.map((e=>e.name)),failure:()=>{throw new Error("Unable to fetch available feature flips")}})))}};b=(0,s.__decorate)([(0,w.GS)(),(0,s.__metadata)("design:paramtypes",[_.l])],b);var E=r(95681),A=r(23347),T=r(25029),C=r(10722);const x=e=>!(!e||"object"!=typeof e)&&"featureFlips"in e;class R extends((0,E.Q)({persist:!0,scope:T.F.Device,storeName:"feature-flip-store",capacity:A.Y._010KB,codec:C.E,storage:{initialValue:{featureFlips:{}},schemaVersion:1,typeGuard:x}})){}var I;!function(e){e.Success="Success",e.Pending="Pending",e.Loading="Loading",e.Cache="Cache"}(I||(I={}));class P extends((0,E.Q)({persist:!1,initialValue:{refreshStatus:I.Pending},scope:T.F.Device,storeName:"feature-flip-refresh-store",capacity:A.Y._001KB})){}function D(e,t){return!(!(0,v.d6)(e)||(0,v.db)(e).userName)||(!(0,v.d6)(e)||!(0,v.db)(e).userName||[I.Success,I.Cache].includes(t))}let U=class{constructor(e,t,r,s,a,n){this.allowedToFailForGetAvailableFeatureFlips=e,this.allowedToFailForGetFeatureFlipsForActiveUser=t,this.featureFlipsService=r,this.featureFlipsStore=s,this.featureFlipsRefreshStore=a,this.introspection=n}async handle({body:e}){if(!e.userName)return await this.featureFlipsRefreshStore.set({refreshStatus:I.Pending}),void await this.featureFlipsStore.set({featureFlips:{}});await this.featureFlipsRefreshStore.set({refreshStatus:I.Loading});const t=this.introspection.modules,r=Object.keys(t).reduce(((e,r)=>{const s=t[r];if(s.requiredFeatureFlips)for(const t of s.requiredFeatureFlips)e.add(t);return e}),new Set),s=Array.from(r);let a=[];await this.allowedToFailForGetAvailableFeatureFlips.doOne((()=>this.featureFlipsService.getAvailableFeatureFlips().then((e=>{a=e.filter((e=>r.has(e)))}))));const n=0===a.length?s:a;await this.allowedToFailForGetFeatureFlipsForActiveUser.doOne((async()=>{try{const e=await this.featureFlipsService.getFeatureFlipsForActiveUser(n),t=new Set(e),r=new Set(a),i=s.reduce(((e,s)=>(e[s]=t.has(s)||!r.has(s)&&void 0,e)),{});await this.featureFlipsStore.set({featureFlips:i}),await this.featureFlipsRefreshStore.set({refreshStatus:I.Success})}catch(e){throw await this.featureFlipsRefreshStore.set({refreshStatus:I.Cache}),e}}))}};U=(0,s.__decorate)([(0,p.b)(i.KZ),(0,s.__metadata)("design:paramtypes",[h.J,h.J,b,R,P,m.Q1])],U);let F=class{constructor(e,t,r){this.featureFlipsStore=e,this.featureFlipsRefreshStore=t,this.requestContextClient=r}execute(){return(0,c.a)([this.requestContextClient.queries.activeUser().pipe((0,u.q)(1)),this.featureFlipsRefreshStore.state$.pipe((0,d.U)((e=>e.refreshStatus))),this.featureFlipsStore.state$.pipe((0,d.U)((e=>e.featureFlips)))]).pipe((0,l.h)((([e,t])=>D(e,t))),(0,d.U)((([e,,t])=>{if((0,v.d6)(e))return(0,v.db)(e).userName?(0,v.Vp)(t):(0,v.Vp)({});throw new Error("Cannot determine if user is logged in")})))}};F=(0,s.__decorate)([(0,y.e)(n.r6),(0,s.__metadata)("design:paramtypes",[R,P,g.Q])],F);let O=class{constructor(e,t,r){this.featureFlipsStore=e,this.featureFlipsRefreshStore=t,this.requestContextClient=r}execute({body:e}){const{featureFlip:t}=e;return(0,c.a)([this.requestContextClient.queries.activeUser().pipe((0,u.q)(1)),this.featureFlipsRefreshStore.state$.pipe((0,d.U)((e=>e.refreshStatus))),this.featureFlipsStore.state$.pipe((0,d.U)((e=>e.featureFlips)))]).pipe((0,l.h)((([e,t])=>D(e,t))),(0,d.U)((([e,,r])=>{if((0,v.d6)(e))return(0,v.db)(e).userName?(0,v.Vp)(r[t]):(0,v.Vp)(void 0);throw new Error("Cannot determine if user is logged in")})))}};O=(0,s.__decorate)([(0,y.e)(n.fV),(0,s.__metadata)("design:paramtypes",[R,P,g.Q])],O);var N=r(65255);let k=class{};k=(0,s.__decorate)([(0,a.Y)({api:n.cV,providers:[b],imports:[o.n],exports:[b],handlers:{commands:{},queries:{userFeatureFlips:F,userFeatureFlip:O},events:{...(0,a.g)(i.t$,{activeUserChanged:U})}},stores:[R,P],requiredFeatureFlips:Object.values(N.w)})],k)},44985:(e,t,r)=>{"use strict";r.d(t,{i:()=>i});var s=r(88802),a=r(99634),n=r(58895);let i=class{};i=(0,s.__decorate)([(0,a.Y)({providers:[n.t],exports:[n.t],sharedModuleName:"platformInfo"})],i)},58895:(e,t,r)=>{"use strict";r.d(t,{t:()=>d});var s=r(88802),a=r(60399),n=r(57924),i=r(94189),o=r(48844),c=r(20195),u=r(53576);let d=class{constructor(e){this.client=e}getPlatformInfo(){return(0,a.z)(this.client.getClient(u.carbonLegacyApi).queries.getPlatformInfo().pipe((0,o.nb)({success:e=>e,failure:c.j})))}};d=(0,s.__decorate)([(0,n.GS)(),(0,s.__metadata)("design:paramtypes",[i.m])],d)},29659:(e,t,r)=>{"use strict";r.d(t,{c:()=>l});var s=r(88802),a=r(57924),n=r(94189),i=r(26457),o=r(87279),c=r(53576),u=r(92233),d=r(88268);let l=class extends d.tI{constructor(e,t){super(),this.cqrsClient=e,this.appLogger=t}async decipher(e,t){const{carbon:r}=this.cqrsClient.getClient(c.carbonLegacyApi).commands,s=await r({name:"decipherRemoteFile",args:[{cipheredFileContent:e,fileMetaData:t}]});if((0,o.hx)(s))return(0,o.Rn)(u.RemoteFileUpdateError.DecipherError);const{carbonResult:a}=(0,o.db)(s);return(e=>"object"==typeof e&&null!==e&&Object.entries(e).some((([e,t])=>"decipheredFile"===e&&t instanceof ArrayBuffer)))(a)?(0,o.Vp)(a.decipheredFile):(0,o.Rn)(u.RemoteFileUpdateError.DecipherError)}};l=(0,s.__decorate)([(0,a.GS)(),(0,s.__metadata)("design:paramtypes",[n.w,i.V])],l)},39995:(e,t,r)=>{"use strict";r.d(t,{Q:()=>c});var s=r(88802),a=r(57924),n=r(7537),i=r(58376),o=r(60399);let c=class{constructor(){this.filesToCheck={},this.publishSubscriber=new n.t,this.updatedFileStream$=new i.y((e=>{this.publishSubscriber.next(e),this.publishSubscriber.complete()}))}publish(e){(0,o.z)(this.publishSubscriber).then((t=>t.next(e)))}fileSubscription(e){return this.filesToCheck={...this.filesToCheck,...e},this.updatedFileStream$}getFilesToCheck(){return this.filesToCheck}};c=(0,s.__decorate)([(0,a.GS)(),(0,s.__metadata)("design:paramtypes",[])],c)},47190:(e,t,r)=>{"use strict";r.d(t,{P:()=>f});var s=r(88802),a=r(87279),n=r(48844),i=r(18533),o=r(92233),c=r(57924),u=r(73774),d=r(69885),l=r(60399),p=r(87065),h=r(73404),m=r(88268),y=r(94143),g=r(25994);const v=e=>e[1].status===y.nQ;let f=class extends m.gG{constructor(e,t){super(),this.httpClient=e,this.serverApiClient=t}async downloadRemoteFileUpdate(e){const t=await this._getFileMeta(e);return(0,a.hx)(t)?[(0,d.of)(t)]:this._retrieveFilesFromServer((0,a.db)(t))}_getFileMeta(e){return(0,l.z)(this.serverApiClient.v1.file.getFileMeta(e).pipe((0,p.U)((e=>{if((0,a.hx)(e))return(0,a.Rn)(o.RemoteFileUpdateError.ServerError);const t=(0,a.db)(e);return r=t.data,Object.values(r).every((e=>"object"==typeof e&&void 0!==e.status&&y.PQ.has(e.status)))?(0,a.Vp)(t.data):(0,a.Rn)(o.RemoteFileUpdateError.ServerError);var r}))))}_retrieveFilesFromServer(e){return Object.entries(e).filter(v).map((([e,t])=>this._getBufferFromURL(e,t)))}_getBufferFromURL(e,t){return this.httpClient.get(t.url,{observe:"body",responseType:"arraybuffer"}).pipe((0,n.Qn)(this._handleSuccess(e,t)),(0,n.DZ)(this._handleFailure))}_handleFailure(e){return(0,i.EQ)(e,{BadStatus:e=>e.response.status===g.W.NotModified?y.ek:o.RemoteFileUpdateError.DownloadError,FetchFailedError:()=>o.RemoteFileUpdateError.DownloadError})}_handleSuccess(e,t){return r=>({fileName:e,buffer:r,updatedFile:t})}};f=(0,s.__decorate)([(0,c.GS)(),(0,s.__metadata)("design:paramtypes",[u.e,h.l])],f)},88268:(e,t,r)=>{"use strict";r.d(t,{gG:()=>s,pF:()=>n,tI:()=>a});class s{}class a{}class n{}},73881:(e,t,r)=>{"use strict";r.d(t,{Q:()=>v});var s=r(88802),a=r(99634),n=r(25504),i=r(25029),o=r(47190),c=r(45760),u=r(57924),d=r(39995),l=r(88268);let p=class{constructor(e,t){this.remoteFileUpdateService=e,this.dispatcherService=t}run(){const e=this.dispatcherService.getFilesToCheck();this.remoteFileUpdateService.observeRemoteFileUpdates(e).subscribe((e=>{this.dispatcherService.publish(e)})),this.remoteFileUpdateService.downloadAndDecipherRemoteFiles()}};p=(0,s.__decorate)([(0,u.GS)(),(0,s.__metadata)("design:paramtypes",[l.pF,d.Q])],p);var h=r(6447),m=r(29659),y=r(83958),g=r(1665);let v=class{};v=(0,s.__decorate)([(0,a.Y)({sharedModuleName:"RemoteFileUpdateModule",configurations:{remoteFileUpdateInfrastructure:{token:l.pF},remoteFileUpdateDownloaderInfrastructure:{token:l.gG},decipherInfrastructure:{token:l.tI}},crons:[{handler:p,periodInMinutes:30,name:"RFUCron",scope:i.F.User}],providers:[y.U,m.c,o.P,d.Q],imports:[c.k,n.X,h.n,g.I],exports:[y.U,m.c,o.P,d.Q]})],v)},83958:(e,t,r)=>{"use strict";r.d(t,{U:()=>S});var s=r(88802),a=r(57924),n=r(26457),i=r(94189),o=r(87279),c=r(7537),u=r(58376),d=r(91501),l=r(6220),p=r(87065),h=r(60399),m=r(20587),y=r(29659),g=r(47190),v=r(88268),f=r(94143),w=r(92233);let S=class extends v.pF{constructor(e,t,r,s){super(),this.appLogger=e,this.rfuDownloaderService=t,this.rfuDecipheringService=r,this.cqrsClient=s,this._filesToCheck={},this._emitDownloadedFilesUpdate$=new c.t,this._downloadedFileStream$=new u.y((e=>{this._emitDownloadedFilesUpdate$.next((t=>{e.next(t)})),this._emitDownloadedFilesUpdate$.complete()}))}observeRemoteFileUpdates(e){return this._filesToCheck={...this._filesToCheck,...e},this._downloadedFileStream$}async downloadAndDecipherRemoteFiles(){const e=(await this.rfuDownloaderService.downloadRemoteFileUpdate(this._filesToCheck)).map((e=>this._downloadAndDecipherSingleFile(e)));(0,d.D)(e).subscribe((e=>{const t=e.reduce(((e,t)=>{if((0,o.hx)(t)){const r=(0,o.Yv)(t);return r===f.ek||this.sendRFUEvents(w.FlowStep.Error,r),e}const r=(0,o.db)(t);return this.sendRFUEvents(w.FlowStep.Complete),{...e,[r.fileName]:r}}),{});this._callEmitDownloadedFilesUpdate(t)}))}async _applyDecipheringStep(e){const t=e.updatedFile.key?await this.rfuDecipheringService.decipher(e.buffer,e.updatedFile):(0,o.Vp)(e.buffer);return(0,o.d6)(t)?(0,o.Vp)({...e,buffer:(0,o.db)(t)}):t}_downloadAndDecipherSingleFile(e){return e.pipe((0,l.z)((e=>(0,o.d6)(e)?this._applyDecipheringStep((0,o.db)(e)):Promise.resolve(e))),(0,p.U)((e=>{if((0,o.hx)(e))return e;const{fileName:t,updatedFile:r,buffer:s}=(0,o.db)(e);return(0,o.Vp)({fileName:t,revision:r.revision,buffer:s,lastDownloadTimestamp:Date.now()})})))}_callEmitDownloadedFilesUpdate(e){return(0,h.z)(this._emitDownloadedFilesUpdate$).then((t=>{t(e)}))}sendRFUEvents(e,t=undefined){const{trackEvent:r}=this.cqrsClient.getClient(m.Yu).commands;r({event:new w.UserReceiveRemoteFileUpdateEvent({flowStep:e,remoteFileUpdateError:t,packageSource:w.PackageSource.Graphene})})}};S=(0,s.__decorate)([(0,a.GS)(),(0,s.__metadata)("design:paramtypes",[n.V,g.P,y.c,i.w])],S)},94143:(e,t,r)=>{"use strict";r.d(t,{PQ:()=>a,ek:()=>n,nQ:()=>s});const s="update_available",a=new Set([s,"not_updated","not_found","error_server"]),n="not_modified"},16988:(e,t,r)=>{"use strict";r.d(t,{L:()=>s});class s{}},32697:(e,t,r)=>{"use strict";r.d(t,{u:()=>U});var s=r(88802),a=r(24966),n=r(60399),i=r(30523),o=r(87065),c=r(6136),u=r(34987),d=r(14888),l=r(43004),p=r(57924),h=r(73774),m=r(91199),y=r(26457),g=r(43702);var v,f=r(23711),w=r(49499),S=r(87279),_=r(58895),b=r(16988),E=r(69912);function A(e){switch(e){case l.w.CRITICAL:return v.ERROR;case l.w.WARNING:return v.WARNING}}!function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.WARNING=1]="WARNING",e[e.ERROR=2]="ERROR"}(v||(v={}));const T=(e,t)=>({action:"logOnline",code:A(t.criticality),type:e.platformName,version:e.appVersion,additionalInfo:JSON.stringify({manifestVersion:e.manifestVersion}),browser:e.browser,browserVersion:e.browserVersion,exceptiontype:t.domainName??"grapheneException",message:t.message,os:e.os,osVersion:e.osVersion,sessionId:t.sessionId,stack:t.callStack,initialUseCaseModule:t.moduleName,initialUseCaseName:t.useCaseName,errorCount:1,featureFlips:(t.featuresFlipped??[]).join(",")});function C(e,t){return new E.L("string"==typeof(r=T(e,t))?r:Object.keys(r).reduce(((e,t)=>{const s=r[t];return void 0===s||(e[t]="string"==typeof s?s:JSON.stringify(s)),e}),{}));var r}const x={"Content-Type":"application/x-www-form-urlencoded"},R=".graphene.exceptionLogs",I=new g.b,P=new class{constructor(e){this.typeGuard=e}decode(e){if(this.typeGuard(e))return e;throw new Error("Bad type")}encode(e){return e}}((e=>!(!e||"object"!=typeof e)&&(0===Object.keys(e).length||Object.keys(e).every((e=>"string"==typeof e))&&Object.values(e).every((e=>{return!!((t=e)&&"object"==typeof t&&"entry"in t&&"id"in t&&"date"in t)&&"string"==typeof t.id&&"number"==typeof t.date&&(0,l.h)(t.entry);var t}))))),D=new f.z;let U=class{constructor(e,t,r,s,n){this.httpClient=e,this.kvStore=t,this.logger=r,this.settings=s,this.platformInfoService=n,this.queue$=new a.X({}),this.logExceptionsCount={},this.platformInfo=null,this.url=`${this.settings.serverEndpoint??"https://kck3hlb9.dashlane.com"}/1/softwarelog/create`,this.codec=(0,w.x)(D,I,P)}async logException(e){const t=this.settings.maxExceptionCountPerSession??10,r=e.message.length?e.message:"UNKNOWN_EXCEPTION";if(r in this.logExceptionsCount){const e=this.logExceptionsCount[r];if(e===t)return Promise.resolve();this.logExceptionsCount[r]=e+1}else this.logExceptionsCount[r]=1;const s=await this.enqueue(e);await(0,n.z)(this.queue$.pipe((0,i.h)((e=>!(s in e)||!!e[s].error))))}async start(){this.platformInfo=await this.platformInfoService.getPlatformInfo(),await this.loadQueue();const e=this.settings.retryDelay??6e4,t=this.queue$.pipe((0,o.U)((e=>Object.keys(e))),(0,c.x)(((e,t)=>t.every((t=>e.includes(t))))),(0,u.b)((()=>this.processQueue())),(0,d.X)({delay:e})).subscribe();return{stop:async()=>{t.unsubscribe(),await this.saveQueue()}}}async ignoreError(e){try{return await e(),!0}catch(e){return this.logger.error("failed to send error log",e),!1}}async saveQueue(){await this.ignoreError((async()=>{const e=await this.codec.encode(this.queue$.value);await this.kvStore.set(R,e)}))}async loadQueue(){await this.ignoreError((async()=>{const e=await this.kvStore.get(R);if(!e||""===e)return void this.queue$.next({});const t=await this.codec.decode(e),r=Date.now()-(this.settings.durationInQueue??864e5);for(const e of Object.keys(t))t[e].date<r&&delete t[e];this.queue$.next(t)}))}async enqueue(e){const t={date:Date.now(),entry:e,id:`${Date.now()}-${Math.random()}`};return this.queue$.value[t.id]=t,await this.saveQueue(),this.queue$.next(this.queue$.value),t.id}async processQueue(){const e=this.platformInfo;if(!e)throw new Error("No platform info");for(;Object.keys(this.queue$.value).length>0;){const t=Object.keys(this.queue$.value)[0],r=this.queue$.value[t];if(!await this.ignoreError((async()=>{const t=await(0,n.z)(this.httpClient.post(this.url,C(e,r.entry),{headers:{...x,"Client-Agent":(s=e,`version:${s.appVersion},platform:${s.platformName}}`)},observe:"response"}));var s;if(!(0,S.d6)(t))throw new Error("Failed to send log")})))throw this.queue$.value[t].error=!0,this.queue$.next(this.queue$.value),new Error("failed to send an item from the queue");delete this.queue$.value[t],await this.saveQueue()}this.queue$.next(this.queue$.value)}};U=(0,s.__decorate)([(0,p.GS)(),(0,s.__metadata)("design:paramtypes",[h.e,m.QI,y.V,b.L,_.t])],U)},64555:(e,t,r)=>{"use strict";r.d(t,{F:()=>u});var s=r(88802),a=r(99634),n=r(25504),i=r(44985),o=r(32697),c=r(16988);let u=class{};u=(0,s.__decorate)([(0,a.Y)({sharedModuleName:"software-exception-sink",imports:[n.X,i.i],providers:[o.u],exports:[o.u],configurations:{settings:{token:c.L}}})],u)},71993:(e,t,r)=>{"use strict";r.d(t,{t:()=>u});var s=r(10722),a=r(25029),n=r(95681),i=r(23347);const o={drift:null},c=e=>!(!e||"object"!=typeof e||!("drift"in e))&&(null===e.drift||"number"==typeof e.drift);class u extends((0,n.Q)({storeTypeGuard:c,storeName:"clocksync",storage:{initialValue:o,schemaVersion:1,typeGuard:c},scope:a.F.Device,isCache:!0,persist:!0,capacity:i.Y._001KB,codec:s.E})){}},60565:(e,t,r)=>{"use strict";r.d(t,{E:()=>ye,F:()=>ge});var s=r(88802),a=r(60399),n=r(89618),i=r(57924),o=r(73774),c=r(9671),u=r(37182),d=r(69885),l=r(14888),p=r(34987),h=r(87065),m=r(87279),y=r(18533),g=r(48844),v=r(4607),f=r(4043),w=r(25994),S=r(64839),_=r(96168);const b=(e,t)=>class extends((0,_.Hu)(e,t)){constructor(e){super(),this.requestId=e}};class E extends(b("BusinessError","Service responded with a business error")){constructor(e,t,r){super(t),this.code=e,this.businessMessage=r}}class A extends(b("RateLimited","Request was throttled by Dashlane API rate limiting setup")){}class T extends(b("OutOfBoundsTimestamp","Client clock is not synced with server clock")){}var C=r(95087),x=r(64718),R=r(43293),I=r(54066),P=r(96303);function D(e){const t=(0,R.N)(e);return(0,I.u)(t)}async function U(e,t){const r=await e.compute(D(t),"SHA-256");return(0,P.k)(r)}function F(e){return e.replace(/[^A-Za-z0-9_.~\\-]/g,(e=>"%"+e.charCodeAt(0).toString(16).toUpperCase()))}function O(e,t){return e.localeCompare(t,"en",{numeric:!0})}function N(e){return e.map((e=>e.toLowerCase()))}class k{constructor(e){this.secureHasher=e}async canonicalizeRequest(e,t){const{makeCanonicalBody:r,makeCanonicalURI:s,makeCanonicalQueryString:a,makeCanonicalHeadersString:n,makeSignedHeaderNamesString:i}=k,{body:o,headers:c,method:u,url:d,params:l}=e,p=new x.Y(d).getHostname(),h=d.indexOf(p),m=d.substring(h+p.length),y=r(o),g=await U(this.secureHasher,y),v=t?N(t):void 0,f=v?(w=N(c.keys()),(S=v).length?w.filter((e=>!S.includes(e))):w):[];var w,S;const _=c.deleteMultiple(f),b=s(m),E=a(l),A=n(_),T=i(_);return{canonicalRequest:[u,b,E,A,T,g].join("\n"),signedHeaderNames:T}}static makeCanonicalURI(e){return function(e){return e.split("/").map((e=>F(e))).join("/")}(e)}static makeCanonicalQueryStringPair(e,t){const r=F(e),s=Array.isArray(t)?t:[t];return s.sort(O).map((e=>{return t=(e=>F(e))(e),[r,t];var t}))}static makeCanonicalQueryString(e){return e.keys().map((t=>`${(([e,t])=>k.makeCanonicalQueryStringPair(e,t))([t,e.getAll(t)??[]]).map((e=>e.join("="))).join("&")}`)).sort(O).join("&")}static makeCanonicalHeadersString(e){return e.keys().map((t=>{return r=t,s=e.get(t),`${r.toLowerCase()}:${s.trim().replace(/\s+/g," ")}\n`;var r,s})).sort(O).join("")}static makeSignedHeaderNamesString(e){return e.keys().map((e=>e.toLowerCase())).sort(O).join(";")}static makeCanonicalBody(e){return e?JSON.stringify(e):""}}const L="DL1-HMAC-SHA256";class M{constructor(e,t){this.hmacSigner=e,this.secureHasher=t}async signRequest(e,t,r){const s=await U(this.secureHasher,e),a=[L,t,s].join("\n"),n=this.getFinalSecretKey(r),i=(0,I.u)(n),o=D(a),c=await this.hmacSigner.sign(i,o);return(0,P.k)(c)}getFinalSecretKey(e){const{appSecretKey:t}=e;switch(e.type){case S.d.APP:return t;case S.d.USER_DEVICE:{const{deviceSecretKey:r}=e;return`${t}\n${r}`}case S.d.SESSION:{const{sessionSecretKey:r}=e;return`${t}\n${r}`}case S.d.TEAM_DEVICE:{const{teamDeviceSecretKey:r}=e;return`${t}\n${r}`}case S.d.EXTERNAL:{const{tokenSecretKey:r}=e;return`${t}\n${r}`}case S.d.BACK_OFFICE:return t;default:(0,C.U)(e)}}}class V{constructor(e,t,r){this.signatureService=new M(t,e),this.canonicalizationService=new k(e),this.clockDriftService=r}async prepareRequestForAuthorization(e,t){if(t.type===S.d.CUSTOM)throw new Error("Unexpected credentials type provided to standard auth method");const r=this.addHostHeader(e),{canonicalRequest:s,signedHeaderNames:a}=await this.canonicalizationService.canonicalizeRequest(r),n=await this.clockDriftService.getDriftCorrectedTimestamp(),i=await this.signatureService.signRequest(s,n,t),o=this.buildAuthorizationHeader(t,n,a,i);return this.addAuthorizationHeader(e,o)}addHostHeader(e){const t=new x.Y(e.url).getHostname(),r=e.headers.append("host",t);return e.clone({headers:r})}addAuthorizationHeader(e,t){const r=e.headers.append("authorization",t);return e.clone({headers:r})}buildAuthorizationHeader(e,t,r,s){const{appAccessKey:a}=e;switch(e.type){case S.d.APP:return L+" "+[`AppAccessKey=${a}`,`Timestamp=${t}`,`SignedHeaders=${r}`,`Signature=${s}`].join(",");case S.d.USER_DEVICE:{const{login:n,deviceAccessKey:i}=e;return L+" "+[`Login=${n}`,`AppAccessKey=${a}`,`DeviceAccessKey=${i}`,`Timestamp=${t}`,`SignedHeaders=${r}`,`Signature=${s}`].join(",")}case S.d.SESSION:{const{deviceAccessKey:n,login:i,sessionAccessKey:o}=e;return L+" "+[`Login=${i}`,`AppAccessKey=${a}`,`SessionAccessKey=${o}`,`DeviceAccessKey=${n}`,`Timestamp=${t}`,`SignedHeaders=${r}`,`Signature=${s}`].join(",")}case S.d.TEAM_DEVICE:{const{teamDeviceAccessKey:n,teamUuid:i}=e;return L+" "+[`TeamUuid=${i}`,`AppAccessKey=${a}`,`DeviceAccessKey=${n}`,`Timestamp=${t}`,`SignedHeaders=${r}`,`Signature=${s}`].join(",")}case S.d.BACK_OFFICE:return L+" "+["Backoffice",`AppAccessKey=${a}`,`Timestamp=${t}`,`SignedHeaders=${r}`,`Signature=${s}`].join(",");case S.d.EXTERNAL:{const{tokenAccessKey:n}=e;return L+" "+[`AppAccessKey=${a}`,`TokenAccessKey=${n}`,`Timestamp=${t}`,`SignedHeaders=${r}`,`Signature=${s}`].join(",")}default:(0,C.U)(e)}}}class G{constructor(e){this.descriptor=e}decode(e){return e}}class q{constructor(e){this.descriptor=e}decode(e){return e}}class j{constructor(e,t,r,s,a,n){this.initHttpRequest=e=>{const{method:t,path:r,version:s}=this.descriptor,{baseUrl:a,platformInfo:n}=this.config,i=`${a.endsWith("/")?a:`${a}/`}${s}/${r}`,o=new v.W({accept:this.descriptor.requestAcceptHeader??"application/json","content-type":"application/json; charset=UTF-8","dashlane-client-agent":JSON.stringify({platform:n.platformName,version:n.version,osversion:n.osversion,language:n.language})});return new f.a(t,i,e,{headers:o})},this.prepareRequestForAuthorization=e=>async t=>{if(this.descriptor.authType===S.d.NONE)return t;let r;if(this.descriptor.authType===S.d.CUSTOM){r=new(this.getCustomAuthPreparationClass())}else r=this.standardAuthPreparationService;const s=this.getSigningCredentials(this.descriptor.authType,e);return await r.prepareRequestForAuthorization(t,s)},this.sendHttpRequest=e=>this.httpClient.request(e),this.handleSuccess=async e=>{if("arraybuffer"===this.descriptor.responseType)return(0,m.Vp)(await e.arrayBuffer());if("text"===this.descriptor.responseType)return(0,m.Vp)(await e.text());const t=await e.json(this.successBodyDecoder);return(0,m.Vp)(t)},this.handleFailure=async e=>await(0,y.EQ)(e,{BadStatus:this.handleBadStatus,FetchFailedError:e=>Promise.resolve((0,m.Rn)(e))}),this.handleBadStatus=async e=>{const{response:t}=e;if(t.status===w.W.BadRequest){const{errors:[e],requestId:r}=await t.json(this.failureBodyDecoder);if("business_error"===e.type){const{code:t,message:s}=e;return(0,m.Rn)(new E(t,r,s))}if("invalid_request_error"===e.type&&"out_of_bounds_timestamp"===e.code)throw new T(r)}return(0,m.Rn)(e)},this.notifyWhenClockDriftErrorCompensated=e=>{if(!(e instanceof T))throw e;return this.clockDriftService.refresh().pipe((0,u.K)((()=>{throw e})))},this.httpClient=e,this.standardAuthPreparationService=new V(t,r,s),this.clockDriftService=s,this.config=a,this.descriptor=n,this.successBodyDecoder=new G(n),this.failureBodyDecoder=new q(n)}executeRequest(e){const{body:t=null,credentials:r}=e;return(0,d.of)(this.initHttpRequest(t)).pipe((0,p.b)(this.prepareRequestForAuthorization(r)),(0,p.b)(this.sendHttpRequest),(0,g.RW)({success:this.handleSuccess,failure:this.handleFailure}),(0,h.U)(this.assertReturnType),(0,l.X)({count:1,delay:this.notifyWhenClockDriftErrorCompensated}))}getCustomAuthPreparationClass(){throw new Error("Unsupported custom authorization level")}getSigningCredentials(e,t){if(e===S.d.APP||e===S.d.BACK_OFFICE){if(t)throw new Error("Superfluous credentials provided");return{type:e,...this.config.appKeys}}if(e===S.d.SESSION){if(!t||!function(e){return"object"==typeof e&&"login"in e&&"string"==typeof e.login&&"deviceAccessKey"in e&&"string"==typeof e.deviceAccessKey&&"sessionAccessKey"in e&&"string"==typeof e.sessionAccessKey&&"sessionSecretKey"in e&&"string"==typeof e.sessionSecretKey}(t))throw new Error("Invalid session credentials provided");return{type:e,...this.config.appKeys,...t}}if(e===S.d.TEAM_DEVICE){if(!t||!function(e){return"object"==typeof e&&"teamUuid"in e&&"string"==typeof e.teamUuid&&"teamDeviceAccessKey"in e&&"string"==typeof e.teamDeviceAccessKey&&"teamDeviceSecretKey"in e&&"string"==typeof e.teamDeviceSecretKey}(t))throw new Error("Invalid team device credentials provided");return{type:e,...this.config.appKeys,...t}}if(e===S.d.USER_DEVICE){if(!t||!function(e){return"object"==typeof e&&"login"in e&&"string"==typeof e.login&&"deviceAccessKey"in e&&"string"==typeof e.deviceAccessKey&&"deviceSecretKey"in e&&"string"==typeof e.deviceSecretKey}(t))throw new Error("Invalid user device credentials provided");return{type:e,...this.config.appKeys,...t}}if(e===S.d.EXTERNAL){if(!t||!function(e){return"object"==typeof e&&"tokenAccessKey"in e&&"string"==typeof e.tokenAccessKey&&"tokenSecretKey"in e&&"string"==typeof e.tokenSecretKey}(t))throw new Error("Invalid external credentials provided");return{type:e,...this.config.appKeys,...t}}return{type:e,...t??{},...this.config.appKeys}}assertReturnType(e){return e}}class K{constructor(e,t,r,s,a){this.httpClient=e,this.clockDriftService=s,this.secureHasher=t,this.hmacSigner=r,this.config=a}createExecutor(e){return new j(this.httpClient,this.secureHasher,this.hmacSigner,this.clockDriftService,this.config,e)}}class W{constructor(e,t){this.timeSyncStore=e,this.serverClockService=t}async getDriftCorrectedTimestamp(){const e=await this.timeSyncStore.getServerToClientClockDrift()??0;return Math.round(this.getUnixTimestamp()-e)}refresh(){return this.serverClockService.getServerTime().pipe((0,h.U)(this.mapServerTimestampToClockDrift.bind(this)),(0,p.b)(this.storeUpdatedClockDrift.bind(this)))}mapServerTimestampToClockDrift(e){const{timestamp:t}=e;return this.getUnixTimestamp()-t}async storeUpdatedClockDrift(e){await this.timeSyncStore.storeServerToClientClockDrift(e)}getUnixTimestamp(){return Math.round(Date.now()/1e3)}}var B=r(73873);class H{getServerTime(){if(!this.executorFactory)throw new Error("No request executor factory");return new B.q(this.executorFactory).getRemoteTime({}).pipe((0,g.nb)({success:e=>({timestamp:e.data.timestamp}),failure:e=>{throw e}}))}setExecutorFactory(e){this.executorFactory=e}}var z=r(58895);class ${constructor(e){this.store=e}async getServerToClientClockDrift(){const{drift:e}=await this.store.getState();return e}storeServerToClientClockDrift(e){return this.store.update((()=>({drift:e})))}}var Q=r(18590),Y=r(71993),X=r(77837),J=r(33027),Z=r(9536),ee=r(69865),te=r(62361),re=r(59091),se=r(52839),ae=r(55127),ne=r(7181),ie=r(91406),oe=r(84626),ce=r(42882);const ue={v1:{accountrecovery:X.u,authentication:J.V,darkwebmonitoring:Z.D,features:ee.A,file:te.$,payments:re.H,pwleak:se.J,sharingUserdevice:ae.b,secretTransfer:ne.V,teams:ie.p,time:B.q,useractivity:oe.V,userconsents:ce.G}};var de=r(31222),le=r(22513);const pe="CF-Access-Client-Id",he="CF-Access-Client-Secret";class me{constructor(e){this.cloudflareKeys=e,this.id="ServerApiForStagingInterceptor"}intercept(e,t){if(e.url.startsWith("https://api.dashlane.com/")||!this.cloudflareKeys)return t(e);if(!e.headers.has(pe)&&!e.headers.has(he)){const{cloudflareAccessKey:r,cloudflareSecretKey:s}=this.cloudflareKeys;return t(e.clone({headers:e.headers.set(pe,r).set(he,s)}))}return t(e)}}let ye=class{constructor(e,t,r,s,a,n,i){this.serverApiConfig=e,this.httpClient=t,this.clockDriftStore=r,this.hmacSigner=s,this.secureHasher=a,this.platformInfoService=n,this.allowedToFail=i}async init(){const{clockDriftStore:e,serverApiConfig:t,secureHasher:r,httpClient:s,hmacSigner:a}=this,n=new $(e),i=await this.platformInfoService.getPlatformInfo(),{appKeys:o,baseUrl:c,cloudflareKeys:u}=t;s.addInterceptor(new me(u));const d=function(e){const{apis:t,config:r,secureHasher:s,httpClient:a,hmacSigner:n,timeSyncStore:i}=e,o=new H,c=new W(i,o),u=new K(a,s,n,c,r);return o.setExecutorFactory(u),{refreshClockDrift:()=>c.refresh(),v1:Object.keys(t.v1).reduce(((e,r)=>{const s=t.v1[r];return e[r]=new s(u),e}),{})}}({secureHasher:r,httpClient:s,timeSyncStore:n,hmacSigner:a,apis:ue,config:{appKeys:o,baseUrl:c,platformInfo:{platformName:i.platformName,version:i.appVersion||"unknown",osversion:i.osVersion||"unknown",language:i.lang||"unknown"}}});await this.initClockDrift(d),this.rawSdk=d}get sdk(){if(!this.rawSdk)throw new Error("ConfiguredServerSdk not initialized");return this.rawSdk}async initClockDrift(e){await this.allowedToFail.doOne((async()=>{const{drift:t}=await this.clockDriftStore.getState();null===t&&await(0,a.z)(e.refreshClockDrift().pipe((0,n.V)({first:5e3})))}))}};function ge(){return{token:ye,asyncFactory:async(e,t,r,s,a,n,i)=>{const o=new ye(e,t,r,s,a,n,i);return await o.init(),o},inject:[Q.$y,o.e,Y.t,de.q,le.Z,z.t,c.J]}}ye=(0,s.__decorate)([(0,i.GS)(),(0,s.__metadata)("design:paramtypes",[Q.$y,o.e,Y.t,de.q,le.Z,z.t,c.J])],ye)},73404:(e,t,r)=>{"use strict";r.d(t,{l:()=>T});var s=r(88802),a=r(34987),n=r(57924),i=r(64839),o=r(77837),c=r(33027),u=r(9536),d=r(69865),l=r(62361),p=r(59091),h=r(52839),m=r(7181),y=r(24982);const g={deleteSecureFile:{method:"POST",path:"securefile/DeleteSecureFile",requestAcceptHeader:"application/json",responseType:"json",authType:i.d.USER_DEVICE,version:y.W.V1}};var v=r(55127),f=r(91406),w=r(73873),S=r(84626),_=r(42882);const b={accountrecovery:o.y,authentication:c.k,darkwebmonitoring:u.T,features:d.Z,file:l._,payments:p.l,pwleak:h.D,secretTransfer:m.t,securefile:g,sharingUserdevice:v.T,teams:f.b,time:w.i,useractivity:S.K,userconsents:_._};o.u,c.V,u.D,d.A,l.$,p.H,h.J,m.V,v.b,f.p,w.q,S.V,_.G;var E=r(60565),A=r(21534);let T=class{constructor(e,t){this.appliedV1Services=this.buildInjectedServices("v1",e.sdk),this.credentialsService=t}get v1(){return this.appliedV1Services}buildInjectedServices(e,t){return Object.keys(t[e]).reduce(((r,s)=>({...r,[s]:this.buildInjectedApiServices(e,t,s)})),{})}buildInjectedApiServices(e,t,r){return Object.getOwnPropertyNames(Object.getPrototypeOf(t.v1[r])).filter((e=>"constructor"!==e)).reduce(((s,a)=>({...s,[a]:this.buildInjectedRouteService(t,e,r,a)})),{})}buildInjectedRouteService(e,t,r,s){const n=b[r][s];if(!n)throw new Error("Unable to find endpoint descriptor");const{authType:o}=n;return(...n)=>{const c=e[t][r],u=c[s].bind(c);if(o===i.d.USER_DEVICE)return this.credentialsService.getActiveUserDeviceCredentials().pipe((0,a.b)((e=>u(e,...n))));if([i.d.NONE,i.d.APP].includes(o))return u(...n);throw new Error("Not supported")}}};T=(0,s.__decorate)([(0,n.GS)(),(0,s.__metadata)("design:paramtypes",[E.E,A.n])],T)},21534:(e,t,r)=>{"use strict";r.d(t,{n:()=>l});var s=r(88802),a=r(87065),n=r(34987),i=r(87279),o=r(57924),c=r(94189),u=r(18590),d=r(8987);let l=class{constructor(e,t){this.cqrsClient=e,this.infra=t}getActiveUserDeviceCredentials(){const{queries:{activeUser:e}}=this.cqrsClient.getClient(d.t$);return e().pipe((0,a.U)((e=>{if((0,i.d6)(e))return(0,i.db)(e);throw new Error("Failed to get active user")})),(0,n.b)((({userName:e})=>{if(!e)throw new Error("No active user available");return this.infra.getDeviceCredentialsForUser(e)})))}};l=(0,s.__decorate)([(0,o.GS)(),(0,s.__metadata)("design:paramtypes",[c.w,u.se])],l)},18590:(e,t,r)=>{"use strict";r.d(t,{$y:()=>s,se:()=>a});class s{constructor(e){this.baseUrl=e.baseUrl,this.appKeys=e.appKeys,this.cloudflareKeys=e.cloudflareKeys}}class a{}new class extends a{getDeviceCredentialsForUser(e){return Promise.resolve({deviceAccessKey:"",deviceSecretKey:"",login:e})}}},6447:(e,t,r)=>{"use strict";r.d(t,{n:()=>y});var s=r(88802),a=r(99634),n=r(25504),i=r(44985),o=r(73404),c=r(57924),u=r(60565);let d=class{constructor(e){this.configuredServerSdk=e}get v1(){return this.configuredServerSdk.sdk.v1}};d=(0,s.__decorate)([(0,c.GS)(),(0,s.__metadata)("design:paramtypes",[u.E])],d);var l=r(18590),p=r(71993),h=r(21534),m=r(37935);let y=class{};y=(0,s.__decorate)([(0,a.Y)({providers:[d,o.l,h.n,(0,u.F)()],exports:[d,o.l],configurations:{serverApi:{token:l.$y},serverApiInfrastructure:{token:l.se}},stores:[p.t],sharedModuleName:"webServices",imports:[m.D,n.X,i.i]})],y)},10370:(e,t,r)=>{"use strict";r.d(t,{s:()=>n});var s=r(46041);function a(e){const t=e.length,r=[];for(let a=0;a<t;a+=3)r.push(s.T[e[a]>>2]),r.push(s.T[(3&e[a])<<4|e[a+1]>>4]),r.push(s.T[(15&e[a+1])<<2|e[a+2]>>6]),r.push(s.T[63&e[a+2]]);return r.join("")}function n(e,t=s.V){const r=new Uint8Array(e),n=r.length,i=t%3,o=0===i?t:t+(3-i),c=Math.ceil(n/o);let u="",d=-1;for(;d++<c;){const e=d*o,t=d===c-1?n:(d+1)*o,s=a(r.slice(e,t));u=u.concat(s)}return n%3==2?u.substring(0,u.length-1)+"=":n%3==1?u.substring(0,u.length-2)+"==":u}},89685:(e,t,r)=>{"use strict";r.d(t,{v:()=>a});const s=Math.pow(2,14)-1;function a(e){const t=new Uint8Array(e),r=t.length;let a="",n=s;for(let e=0;e<r;e+=n){e+n>r&&(n=r-e);const s=t.subarray(e,e+n);a+=String.fromCharCode(...s)}return a}},68376:(e,t,r)=>{"use strict";r.d(t,{L:()=>a});var s=r(96785);function a(e){const t=new Uint8Array(e),r=[];for(let e=0;e<t.byteLength;e++)r[e>>>2]|=t[e]<<24-e%4*8;return s.lib.WordArray.create(r,t.byteLength)}},66122:(e,t,r)=>{"use strict";r.d(t,{R:()=>n});var s=r(46041);const a=new Uint8Array(256);for(let e=0;e<s.T.length;e++)a[s.T.charCodeAt(e)]=e;function n(e){let t=.75*e.length;const r=e.length;let s,n,i,o,c,u=0;e.endsWith("=")&&(t--,"="===e[e.length-2]&&t--);const d=new ArrayBuffer(t),l=new Uint8Array(d);for(s=0;s<r;s+=4)n=a[e.charCodeAt(s)],i=a[e.charCodeAt(s+1)],o=a[e.charCodeAt(s+2)],c=a[e.charCodeAt(s+3)],l[u++]=n<<2|i>>4,l[u++]=(15&i)<<4|o>>2,l[u++]=(3&o)<<6|63&c;return d}},96303:(e,t,r)=>{"use strict";function s(e){return Array.prototype.map.call(new Uint8Array(e),(e=>("00"+e.toString(16)).slice(-2))).join("")}r.d(t,{k:()=>s})},82933:(e,t,r)=>{"use strict";function s(...e){const t=e.reduce(((e,t)=>e+t.byteLength),0),r=new Uint8Array(t);return e.reduce(((e,t)=>(r.set(new Uint8Array(t),e),e+t.byteLength)),0),r.buffer}r.d(t,{K:()=>s})},46041:(e,t,r)=>{"use strict";r.d(t,{T:()=>a,V:()=>s});const s=Math.pow(10,6),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"},83168:(e,t,r)=>{"use strict";r.d(t,{B:()=>i});var s=r(3417),a=r.n(s),n=r(54066);function i(e){const{asn1:t,pki:r}=a(),s=r.privateKeyFromPem(e),i=r.privateKeyToAsn1(s),o=r.wrapRsaPrivateKey(i),c=t.toDer(o).getBytes();return(0,n.u)(c)}},4761:(e,t,r)=>{"use strict";r.d(t,{M:()=>i});var s=r(3417),a=r.n(s),n=r(54066);function i(e){const{asn1:t,pki:r}=a(),s=r.publicKeyFromPem(e),i=r.publicKeyToAsn1(s),o=t.toDer(i).getBytes();return(0,n.u)(o)}},54066:(e,t,r)=>{"use strict";function s(e){const t=new ArrayBuffer(e.length),r=new Uint8Array(t);for(let t=0;t<e.length;++t)r[t]=e.charCodeAt(t);return t}r.d(t,{u:()=>s})},43293:(e,t,r)=>{"use strict";r.d(t,{N:()=>n});var s=r(30543),a=r(46041);function n(e,t=a.V){const r=e.length;if(0===r)return"";let n="",i=0,o=Math.min(i+t,r);for(;o<=r;){const a=e.charCodeAt(o-1);if(a>=55296&&a<=56319){if(o++,o>r)throw new Error("Invalid string provided to utf8ChunkEncode");continue}const c=e.slice(i,o),u=s.encode(c);if(n=n.concat(u),o===r)break;i=o,o=Math.min(i+t,r)}return n}},69806:(e,t,r)=>{"use strict";function s(e){const{sigBytes:t,words:r}=e,s=new Uint8Array(t);let a=0,n=0;for(;a!==t;){const e=r[n++];if(s[a++]=(4278190080&e)>>>24,a===t)break;if(s[a++]=(16711680&e)>>>16,a===t)break;if(s[a++]=(65280&e)>>>8,a===t)break;s[a++]=255&e}return s.buffer}r.d(t,{o:()=>s})},84473:(e,t,r)=>{"use strict";r.d(t,{W:()=>n});var s=r(75994),a=r(92204);class n extends s.X{async fetch(e){const t=(0,a.A)(e);return(await fetch(t)).json()}}},37298:(e,t,r)=>{"use strict";r.d(t,{j:()=>a});var s=r(58376);class a{constructor(e,t){this.source=e,this.filter=t;let r=[];const a=new Set;this.listener=(e,t)=>{if(!this.filter(e,t))return!1;a.size?a.forEach((r=>r.next([e,t]))):r.push([e,t])},this.events$=new s.y((e=>(a.size||(r.forEach((t=>e.next(t))),r=[]),a.add(e),()=>{a.delete(e)}))),this.source.addListener(this.listener)}stop(){this.source.removeListener(this.listener)}}},64391:(e,t,r)=>{"use strict";r.d(t,{O:()=>c,x:()=>o});var s=r(34064),a=r.n(s),n=r(68376),i=r(69806);function o(e,t){if(self.crypto.subtle)return self.crypto.subtle.digest({name:t},e);if("SHA-1"===t){const t=(0,n.L)(e),r=(0,i.o)(a()(t));return Promise.resolve(r)}return Promise.reject(new Error("Unsupported hash method"))}function c(e,t){if("SHA-1"===t){const t=(0,n.L)(e);return(0,i.o)(a()(t))}throw new Error("Unsupported hash method")}},86381:(e,t,r)=>{"use strict";r.d(t,{$:()=>n});var s=r(22609),a=r(83961);async function n(e,t,r){const n=await(0,a.Y)(e);return self.crypto.subtle.decrypt({name:s.z,iv:t},n,r)}},39560:(e,t,r)=>{"use strict";r.d(t,{G:()=>a});var s=r(83407);async function a(e,t,r){const a={name:s.$,hash:{name:r}},n=await self.crypto.subtle.importKey("pkcs8",e,a,!1,["decrypt"]);return self.crypto.subtle.decrypt(a,n,t)}},76254:(e,t,r)=>{"use strict";r.d(t,{f:()=>n});var s=r(35558),a=r.n(s);async function n(e,t,r){const{tCost:n,mCost:i,parallelism:o}=r,{hash:c}=await a().hash({pass:new Uint8Array(e),salt:new Uint8Array(t),time:n,mem:i,hashLen:32,parallelism:o,type:s.ArgonType.Argon2d});return c.buffer}},80954:(e,t,r)=>{"use strict";r.d(t,{x:()=>a});var s=r(22609);async function a(e,t,r){const a=await self.crypto.subtle.importKey("raw",e,"PBKDF2",!1,["deriveKey"]),n={name:s.z,length:256},{iterations:i,hashType:o}=r,c={name:"PBKDF2",salt:t,iterations:i,hash:{name:o}},u=await self.crypto.subtle.deriveKey(c,a,n,!0,["encrypt","decrypt"]);return self.crypto.subtle.exportKey("raw",u)}},48264:(e,t,r)=>{"use strict";r.d(t,{P:()=>n});var s=r(22609),a=r(83961);async function n(e,t,r){const n=await(0,a.Y)(e);return self.crypto.subtle.encrypt({name:s.z,iv:t},n,r)}},64396:(e,t,r)=>{"use strict";r.d(t,{b:()=>a});var s=r(83407);async function a(e,t,r){const a={name:s.$,hash:{name:r}},n=await self.crypto.subtle.importKey("spki",e,a,!1,["encrypt"]);return self.crypto.subtle.encrypt(a,n,t)}},420:(e,t,r)=>{"use strict";r.d(t,{o:()=>a});var s=r(22609);async function a(){const e=await self.crypto.subtle.generateKey({name:s.z,length:s.N},!0,["encrypt","decrypt"]);return self.crypto.subtle.exportKey("raw",e)}},26857:(e,t,r)=>{"use strict";r.d(t,{Y:()=>n});var s=r(83407);const a=new Uint8Array([1,0,1]);async function n(e){const t=await self.crypto.subtle.generateKey({name:s.$,modulusLength:2048,publicExponent:a,hash:{name:e}},!0,["encrypt","decrypt"]),{privateKey:r,publicKey:n}=t;return{privateKey:await self.crypto.subtle.exportKey("pkcs8",r),publicKey:await self.crypto.subtle.exportKey("spki",n)}}},39911:(e,t,r)=>{"use strict";function s(e){const t=new Uint8Array(e);return self.crypto.getRandomValues(t)}r.d(t,{P:()=>s})},83961:(e,t,r)=>{"use strict";r.d(t,{Y:()=>a});var s=r(22609);function a(e){return self.crypto.subtle.importKey("raw",e,s.z,!1,["encrypt","decrypt"])}},48297:(e,t,r)=>{"use strict";function s(e,t){return self.crypto.subtle.importKey("raw",e,{name:"HMAC",hash:{name:t}},!0,["sign","verify"])}r.d(t,{r:()=>s})},43838:(e,t,r)=>{"use strict";r.d(t,{n:()=>n});var s=r(74017),a=r(48297);async function n(e,t,r=s.x){const n=await(0,a.r)(e,r);return self.crypto.subtle.sign({name:"HMAC",hash:{name:r}},n,t)}},39387:(e,t,r)=>{"use strict";r.d(t,{f:()=>a});var s=r(83407);async function a(e,t,r){const a={name:s.x,hash:{name:r}},n=await self.crypto.subtle.importKey("pkcs8",e,a,!1,["sign"]);return self.crypto.subtle.sign(a,n,t)}},396:(e,t,r)=>{"use strict";r.d(t,{H:()=>o});var s=r(81968),a=r.n(s),n=r(68376),i=r(69806);function o(e){const t=(0,n.L)(e);return(0,i.o)(a()(t))}},57487:(e,t,r)=>{"use strict";r.d(t,{o:()=>n});var s=r(74017),a=r(48297);async function n(e,t,r,n=s.x){const i=await(0,a.r)(e,n);return self.crypto.subtle.verify({name:"HMAC",hash:{name:n}},i,t,r)}},83074:(e,t,r)=>{"use strict";r.d(t,{A:()=>m});var s=r(87065),a=r(93192),n=r(90171),i=r(47968),o=r(37182),c=r(69885),u=r(51992),d=r(73155),l=r(12964),p=r(4607),h=r(87279);class m{constructor(){this.toHttpResult=e=>e instanceof d.a?(0,h.Rn)(e):e.ok?(0,h.Vp)(e):(0,h.Rn)(new d.R(e)),this.toHttpResponse=e=>e instanceof d.a?e:new l.Z({body:e.body,url:e.url,status:e.status,statusText:e.statusText,headers:this.mapToHttpHeaders(e.headers)})}handle(e){const t=this.getTimeout$(e.timeout),r=this.doFetch(e).pipe((0,s.U)(this.toHttpResponse),(0,s.U)(this.toHttpResult));return(0,a.S)(t,r)}getTimeout$(e){return e?(0,n.H)(e).pipe((0,s.U)((()=>(0,h.Rn)(new d.a)))):i.C}doFetch(e){return(0,u.U)(e.url,{method:e.method,body:e.serializeBody(),headers:this.getHeaders(e),credentials:e.withCredentials?"include":"omit",mode:e.mode}).pipe((0,o.K)((e=>{if(!(e instanceof TypeError))throw e;return(0,c.of)(new d.a)})))}mapToHttpHeaders(e){const t=new p.W;return e.forEach(((e,r)=>t.set(r,e))),t}getHeaders(e){return e.headers.keys().reduce(((t,r)=>({...t,[r]:e.headers.get(r)})),{})}}},93699:(e,t,r)=>{"use strict";r.r(t),r.d(t,{BrowserCronSource:()=>Pe,BrowserPortConnector:()=>Ke,BrowserPortListener:()=>Me.P,BrowserPortListenerChannel:()=>ze,BufferedEventStream:()=>i.j,ExtensionCronSource:()=>De.y,ExtensionLocalStorageInfrastructure:()=>be.e,HttpFetchBackend:()=>x.A,IndexDbKeyValueStorage:()=>xe,IndexDbStorage:()=>Ce,JsonExtensionResourceFetcher:()=>n.W,JsonWebAppResourceFetcher:()=>a,PageToWorkerChannel:()=>Le,computeHash:()=>o.x,computeHashSynchronous:()=>o.O,cookieRemoveByDomain:()=>z,decryptAes256:()=>c.$,decryptAesEcb256:()=>p,decryptRsaOaep:()=>h.G,deriveKeyArgon2d:()=>m.f,deriveKeyPbkdf2:()=>y.x,disableBrowserNativeAutofill:()=>M,enablePrivacyService:()=>L,encryptAes256:()=>g.P,encryptRsaOaep:()=>v.b,generateKeyAes256:()=>f.o,generateKeyPairRsaOaep:()=>w.Y,getLanguage:()=>U,getRandomValues:()=>S.P,getShortcutValues:()=>ae,isMv3Environment:()=>Ue,makeStoreInfrastructure:()=>_e.e,signHmacSha:()=>_.n,signRsassaPkcs1:()=>b.f,storageLocalItemExists:()=>oe,unsafeComputeMd5Hash:()=>E.H,updateToolbarIcon:()=>K,verifyHmacSha:()=>A.o,verifyRsassaPkcs1:()=>C,webappClose:()=>Se,webappOpen:()=>fe});var s=r(75994);class a extends s.X{constructor(e){super(),this.publicPath=e}async fetch(e){return(await fetch(new URL(e.replace(/^\/*/,""),this.publicPath).href)).json()}}var n=r(84473),i=r(37298),o=r(64391),c=r(86381),u=r(89685),d=r(68376),l=r(69806);function p(e,t){const r=(0,u.v)(t),s=(0,d.L)(e);return(0,l.o)(CryptoJS.AES.decrypt(r,s,{mode:CryptoJS.mode.ECB}))}var h=r(39560),m=r(76254),y=r(80954),g=r(48264),v=r(64396),f=r(420),w=r(26857),S=r(39911),_=r(43838),b=r(39387),E=r(396),A=r(57487),T=r(83407);async function C(e,t,r,s){const a={name:T.x,hash:{name:s}},n=await self.crypto.subtle.importKey("spki",e,a,!1,["verify"]);return self.crypto.subtle.verify(a,n,t,r)}var x=r(83074);const R=new Set(["en","fr","es","ja","de","pt","it","ko","zh","nl","sv"]),I="en";function P(e){return e.substr(0,2)}function D(e){const t=P(e);return R.has(t)}function U(){const e=[navigator.language].concat(navigator.languages).find(D);if(!e)return I;if(!e.includes("-"))return e;return P(e)}var F=r(30754),O=r(82324),N=r(81805);const k=" ";async function L(e,t){try{const{levelOfControl:t}=await(0,F.U)(e);if("controllable_by_this_extension"!==t&&"controlled_by_this_extension"!==t){const r=[`Impossible to change browser setting: ${e}.`,`Extension prevented from changing: ${t}`].join(k);throw new Error(r)}}catch(t){if((0,O.b)(t)){throw new Error(`Browser setting not supported: ${e}`)}if((0,O.I)(t))throw t.runtimeError;throw t}try{await(0,N.t)(e,t)}catch(e){throw(0,O.I)(e)?e.runtimeError:e}}async function M(){const e=["autofillAddressEnabled","autofillCreditCardEnabled","passwordSavingEnabled"].map((e=>L(e,!1)));await Promise.all(e)}var V=r(84318),G=r(16241);const q={nightly:"icon_nightly_auth",mv2:"icon_auth",mv3:"icon_mv3_auth"},j="icon_not_auth";async function K({isUserAuthenticated:e}){const t=`icons/action/${e?function(){const e=(0,V.W)();return e.name.includes("Nightly")?q.nightly:e.name.includes("Beta")||3===e.manifest_version?q.mv3:q.mv2}():j}`,r={16:`${t}.png`,32:`${t}@2x.png`};await(0,G.B)(r)}var W=r(329),B=r(98641);function H(e){return`${"http"+(e.secure?"s":"")}://${e.domain.startsWith(".")?e.domain.substring(1):e.domain}${e.path}`}async function z(e){const t=await(0,W.g)({domain:e});return Promise.all(t.map((e=>(0,B.O)({url:H(e),name:e.name}))))}var $=r(57323),Q=r(839);const Y=/^_execute(_browser){0,1}_action$/,X="+";var J;function Z(e){return Y.test(e.name??"")}function ee(e){const t=e.toUpperCase();switch(t){case"":case"CTRL":return $.os.isMacOS()?J.Command:J.Ctrl;case"SHIFT":case"":return J.Shift;case"COMMAND":case"":return J.Command;case"MACCTRL":return J.MacCtrl;default:return t}}function te(e){const t=Object.values(J),r=t.indexOf(e);return-1===r?t.length:r}function re(e,t){return te(e)-te(t)}function se(e){switch(e){case J.Ctrl:case J.MacCtrl:return"Ctrl";case J.Shift:return"";case J.Command:return"";default:return e}}async function ae(){const e=await new Promise(((e,t)=>{(0,Q.Ez)("commands.getAll")?chrome.commands.getAll((r=>{if(chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError",r=new Error(`commands/getAll: ${e}`);t(r)}else e(r)})):t(new Error("No commands.getAll support"))})),t=e.find(Z)?.shortcut;if(!t)return;const r=function(e){return e.split(e.includes(X)?X:"")}(t);return r.map(ee).sort(re).map(se)}!function(e){e.Command="Command",e.Ctrl="Ctrl",e.MacCtrl="MacCtrl",e.Shift="Shift"}(J||(J={}));var ne=r(39680),ie=r(41808);async function oe(e){if((0,ne.G)()){return await(0,ne.y)(e)>0}const t=await(0,ie.U)(e),r=void 0===t[e],s=null===t[e];return!r&&!s}var ce=r(92204),ue=r(24715),de=r(72733),le=r(57306),pe=r(31460),he=r(61222);async function me(){const e=await(0,he.I)({}),t=(0,ce.A)("");return e.filter((e=>"string"==typeof e.url&&e.url.startsWith(t))).filter((e=>""!==e.url))}const ye="index.html";function ge(){return`${(0,ce.A)("")}${ye}`}function ve({identifier:e,queryInfo:t,name:r}){const s=ge();if(!r)return s;const a=e?`#${r}/${e}`:`#${r}`,n=t?`?${function(e){return Object.keys(e).map((t=>`${t}=${e[t]}`)).join("&")}(t)}`:"";return encodeURI(`${s}${a}${n}`)}async function fe({id:e,query:t,route:r}){const s=ve({identifier:e,queryInfo:t,name:r}),a=await me();a.length?await async function({path:e,tabs:t}){const r=await(0,de.T)(),s=function({existingTabs:e,focusedWindow:t}){const r=e.filter((e=>e.active)),s=r.find((e=>e.windowId===t.id)),a=r.pop(),n=e.pop();return s??a??n}({existingTabs:t,focusedWindow:r});if(!s)return;if(s.windowId!==r.id&&(0,le.V)(s.windowId,{focused:!0}),!s.id)return;const a={active:!0,...e===ge()?{}:{url:e}};await(0,pe.V)(s.id,a)}({path:s,tabs:a}):await async function(e){const t={url:e};await(0,ue.U)(t)}(s)}var we=r(49259);async function Se(){const e=await me();if(!e.length)return;const t=chrome.tabs.TAB_ID_NONE,r=e.map((e=>e.id)).filter((e=>"number"==typeof e&&e!==t));await(0,we.O)(r)}var _e=r(42973),be=r(62853),Ee=r(96168),Ae=r(87279);class Te extends((0,Ee.Hu)("NotSupported","Index DB is not supported in this environment")){}class Ce{constructor(e,t,r){this.DB_STORE_NAME=e,this.DB_VERSION=t,this.DB_OBJECT_STORE_NAME=r}getIndexedDB(){return new Promise(((e,t)=>{const r=self.indexedDB;if(!r)return t(new Error("indexedDB is not supported in this environment"));const s=r.open(this.DB_STORE_NAME,this.DB_VERSION);s.onerror=function(){"InvalidStateError"===s.error?.name&&e((0,Ae.Rn)(new Te)),t(s.error)},s.onupgradeneeded=()=>{s.result.objectStoreNames.contains(this.DB_OBJECT_STORE_NAME)||s.result.createObjectStore(this.DB_OBJECT_STORE_NAME)},s.onsuccess=function(){s.onsuccess=null,e((0,Ae.Vp)(s.result))}}))}async isSupported(){return(0,Ae.d6)(await this.getIndexedDB())}async getStore(e="readwrite"){const t=await this.getIndexedDB();if(!(0,Ae.d6)(t))throw new Error("Failed to get db");return t.data.transaction([this.DB_OBJECT_STORE_NAME],e).objectStore(this.DB_OBJECT_STORE_NAME)}async readItem(e){const t=await this.getStore("readonly");return new Promise((r=>{const s=t.get(e);s.onsuccess=()=>{s.onsuccess=null,r(s.result)}}))}async getAllKeys(){const e=await this.getStore("readonly");return new Promise((t=>{const r=e.getAllKeys();r.onsuccess=()=>{t(r.result.map((e=>String(e))))}}))}async removeItem(e){const t=await this.getStore("readwrite");return new Promise((r=>{const s=t.delete(e);s.onsuccess=()=>{s.onsuccess=null,r()}}))}async writeItem(e,t){const r=await this.getStore("readwrite");return new Promise((s=>{const a=r.put(t,e);a.onsuccess=()=>{a.onsuccess=null,s()}}))}async itemExists(e){const t=await this.readItem(e);return null!=t}}class xe{constructor(){this.storageLayer=new Ce("dashlane-ng",1,"module-data")}isSupported(){return this.storageLayer.isSupported()}getAllKeys(){return this.storageLayer.getAllKeys()}async set(e,t){return await this.storageLayer.writeItem(e,t)}remove(e){return this.storageLayer.removeItem(e)}async get(e){return await this.storageLayer.readItem(e)??void 0}}var Re=r(69594),Ie=r(58376);class Pe extends Re.R_{constructor(){super(...arguments),this.alarm$=new Ie.y((e=>{const t=self.setInterval((()=>{e.next()}),6e4);return()=>{self.clearInterval(t)}}))}}var De=r(11565);function Ue(){return"undefined"!=typeof chrome&&void 0!==chrome.runtime&&void 0!==chrome.runtime.getManifest&&3===(0,V.W)().manifest_version}var Fe=r(15572),Oe=r(45244),Ne=r(69885),ke=r(7074);class Le{constructor(e,t){this.worker=e,this.channelName=t,this.status$=(0,Ne.of)(Fe.D.Connected),this.messages$=new Ie.y((t=>{const r=e=>{(0,Oe.F)(e.data)&&!e.origin&&t.next(e.data.message)};return e.addEventListener("message",r),()=>{e.removeEventListener("message",r)}})).pipe((0,ke.B)())}async sendMessage(e){this.worker.postMessage((0,Oe.k)({channelName:this.channelName,message:e}))}stop(){return Promise.resolve()}}var Me=r(66917),Ve=r(24966),Ge=r(97280),qe=r(6220),je=r(60399);class Ke{constructor(e){this.status$=new Ve.X(Fe.D.Connected),this.port$=new Ie.y((t=>{let r;const s=this.status$;function a(){r?.onDisconnect.removeListener(a);const n=function(e){if(!(0,Q.Ez)("runtime.connect"))throw new Error("No runtime.connect support");return chrome.runtime.connect(e)}({name:e});s.next(Fe.D.Disconnected),n.onDisconnect.addListener(a),t.next(n),s.next(Fe.D.Connected),r=n}return a(),()=>{r?.onDisconnect.removeListener(a),r?.disconnect()}})).pipe((0,Ge.d)(1)),this.portSubscription=this.port$.subscribe(),this.messages$=this.port$.pipe((0,qe.z)((t=>new Ie.y((r=>{const s=t=>{(0,Oe.F)(t)&&t.channelName===e&&r.next(t.message)};return t.onMessage.addListener(s),()=>{t.onMessage.removeListener(s)}})))))}async sendMessage(e){const t=await(0,je.z)(this.port$);t.postMessage((0,Oe.k)({channelName:t.name,message:e}))}stop(){return this.portSubscription.unsubscribe(),this.status$.next(Fe.D.Disconnected),Promise.resolve()}}var We=r(87065),Be=r(43978),He=r(17350);class ze{constructor(e){this.listener=new Me.P(e),this.channel$=this.listener.connectedChannels$.pipe((0,We.U)((e=>{const t=Object.values(e);if(t.length)return t[0]})),(0,Ge.d)(1)),this.receivedMessages$=this.channel$.pipe((0,Be.w)((e=>e?e.receivedMessages$:He.E))),this.channelState$=this.channel$.pipe((0,We.U)((e=>e?Fe.D.Connected:Fe.D.Disconnected)))}async send(e){const t=await(0,je.z)(this.channel$);if(!t)throw new Error("Channel is not connected");await t.send(e)}stop(){this.listener.stop()}}},42973:(e,t,r)=>{"use strict";r.d(t,{e:()=>S});var s=r(83081),a=r(32012),n=r(58376),i=r(7074),o=r(24966),c=r(85390),u=r(15023),d=r(87065),l=r(839);const p={addListener:function(e){if(!(0,l.qX)(["storage"]))throw new Error("No storage.session.onChanged.addListener support, permission is missing");if(!(0,l.Ez)("storage.session.onChanged.addListener"))throw new Error("No storage.session.onChanged.addListener support");const t=t=>{if(chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError";throw new Error(`storage/session/onChanged: ${e}`)}return e(t)};return chrome.storage.session.onChanged.addListener(t),t},removeListener:function(e){if(!(0,l.qX)(["storage"]))throw new Error("No storage.session.onChanged.removeListener support, permission is missing");if(!(0,l.Ez)("storage.session.onChanged.removeListener"))throw new Error("No storage.session.onChanged.removeListener support");chrome.storage.session.onChanged.removeListener(e)}};var h=r(56847),m=r(52477),y=r(15026);function g(e){return JSON.parse(JSON.stringify(e))}class v{constructor(){this.events$=new n.y((e=>{const t=t=>{e.next(t)};return p.addListener(t),()=>p.removeListener(t)})).pipe((0,i.B)())}}class f{constructor(e,t,r){this.stopped$=new o.X(!1),this.key=t,this.typeGuard=r??(e=>!0);const s=new n.y((r=>{this.getState().then((e=>{r.next(e)}));const s=e.events$.subscribe((e=>{if(t in e){const{newValue:s}=e[t];return r.next(this.asDataWithTimestamp(s))}}));return()=>s.unsubscribe()}));this.state$=(0,c.a)({state:s,isStopped:this.stopped$}).pipe((0,u.o)((({isStopped:e})=>!e),!1),(0,d.U)((({state:e})=>e)))}async update(e){return this.set(e(await this.getState()))}persist(){return Promise.resolve()}load(){return Promise.resolve()}set(e){return(0,h.t)(g({[this.key]:e}))}init(e){return(0,h.t)(g({[this.key]:e}))}clear(){return(0,m.O)(this.key)}stop(){this.stopped$.next(!0)}async getState(){const e=(await(0,y.U)(this.key))[this.key];return this.asDataWithTimestamp(e)}asDataWithTimestamp(e){return e&&"object"==typeof e&&"timestamp"in e&&"number"==typeof e.timestamp&&e.timestamp&&"data"in e&&this.typeGuard(e.data)?{timestamp:e.timestamp,data:e.data}:{timestamp:void 0}}}class w extends s.G{constructor(){super(...arguments),this.source=new v}createUserScopedInfrastructure(e,t,r,s){const a=`graphene.${e}.${t}.${r}`;return new f(this.source,a,s)}createDeviceScopedInfrastructure(e,t,r){const s=`graphene.${e}.${t}`;return new f(this.source,s,r)}}function S(){return(0,a.G)()?new w:new s.N}},62853:(e,t,r)=>{"use strict";r.d(t,{e:()=>i});var s=r(41808),a=r(9244),n=r(45441);class i{async getAllKeys(){return Object.keys(await(0,s.U)(null))}async get(e){const t=(await(0,s.U)([e]))[e];if(t){if("string"!=typeof t)throw new Error(`[ChromeLocalStorage] - cannot read content of ${e} properly. Type is\n        ${typeof t} but should be 'string'`);return t}}async set(e,t){await(0,a.t)({[e]:t})}async remove(e){await(0,n.O)([e])}}},11565:(e,t,r)=>{"use strict";r.d(t,{y:()=>p});var s=r(69594),a=r(58376),n=r(97280),i=r(839);const o=e=>{if(!(0,i.qX)(["alarms"]))throw new Error("No alarms.onAlarm.addListener support, permission is missing");if(!(0,i.Ez)("alarms.onAlarm.addListener"))throw new Error("No alarms.onAlarm.addListener support");chrome.alarms.onAlarm.addListener(e);const t=chrome.runtime.lastError?.message;if(t)throw new Error("alarms/onAlarm error:"+t)},c=e=>{if(!(0,i.qX)(["alarms"]))throw new Error("No alarms.onAlarm.removeListener support, permission is missing");if(!(0,i.Ez)("alarms.onAlarm.removeListener"))throw new Error("No alarms.onAlarm.removeListener support");chrome.alarms.onAlarm.removeListener(e);const t=chrome.runtime.lastError?.message;if(t)throw new Error("alarms/onAlarm error:"+t)};const u="cron-source",d=()=>new a.y((e=>{const t=t=>{t.name===u&&e.next()};return((e,t)=>{if(!(0,i.qX)(["alarms"]))throw new Error("No alarms.create support, permission is missing");if(!(0,i.Ez)("alarms.create"))throw new Error("No alarms.create support");chrome.alarms.create(e,t)})(u,{delayInMinutes:1,periodInMinutes:1}),o(t),()=>{c(t)}})),l=()=>(0,i.Ez)("alarms.clear")&&(0,i.qX)(["alarms"])?d():new a.y((e=>{const t=self.setInterval((()=>{e.next()}),6e4);return()=>{self.clearInterval(t)}}));class p extends s.R_{constructor(){super(...arguments),this.alarm$=l().pipe((0,n.d)(1)),this.subscription=this.alarm$.subscribe()}stop(){this.subscription.unsubscribe()}}},66917:(e,t,r)=>{"use strict";r.d(t,{P:()=>p});var s=r(69183),a=r(24966),n=r(58376),i=r(87065),o=r(45244),c=r(15572),u=r(58649),d=r(20500),l=r(37298);class p{constructor(e){this.connectedChannels$=new a.X({});const t=new n.y((t=>{const r={},n=n=>{const d=(0,s.Z)();if(n.name!==e)return;const p=new l.j({addListener:e=>n.onMessage.addListener(e),removeListener:e=>n.onMessage.removeListener(e)},(t=>(0,o.F)(t)&&t.channelName===e)),h=new Promise((e=>{const t=()=>{n.onDisconnect.removeListener(t),e(null)};n.onDisconnect.addListener(t)})),m=new a.X(c.D.Connected);h.then((()=>{p.stop(),m.next(c.D.Disconnected),delete r[d],t.next(r)}));const y={messages$:p.events$.pipe((0,i.U)((([e])=>e.message))),sendMessage:t=>(n.postMessage((0,o.k)({channelName:e,message:t})),Promise.resolve()),stop:()=>(n.disconnect(),Promise.resolve()),status$:m},g=new u.N(y);r[d]=g,t.next(r)};return d.b.addListener(n),()=>{d.b.removeListener(n)}}));this.subscription=t.subscribe((e=>this.connectedChannels$.next(e)))}stop(){this.subscription.unsubscribe()}}},23711:(e,t,r)=>{"use strict";r.d(t,{z:()=>n});var s=r(66122),a=r(10370);class n{decode(e){return(0,s.R)(e)}encode(e){return(0,a.s)(e)}}},49499:(e,t,r)=>{"use strict";function s(...e){const t=[...e].reverse();return{decode:async t=>{for(const r of e)t=await r.decode(t);return t},encode:async e=>{for(const r of t)e=await r.encode(e);return e}}}r.d(t,{x:()=>s})},43702:(e,t,r)=>{"use strict";r.d(t,{b:()=>n});var s=r(89685),a=r(54066);class n{decode(e){return JSON.parse((0,s.v)(e))}encode(e){return(0,a.u)(JSON.stringify(e))}}},10722:(e,t,r)=>{"use strict";r.d(t,{E:()=>a});const s=e=>e;class a{constructor(){this.encode=s,this.decode=s}}},16698:(e,t,r)=>{"use strict";r.d(t,{BU:()=>n,No:()=>i,Nw:()=>s,gO:()=>a});const s={algorithm:"aes256",mode:"cbchmac",ivLength:16},a={algorithm:"aes256",mode:"cbchmac64",ivLength:16},n={algorithm:"aes256",mode:"cbchmac",ivLength:16,padding:16,bytesToKey:0,reuseSalt:!1},i={algorithm:"aes256",mode:"cbc",ivLength:16,saltLength:32,padding:0,bytesToKey:{algorithm:"sha1",iterations:3,keyLength:32}}},94805:(e,t,r)=>{"use strict";r.d(t,{E1:()=>a,Yi:()=>i,b9:()=>o,mr:()=>s,oo:()=>n});const s={algorithm:"argon2d",saltLength:16,tCost:3,mCost:32768,parallelism:2},a={algorithm:"pbkdf2",saltLength:16,iterations:2e5,hashAlgorithm:"sha256"},n={algorithm:"noderivation"},i={algorithm:"pbkdf2",saltLength:32,iterations:10204,hashAlgorithm:"sha1"};function o(e){return["argon2d","pbkdf2","noderivation"].some((t=>t===e))}},69591:(e,t,r)=>{"use strict";r.d(t,{F:()=>s,g:()=>a});const s="$",a=1},33055:(e,t,r)=>{"use strict";r.d(t,{ARGON2D_MARKER_SCHEMA:()=>s,NODERIVATION_MARKER_SCHEMA:()=>n,PBKDF2_MARKER_SCHEMA:()=>a});const s={count:9,index:{version:0,derivation:1,saltLength:2,tCost:3,mCost:4,parallelism:5,cipher:6,mode:7,ivLength:8}},a={count:8,index:{version:0,derivation:1,saltLength:2,iterations:3,hashAlgorithm:4,cipher:5,mode:6,ivLength:7}},n={count:5,index:{version:0,derivation:1,cipher:2,mode:3,ivLength:4}}},38291:(e,t,r)=>{"use strict";r.d(t,{PD:()=>s,RB:()=>i,en:()=>a,jK:()=>n});const s="KWC5",a=16,n=32,i=0},6752:(e,t,r)=>{"use strict";r.d(t,{b:()=>n});var s=r(54066);var a=r(12087);function n(e,t,r,n,i,o){return"pbkdf2"===i.algorithm?(0,a.E)(r,o,i,e,t):async function(e,t,r,a,n){const{tCost:i,mCost:o,parallelism:c}=r,u=(0,s.u)(Object.values(r).join("")),d=t.getCacheKey(a,n,u),l=t.getCachedDerivation(d);if(l)return l;const p={tCost:i,mCost:o,parallelism:c},h=await e(a,n,p);return t.setCachedDerivation({cacheKey:d,data:h}),h}(n,o,i,e,t)}},12087:(e,t,r)=>{"use strict";r.d(t,{E:()=>n});var s=r(54066),a=r(95087);async function n(e,t,r,n,i){const o=(0,s.u)(Object.values(r).join("")),c=t.getCacheKey(n,i,o),u=t.getCachedDerivation(c);if(u)return u;const d=function(e){switch(e){case"sha1":return"SHA-1";case"sha256":return"SHA-256";case"sha384":return"SHA-384";case"sha512":return"SHA-512";default:(0,a.U)(e)}}(r.hashAlgorithm),l=await e(n,i,{iterations:r.iterations,hashType:d});return t.setCachedDerivation({cacheKey:c,data:l}),l}},60745:(e,t,r)=>{"use strict";r.d(t,{F:()=>M});var s=r(82933),a=r(89685),n=r(95087),i=r(94805);function o({transportableData:e,marker:t,metadata:r}){const s=t.length+r.length;return e.substring(s)}var c=r(54066);function u({encipheredContents:e,marker:t,metadata:r}){const{derivation:s,cipher:a,type:n,version:i}=t,{iv:o,salt:u,signature:d}=r;return{type:n,version:i,derivationConfig:s,cipherConfig:a,salt:(0,c.u)(u),signature:(0,c.u)(d),iv:(0,c.u)(o),encipheredContents:(0,c.u)(e)}}function d({str:e,substr:t,occurrence:r}){if(r<1)return-1;let s=0,a=-1;for(;s<r;){if(a=e.indexOf(t,a+1),a<0)return a;s++}return a}var l=r(69591);function p({transportableData:e,makeMarker:t,schema:r}){const s=r.count+1,a=d({str:e,substr:l.F,occurrence:s}),n=e.substring(1,a).split(l.F);if(n.length!==r.count)throw new Error("Marker and schema length mismatch");return t({bytes:a+1,markerSchema:r,values:n})}var h=r(7165);const m=h.z.object({algorithm:h.z.literal("aes256"),mode:h.z.literal("cbchmac"),ivLength:h.z.literal(16)}),y=h.z.object({algorithm:h.z.literal("aes256"),mode:h.z.literal("cbchmac64"),ivLength:h.z.literal(16)}),g=h.z.union([m,y]),v=h.z.object({algorithm:h.z.literal("argon2d"),saltLength:h.z.literal(16),tCost:h.z.number(),mCost:h.z.number(),parallelism:h.z.number()}),f=h.z.object({algorithm:h.z.literal("pbkdf2"),saltLength:h.z.union([h.z.literal(16),h.z.literal(32)]),iterations:h.z.number(),hashAlgorithm:h.z.enum(["sha1","sha256"])}),w=h.z.object({algorithm:h.z.literal("noderivation")}),S=h.z.literal("flexible"),_=h.z.object({version:h.z.literal(1),type:S,length:h.z.number(),derivation:v,cipher:m});function b({bytes:e,markerSchema:t,values:r}){const{version:s,derivation:a,saltLength:n,tCost:i,mCost:o,parallelism:c,cipher:u,mode:d,ivLength:l}=t.index,p=_.safeParse({version:Number(r[s]),type:"flexible",length:e,derivation:{algorithm:r[a],saltLength:Number(r[n]),tCost:Number(r[i]),mCost:Number(r[o]),parallelism:Number(r[c])},cipher:{algorithm:r[u],mode:r[d],ivLength:Number(r[l])}});if(!p.success)throw new Error(p.error.message);return p.data}var E=r(33055);const A=32;function T({transportableData:e,marker:t}){const{length:r,derivation:s,cipher:a}=t,n=s.saltLength,{ivLength:i}=a,o=r+0,c=o+n,u=c+i;return{iv:e.substring(c,c+i),length:n+i+A,salt:e.substring(o,o+n),signature:e.substring(u,u+A)}}const C=h.z.object({version:h.z.literal(1),type:S,length:h.z.number(),derivation:w,cipher:g});function x({bytes:e,markerSchema:t,values:r}){const{version:s,cipher:a,mode:n,ivLength:i}=t.index,o=C.safeParse({version:Number(r[s]),type:"flexible",length:e,derivation:{algorithm:"noderivation"},cipher:{algorithm:r[a],mode:r[n],ivLength:Number(r[i])}});if(!o.success)throw new Error(o.error.message);return o.data}function R(){return e=>{const t=p({transportableData:e,makeMarker:x,schema:E.NODERIVATION_MARKER_SCHEMA}),r=function({transportableData:e,marker:t}){const{length:r,cipher:s}=t,{ivLength:a}=s,n=r+0,i=n+a;return{iv:e.substring(n,n+a),length:a+A,signature:e.substring(i,i+A)}}({transportableData:e,marker:t});return function({encipheredContents:e,marker:t,metadata:r}){const{derivation:s,cipher:a,type:n,version:i}=t,{iv:o,signature:u}=r;return{type:n,version:i,derivationConfig:s,cipherConfig:a,signature:(0,c.u)(u),iv:(0,c.u)(o),encipheredContents:(0,c.u)(e)}}({encipheredContents:o({transportableData:e,marker:t,metadata:r}),marker:t,metadata:r})}}const I=h.z.object({version:h.z.literal(1),type:S,length:h.z.number(),derivation:f,cipher:m});function P({bytes:e,markerSchema:t,values:r}){const{version:s,derivation:a,saltLength:n,iterations:i,hashAlgorithm:o,cipher:c,mode:u,ivLength:d}=t.index,l=I.safeParse({version:Number(r[s]),type:"flexible",length:e,derivation:{algorithm:r[a],saltLength:Number(r[n]),iterations:Number(r[i]),hashAlgorithm:r[o]},cipher:{algorithm:r[c],mode:r[u],ivLength:Number(r[d])}});if(!l.success)throw new Error(l.error.message);return l.data}function D({transportableData:e,index:t}){const r=t+1,s=d({str:e,substr:l.F,occurrence:r}),a=d({str:e,substr:l.F,occurrence:r+1});if(-1===s||-1===a)throw new Error("Marker info indices not found");return e.substring(s+1,a)}const U=0,F=1;function O(e){switch(e){case"argon2d":return e=>{const t=p({transportableData:e,makeMarker:b,schema:E.ARGON2D_MARKER_SCHEMA}),r=T({transportableData:e,marker:t});return u({encipheredContents:o({transportableData:e,marker:t,metadata:r}),marker:t,metadata:r})};case"pbkdf2":return e=>{const t=p({transportableData:e,makeMarker:P,schema:E.PBKDF2_MARKER_SCHEMA}),r=T({transportableData:e,marker:t});return u({encipheredContents:o({transportableData:e,marker:t,metadata:r}),marker:t,metadata:r})};case"noderivation":return R();default:(0,n.U)(e)}}var N=r(6424),k=r(58396),L=r(6752);async function M(e,t,r,n){const o=function(e){const t=(0,a.v)(e),r=D({transportableData:t,index:U});if(Number(r)!==l.g)throw new Error("Marker version not supported");const s=D({transportableData:t,index:F});if(!(0,i.b9)(s))throw new Error("Derivation algorithm not supported");return O(s)(t)}(n),{deriveKeyArgon2d:c,deriveKeyPbkdf2:u}=t,{derivationConfig:d,salt:p}=o,{algorithm:h}=d,m="pbkdf2"===h||"argon2d"===h;if(m&&!p)throw new Error("Need salt for derivation");const y=m&&p?await(0,L.b)(e,p,u,c,d,r):e,{mode:g}=o.cipherConfig,{computeHash:v}=t,{encryptionKey:f,signatureKey:w}="cbchmac64"===g?await(0,k.U)(y):await(0,N.Y)(y,v),{iv:S,encipheredContents:_}=o,b=(0,s.K)(S,_),{verifyHmacSha:E}=t,{signature:A}=o;if(!await E(w,A,b))throw new Error("Signature cannot be verified");const{decryptAes256:T}=t;return T(f,S,_)}},7449:(e,t,r)=>{"use strict";r.d(t,{I:()=>d});var s=r(82933),a=r(94805),n=r(16698),i=r(38291);const o={type:"KWC5",derivation:a.oo,cipher:n.BU};function c(e){const t=function({transportableData:e,marker:t}){const{cipher:r,type:s}=t,{ivLength:a}=r,n=i.RB+a+i.en+s.length,o=n+i.jK;return{iv:e.slice(i.RB,i.RB+a),signature:e.slice(n,n+i.jK),encipheredContents:e.slice(o)}}({transportableData:e,marker:o});return{iv:t.iv,type:i.PD,signature:t.signature,encipheredContents:t.encipheredContents,derivationConfig:a.oo,cipherConfig:n.BU}}var u=r(6424);async function d(e,t,r){const a=c(r),{computeHash:n}=t,{encryptionKey:i,signatureKey:o}=await(0,u.Y)(e,n),{iv:d,encipheredContents:l}=a,p=(0,s.K)(d,l),{verifyHmacSha:h}=t,{signature:m}=a;if(!await h(o,m,p))throw new Error("Signature cannot be verified");const{decryptAes256:y}=t;return y(i,d,l)}},58396:(e,t,r)=>{"use strict";function s(e){const t=new Uint8Array(e),r=e.byteLength/2,s=t.slice(0,r),a=t.slice(r);return Promise.resolve({encryptionKey:s.buffer,signatureKey:a.buffer})}r.d(t,{U:()=>s})},6424:(e,t,r)=>{"use strict";r.d(t,{Y:()=>a});const s="SHA-512";async function a(e,t){const r=await t(e,s),a=new Uint8Array(r),n=r.byteLength/2,i=a.slice(0,n),o=a.slice(n,r.byteLength);return{encryptionKey:i.buffer,signatureKey:o.buffer}}},22609:(e,t,r)=>{"use strict";r.d(t,{N:()=>a,z:()=>s});const s="AES-CBC",a=256},74017:(e,t,r)=>{"use strict";r.d(t,{x:()=>s});const s="SHA-256"},83407:(e,t,r)=>{"use strict";r.d(t,{$:()=>s,x:()=>a});const s="RSA-OAEP",a="RSASSA-PKCS1-v1_5"},22253:(e,t,r)=>{"use strict";r.d(t,{j:()=>s});class s{}},4607:(e,t,r)=>{"use strict";r.d(t,{W:()=>s});class s{constructor(e){this.headers=new Map,this.normalizedNames=new Map,"string"==typeof e?this.initFromString(e):e&&this.initFromObject(e)}has(e){return this.headers.has(e.toLowerCase())}get(e){const t=this.headers.get(e.toLowerCase());return t?.[0]??null}keys(){return Array.from(this.normalizedNames.values())}getAll(e){return this.headers.get(e.toLowerCase())??null}append(e,t){return this.clone({name:e,value:t,op:0})}set(e,t){return this.clone({name:e,value:t,op:1})}delete(e,t){return this.clone({name:e,value:t,op:2})}deleteMultiple(e){return this.clone({names:e,op:3})}toObject(){return Object.fromEntries(this.headers)}maybeSetNormalizedName(e,t){this.normalizedNames.has(t)||this.normalizedNames.set(t,e)}clone(e){const t=new s;return t.initFromOther(this),t.applyUpdate(e),t}applyUpdate(e){switch(e.op){case 0:case 1:{const t=e.name.toLowerCase();let r=e.value;if("string"==typeof r&&(r=[r]),0===r.length)return;this.maybeSetNormalizedName(e.name,t);const s=(0===e.op?this.headers.get(t):void 0)??[];s.push(...r),this.headers.set(t,s)}break;case 2:{const t=e.name.toLowerCase(),r=e.value;if(r){let e=this.headers.get(t);if(!e)return;const s=Array.isArray(r)?r:[r];e=e.filter((e=>!s.includes(e))),0===e.length?(this.headers.delete(t),this.normalizedNames.delete(t)):this.headers.set(t,e)}else this.headers.delete(t),this.normalizedNames.delete(t)}break;case 3:e.names.forEach((e=>{const t=e.toLowerCase();this.headers.delete(t),this.normalizedNames.delete(t)}))}}initFromOther(e){Array.from(e.headers.keys()).forEach((t=>{this.headers.set(t,[...e.headers.get(t)]),this.normalizedNames.set(t,e.normalizedNames.get(t))}))}initFromObject(e){Object.keys(e).forEach((t=>{let r=e[t];const s=t.toLowerCase();"string"==typeof r&&(r=[r]),r.length>0&&(this.headers.set(s,r),this.maybeSetNormalizedName(t,s))}))}initFromString(e){e.split("\n").forEach((e=>{const t=e.indexOf(":");if(t>0){const r=e.slice(0,t),s=r.toLowerCase(),a=e.slice(t+1).trim();this.maybeSetNormalizedName(r,s),this.headers.has(s)?this.headers.get(s).push(a):this.headers.set(s,[a])}}))}}},69912:(e,t,r)=>{"use strict";r.d(t,{L:()=>a});class s{encodeKey(e){return this.standardEncoding(e)}encodeValue(e){return this.standardEncoding(e)}decodeKey(e){return decodeURIComponent(e)}decodeValue(e){return decodeURIComponent(e)}standardEncoding(e){return encodeURIComponent(e).replace(s.STANDARD_ENCODING_REGEX,((e,t)=>s.STANDARD_ENCODING_REPLACEMENTS[t]??e))}}s.STANDARD_ENCODING_REGEX=/%(\d[a-f0-9])/gi,s.STANDARD_ENCODING_REPLACEMENTS={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};class a{constructor(e={},t={}){this.map=new Map,this.encoder=t.encoder??new s,"string"==typeof e?this.initFromString(e):this.initFromObject(e)}has(e){return this.map.has(e)}get(e){const t=this.map.get(e);return t?.[0]??null}getAll(e){return this.map.get(e)??null}keys(){return Array.from(this.map.keys())}append(e,t){return this.clone({param:e,value:t,op:0})}appendAll(e){const t=[];return Object.keys(e).forEach((r=>{const s=e[r];Array.isArray(s)?s.forEach((e=>{t.push({param:r,value:e,op:0})})):t.push({param:r,value:s,op:0})})),this.clone(t)}set(e,t){return this.clone({param:e,value:t,op:1})}delete(e,t){return this.clone({param:e,value:t,op:2})}toString(){return this.keys().map((e=>{const t=this.encoder.encodeKey(e);return this.map.get(e).map((e=>t+"="+this.encoder.encodeValue(e))).join("&")})).filter((e=>""!==e)).join("&")}clone(e){const t=new a({},{encoder:this.encoder});return t.initFromOther(this),t.applyUpdates(Array.isArray(e)?e:[e]),t}initFromOther(e){e.keys().forEach((t=>this.map.set(t,[...e.map.get(t)])))}initFromObject(e){Object.keys(e).forEach((t=>{const r=e[t],s=a.isValueArray(r)?r.map(a.valueToString):[a.valueToString(r)];this.map.set(t,s)}))}initFromString(e){const{encoder:t}=this;if(e.length>0){e.replace(/^\?/,"").split("&").forEach((e=>{const r=e.indexOf("="),[s,a]=-1===r?[t.decodeKey(e),""]:[t.decodeKey(e.slice(0,r)),t.decodeValue(e.slice(r+1))],n=this.map.get(s)??[];n.push(a),this.map.set(s,n)}))}}applyUpdates(e){e.forEach((e=>{switch(e.op){case 0:case 1:{const t=(0===e.op?this.map.get(e.param):void 0)??[];t.push(a.valueToString(e.value)),this.map.set(e.param,t);break}case 2:if(void 0===e.value){this.map.delete(e.param);break}{const t=this.map.get(e.param)??[],r=t.indexOf(a.valueToString(e.value));-1!==r&&t.splice(r,1),t.length>0?this.map.set(e.param,t):this.map.delete(e.param)}}}))}static valueToString(e){return`${e}`}static isValueArray(e){return Array.isArray(e)}}},4043:(e,t,r)=>{"use strict";r.d(t,{a:()=>n});var s=r(4607),a=r(69912);class n{constructor(e,t,r,i){this.body=null,this.headers=new s.W,this.withCredentials=!1,this.timeout=void 0,this.responseType="json",this.params=new a.L({}),this.url=t,this.method=e,n.mightHaveBody(this.method)&&(this.body=r??null),i&&(this.withCredentials=Boolean(i.withCredentials),i.responseType&&(this.responseType=i.responseType),i.headers&&(this.headers=this.getHeadersFromOptions(i.headers)),i.params&&(this.params=this.getParamsFromOptions(i.params)),i.timeout&&i.timeout>0&&(this.timeout=i.timeout),i.mode&&(this.mode=i.mode)),this.urlWithParams=this.initUrlWithParams()}serializeBody(){return null===this.body?null:n.isArrayBuffer(this.body)||"string"==typeof this.body?this.body:this.body instanceof a.L?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||n.isArrayBuffer(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof a.L?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(e={}){const t=e.method??this.method,r=e.url??this.url,s=e.responseType??this.responseType,a=void 0!==e.body?e.body:this.body,i=void 0!==e.withCredentials?e.withCredentials:this.withCredentials,o=void 0!==e.timeout?e.timeout:this.timeout,c=e.mode??this.mode;let u=e.headers?this.getHeadersFromOptions(e.headers):this.headers,d=e.params?this.getParamsFromOptions(e.params):this.params;const l=e.setHeaders;l&&(u=Object.keys(l).reduce(((e,t)=>e.set(t,l[t])),u));const p=e.setParams;return p&&(d=Object.keys(p).reduce(((e,t)=>e.set(t,p[t])),d)),new n(t,r,a,{params:d,headers:u,responseType:s,withCredentials:i,timeout:o,mode:c})}getHeadersFromOptions(e){return e instanceof s.W?e:new s.W(e)}getParamsFromOptions(e){return e instanceof a.L?e:new a.L(e)}initUrlWithParams(){const e=this.params.toString();if(0===e.length)return this.url;const t=this.url.indexOf("?"),r=-1===t?"?":t<this.url.length-1?"&":"";return this.url+r+e}static mightHaveBody(e){switch(e){case"DELETE":case"GET":case"HEAD":case"OPTIONS":return!1;default:return!0}}static isArrayBuffer(e){return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer}}},12964:(e,t,r)=>{"use strict";r.d(t,{Z:()=>d});var s=r(87631),a=r(89685),n=r(54066),i=r(4607),o=r(25994);async function c(e){const t=e.getReader();let r=new Uint8Array(0),s=await t.read();for(;!s.done;){const e=new Uint8Array(r.byteLength+s.value.byteLength);e.set(r,0),e.set(s.value,r.byteLength),r=e,s=await t.read()}return r}class u{constructor(e){this.bytesRead=0,this.data=e}pull(e){const{bytesRead:t,data:r}=this;if(t>=r.byteLength)return void e.close();const s=Math.min(r.byteLength-t,e.desiredSize??1/0);if(s>0){const a=new Uint8Array(r,t,s);e.enqueue(a),this.bytesRead+=s}t>=r.byteLength&&e.close()}}class d{constructor(e={},t=o.W.Ok,r="OK"){this.headers=e.headers instanceof i.W?e.headers:new i.W(e.headers),this.status=void 0!==e.status?e.status:t,this.statusText=e.statusText??r,this.url=e.url??null,this.ok=this.status>=200&&this.status<300,this.body=void 0!==e.body?e.body:null}clone(e={}){return new d({body:void 0!==e.body?e.body:null===this.body?null:this.body instanceof s.ReadableStream?this.body.tee()[0]:this.body,headers:e.headers??this.headers,status:void 0!==e.status?e.status:this.status,statusText:e.statusText??this.statusText,url:e.url??this.url??void 0})}async arrayBuffer(){if(null===this.body)throw new Error("Empty response body");if("object"==typeof this.body&&"ReadableStream"===this.body.constructor.name){return(await c(this.body)).buffer}if(!(this.body instanceof ArrayBuffer))throw new Error("Unexpected body type, not an ArrayBuffer");return this.body}async text(){if(null===this.body)throw new Error("Empty response body");if("object"==typeof this.body&&"ReadableStream"===this.body.constructor.name){const e=await c(this.body);return(0,a.v)(e.buffer)}if("string"!=typeof this.body)throw new Error("Unexpected body type, not a string");return this.body}async json(e){if(null===this.body)throw new Error("Empty response body");if("object"==typeof this.body&&"ReadableStream"===this.body.constructor.name){const t=await c(this.body),r=(0,a.v)(t.buffer);try{const t=JSON.parse(r);return e.decode(t)}catch(e){throw new Error("Failed to parse response body JSON")}}if(this.body instanceof ArrayBuffer||"string"==typeof this.body)throw new Error("Unexpected body type");return e.decode(this.body)}bodyStream(){if(null===this.body)throw new Error("Empty response body");if("object"==typeof this.body&&"ReadableStream"===this.body.constructor.name)return this.body;if("string"==typeof this.body)return new s.ReadableStream(new u((0,n.u)(this.body)));if(this.body instanceof ArrayBuffer)return new s.ReadableStream(new u(this.body));const e=JSON.stringify(this.body);return new s.ReadableStream(new u((0,n.u)(e)))}}},25994:(e,t,r)=>{"use strict";var s;r.d(t,{W:()=>s}),function(e){e[e.Continue=100]="Continue",e[e.SwitchingProtocols=101]="SwitchingProtocols",e[e.Processing=102]="Processing",e[e.EarlyHints=103]="EarlyHints",e[e.Ok=200]="Ok",e[e.Created=201]="Created",e[e.Accepted=202]="Accepted",e[e.NonAuthoritativeInformation=203]="NonAuthoritativeInformation",e[e.NoContent=204]="NoContent",e[e.ResetContent=205]="ResetContent",e[e.PartialContent=206]="PartialContent",e[e.MultiStatus=207]="MultiStatus",e[e.AlreadyReported=208]="AlreadyReported",e[e.ImUsed=226]="ImUsed",e[e.MultipleChoices=300]="MultipleChoices",e[e.MovedPermanently=301]="MovedPermanently",e[e.Found=302]="Found",e[e.SeeOther=303]="SeeOther",e[e.NotModified=304]="NotModified",e[e.UseProxy=305]="UseProxy",e[e.Unused=306]="Unused",e[e.TemporaryRedirect=307]="TemporaryRedirect",e[e.PermanentRedirect=308]="PermanentRedirect",e[e.BadRequest=400]="BadRequest",e[e.Unauthorized=401]="Unauthorized",e[e.PaymentRequired=402]="PaymentRequired",e[e.Forbidden=403]="Forbidden",e[e.NotFound=404]="NotFound",e[e.MethodNotAllowed=405]="MethodNotAllowed",e[e.NotAcceptable=406]="NotAcceptable",e[e.ProxyAuthenticationRequired=407]="ProxyAuthenticationRequired",e[e.RequestTimeout=408]="RequestTimeout",e[e.Conflict=409]="Conflict",e[e.Gone=410]="Gone",e[e.LengthRequired=411]="LengthRequired",e[e.PreconditionFailed=412]="PreconditionFailed",e[e.PayloadTooLarge=413]="PayloadTooLarge",e[e.UriTooLong=414]="UriTooLong",e[e.UnsupportedMediaType=415]="UnsupportedMediaType",e[e.RangeNotSatisfiable=416]="RangeNotSatisfiable",e[e.ExpectationFailed=417]="ExpectationFailed",e[e.ImATeapot=418]="ImATeapot",e[e.MisdirectedRequest=421]="MisdirectedRequest",e[e.UnprocessableEntity=422]="UnprocessableEntity",e[e.Locked=423]="Locked",e[e.FailedDependency=424]="FailedDependency",e[e.TooEarly=425]="TooEarly",e[e.UpgradeRequired=426]="UpgradeRequired",e[e.PreconditionRequired=428]="PreconditionRequired",e[e.TooManyRequests=429]="TooManyRequests",e[e.RequestHeaderFieldsTooLarge=431]="RequestHeaderFieldsTooLarge",e[e.UnavailableForLegalReasons=451]="UnavailableForLegalReasons",e[e.InternalServerError=500]="InternalServerError",e[e.NotImplemented=501]="NotImplemented",e[e.BadGateway=502]="BadGateway",e[e.ServiceUnavailable=503]="ServiceUnavailable",e[e.GatewayTimeout=504]="GatewayTimeout",e[e.HttpVersionNotSupported=505]="HttpVersionNotSupported",e[e.VariantAlsoNegotiates=506]="VariantAlsoNegotiates",e[e.InsufficientStorage=507]="InsufficientStorage",e[e.LoopDetected=508]="LoopDetected",e[e.NotExtended=510]="NotExtended",e[e.NetworkAuthenticationRequired=511]="NetworkAuthenticationRequired"}(s||(s={}))},73155:(e,t,r)=>{"use strict";r.d(t,{R:()=>a,a:()=>n});var s=r(96168);class a extends((0,s.Hu)("BadStatus","The HTTP response has a non-successful status code (not 2XX)")){constructor(e){super(),this.response=e}}class n extends((0,s.Hu)("FetchFailedError","Something happened while communicating to the server")){}},96168:(e,t,r)=>{"use strict";r.d(t,{As:()=>a,BU:()=>n,Hu:()=>s});const s=(e,t)=>class extends Error{constructor(){super(t),this.tag=e}};function a(e,t){return t.includes(e.tag)}const n=e=>e.tag},20195:(e,t,r)=>{"use strict";function s(e){if(e instanceof Error)throw e;if("string"==typeof e)throw new Error(e);throw new Error(e.tag)}r.d(t,{j:()=>s})},61475:(e,t,r)=>{"use strict";r.r(t),r.d(t,{FunctionalError:()=>s.Hu,assertUnreachable:()=>n.U,concatMapFailure:()=>c.Tc,concatMapSuccess:()=>c.Gx,concatMatchResult:()=>c.RW,createMatchable:()=>i.H6,failure:()=>o.Rn,getBrander:()=>u.zq,getFailure:()=>o.Yv,getSuccess:()=>o.db,hasProperty:()=>u.l$,isFailure:()=>o.hx,isFunctionalErrorOfType:()=>s.As,isMatchable:()=>i.cw,isResult:()=>o.AZ,isSuccess:()=>o.d6,mapFailure:()=>o.SN,mapFailureObservable:()=>c.DZ,mapResultObservable:()=>c.vg,mapSuccess:()=>o.ty,mapSuccessObservable:()=>c.Qn,mapSuccessResultObservable:()=>c.lk,match:()=>i.EQ,matchResultObservable:()=>c.nb,panic:()=>a.j,safeCast:()=>u.Ay,success:()=>o.Vp,switchMapFailure:()=>c.pr,switchMapSuccess:()=>c.CP,switchMatchResult:()=>c.bM,toFunctionalErrorCode:()=>s.BU});var s=r(96168),a=r(20195),n=r(95087),i=r(18533),o=r(87279),c=r(48844),u=r(28489)},95087:(e,t,r)=>{"use strict";function s(e,t){throw new Error(t??`Unreachable code detected (${e})`)}r.d(t,{U:()=>s})},18533:(e,t,r)=>{"use strict";r.d(t,{EQ:()=>a,H6:()=>s,cw:()=>n});const s=(e,t)=>({tag:e,...t}),a=(e,t)=>{const r=e.tag,s=r in t?t[r]:null;if(!s)throw new Error("Unmatchable case");return s(e)},n=(e,...t)=>{if("object"!=typeof e||!e)return!1;return"tag"in e&&t.includes(e.tag)}},48844:(e,t,r)=>{"use strict";r.d(t,{CP:()=>g,DZ:()=>d,Gx:()=>h,Qn:()=>u,RW:()=>y,Tc:()=>m,bM:()=>f,lk:()=>p,nb:()=>c,pr:()=>v,vg:()=>l});var s=r(87065),a=r(34987),n=r(43978),i=r(87279),o=r(18533);function c(e){return t=>t.pipe((0,s.U)((t=>(0,o.EQ)(t,{success:({data:t})=>e.success(t),failure:({error:t})=>e.failure(t)}))))}function u(e){return t=>t.pipe((0,s.U)((t=>(0,i.hx)(t)?t:(0,i.Vp)(e(t.data)))))}function d(e){return t=>t.pipe((0,s.U)((t=>(0,i.d6)(t)?t:(0,i.Rn)(e(t.error)))))}function l(e,t){return r=>r.pipe((0,s.U)((r=>(0,i.hx)(r)?t?t(r.error):r:e(r.data))))}function p(e){return t=>t.pipe((0,s.U)((t=>(0,i.hx)(t)?t:e(t.data))))}function h(e){return t=>t.pipe((0,a.b)((async t=>(0,i.hx)(t)?t:(0,i.Vp)(await e(t.data)))))}function m(e){return t=>t.pipe((0,a.b)((async t=>(0,i.d6)(t)?t:(0,i.Rn)(await e(t.error)))))}function y(e){return t=>t.pipe((0,a.b)((t=>(0,i.f2)(t,e))))}function g(e){return t=>t.pipe((0,n.w)((async t=>(0,i.hx)(t)?t:(0,i.Vp)(await e(t.data)))))}function v(e){return t=>t.pipe((0,n.w)((async t=>(0,i.d6)(t)?t:(0,i.Rn)(await e(t.error)))))}function f(e){return t=>t.pipe((0,n.w)((t=>(0,i.f2)(t,e))))}},87279:(e,t,r)=>{"use strict";r.d(t,{Rn:()=>o,Yv:()=>h,db:()=>p,hx:()=>d,AZ:()=>l,d6:()=>u,SN:()=>y,ty:()=>m,f2:()=>c,Vp:()=>i});var s=r(18533);const a="success",n="failure",i=e=>(0,s.H6)("success",{data:e}),o=e=>(0,s.H6)("failure",{error:e}),c=(e,t)=>(0,s.EQ)(e,{success:({data:e})=>t.success(e),failure:({error:e})=>t.failure(e)}),u=e=>e.tag===a,d=e=>e.tag===n,l=e=>(0,s.cw)(e,a,n),p=e=>e.data,h=e=>e.error,m=(e,t)=>d(e)?e:i(t(e.data)),y=(e,t)=>u(e)?e:o(t(e.error))},28489:(e,t,r)=>{"use strict";r.d(t,{Ay:()=>a,l$:()=>n,zq:()=>s});const s=e=>t=>Object.assign(t,{brand:e}),a=e=>e;function n(e,t){return t in e}},77837:(e,t,r)=>{"use strict";r.d(t,{u:()=>i,y:()=>n});var s=r(64839),a=r(24982);const n={confirmActivation:{method:"POST",path:"accountrecovery/ConfirmActivation",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},deactivate:{method:"POST",path:"accountrecovery/Deactivate",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},getEncryptedVaultKey:{method:"POST",path:"accountrecovery/GetEncryptedVaultKey",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.APP,version:a.W.V1},getStatus:{method:"POST",path:"accountrecovery/GetStatus",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.APP,version:a.W.V1},requestActivation:{method:"POST",path:"accountrecovery/RequestActivation",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1}};class i{constructor(e){this.executorFactory=e}confirmActivation(e,t){return this.executorFactory.createExecutor(n.confirmActivation).executeRequest({credentials:e,body:t})}deactivate(e,t){return this.executorFactory.createExecutor(n.deactivate).executeRequest({credentials:e,body:t})}getEncryptedVaultKey(e){return this.executorFactory.createExecutor(n.getEncryptedVaultKey).executeRequest({body:e})}getStatus(e){return this.executorFactory.createExecutor(n.getStatus).executeRequest({body:e})}requestActivation(e,t){return this.executorFactory.createExecutor(n.requestActivation).executeRequest({credentials:e,body:t})}}},33027:(e,t,r)=>{"use strict";r.d(t,{V:()=>i,k:()=>n});var s=r(64839),a=r(24982);const n={completeDeviceRegistrationWithAuthTicket:{method:"POST",path:"authentication/CompleteDeviceRegistrationWithAuthTicket",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.APP,version:a.W.V1},completeDeviceRegistrationWithToken:{method:"POST",path:"authentication/CompleteDeviceRegistrationWithToken",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.APP,version:a.W.V1},completeDeviceRegistrationWithTotp:{method:"POST",path:"authentication/CompleteDeviceRegistrationWithTOTP",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.APP,version:a.W.V1},completeExtraDeviceRegistrationWithToken:{method:"POST",path:"authentication/CompleteExtraDeviceRegistrationWithToken",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.APP,version:a.W.V1},completeLoginWithAuthTicket:{method:"POST",path:"authentication/CompleteLoginWithAuthTicket",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.APP,version:a.W.V1},completeLoginWithTotp:{method:"POST",path:"authentication/CompleteLoginWithTOTP",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.APP,version:a.W.V1},completeRememberMeOpenSession:{method:"POST",path:"authentication/CompleteRememberMeOpenSession",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.SESSION,version:a.W.V1},completeRememberMeRegistration:{method:"POST",path:"authentication/CompleteRememberMeRegistration",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},completeTotpActivation:{method:"POST",path:"authentication/CompleteTOTPActivation",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},completeWebAuthnAuthenticatorRegistration:{method:"POST",path:"authentication/CompleteWebAuthnAuthenticatorRegistration",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},createSamlSession:{method:"POST",path:"authentication/CreateSAMLSession",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.APP,version:a.W.V1},createTokenExtAuth:{method:"POST",path:"authentication/CreateTokenExtAuth",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},deactivateRememberMe:{method:"POST",path:"authentication/DeactivateRememberMe",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},deactivateTotp:{method:"POST",path:"authentication/DeactivateTOTP",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},deactivateU2FDevice:{method:"POST",path:"authentication/DeactivateU2FDevice",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},deactivateWebAuthnAuthenticator:{method:"POST",path:"authentication/DeactivateWebAuthnAuthenticator",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},destroySamlSession:{method:"POST",path:"authentication/DestroySAMLSession",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.BACK_OFFICE,version:a.W.V1},get2FaStatus:{method:"POST",path:"authentication/Get2FAStatus",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},get2FaStatusUnauthenticated:{method:"POST",path:"authentication/Get2FAStatusUnauthenticated",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.APP,version:a.W.V1},getAuthenticationMethodsForDevice:{method:"POST",path:"authentication/GetAuthenticationMethodsForDevice",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.APP,version:a.W.V1},getAuthenticationMethodsForLogin:{method:"POST",path:"authentication/GetAuthenticationMethodsForLogin",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.APP,version:a.W.V1},getAvailableWebAuthnAuthenticators:{method:"POST",path:"authentication/GetAvailableWebAuthnAuthenticators",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.SESSION,version:a.W.V1},getMasterPasswordCipheringKey:{method:"POST",path:"authentication/GetMasterPasswordCipheringKey",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.SESSION,version:a.W.V1},getRecoveryPhoneNumber:{method:"POST",path:"authentication/GetRecoveryPhoneNumber",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},getTokensList:{method:"GET",path:"authentication/GetTokens",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.APP,version:a.W.V1},getTokens:{method:"POST",path:"authentication/GetTokens",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.APP,version:a.W.V1},getU2FDevices:{method:"POST",path:"authentication/GetU2FDevices",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},getUnauthorizedProfiles:{method:"POST",path:"authentication/GetUnauthorizedProfiles",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.APP,version:a.W.V1},getUserSsoInfo:{method:"POST",path:"authentication/GetUserSSOInfo",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.TEAM_DEVICE,version:a.W.V1},getWebAuthnAuthenticators:{method:"POST",path:"authentication/GetWebAuthnAuthenticators",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},initRememberMasterPassword:{method:"POST",path:"authentication/InitRememberMasterPassword",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},performDashlaneAuthenticatorVerification:{method:"POST",path:"authentication/PerformDashlaneAuthenticatorVerification",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.APP,version:a.W.V1},performDuoPushVerification:{method:"POST",path:"authentication/PerformDuoPushVerification",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.APP,version:a.W.V1},performEmailTokenVerification:{method:"POST",path:"authentication/PerformEmailTokenVerification",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.APP,version:a.W.V1},performExtraDeviceVerification:{method:"POST",path:"authentication/PerformExtraDeviceVerification",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.APP,version:a.W.V1},performSsoVerification:{method:"POST",path:"authentication/PerformSsoVerification",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.APP,version:a.W.V1},performTotpVerification:{method:"POST",path:"authentication/PerformTotpVerification",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.APP,version:a.W.V1},performU2FVerification:{method:"POST",path:"authentication/PerformU2FVerification",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.APP,version:a.W.V1},renameWebAuthnAuthenticator:{method:"POST",path:"authentication/RenameWebAuthnAuthenticator",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},requestDeviceRegistration:{method:"POST",path:"authentication/RequestDeviceRegistration",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.APP,version:a.W.V1},requestEmailTokenVerification:{method:"POST",path:"authentication/RequestEmailTokenVerification",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.APP,version:a.W.V1},requestExtraDeviceRegistration:{method:"POST",path:"authentication/RequestExtraDeviceRegistration",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},requestLogin:{method:"POST",path:"authentication/RequestLogin",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.APP,version:a.W.V1},requestPushNotificationToken:{method:"POST",path:"authentication/RequestPushNotificationToken",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},requestTotpActivation:{method:"POST",path:"authentication/RequestTOTPActivation",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},requestWebauthnOpenSession:{method:"POST",path:"authentication/RequestWebauthnOpenSession",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.SESSION,version:a.W.V1},requestWebauthnRegistration:{method:"POST",path:"authentication/RequestWebauthnRegistration",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},resetBlockedToken:{method:"POST",path:"authentication/ResetBlockedToken",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.APP,version:a.W.V1},updateRecoveryPhoneNumber:{method:"POST",path:"authentication/UpdateRecoveryPhoneNumber",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1}};class i{constructor(e){this.executorFactory=e}completeDeviceRegistrationWithAuthTicket(e){return this.executorFactory.createExecutor(n.completeDeviceRegistrationWithAuthTicket).executeRequest({body:e})}completeDeviceRegistrationWithToken(e){return this.executorFactory.createExecutor(n.completeDeviceRegistrationWithToken).executeRequest({body:e})}completeDeviceRegistrationWithTotp(e){return this.executorFactory.createExecutor(n.completeDeviceRegistrationWithTotp).executeRequest({body:e})}completeExtraDeviceRegistrationWithToken(e){return this.executorFactory.createExecutor(n.completeExtraDeviceRegistrationWithToken).executeRequest({body:e})}completeLoginWithAuthTicket(e){return this.executorFactory.createExecutor(n.completeLoginWithAuthTicket).executeRequest({body:e})}completeLoginWithTotp(e){return this.executorFactory.createExecutor(n.completeLoginWithTotp).executeRequest({body:e})}completeRememberMeOpenSession(e,t){return this.executorFactory.createExecutor(n.completeRememberMeOpenSession).executeRequest({credentials:e,body:t})}completeRememberMeRegistration(e,t){return this.executorFactory.createExecutor(n.completeRememberMeRegistration).executeRequest({credentials:e,body:t})}completeTotpActivation(e,t){return this.executorFactory.createExecutor(n.completeTotpActivation).executeRequest({credentials:e,body:t})}completeWebAuthnAuthenticatorRegistration(e,t){return this.executorFactory.createExecutor(n.completeWebAuthnAuthenticatorRegistration).executeRequest({credentials:e,body:t})}createSamlSession(e){return this.executorFactory.createExecutor(n.createSamlSession).executeRequest({body:e})}createTokenExtAuth(e){return this.executorFactory.createExecutor(n.createTokenExtAuth).executeRequest({credentials:e})}deactivateRememberMe(e,t){return this.executorFactory.createExecutor(n.deactivateRememberMe).executeRequest({credentials:e,body:t})}deactivateTotp(e,t){return this.executorFactory.createExecutor(n.deactivateTotp).executeRequest({credentials:e,body:t})}deactivateU2FDevice(e,t){return this.executorFactory.createExecutor(n.deactivateU2FDevice).executeRequest({credentials:e,body:t})}deactivateWebAuthnAuthenticator(e,t){return this.executorFactory.createExecutor(n.deactivateWebAuthnAuthenticator).executeRequest({credentials:e,body:t})}destroySamlSession(){return this.executorFactory.createExecutor(n.destroySamlSession).executeRequest({})}get2FaStatus(e){return this.executorFactory.createExecutor(n.get2FaStatus).executeRequest({credentials:e})}get2FaStatusUnauthenticated(e){return this.executorFactory.createExecutor(n.get2FaStatusUnauthenticated).executeRequest({body:e})}getAuthenticationMethodsForDevice(e){return this.executorFactory.createExecutor(n.getAuthenticationMethodsForDevice).executeRequest({body:e})}getAuthenticationMethodsForLogin(e){return this.executorFactory.createExecutor(n.getAuthenticationMethodsForLogin).executeRequest({body:e})}getAvailableWebAuthnAuthenticators(e){return this.executorFactory.createExecutor(n.getAvailableWebAuthnAuthenticators).executeRequest({credentials:e})}getMasterPasswordCipheringKey(e){return this.executorFactory.createExecutor(n.getMasterPasswordCipheringKey).executeRequest({credentials:e})}getRecoveryPhoneNumber(e){return this.executorFactory.createExecutor(n.getRecoveryPhoneNumber).executeRequest({credentials:e})}getTokensList(){return this.executorFactory.createExecutor(n.getTokensList).executeRequest({})}getTokens(){return this.executorFactory.createExecutor(n.getTokens).executeRequest({})}getU2FDevices(e){return this.executorFactory.createExecutor(n.getU2FDevices).executeRequest({credentials:e})}getUnauthorizedProfiles(e){return this.executorFactory.createExecutor(n.getUnauthorizedProfiles).executeRequest({body:e})}getUserSsoInfo(e,t){return this.executorFactory.createExecutor(n.getUserSsoInfo).executeRequest({credentials:e,body:t})}getWebAuthnAuthenticators(e){return this.executorFactory.createExecutor(n.getWebAuthnAuthenticators).executeRequest({credentials:e})}initRememberMasterPassword(e,t){return this.executorFactory.createExecutor(n.initRememberMasterPassword).executeRequest({credentials:e,body:t})}performDashlaneAuthenticatorVerification(e){return this.executorFactory.createExecutor(n.performDashlaneAuthenticatorVerification).executeRequest({body:e})}performDuoPushVerification(e){return this.executorFactory.createExecutor(n.performDuoPushVerification).executeRequest({body:e})}performEmailTokenVerification(e){return this.executorFactory.createExecutor(n.performEmailTokenVerification).executeRequest({body:e})}performExtraDeviceVerification(e){return this.executorFactory.createExecutor(n.performExtraDeviceVerification).executeRequest({body:e})}performSsoVerification(e){return this.executorFactory.createExecutor(n.performSsoVerification).executeRequest({body:e})}performTotpVerification(e){return this.executorFactory.createExecutor(n.performTotpVerification).executeRequest({body:e})}performU2FVerification(e){return this.executorFactory.createExecutor(n.performU2FVerification).executeRequest({body:e})}renameWebAuthnAuthenticator(e,t){return this.executorFactory.createExecutor(n.renameWebAuthnAuthenticator).executeRequest({credentials:e,body:t})}requestDeviceRegistration(e){return this.executorFactory.createExecutor(n.requestDeviceRegistration).executeRequest({body:e})}requestEmailTokenVerification(e){return this.executorFactory.createExecutor(n.requestEmailTokenVerification).executeRequest({body:e})}requestExtraDeviceRegistration(e,t){return this.executorFactory.createExecutor(n.requestExtraDeviceRegistration).executeRequest({credentials:e,body:t})}requestLogin(e){return this.executorFactory.createExecutor(n.requestLogin).executeRequest({body:e})}requestPushNotificationToken(e){return this.executorFactory.createExecutor(n.requestPushNotificationToken).executeRequest({credentials:e})}requestTotpActivation(e,t){return this.executorFactory.createExecutor(n.requestTotpActivation).executeRequest({credentials:e,body:t})}requestWebauthnOpenSession(e){return this.executorFactory.createExecutor(n.requestWebauthnOpenSession).executeRequest({credentials:e})}requestWebauthnRegistration(e){return this.executorFactory.createExecutor(n.requestWebauthnRegistration).executeRequest({credentials:e})}resetBlockedToken(e){return this.executorFactory.createExecutor(n.resetBlockedToken).executeRequest({body:e})}updateRecoveryPhoneNumber(e,t){return this.executorFactory.createExecutor(n.updateRecoveryPhoneNumber).executeRequest({credentials:e,body:t})}}},9536:(e,t,r)=>{"use strict";r.d(t,{D:()=>i,T:()=>n});var s=r(64839),a=r(24982);const n={confirmRegistration:{method:"POST",path:"darkwebmonitoring/ConfirmRegistration",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.APP,version:a.W.V1},deregisterEmail:{method:"POST",path:"darkwebmonitoring/DeregisterEmail",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},listLeaks:{method:"POST",path:"darkwebmonitoring/ListLeaks",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},listRegistrations:{method:"POST",path:"darkwebmonitoring/ListRegistrations",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},registerEmail:{method:"POST",path:"darkwebmonitoring/RegisterEmail",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1}};class i{constructor(e){this.executorFactory=e}confirmRegistration(e){return this.executorFactory.createExecutor(n.confirmRegistration).executeRequest({body:e})}deregisterEmail(e,t){return this.executorFactory.createExecutor(n.deregisterEmail).executeRequest({credentials:e,body:t})}listLeaks(e,t){return this.executorFactory.createExecutor(n.listLeaks).executeRequest({credentials:e,body:t})}listRegistrations(e){return this.executorFactory.createExecutor(n.listRegistrations).executeRequest({credentials:e})}registerEmail(e,t){return this.executorFactory.createExecutor(n.registerEmail).executeRequest({credentials:e,body:t})}}},69865:(e,t,r)=>{"use strict";r.d(t,{A:()=>i,Z:()=>n});var s=r(64839),a=r(24982);const n={getAndEvaluateForUser:{method:"POST",path:"features/GetAndEvaluateForUser",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},listAvailableFeatureFlips:{method:"POST",path:"features/ListAvailableFeatureFlips",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.APP,version:a.W.V1}};class i{constructor(e){this.executorFactory=e}getAndEvaluateForUser(e,t){return this.executorFactory.createExecutor(n.getAndEvaluateForUser).executeRequest({credentials:e,body:t})}listAvailableFeatureFlips(){return this.executorFactory.createExecutor(n.listAvailableFeatureFlips).executeRequest({})}}},62361:(e,t,r)=>{"use strict";r.d(t,{$:()=>i,_:()=>n});var s=r(64839),a=r(24982);const n={getFileMeta:{method:"POST",path:"file/GetFileMeta",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},updatedFile:{method:"POST",path:"file/UpdatedFile",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.APP,version:a.W.V1}};class i{constructor(e){this.executorFactory=e}getFileMeta(e,t){return this.executorFactory.createExecutor(n.getFileMeta).executeRequest({credentials:e,body:t})}updatedFile(e){return this.executorFactory.createExecutor(n.updatedFile).executeRequest({body:e})}}},59091:(e,t,r)=>{"use strict";r.d(t,{H:()=>i,l:()=>n});var s=r(64839),a=r(24982);const n={accessibleMobileOffers:{method:"POST",path:"payments/AccessibleMobileOffers",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},getAccessibleStoreOffers:{method:"POST",path:"payments/GetAccessibleStoreOffers",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},getAccessibleWebOffers:{method:"POST",path:"payments/GetAccessibleWebOffers",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.APP,version:a.W.V1},getCustomerInvoice:{method:"POST",path:"payments/GetCustomerInvoice",requestAcceptHeader:"application/pdf",responseType:"arraybuffer",authType:s.d.USER_DEVICE,version:a.W.V1},getDefaultWebOffers:{method:"POST",path:"payments/GetDefaultWebOffers",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.APP,version:a.W.V1},getExpectedTaxInformation:{method:"POST",path:"payments/GetExpectedTaxInformation",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.APP,version:a.W.V1},getProcessOutKeys:{method:"POST",path:"payments/GetProcessOutKeys",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.NONE,version:a.W.V1},grantFullRefundAndCancelSubscription:{method:"POST",path:"payments/GrantFullRefundAndCancelSubscription",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},listInvoices:{method:"POST",path:"payments/ListInvoices",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1}};class i{constructor(e){this.executorFactory=e}accessibleMobileOffers(e,t){return this.executorFactory.createExecutor(n.accessibleMobileOffers).executeRequest({credentials:e,body:t})}getAccessibleStoreOffers(e,t){return this.executorFactory.createExecutor(n.getAccessibleStoreOffers).executeRequest({credentials:e,body:t})}getAccessibleWebOffers(e){return this.executorFactory.createExecutor(n.getAccessibleWebOffers).executeRequest({body:e})}getCustomerInvoice(e,t){return this.executorFactory.createExecutor(n.getCustomerInvoice).executeRequest({credentials:e,body:t})}getDefaultWebOffers(e){return this.executorFactory.createExecutor(n.getDefaultWebOffers).executeRequest({body:e})}getExpectedTaxInformation(e){return this.executorFactory.createExecutor(n.getExpectedTaxInformation).executeRequest({body:e})}getProcessOutKeys(){return this.executorFactory.createExecutor(n.getProcessOutKeys).executeRequest({})}grantFullRefundAndCancelSubscription(e,t){return this.executorFactory.createExecutor(n.grantFullRefundAndCancelSubscription).executeRequest({credentials:e,body:t})}listInvoices(e){return this.executorFactory.createExecutor(n.listInvoices).executeRequest({credentials:e})}}},52839:(e,t,r)=>{"use strict";r.d(t,{D:()=>n,J:()=>i});var s=r(64839),a=r(24982);const n={getHashes:{method:"POST",path:"pwleak/GetHashes",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.APP,version:a.W.V1},getLastUpdate:{method:"POST",path:"pwleak/GetLastUpdate",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.APP,version:a.W.V1}};class i{constructor(e){this.executorFactory=e}getHashes(e){return this.executorFactory.createExecutor(n.getHashes).executeRequest({body:e})}getLastUpdate(){return this.executorFactory.createExecutor(n.getLastUpdate).executeRequest({})}}},7181:(e,t,r)=>{"use strict";r.d(t,{V:()=>i,t:()=>n});var s=r(64839),a=r(24982);const n={getKeyExchangeTransferInfo:{method:"POST",path:"secretTransfer/GetKeyExchangeTransferInfo",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},requestTransfer:{method:"POST",path:"secretTransfer/RequestTransfer",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.APP,version:a.W.V1},startReceiverKeyExchange:{method:"POST",path:"secretTransfer/StartReceiverKeyExchange",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.APP,version:a.W.V1}};class i{constructor(e){this.executorFactory=e}getKeyExchangeTransferInfo(e){return this.executorFactory.createExecutor(n.getKeyExchangeTransferInfo).executeRequest({credentials:e})}requestTransfer(e){return this.executorFactory.createExecutor(n.requestTransfer).executeRequest({body:e})}startReceiverKeyExchange(e){return this.executorFactory.createExecutor(n.startReceiverKeyExchange).executeRequest({body:e})}}},55127:(e,t,r)=>{"use strict";r.d(t,{T:()=>n,b:()=>i});var s=r(64839),a=r(24982);const n={acceptCollection:{method:"POST",path:"sharing-userdevice/AcceptCollection",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},acceptItemGroup:{method:"POST",path:"sharing-userdevice/AcceptItemGroup",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},acceptUserGroup:{method:"POST",path:"sharing-userdevice/AcceptUserGroup",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},addItemGroupsToCollection:{method:"POST",path:"sharing-userdevice/AddItemGroupsToCollection",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},addItems:{method:"POST",path:"sharing-userdevice/AddItems",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},createCollection:{method:"POST",path:"sharing-userdevice/CreateCollection",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},createItemGroup:{method:"POST",path:"sharing-userdevice/CreateItemGroup",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},createTeamAdminsUserGroup:{method:"POST",path:"sharing-userdevice/CreateTeamAdminsUserGroup",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},createUserGroup:{method:"POST",path:"sharing-userdevice/CreateUserGroup",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},createUserGroupsItemGroup:{method:"POST",path:"sharing-userdevice/CreateUserGroupsItemGroup",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},deleteCollection:{method:"POST",path:"sharing-userdevice/DeleteCollection",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},deleteItemGroup:{method:"POST",path:"sharing-userdevice/DeleteItemGroup",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},deleteUserGroup:{method:"POST",path:"sharing-userdevice/DeleteUserGroup",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},postSharingUserdevice:{method:"POST",path:"sharing-userdevice/Get",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},getTeamLogins:{method:"POST",path:"sharing-userdevice/GetTeamLogins",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},getUsersPublicKey:{method:"POST",path:"sharing-userdevice/GetUsersPublicKey",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},inviteCollectionMembers:{method:"POST",path:"sharing-userdevice/InviteCollectionMembers",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},inviteItemGroupMembers:{method:"POST",path:"sharing-userdevice/InviteItemGroupMembers",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},inviteUserGroupUsers:{method:"POST",path:"sharing-userdevice/InviteUserGroupUsers",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},refuseCollection:{method:"POST",path:"sharing-userdevice/RefuseCollection",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},refuseItemGroup:{method:"POST",path:"sharing-userdevice/RefuseItemGroup",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},refuseUserGroup:{method:"POST",path:"sharing-userdevice/RefuseUserGroup",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},removeItemGroupsFromCollection:{method:"POST",path:"sharing-userdevice/RemoveItemGroupsFromCollection",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},removeItems:{method:"POST",path:"sharing-userdevice/RemoveItems",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},renameCollection:{method:"POST",path:"sharing-userdevice/RenameCollection",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},renameUserGroup:{method:"POST",path:"sharing-userdevice/RenameUserGroup",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},resendItemGroupInvites:{method:"POST",path:"sharing-userdevice/ResendItemGroupInvites",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},revokeCollectionMembers:{method:"POST",path:"sharing-userdevice/RevokeCollectionMembers",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},revokeItemGroupMembers:{method:"POST",path:"sharing-userdevice/RevokeItemGroupMembers",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},revokeUserGroupUsers:{method:"POST",path:"sharing-userdevice/RevokeUserGroupUsers",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},updateCollectionMembers:{method:"POST",path:"sharing-userdevice/UpdateCollectionMembers",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},updateItem:{method:"POST",path:"sharing-userdevice/UpdateItem",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},updateItemGroupMembers:{method:"POST",path:"sharing-userdevice/UpdateItemGroupMembers",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},updateUserGroupUsers:{method:"POST",path:"sharing-userdevice/UpdateUserGroupUsers",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1}};class i{constructor(e){this.executorFactory=e}acceptCollection(e,t){return this.executorFactory.createExecutor(n.acceptCollection).executeRequest({credentials:e,body:t})}acceptItemGroup(e,t){return this.executorFactory.createExecutor(n.acceptItemGroup).executeRequest({credentials:e,body:t})}acceptUserGroup(e,t){return this.executorFactory.createExecutor(n.acceptUserGroup).executeRequest({credentials:e,body:t})}addItemGroupsToCollection(e,t){return this.executorFactory.createExecutor(n.addItemGroupsToCollection).executeRequest({credentials:e,body:t})}addItems(e,t){return this.executorFactory.createExecutor(n.addItems).executeRequest({credentials:e,body:t})}createCollection(e,t){return this.executorFactory.createExecutor(n.createCollection).executeRequest({credentials:e,body:t})}createItemGroup(e,t){return this.executorFactory.createExecutor(n.createItemGroup).executeRequest({credentials:e,body:t})}createTeamAdminsUserGroup(e,t){return this.executorFactory.createExecutor(n.createTeamAdminsUserGroup).executeRequest({credentials:e,body:t})}createUserGroup(e,t){return this.executorFactory.createExecutor(n.createUserGroup).executeRequest({credentials:e,body:t})}createUserGroupsItemGroup(e,t){return this.executorFactory.createExecutor(n.createUserGroupsItemGroup).executeRequest({credentials:e,body:t})}deleteCollection(e,t){return this.executorFactory.createExecutor(n.deleteCollection).executeRequest({credentials:e,body:t})}deleteItemGroup(e,t){return this.executorFactory.createExecutor(n.deleteItemGroup).executeRequest({credentials:e,body:t})}deleteUserGroup(e,t){return this.executorFactory.createExecutor(n.deleteUserGroup).executeRequest({credentials:e,body:t})}postSharingUserdevice(e,t){return this.executorFactory.createExecutor(n.postSharingUserdevice).executeRequest({credentials:e,body:t})}getTeamLogins(e){return this.executorFactory.createExecutor(n.getTeamLogins).executeRequest({credentials:e})}getUsersPublicKey(e,t){return this.executorFactory.createExecutor(n.getUsersPublicKey).executeRequest({credentials:e,body:t})}inviteCollectionMembers(e,t){return this.executorFactory.createExecutor(n.inviteCollectionMembers).executeRequest({credentials:e,body:t})}inviteItemGroupMembers(e,t){return this.executorFactory.createExecutor(n.inviteItemGroupMembers).executeRequest({credentials:e,body:t})}inviteUserGroupUsers(e,t){return this.executorFactory.createExecutor(n.inviteUserGroupUsers).executeRequest({credentials:e,body:t})}refuseCollection(e,t){return this.executorFactory.createExecutor(n.refuseCollection).executeRequest({credentials:e,body:t})}refuseItemGroup(e,t){return this.executorFactory.createExecutor(n.refuseItemGroup).executeRequest({credentials:e,body:t})}refuseUserGroup(e,t){return this.executorFactory.createExecutor(n.refuseUserGroup).executeRequest({credentials:e,body:t})}removeItemGroupsFromCollection(e,t){return this.executorFactory.createExecutor(n.removeItemGroupsFromCollection).executeRequest({credentials:e,body:t})}removeItems(e,t){return this.executorFactory.createExecutor(n.removeItems).executeRequest({credentials:e,body:t})}renameCollection(e,t){return this.executorFactory.createExecutor(n.renameCollection).executeRequest({credentials:e,body:t})}renameUserGroup(e,t){return this.executorFactory.createExecutor(n.renameUserGroup).executeRequest({credentials:e,body:t})}resendItemGroupInvites(e,t){return this.executorFactory.createExecutor(n.resendItemGroupInvites).executeRequest({credentials:e,body:t})}revokeCollectionMembers(e,t){return this.executorFactory.createExecutor(n.revokeCollectionMembers).executeRequest({credentials:e,body:t})}revokeItemGroupMembers(e,t){return this.executorFactory.createExecutor(n.revokeItemGroupMembers).executeRequest({credentials:e,body:t})}revokeUserGroupUsers(e,t){return this.executorFactory.createExecutor(n.revokeUserGroupUsers).executeRequest({credentials:e,body:t})}updateCollectionMembers(e,t){return this.executorFactory.createExecutor(n.updateCollectionMembers).executeRequest({credentials:e,body:t})}updateItem(e,t){return this.executorFactory.createExecutor(n.updateItem).executeRequest({credentials:e,body:t})}updateItemGroupMembers(e,t){return this.executorFactory.createExecutor(n.updateItemGroupMembers).executeRequest({credentials:e,body:t})}updateUserGroupUsers(e,t){return this.executorFactory.createExecutor(n.updateUserGroupUsers).executeRequest({credentials:e,body:t})}}},91406:(e,t,r)=>{"use strict";r.d(t,{b:()=>n,p:()=>i});var s=r(64839),a=r(24982);const n={accessibleTeamOffers:{method:"POST",path:"teams/AccessibleTeamOffers",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.APP,version:a.W.V1},activateSsoForUsers:{method:"POST",path:"teams/ActivateSsoForUsers",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},addGroupManager:{method:"POST",path:"teams/AddGroupManager",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},addSeats:{method:"POST",path:"teams/AddSeats",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},addTeamCaptain:{method:"POST",path:"teams/AddTeamCaptain",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},changeTeamKeyTeamSignUpPage:{method:"POST",path:"teams/ChangeTeamKeyTeamSignUpPage",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},changeTierMidCycle:{method:"POST",path:"teams/ChangeTierMidCycle",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},completeDomainsRegistration:{method:"POST",path:"teams/CompleteDomainsRegistration",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},computePlanPricing:{method:"POST",path:"teams/ComputePlanPricing",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},createTeamDeviceAccount:{method:"POST",path:"teams/CreateTeamDeviceAccount",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},createTeamSignUpPage:{method:"POST",path:"teams/CreateTeamSignUpPage",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},deactivateDomain:{method:"POST",path:"teams/DeactivateDomain",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},deactivateSsoForUsers:{method:"POST",path:"teams/DeactivateSsoForUsers",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},deactivateTeamDevice:{method:"POST",path:"teams/DeactivateTeamDevice",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},deleteTeamVat:{method:"POST",path:"teams/DeleteTeamVAT",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},extendFreeTrial:{method:"POST",path:"teams/ExtendFreeTrial",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},getAllMemberDeviceInformation:{method:"POST",path:"teams/GetAllMemberDeviceInformation",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},getAuditLogQueryResults:{method:"POST",path:"teams/GetAuditLogQueryResults",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},getAuditLogs:{method:"POST",path:"teams/GetAuditLogs",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},getDarkWebInsightsReportDetails:{method:"POST",path:"teams/GetDarkWebInsightsReportDetails",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},getDarkWebInsightsSummary:{method:"POST",path:"teams/GetDarkWebInsightsSummary",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},getExpectedTaxInformation:{method:"POST",path:"teams/GetExpectedTaxInformation",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},getMidCycleTierUpgradePrice:{method:"POST",path:"teams/GetMidCycleTierUpgradePrice",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},getRecoveryCodesAsTeamCaptain:{method:"POST",path:"teams/GetRecoveryCodesAsTeamCaptain",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},getTeamDevice:{method:"POST",path:"teams/GetTeamDevice",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},getTeamDeviceEncryptedConfiguration:{method:"POST",path:"teams/GetTeamDeviceEncryptedConfiguration",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},getTeamLastUpdateTs:{method:"POST",path:"teams/GetTeamLastUpdateTs",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},getTeamMembers:{method:"POST",path:"teams/GetTeamMembers",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},getTeamOffers:{method:"POST",path:"teams/GetTeamOffers",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},getTeamReceipts:{method:"POST",path:"teams/GetTeamReceipts",requestAcceptHeader:"application/pdf",responseType:"arraybuffer",authType:s.d.USER_DEVICE,version:a.W.V1},getTeamSignUpPage:{method:"POST",path:"teams/GetTeamSignUpPage",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.APP,version:a.W.V1},getTeamSignUpPageForAdmin:{method:"POST",path:"teams/GetTeamSignUpPageForAdmin",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},getTeamVat:{method:"POST",path:"teams/GetTeamVAT",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},getUserPermissions:{method:"POST",path:"teams/GetUserPermissions",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},invoiceTeamCreate:{method:"POST",path:"teams/InvoiceTeamCreate",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.APP,version:a.W.V1},invoiceTeamUpgrade:{method:"POST",path:"teams/InvoiceTeamUpgrade",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.APP,version:a.W.V1},lastAdSyncDate:{method:"POST",path:"teams/LastADSyncDate",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},listDomains:{method:"POST",path:"teams/ListDomains",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},listTeamDevices:{method:"POST",path:"teams/ListTeamDevices",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},proposeMembers:{method:"POST",path:"teams/ProposeMembers",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},registerFreeTrial:{method:"POST",path:"teams/RegisterFreeTrial",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.APP,version:a.W.V1},registerFreeTrialOptionalFields:{method:"POST",path:"teams/RegisterFreeTrialOptionalFields",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.APP,version:a.W.V1},registerTeamDevice:{method:"POST",path:"teams/RegisterTeamDevice",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},removeGroupManager:{method:"POST",path:"teams/RemoveGroupManager",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},report:{method:"POST",path:"teams/Report",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},reportTeamDeviceError:{method:"POST",path:"teams/ReportTeamDeviceError",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.TEAM_DEVICE,version:a.W.V1},requestDomainRegistration:{method:"POST",path:"teams/RequestDomainRegistration",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},requestTeamInviteToken:{method:"POST",path:"teams/RequestTeamInviteToken",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.APP,version:a.W.V1},startAuditLogsQuery:{method:"POST",path:"teams/StartAuditLogsQuery",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},storeActivityLogs:{method:"POST",path:"teams/StoreActivityLogs",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},storeAuditLogs:{method:"POST",path:"teams/StoreAuditLogs",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},teamStatus:{method:"POST",path:"teams/TeamStatus",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},toggleTeamSignUpPage:{method:"POST",path:"teams/ToggleTeamSignUpPage",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},updateTeamDeviceEncryptedConfiguration:{method:"POST",path:"teams/UpdateTeamDeviceEncryptedConfiguration",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},upsertTeamVat:{method:"POST",path:"teams/UpsertTeamVAT",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1}};class i{constructor(e){this.executorFactory=e}accessibleTeamOffers(e){return this.executorFactory.createExecutor(n.accessibleTeamOffers).executeRequest({body:e})}activateSsoForUsers(e,t){return this.executorFactory.createExecutor(n.activateSsoForUsers).executeRequest({credentials:e,body:t})}addGroupManager(e,t){return this.executorFactory.createExecutor(n.addGroupManager).executeRequest({credentials:e,body:t})}addSeats(e,t){return this.executorFactory.createExecutor(n.addSeats).executeRequest({credentials:e,body:t})}addTeamCaptain(e,t){return this.executorFactory.createExecutor(n.addTeamCaptain).executeRequest({credentials:e,body:t})}changeTeamKeyTeamSignUpPage(e){return this.executorFactory.createExecutor(n.changeTeamKeyTeamSignUpPage).executeRequest({credentials:e})}changeTierMidCycle(e,t){return this.executorFactory.createExecutor(n.changeTierMidCycle).executeRequest({credentials:e,body:t})}completeDomainsRegistration(e){return this.executorFactory.createExecutor(n.completeDomainsRegistration).executeRequest({credentials:e})}computePlanPricing(e,t){return this.executorFactory.createExecutor(n.computePlanPricing).executeRequest({credentials:e,body:t})}createTeamDeviceAccount(e,t){return this.executorFactory.createExecutor(n.createTeamDeviceAccount).executeRequest({credentials:e,body:t})}createTeamSignUpPage(e,t){return this.executorFactory.createExecutor(n.createTeamSignUpPage).executeRequest({credentials:e,body:t})}deactivateDomain(e,t){return this.executorFactory.createExecutor(n.deactivateDomain).executeRequest({credentials:e,body:t})}deactivateSsoForUsers(e,t){return this.executorFactory.createExecutor(n.deactivateSsoForUsers).executeRequest({credentials:e,body:t})}deactivateTeamDevice(e,t){return this.executorFactory.createExecutor(n.deactivateTeamDevice).executeRequest({credentials:e,body:t})}deleteTeamVat(e){return this.executorFactory.createExecutor(n.deleteTeamVat).executeRequest({credentials:e})}extendFreeTrial(e){return this.executorFactory.createExecutor(n.extendFreeTrial).executeRequest({credentials:e})}getAllMemberDeviceInformation(e){return this.executorFactory.createExecutor(n.getAllMemberDeviceInformation).executeRequest({credentials:e})}getAuditLogQueryResults(e,t){return this.executorFactory.createExecutor(n.getAuditLogQueryResults).executeRequest({credentials:e,body:t})}getAuditLogs(e,t){return this.executorFactory.createExecutor(n.getAuditLogs).executeRequest({credentials:e,body:t})}getDarkWebInsightsReportDetails(e,t){return this.executorFactory.createExecutor(n.getDarkWebInsightsReportDetails).executeRequest({credentials:e,body:t})}getDarkWebInsightsSummary(e,t){return this.executorFactory.createExecutor(n.getDarkWebInsightsSummary).executeRequest({credentials:e,body:t})}getExpectedTaxInformation(e,t){return this.executorFactory.createExecutor(n.getExpectedTaxInformation).executeRequest({credentials:e,body:t})}getMidCycleTierUpgradePrice(e,t){return this.executorFactory.createExecutor(n.getMidCycleTierUpgradePrice).executeRequest({credentials:e,body:t})}getRecoveryCodesAsTeamCaptain(e,t){return this.executorFactory.createExecutor(n.getRecoveryCodesAsTeamCaptain).executeRequest({credentials:e,body:t})}getTeamDevice(e,t){return this.executorFactory.createExecutor(n.getTeamDevice).executeRequest({credentials:e,body:t})}getTeamDeviceEncryptedConfiguration(e,t){return this.executorFactory.createExecutor(n.getTeamDeviceEncryptedConfiguration).executeRequest({credentials:e,body:t})}getTeamLastUpdateTs(e,t){return this.executorFactory.createExecutor(n.getTeamLastUpdateTs).executeRequest({credentials:e,body:t})}getTeamMembers(e,t){return this.executorFactory.createExecutor(n.getTeamMembers).executeRequest({credentials:e,body:t})}getTeamOffers(e,t){return this.executorFactory.createExecutor(n.getTeamOffers).executeRequest({credentials:e,body:t})}getTeamReceipts(e,t){return this.executorFactory.createExecutor(n.getTeamReceipts).executeRequest({credentials:e,body:t})}getTeamSignUpPage(e){return this.executorFactory.createExecutor(n.getTeamSignUpPage).executeRequest({body:e})}getTeamSignUpPageForAdmin(e){return this.executorFactory.createExecutor(n.getTeamSignUpPageForAdmin).executeRequest({credentials:e})}getTeamVat(e){return this.executorFactory.createExecutor(n.getTeamVat).executeRequest({credentials:e})}getUserPermissions(e){return this.executorFactory.createExecutor(n.getUserPermissions).executeRequest({credentials:e})}invoiceTeamCreate(e){return this.executorFactory.createExecutor(n.invoiceTeamCreate).executeRequest({body:e})}invoiceTeamUpgrade(e){return this.executorFactory.createExecutor(n.invoiceTeamUpgrade).executeRequest({body:e})}lastAdSyncDate(e){return this.executorFactory.createExecutor(n.lastAdSyncDate).executeRequest({credentials:e})}listDomains(e){return this.executorFactory.createExecutor(n.listDomains).executeRequest({credentials:e})}listTeamDevices(e){return this.executorFactory.createExecutor(n.listTeamDevices).executeRequest({credentials:e})}proposeMembers(e,t){return this.executorFactory.createExecutor(n.proposeMembers).executeRequest({credentials:e,body:t})}registerFreeTrial(e){return this.executorFactory.createExecutor(n.registerFreeTrial).executeRequest({body:e})}registerFreeTrialOptionalFields(e){return this.executorFactory.createExecutor(n.registerFreeTrialOptionalFields).executeRequest({body:e})}registerTeamDevice(e,t){return this.executorFactory.createExecutor(n.registerTeamDevice).executeRequest({credentials:e,body:t})}removeGroupManager(e,t){return this.executorFactory.createExecutor(n.removeGroupManager).executeRequest({credentials:e,body:t})}report(e,t){return this.executorFactory.createExecutor(n.report).executeRequest({credentials:e,body:t})}reportTeamDeviceError(e,t){return this.executorFactory.createExecutor(n.reportTeamDeviceError).executeRequest({credentials:e,body:t})}requestDomainRegistration(e,t){return this.executorFactory.createExecutor(n.requestDomainRegistration).executeRequest({credentials:e,body:t})}requestTeamInviteToken(e){return this.executorFactory.createExecutor(n.requestTeamInviteToken).executeRequest({body:e})}startAuditLogsQuery(e,t){return this.executorFactory.createExecutor(n.startAuditLogsQuery).executeRequest({credentials:e,body:t})}storeActivityLogs(e,t){return this.executorFactory.createExecutor(n.storeActivityLogs).executeRequest({credentials:e,body:t})}storeAuditLogs(e,t){return this.executorFactory.createExecutor(n.storeAuditLogs).executeRequest({credentials:e,body:t})}teamStatus(e){return this.executorFactory.createExecutor(n.teamStatus).executeRequest({credentials:e})}toggleTeamSignUpPage(e,t){return this.executorFactory.createExecutor(n.toggleTeamSignUpPage).executeRequest({credentials:e,body:t})}updateTeamDeviceEncryptedConfiguration(e,t){return this.executorFactory.createExecutor(n.updateTeamDeviceEncryptedConfiguration).executeRequest({credentials:e,body:t})}upsertTeamVat(e,t){return this.executorFactory.createExecutor(n.upsertTeamVat).executeRequest({credentials:e,body:t})}}},73873:(e,t,r)=>{"use strict";r.d(t,{i:()=>n,q:()=>i});var s=r(64839),a=r(24982);const n={getRemoteTimeList:{method:"GET",path:"time/GetRemoteTime",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.NONE,version:a.W.V1},getRemoteTime:{method:"POST",path:"time/GetRemoteTime",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.NONE,version:a.W.V1}};class i{constructor(e){this.executorFactory=e}getRemoteTimeList(e){return this.executorFactory.createExecutor(n.getRemoteTimeList).executeRequest({body:e})}getRemoteTime(e){return this.executorFactory.createExecutor(n.getRemoteTime).executeRequest({body:e})}}},84626:(e,t,r)=>{"use strict";r.d(t,{K:()=>n,V:()=>i});var s=r(64839),a=r(24982);const n={create:{method:"POST",path:"useractivity/Create",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1}};class i{constructor(e){this.executorFactory=e}create(e,t){return this.executorFactory.createExecutor(n.create).executeRequest({credentials:e,body:t})}}},42882:(e,t,r)=>{"use strict";r.d(t,{G:()=>i,_:()=>n});var s=r(64839),a=r(24982);const n={getConsents:{method:"POST",path:"userconsents/GetConsents",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1},updateConsents:{method:"POST",path:"userconsents/UpdateConsents",requestAcceptHeader:"application/json",responseType:"json",authType:s.d.USER_DEVICE,version:a.W.V1}};class i{constructor(e){this.executorFactory=e}getConsents(e,t){return this.executorFactory.createExecutor(n.getConsents).executeRequest({credentials:e,body:t})}updateConsents(e,t){return this.executorFactory.createExecutor(n.updateConsents).executeRequest({credentials:e,body:t})}}},63877:(e,t,r)=>{"use strict";var s,a,n;r.d(t,{ET:()=>a,qb:()=>n,y3:()=>s}),function(e){e.Admin="admin",e.Limited="limited"}(s||(s={})),function(e){e.USER="USER",e.TAC="TAC",e.AD="AD",e.SCIM="SCIM"}(a||(a={})),function(e){e.Pending="pending",e.Accepted="accepted",e.Refused="refused",e.Revoked="revoked"}(n||(n={}))},64839:(e,t,r)=>{"use strict";var s;r.d(t,{d:()=>s}),function(e){e.NONE="NONE",e.APP="App",e.USER_DEVICE="UserDevice",e.SESSION="Session",e.TEAM_DEVICE="TeamDevice",e.BACK_OFFICE="Backoffice",e.EXTERNAL="External",e.CUSTOM="Custom"}(s||(s={}))},24982:(e,t,r)=>{"use strict";var s;r.d(t,{W:()=>s}),function(e){e.V1="v1"}(s||(s={}))},96873:(e,t,r)=>{"use strict";r.d(t,{_:()=>a});var s=r(839);function a(e){return new Promise(((t,r)=>{if(!(0,s.Ez)("action.setBadgeBackgroundColor")&&!(0,s.Ez)("browserAction.setBadgeBackgroundColor"))return void r(new Error("No setBadgeBackgroundColor support"));(chrome.action?.setBadgeBackgroundColor??chrome.browserAction.setBadgeBackgroundColor)(e,(()=>{if(chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError",t=new Error(`action/setBadgeBackgroundColor: ${e}`);r(t)}else t()}))}))}},86554:(e,t,r)=>{"use strict";r.d(t,{d:()=>a});var s=r(839);function a(e){return new Promise(((t,r)=>{if(!(0,s.Ez)("action.setBadgeText")&&!(0,s.Ez)("browserAction.setBadgeText"))return void r(new Error("No setBadgeText support"));(chrome.action?.setBadgeText??chrome.browserAction.setBadgeText)(e,(()=>{if(chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError",t=new Error(`action/setBadgeText: ${e}`);r(t)}else t()}))}))}},16241:(e,t,r)=>{"use strict";r.d(t,{B:()=>a});var s=r(839);function a(e,t){return new Promise(((r,a)=>{if(!(0,s.Ez)("action.setIcon")&&!(0,s.Ez)("browserAction.setIcon"))return void a(new Error("No action.setIcon support"));(chrome.action?.setIcon??chrome.browserAction.setIcon)({path:e,tabId:t},(()=>{if(chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError",t=new Error(`action/setIcon: ${e}`);a(t)}else r()}))}))}},329:(e,t,r)=>{"use strict";r.d(t,{g:()=>a});var s=r(839);function a(e={}){return new Promise(((t,r)=>{(0,s.qX)(["cookies"])?(0,s.Ez)("cookies.getAll")?chrome.cookies.getAll(e,(e=>{if(chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError",t=new Error(`cookies/getAll: ${e}`);r(t)}else t(e)})):r(new Error("No cookies.getAll support")):r(new Error("No cookies.getAll support, permission is missing"))}))}},98641:(e,t,r)=>{"use strict";r.d(t,{O:()=>a});var s=r(839);function a(e){return new Promise(((t,r)=>{(0,s.qX)(["cookies"])?(0,s.Ez)("cookies.remove")?chrome.cookies.remove(e,(e=>{if(chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError",t=new Error(`cookies/remove: ${e}`);r(t)}else t(e)})):r(new Error("No cookies.remove support")):r(new Error("No cookies.remove support, permission is missing"))}))}},6212:(e,t,r)=>{"use strict";r.d(t,{z:()=>a});var s=r(839);function a(){return new Promise(((e,t)=>{(0,s.qX)(["declarativeNetRequest"])?(0,s.Ez)("declarativeNetRequest.getDynamicRules")?chrome.declarativeNetRequest.getDynamicRules((r=>{if(chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError",r=new Error(`declarativeNetRequest/getDynamicRules: ${e}`);t(r)}else e(r)})):t(new Error("No declarativeNetRequest.getDynamicRules support")):t(new Error("No declarativeNetRequest.getDynamicRules support, permission is missing"))}))}},25417:(e,t,r)=>{"use strict";r.d(t,{G:()=>a});var s=r(839);function a(){return(0,s.Ez)("declarativeNetRequest")&&(0,s.qX)(["declarativeNetRequest"])}},84867:(e,t,r)=>{"use strict";r.d(t,{O:()=>a});var s=r(839);function a(e){return new Promise(((t,r)=>{(0,s.qX)(["declarativeNetRequest"])?(0,s.Ez)("declarativeNetRequest.updateDynamicRules")?chrome.declarativeNetRequest.updateDynamicRules(e,(()=>{if(chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError",t=new Error(`declarativeNetRequest/updateDynamicRules: ${e}`);r(t)}else t()})):r(new Error("No declarativeNetRequest.updateDynamicRules support")):r(new Error("No declarativeNetRequest.updateDynamicRules support, permission is missing"))}))}},839:(e,t,r)=>{"use strict";r.d(t,{Ez:()=>n,qX:()=>a});var s=r(84318);function a(e){const t=(0,s.W)().permissions??[];return e.every((e=>t.includes(e)))}function n(e){if("undefined"==typeof chrome)return!1;const t=e.split(".").reduce(((e,t)=>e?.[t]),chrome);return Boolean(t)}},13090:(e,t,r)=>{"use strict";r.d(t,{e:()=>a});var s=r(839);const a={addListener:function(e){if(!(0,s.qX)(["idle"]))throw new Error("No idle.onStateChanged.addListener support, permission is missing");if(!(0,s.Ez)("idle.onStateChanged.addListener"))throw new Error("No idle.onStateChanged.addListener support");const t=t=>{if(chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError";throw new Error(`idle/onStateChanged: ${e}`)}return e(t)};return chrome.idle.onStateChanged.addListener(t),t},removeListener:function(e){if(!(0,s.qX)(["idle"]))throw new Error("No idle.onStateChanged.removeListener support, permission is missing");if(!(0,s.Ez)("idle.onStateChanged.removeListener"))throw new Error("No idle.onStateChanged.removeListener support");chrome.idle.onStateChanged.removeListener(e)}}},54422:(e,t,r)=>{"use strict";r.d(t,{X:()=>a});var s=r(839);function a(e){if(!(0,s.qX)(["idle"]))throw new Error("No idle.setDetectionInterval support, permission is missing");if(!(0,s.Ez)("idle.setDetectionInterval"))throw new Error("No idle.setDetectionInterval support");chrome.idle.setDetectionInterval(e)}},82324:(e,t,r)=>{"use strict";r.d(t,{I:()=>a,b:()=>n});var s=r(74972);function a(e){if("object"!=typeof e||!e)return!1;return!!("reason"in e)&&e.reason===s.$.RuntimeError}function n(e){if("object"!=typeof e||!e)return!1;return!!("reason"in e)&&e.reason===s.$.SettingNotSupported}},30754:(e,t,r)=>{"use strict";r.d(t,{U:()=>i});var s=r(839),a=r(74972);const n={reason:a.$.SettingNotSupported};function i(e){return new Promise(((t,r)=>{(0,s.qX)(["privacy"])&&(0,s.Ez)(`privacy.services.${e}.get`)?chrome.privacy.services[e].get({},(e=>{if(chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError",t={reason:a.$.RuntimeError,runtimeError:new Error(e)};r(t)}else t(e)})):r(n)}))}},74972:(e,t,r)=>{"use strict";var s;r.d(t,{$:()=>s}),function(e){e.RuntimeError="runtimeError",e.SettingNotSupported="settingNotSupported"}(s||(s={}))},81805:(e,t,r)=>{"use strict";r.d(t,{t:()=>i});var s=r(839),a=r(74972);const n={reason:a.$.SettingNotSupported};function i(e,t){return new Promise(((r,i)=>{(0,s.qX)(["privacy"])&&(0,s.Ez)(`privacy.services.${e}.set`)?chrome.privacy.services[e].set({value:t},(()=>{if(chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError",t={reason:a.$.RuntimeError,runtimeError:new Error(e)};i(t)}else r()})):i(n)}))}},84318:(e,t,r)=>{"use strict";r.d(t,{W:()=>a});var s=r(839);function a(){if(!(0,s.Ez)("runtime.getManifest"))throw new Error("No runtime.getManifest support");return chrome.runtime.getManifest()}},92204:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});var s=r(839);function a(e){if(!(0,s.Ez)("runtime.getURL"))throw new Error("No runtime.getURL support");return chrome.runtime.getURL(e)}},20500:(e,t,r)=>{"use strict";r.d(t,{b:()=>a});var s=r(839);const a={addListener:function(e){if(!(0,s.Ez)("runtime.onConnect.addListener"))throw new Error("No runtime.onConnect.addListener support");const t=t=>{if(chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError";throw new Error(`runtime/onConnect: ${e}`)}return e(t)};return chrome.runtime.onConnect.addListener(t),t},removeListener:function(e){if(!(0,s.Ez)("runtime.onConnect.removeListener"))throw new Error("No runtime.onConnect.removeListener support");chrome.runtime.onConnect.removeListener(e)}}},23386:(e,t,r)=>{"use strict";r.d(t,{Y:()=>a});var s=r(839);const a={addListener:function(e){if(!(0,s.Ez)("runtime.onInstalled.addListener"))throw new Error("No runtime.onInstalled.addListener support");chrome.runtime.onInstalled.addListener((t=>{if(chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError";throw new Error(`runtime/onInstalled: ${e}`)}return e(t)}))}}},56386:(e,t,r)=>{"use strict";r.d(t,{H:()=>a});var s=r(839);function a(){if(!(0,s.Ez)("runtime.reload"))throw new Error("No runtime.reload support");chrome.runtime.reload()}},2927:(e,t,r)=>{"use strict";r.d(t,{S:()=>a});var s=r(839);function a(e){if(!(0,s.Ez)("runtime.setUninstallURL"))throw new Error("No runtime.setUninstallURL support");chrome.runtime.setUninstallURL(e)}},21763:(e,t,r)=>{"use strict";r.d(t,{k:()=>n});var s=r(839);const a=(e,t)=>()=>{if(chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError",r=new Error(`scripting/executeScript: ${e}`);t(r)}else e()};function n(e,t){return(0,s.Ez)("scripting.executeScript")?function(e,t){return new Promise(((r,s)=>{const n=t??a(r,s);chrome.scripting.executeScript(e,n)}))}(e,t):(0,s.Ez)("tabs.executeScript")?function(e,t){return new Promise(((r,s)=>{const n=t??a(r,s),i={allFrames:e.target.allFrames,file:void 0,frameId:e.target.frameIds?.[0],runAt:"document_start"};"func"in e?i.code=e.func.toString():i.file=e.files[0],chrome.tabs.executeScript(e.target.tabId,i,n)}))}(e,t):Promise.reject(new Error("No scripting.executeScript support"))}},39680:(e,t,r)=>{"use strict";r.d(t,{G:()=>a,y:()=>n});var s=r(839);function a(){return!!chrome.storage?.local.getBytesInUse}function n(e){return new Promise(((t,r)=>{(0,s.qX)(["storage"])?(0,s.Ez)("storage.local.getBytesInUse")?chrome.storage.local.getBytesInUse(e,(e=>{if(chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError",t=new Error(`storage/local/getBytesInUse: ${e}`);r(t)}else t(e)})):r(new Error("No storage.local.getBytesInUse support")):r(new Error("No storage.local.getBytesInUse support, permission is missing"))}))}},41808:(e,t,r)=>{"use strict";r.d(t,{U:()=>a});var s=r(839);function a(e){return new Promise(((t,r)=>{(0,s.qX)(["storage"])?(0,s.Ez)("storage.local.get")?chrome.storage.local.get(e,(e=>{if(chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError",t=new Error(`storage/local/get: ${e}`);r(t)}else t(e)})):r(new Error("No storage.local.get support")):r(new Error("No storage.local.get support, permission is missing"))}))}},45441:(e,t,r)=>{"use strict";r.d(t,{O:()=>a});var s=r(839);function a(e){return new Promise(((t,r)=>{(0,s.qX)(["storage"])?(0,s.Ez)("storage.local.remove")?chrome.storage.local.remove(e,(()=>{if(chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError",t=new Error(`storage/local/remove: ${e}`);r(t)}else t()})):r(new Error("No storage.local.remove support")):r(new Error("No storage.local.remove support, permission is missing"))}))}},9244:(e,t,r)=>{"use strict";r.d(t,{t:()=>a});var s=r(839);function a(e){return new Promise(((t,r)=>{(0,s.qX)(["storage"])?(0,s.Ez)("storage.local.set")?chrome.storage.local.set(e,(()=>{if(chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError",t=new Error(`storage/local/set: ${e}`);r(t)}else t()})):r(new Error("No storage.local.set support")):r(new Error("No storage.local.set support, permission is missing"))}))}},15026:(e,t,r)=>{"use strict";r.d(t,{U:()=>a});var s=r(839);function a(e){return new Promise(((t,r)=>{(0,s.qX)(["storage"])?(0,s.Ez)("storage.session.get")?chrome.storage.session.get(e,(e=>{if(chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError",t=new Error(`storage/session/get: ${e}`);r(t)}t(e)})):r(new Error("No storage.session.get support")):r(new Error("No storage.session.get support, permission is missing"))}))}},32012:(e,t,r)=>{"use strict";r.d(t,{G:()=>n});var s=r(839),a=r(84318);function n(){return(0,s.Ez)("storage.session")&&(0,s.qX)(["storage"])&&3===(0,a.W)().manifest_version}},52477:(e,t,r)=>{"use strict";r.d(t,{O:()=>a});var s=r(839);function a(e){return new Promise(((t,r)=>{(0,s.qX)(["storage"])?(0,s.Ez)("storage.session.remove")?chrome.storage.session.remove(e,(()=>{if(chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError",t=new Error(`storage/session/remove: ${e}`);r(t)}t()})):r(new Error("No storage.session.remove support")):r(new Error("No storage.session.remove support, permission is missing"))}))}},56847:(e,t,r)=>{"use strict";r.d(t,{t:()=>a});var s=r(839);function a(e){return new Promise(((t,r)=>{(0,s.qX)(["storage"])?(0,s.Ez)("storage.session.set")?chrome.storage.session.set(e,(()=>{if(chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError",t=new Error(`storage/session/set: ${e}`);r(t)}t()})):r(new Error("No storage.session.set support")):r(new Error("No storage.session.set support, permission is missing"))}))}},24715:(e,t,r)=>{"use strict";r.d(t,{U:()=>a});var s=r(839);function a(e){return new Promise(((t,r)=>{(0,s.Ez)("tabs.create")?chrome.tabs.create(e,(e=>{if(chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError",t=new Error(`tabs/create: ${e}`);r(t)}else t(e)})):r(new Error("No tabs.create support"))}))}},61222:(e,t,r)=>{"use strict";r.d(t,{I:()=>a});var s=r(839);function a(e){return new Promise(((t,r)=>{(0,s.qX)(["tabs"])?(0,s.Ez)("tabs.query")?chrome.tabs.query(e,(e=>{if(chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError",t=new Error(`tabs/query: ${e}`);r(t)}else t(e)})):r(new Error("No tabs.query support")):r(new Error("No tabs.query support, permission is missing"))}))}},49259:(e,t,r)=>{"use strict";r.d(t,{O:()=>a});var s=r(839);function a(e){return new Promise(((t,r)=>{(0,s.Ez)("tabs.remove")?chrome.tabs.remove(e,(()=>{if(chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError",t=new Error(`tabs/remove: ${e}`);r(t)}else t()})):r(new Error("No tabs.remove support"))}))}},31460:(e,t,r)=>{"use strict";r.d(t,{V:()=>a});var s=r(839);function a(e,t){return new Promise(((r,a)=>{(0,s.Ez)("tabs.update")?chrome.tabs.update(e,t,(e=>{if(chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError",t=new Error(`tabs/update: ${e}`);a(t)}else r(e)})):a(new Error("No tabs.update support"))}))}},48291:(e,t,r)=>{"use strict";r.d(t,{a:()=>n});var s=r(65881),a=r(839);const n={addListener:function(e,t,r){const n=r?.includes(s.X.Blocking)?["webRequest","webRequestBlocking"]:["webRequest"];if(!(0,a.qX)(n))throw new Error("No webRequest.onBeforeRequest.addListener support, permission is missing");if(!(0,a.Ez)("webRequest.onBeforeRequest.addListener"))throw new Error("No webRequest.onBeforeRequest.addListener support");const i=t=>{if(chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError";throw new Error(`webRequest/onBeforeRequest: ${e}`)}return e(t)};return chrome.webRequest.onBeforeRequest.addListener(i,t,r),i},hasListener:function(e){if(!(0,a.qX)(["webRequest","webRequestBlocking"]))throw new Error("No webRequest.onBeforeRequest.hasListener support, permission is missing");if(!(0,a.Ez)("webRequest.onBeforeRequest.hasListener"))throw new Error("No webRequest.onBeforeRequest support");return chrome.webRequest.onBeforeRequest.hasListener(e)},removeListener:function(e){if(!(0,a.qX)(["webRequest"]))throw new Error("No webRequest.onBeforeRequest.removeListener support, permission is missing");if(!(0,a.Ez)("webRequest.onBeforeRequest.removeListener"))throw new Error("No webRequest.onBeforeRequest support");chrome.webRequest.onBeforeRequest.removeListener(e)}}},65881:(e,t,r)=>{"use strict";var s;r.d(t,{X:()=>s}),function(e){e.Blocking="blocking",e.RequestBody="requestBody"}(s||(s={}))},72733:(e,t,r)=>{"use strict";r.d(t,{T:()=>a});var s=r(839);function a(e){return new Promise(((t,r)=>{if(!(0,s.Ez)("windows.getCurrent"))return void r(new Error("No windows.getCurrent support"));const a=e=>{if(chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError",t=new Error(`windows/getCurrent: ${e}`);r(t)}else t(e)};e?chrome.windows.getCurrent(e,a):chrome.windows.getCurrent(a)}))}},57306:(e,t,r)=>{"use strict";r.d(t,{V:()=>a});var s=r(839);function a(e,t){return new Promise(((r,a)=>{(0,s.Ez)("windows.update")?chrome.windows.update(e,t,(e=>{if(chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError",t=new Error(`windows/update: ${e}`);a(t)}else r(e)})):a(new Error("No windows.update support"))}))}},34573:()=>{},19381:()=>{},86585:()=>{},1342:()=>{},22324:()=>{},17978:()=>{},98814:()=>{},97961:()=>{},3275:()=>{},63619:()=>{},25387:()=>{},46332:()=>{},48263:()=>{},1973:()=>{},43350:()=>{}}]);