"use strict";(globalThis.webpackChunk_dashlane_leeloo=globalThis.webpackChunk_dashlane_leeloo||[]).push([[2634],{368021:(e,t,a)=>{a.r(t),a.d(t,{CredentialAddPanel:()=>q}),a(461238);var i=a(526849),n=a(66941),s=a(947843),r=a(988799),o=a(696832),l=a(453576),c=a(592233),d=a(112555),u=a(482598),m=a(299074),p=a(96862),C=a(886025),w=a(441217),g=a(201389),S=a(787268),y=a(62429),h=a(635164),I=a(796446),v=a(352116),P=a(849399),f=a(819978),b=a(111768),k=a(383849),T=a.n(k);const _=()=>{const{translate:e}=(0,g.Z)();return(0,b.tZ)(I.V9,{icon:(0,b.tZ)("div",{className:T()("icon--gEZfcCvjSg","dummyIcon--ix6eIwyFEN")}),title:e("webapp_credential_addition_website")})};var E;const V=["name","website"],A={name:"title",website:"url"};var N=a(889483);const U=()=>({filterToken:{filterCriteria:[]},sortToken:{sortCriteria:[],uniqField:"id"}}),D={live:n.C.liveCredentialsCount,liveParam:(0,i.compose)(btoa,JSON.stringify,U),query:n.C.getCredentialsCount,queryParam:U},L={activeSpaces:{query:n.C.getActiveSpaces},credentialsCount:D,premiumStatus:{live:n.C.livePremiumStatus,query:n.C.getPremiumStatus}},B={strategies:L},O=(0,N.DP)((({activeSpaces:e,premiumStatus:t,onClose:a,protectedItemsUnlockerShown:i,openProtectedItemsUnlocker:s,areProtectedItemsUnlocked:r})=>{var b,k;const T=(0,o.createRef)(),[N,U]=(0,o.useState)(!1),{routes:D}=(0,h.Xo)(),{currentSpaceId:L}=(0,v.fV)(),B=(0,S.V)(),{translate:O}=(0,g.Z)(),{wrap:q}=(0,d.u)(),{createCollection:W,updateCollection:F}=(0,u.u)(m.v),{addItemToCollections:R}=(0,u.u)(C.a),[Z,M]=(0,o.useState)(!1),[H,K]=o.useState(!1),x=(0,h.TH)(),X=(0,o.useRef)(x.state?.previouslyGeneratedPassword),[j,z]=(0,o.useState)(Boolean(X.current)),G=()=>{const{capabilities:e}=t;return Boolean(e?.passwordsLimit?.info?.limit)},J=async()=>{const e=await n.C.getCredentialsCount({filterToken:{filterCriteria:[]},sortToken:{sortCriteria:[],uniqField:"id"}}),a=(e=>{var t;return null!=(t=e?.capabilities?.passwordsLimit?.info?.limit)?t:0})(t);return a-e},$=()=>{(0,y.Nc)(c.PageView.ItemCredentialList),a?a():(0,h.uX)(D.userCredentials)};o.useEffect((()=>{G()&&(async()=>{await J()<=0&&M(!0)})(),(0,y.Nc)(c.PageView.ItemCredentialCreate)}),[]);const Q=(()=>{const e=(0,h.CN)();return V.reduce(((t,a)=>(t[A[a]||a]=e.get(a),t)),{})})(),Y={...Q,url:null!=(b=x.state?.website)?b:Q.url,password:null!=(k=X.current)?k:""},ee={...(e=>({autoLogin:!0,autoProtected:!1,category:"",email:"",id:"",limitedPermissions:!1,login:"",note:"",onlyForThisSubdomain:!1,otpSecret:"",otpUrl:"",password:"",protectWithMasterPassword:!1,secondaryLogin:"",spaceId:e,subdomainOnly:!1,title:"",type:"KWAuthentifiant",url:"",linkedWebsites:{addedByDashlane:[],addedByUser:[]}}))(L),...Y};return o.createElement(I.zI,{isViewingExistingItem:!1,isSomeDialogOpen:H,itemHasBeenEdited:j,onSubmit:async()=>{const e=T.current?.getState();Boolean(T.current?.isFormValid())&&e&&(U(!0),await(async e=>{const t=T.current?.getVaultItemCollections(),a={kwType:"KWAuthentifiant",origin:l.SaveOrigin.MANUAL,content:e,shouldSkipSync:t?.some((e=>e.isShared))},i=await n.C.savePersonalDataItem(a);i.success&&t?.length&&await q((()=>(async(e,t)=>{const a=[];for(const i of t)i.isShared?a.push(i.id):(i.vaultItems=[{id:e,type:l.DataModelType.KWAuthentifiant}],i.id?await F({id:i.id,collection:i,operationType:p.C.APPEND_VAULT_ITEMS}):await W({content:i}));a.length&&await R({collectionIds:a,itemId:e})})(i.itemId,t)),(()=>{B.showAlert(O("_common_generic_error"),w.BLW.ERROR)}))()})(e),G()&&await J()<=0?M(!0):$())},onNavigateOut:$,formId:"add_credential_panel",header:E||(E=o.createElement(_,null)),submitPending:N},o.createElement(P.S,{ref:T,values:ee,isNewItem:!0,signalEditedValues:()=>z(!0),additionalProps:{activeSpaces:e,areProtectedItemsUnlocked:r,openProtectedItemsUnlocker:s,protectedItemsUnlockerShown:i,setHasOpenedDialogs:K}}),Z&&o.createElement(f.e,{isVisible:Z,handleDismiss:()=>$()}))})),q=(0,s.$)((0,r.i)(O,B),L)}}]);